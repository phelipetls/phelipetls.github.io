<!DOCTYPE html>
<html class="h-full min-h-0 text-base sm:text-lg selection:bg-primary selection:text-on-primary scroll-smooth scroll-pt-nav-height sm:scroll-pt-0" lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="deploy-date" content="2023-08-12">
    <meta name="author" content="Phelipe Teles">
    <meta name="color-scheme" content="dark light">

    <title>Ansible for dotfiles: the introduction I wish I've had - Phelipe Teles | Phelipe Teles</title>



<link rel="canonical" href="https://phelipetls.github.io/posts/introduction-to-ansible/">

<meta name="description" content="A dotfiles repo will help you manage configuration over time and synchronize
them across machines, but it won’t help you with your dependencies — you still
have to install git, tmux, vim, etc. Let’s see how Ansible can help with that.">

<meta name="robots" content="index, follow">

<meta property="og:title" content="Ansible for dotfiles: the introduction I wish I've had">
<meta property="og:type" content="article">
<meta property="og:image" content="/posts/introduction-to-ansible/image.png">
<meta property="og:url" content="https://phelipetls.github.io/posts/introduction-to-ansible/">


<meta property="article:published_time" content="2022-05-26T00:00:00Z">


<meta property="article:author" content="Phelipe Teles">

<meta property="article:tag" content="ansible"><meta property="article:tag" content="linux"><meta property="article:tag" content="fedora"><meta property="article:tag" content="ubuntu"><meta property="article:tag" content="macos">
<meta name="twitter:card" content="summary_large_image">



<meta content="/posts/introduction-to-ansible/image.png" name="twitter:image">

    
    <meta name="publish-date" content="2022-05-26">
    <meta name="keywords" content="ansible, linux, fedora, ubuntu, macos"><meta name="description" content="A dotfiles repo will help you manage configuration over time and synchronize
them across machines, but it won’t help you with your dependencies — you still
have to install git, tmux, vim, etc. Let’s see how Ansible can help with that.">

    <style id="sandpack">--sxs{--sxs:1 sp-k-eyOShd sp-k-iOHdLQ}@media{@keyframes sp-k-eyOShd{0%{opacity:0}100%{opacity:1}}@keyframes sp-k-iOHdLQ{0%{transform:rotateX(-25.5deg) rotateY(45deg)}100%{transform:rotateX(-25.5deg) rotateY(405deg)}}}--sxs{--sxs:2 sp-c-gMfcns sp-c-bxeRRt sp-c-hfoyCM sp-c-fWymNx sp-c-euXojQ sp-c-bpmgvy sp-c-PJLV}@media{.sp-c-gMfcns svg{margin:auto}.sp-c-bxeRRt{-webkit-appearance:none;appearance:none;outline:none;display:flex;align-items:center;font-size:inherit;font-family:inherit;background-color:transparent;transition:color var(--sp-transitions-default), background var(--sp-transitions-default);cursor:pointer;color:var(--sp-colors-clickable);border:0;text-decoration:none}.sp-c-bxeRRt:disabled{color:var(--sp-colors-disabled)}.sp-c-bxeRRt:hover:not(:disabled,[data-active='true']){color:var(--sp-colors-hover)}.sp-c-bxeRRt[data-active="true"]{color:var(--sp-colors-accent)}.sp-c-bxeRRt svg{min-width:var(--sp-space-4);width:var(--sp-space-4);height:var(--sp-space-4)}.sp-c-bxeRRt.sp-c-gMfcns{padding:var(--sp-space-1);height:var(--sp-space-7);display:flex}.sp-c-bxeRRt.sp-c-gMfcns.sp-c-bxeRRt:not(:has(span)){width:var(--sp-space-7)}.sp-c-bxeRRt.sp-c-gMfcns.sp-c-bxeRRt:has(svg + span){padding-right:var(--sp-space-3);padding-left:var(--sp-space-2);gap:var(--sp-space-1)}.sp-c-hfoyCM{padding:0 var(--sp-space-1) 0 var(--sp-space-1);border-radius:var(--sp-border-radius);margin-left:var(--sp-space-1);width:var(--sp-space-5);visibility:hidden}.sp-c-hfoyCM svg{width:var(--sp-space-3);height:var(--sp-space-3);display:block;position:relative;top:1px}.sp-c-fWymNx{margin:0;display:block;font-family:var(--sp-font-mono);font-size:var(--sp-font-size);color:var(--sp-syntax-color-plain);line-height:var(--sp-font-lineHeight)}.sp-c-euXojQ{display:flex;flex-direction:column;width:100%;position:relative;background-color:var(--sp-colors-surface1);gap:1px}.sp-c-euXojQ:has(.sp-stack){background-color:var(--sp-colors-surface2)}.sp-c-bpmgvy{transform:translate(-4px, 9px) scale(0.13, 0.13)}.sp-c-bpmgvy *{position:absolute;width:96px;height:96px}}--sxs{--sxs:3 sp-c-PJLV-kCOVwI-status-pass sp-c-PJLV-kEzYsr-status-fail sp-c-PJLV-gHAhSA-status-skip sp-c-PJLV-jgnHyR-status-title sp-c-PJLV-iCgxLS-status-run sp-c-PJLV-bnDZSy-status-pass sp-c-PJLV-eYuGwt-status-fail}@media{.sp-c-PJLV-kCOVwI-status-pass{color:var(--test-pass)}.sp-c-PJLV-kEzYsr-status-fail{color:var(--test-fail)}.sp-c-PJLV-gHAhSA-status-skip{color:var(--test-skip)}.sp-c-PJLV-jgnHyR-status-title{color:var(--test-title)}.sp-c-PJLV-iCgxLS-status-run{background:var(--test-run);color:var(--sp-colors-surface1)}.sp-c-PJLV-bnDZSy-status-pass{background:var(--test-pass);color:var(--sp-colors-surface1)}.sp-c-PJLV-eYuGwt-status-fail{background:var(--test-fail);color:var(--sp-colors-surface1)}}</style>
  
  <link rel="stylesheet" href="/_astro/_id_.133d5e89.css" />
<link rel="stylesheet" href="/_astro/_id_.f7b41e74.css" /><script type="module" src="/_astro/hoisted.12f342b6.js"></script></head>

  <body data-preload class="relative flex h-full flex-col bg-background font-sans text-on-background">
    <script>
  // @ts-check
  const storedThemeChoice = window.localStorage.getItem('__theme') ?? 'system'

  window.__setTheme = setTheme
  // prettier-ignore
  window.__setTheme(/** @type {ThemeChoice} */ (storedThemeChoice))

  /**
   * @type {(themeChoice: ThemeChoice) => void}
   */
  function setTheme(themeChoice) {
    let theme = themeChoice

    if (themeChoice === 'system') {
      theme = window.matchMedia('(prefers-color-scheme: dark)').matches
        ? 'dark'
        : 'light'
    }

    document.body.classList.toggle('dark', theme === 'dark')

    window.localStorage.setItem('__theme', themeChoice)

    document.body.dispatchEvent(
      new CustomEvent('newTheme', {
        detail: {
          themeChoice,
          theme,
        },
      })
    )
  }

  window.addEventListener('storage', function (e) {
    const newTheme = e.newValue
    if (newTheme && newTheme && e.key === '__theme') {
      // prettier-ignore
      window.__setTheme(/** @type {ThemeChoice} */ (newTheme))
    }
  })

  window.addEventListener('load', function () {
    document.querySelectorAll('[data-preload]').forEach((elem) => {
      elem.removeAttribute('data-preload')
    })
  })
</script>

    <div class="w-full">
  <div class="pt-nav-height sm:hidden">
    <div class="fixed top-0 left-0 z-30 flex w-screen justify-between rounded-none border-b border-divider bg-background/90 py-4 px-horizontal-padding backdrop-blur">
  <div class="flex flex-row items-center gap-2">
    <a href="/posts/" data-testid="parent-page-link" aria-label="Go back to previous page">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left"><polyline points="15 18 9 12 15 6"></polyline></svg>
        </a>

    <h2 class="m-0 truncate font-sans font-normal">Ansible for dotfiles: the introduction I wish I&#39;ve had - Phelipe Teles</h2>
  </div>

  <button type="button" class="hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 min-w-[40px] h-[40px] flex justify-center items-center rounded-full px-2 bg-transparent" data-a11y-dialog-show="sidenav" data-testid="open-sidenav" aria-label="Open navigation sidebar">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg>
  </button>
</div>
  </div>

  <div class="hidden h-full w-full sm:block">
    <div class="flex w-full items-center justify-between pr-horizontal-padding">
  <div class="mx-auto flex w-full max-w-content justify-between">
    <nav class="flex justify-between pl-horizontal-padding" aria-label="Main navigation">
      <ul class="m-0 flex flex-row list-none gap-2">
        <li>
                <a id="about" href="/" class="p-2 inline-block h-full w-full group">
                  <span class="underline underline-offset-8 decoration-2 decoration-transparent group-hover:decoration-hover">
                    About
                  </span>
                </a>
              </li><li>
                <a id="posts" href="/posts" class="p-2 inline-block h-full w-full group" aria-current="page">
                  <span class="underline underline-offset-8 decoration-2 decoration-primary group-hover:decoration-primary-hover">
                    Posts
                  </span>
                </a>
              </li>
      </ul>
    </nav>

    <div class="flex flex-row items-center gap-2">
      

      <div style="--cols:3" class="rounded items-center grid grid-cols-[repeat(var(--cols),1fr)] bg-surface shadow-sm shadow-shadow">
  <select class="py-1 sm:py-0 rounded bg-inherit appearance-none text-center row-start-1 col-[1_/_calc(var(--cols)+1)] px-8" data-theme-select aria-label="Choose a theme">
    
  <option value="light">Light</option>
  <option value="dark">Dark</option>
  <option value="system">System</option>

  

  </select>

  <span class="pointer-events-none col-start-1 row-start-1 px-1 text-sm">
        <svg class="feather" viewBox="0 0 24 24" width="24" height="24">
    <title>Theme icon</title>

    <defs>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon" id="moon"><path d="M12 3a6.364 6.364 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun" id="sun"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-monitor" id="monitor"><rect width="20" height="14" x="2" y="3" rx="2" ry="2"></rect><line x1="8" x2="16" y1="21" y2="21"></line><line x1="12" x2="12" y1="17" y2="21"></line></svg>
    </defs>

    <use data-theme-select-icon href="#monitor"></use>
  </svg>
      </span>

  <span class="flex flex-row justify-end pointer-events-none text-sm row-start-1 px-1 col-[var(--cols)_/_var(--cols)]">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down" slot="end-icon"><polyline points="6 9 12 15 18 9"></polyline></svg>
  </span>
</div>
    </div>
  </div>
</div>
  </div>
</div>
    <aside data-a11y-dialog="sidenav" aria-hidden="true" class="fixed z-50 h-full w-full" style="visibility: hidden;">
  <div data-a11y-dialog-hide class="fixed inset-0 -z-1 w-full bg-neutral-700 bg-opacity-75 backdrop-blur-sm">
  </div>

  <div role="document" class="ml-auto h-full flex flex-col w-3/4 rounded-none bg-background py-0 will-change-transform">
    <div class="mb-2 flex h-nav-height items-center justify-end px-horizontal-padding">
      <button type="button" data-a11y-dialog-hide="true" aria-label="Close" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 min-w-[40px] h-[40px] flex justify-center items-center rounded-full px-2">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><line x1="18" x2="6" y1="6" y2="18"></line><line x1="6" x2="18" y1="6" y2="18"></line></svg>
      </button>
    </div>

    <nav class="flex flex-col" aria-label="Main navigation">
      <ul class="m-0 flex list-none flex-col items-center justify-center gap-2 px-horizontal-padding">
        <li class="w-full">
                <a id="about" href="/" class="flex items-center justify-center flex-row gap-2 transition-colors duration-300 hover:bg-hover disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled rounded py-1 px-2 bg-background text-on-background">About</a>
              </li><li class="w-full">
                <a id="posts" href="/posts" aria-current="page" class="flex items-center justify-center flex-row gap-2 transition-colors duration-300 disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled rounded py-1 px-2 bg-primary text-on-primary hover:bg-primary-hover shadow-sm shadow-shadow">Posts</a>
              </li>
      </ul>
    </nav>

    <div class="flex flex-col gap-2 pb-4 mt-auto px-horizontal-padding [&_div]:flex-1">
      <div style="--cols:3" class="rounded items-center grid grid-cols-[repeat(var(--cols),1fr)] bg-background">
  <select class="py-1 sm:py-0 rounded bg-inherit appearance-none text-center row-start-1 col-[1_/_calc(var(--cols)+1)] px-8" data-language-select aria-label="Choose a language">
    
  <option selected="true" value="en">English</option>
  <option value="pt">Português</option>

  

  </select>

  <span class="pointer-events-none col-start-1 row-start-1 px-1 text-sm">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-languages" slot="start-icon"><path d="m5 8 6 6"></path><path d="m4 14 6-6 2-3"></path><path d="M2 5h12"></path><path d="M7 2h1"></path><path d="m22 22-5-10-5 10"></path><path d="M14 18h6"></path></svg>
      </span>

  <span class="flex flex-row justify-end pointer-events-none text-sm row-start-1 px-1 col-[var(--cols)_/_var(--cols)]">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down" slot="end-icon"><polyline points="6 9 12 15 18 9"></polyline></svg>
  </span>
</div>
      <div style="--cols:3" class="rounded items-center grid grid-cols-[repeat(var(--cols),1fr)] bg-surface shadow-sm shadow-shadow">
  <select class="py-1 sm:py-0 rounded bg-inherit appearance-none text-center row-start-1 col-[1_/_calc(var(--cols)+1)] px-8" data-theme-select aria-label="Choose a theme">
    
  <option value="light">Light</option>
  <option value="dark">Dark</option>
  <option value="system">System</option>

  

  </select>

  <span class="pointer-events-none col-start-1 row-start-1 px-1 text-sm">
        <svg class="feather" viewBox="0 0 24 24" width="24" height="24">
    <title>Theme icon</title>

    <defs>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon" id="moon"><path d="M12 3a6.364 6.364 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun" id="sun"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-monitor" id="monitor"><rect width="20" height="14" x="2" y="3" rx="2" ry="2"></rect><line x1="8" x2="16" y1="21" y2="21"></line><line x1="12" x2="12" y1="17" y2="21"></line></svg>
    </defs>

    <use data-theme-select-icon href="#monitor"></use>
  </svg>
      </span>

  <span class="flex flex-row justify-end pointer-events-none text-sm row-start-1 px-1 col-[var(--cols)_/_var(--cols)]">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down" slot="end-icon"><polyline points="6 9 12 15 18 9"></polyline></svg>
  </span>
</div>
    </div>
  </div>
</aside>

    
  

  <main class="grid grid-cols-layout">
    <div class="pt-8 sm:col-content px-0">
      <article>
        <header class="flex flex-col">
          <h1 class="mb-4 text-4xl max-w-prose">
            Ansible for dotfiles: the introduction I wish I&#39;ve had
          </h1>

          <div class="mb-4 flex gap-2 flex-row">
            <div class="flex items-center gap-2">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect><line x1="16" x2="16" y1="2" y2="6"></line><line x1="8" x2="8" y1="2" y2="6"></line><line x1="3" x2="21" y1="10" y2="10"></line></svg>

  <time datetime="2022-05-26">
    May 26
  </time>
</div>
            <div class="flex items-center gap-2">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-timer"><line x1="10" x2="14" y1="2" y2="2"></line><line x1="12" x2="15" y1="14" y2="11"></line><circle cx="12" cy="14" r="8"></circle></svg>

  <div>14 min.</div>
</div>
          </div>

          <div class="mb-4 flex max-w-lg flex-wrap gap-2">
                <a class="inline-flex gap-2 w-fit items-center justify-center rounded-full border border-divider bg-surface px-4 no-underline shadow-sm shadow-shadow transition-colors duration-300 hover:border-divider hover:bg-hover whitespace-nowrap [&#38;_svg]:w-[1em] [&#38;_svg]:h-[1em] order-2" href="/tags/ansible">
  

  ansible

  
</a><a class="inline-flex gap-2 w-fit items-center justify-center rounded-full border border-divider bg-surface px-4 no-underline shadow-sm shadow-shadow transition-colors duration-300 hover:border-divider hover:bg-hover whitespace-nowrap [&#38;_svg]:w-[1em] [&#38;_svg]:h-[1em] order-2" href="/tags/linux">
  

  linux

  
</a><a class="inline-flex gap-2 w-fit items-center justify-center rounded-full border border-divider bg-surface px-4 no-underline shadow-sm shadow-shadow transition-colors duration-300 hover:border-divider hover:bg-hover whitespace-nowrap [&#38;_svg]:w-[1em] [&#38;_svg]:h-[1em] order-2" href="/tags/fedora">
  

  fedora

  
</a><a class="inline-flex gap-2 w-fit items-center justify-center rounded-full border border-divider bg-surface px-4 no-underline shadow-sm shadow-shadow transition-colors duration-300 hover:border-divider hover:bg-hover whitespace-nowrap [&#38;_svg]:w-[1em] [&#38;_svg]:h-[1em] order-2" href="/tags/ubuntu">
  

  ubuntu

  
</a><a class="inline-flex gap-2 w-fit items-center justify-center rounded-full border border-divider bg-surface px-4 no-underline shadow-sm shadow-shadow transition-colors duration-300 hover:border-divider hover:bg-hover whitespace-nowrap [&#38;_svg]:w-[1em] [&#38;_svg]:h-[1em] order-2" href="/tags/macos">
  

  macos

  
</a>

                <a class="inline-flex gap-2 w-fit items-center justify-center rounded-full border border-divider bg-surface px-4 no-underline shadow-sm shadow-shadow transition-colors duration-300 hover:border-divider hover:bg-hover whitespace-nowrap [&#38;_svg]:w-[1em] [&#38;_svg]:h-[1em] order-2" href="/tags">
  

  ...

  
</a>
              </div>
        </header>

        <hr class="my-8">

        <div data-blog-post-container data-toc="open" class="group flex flex-col lg:gap-8 lg:flex-row-reverse">
          <aside style="--offset-from-top:1rem" class="relative mb-8 lg:ml-auto lg:mb-0 lg:basis-1/3 lg:sticky lg:top-[var(--offset-from-top)] lg:h-[calc(100vh-var(--offset-from-top)_*_2)]">
                <button type="button" data-toggle-toc="true" data-open-toc-label="Open table of contents" data-closed-toc-label="Close table of contents" aria-label="Close table of contents" style="--duration:150ms" data-preload="true" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary min-w-[40px] h-[40px] justify-center items-center rounded-full px-2 z-1 absolute top-4 right-4 hidden lg:grid lg:min-w-0 lg:group-data-toc-open:grid-cols-[0fr_max-content] lg:group-data-toc-closed:grid-cols-[1fr_max-content] transition-all duration-[var(--duration)] ease-in-out overflow-hidden lg:justify-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="col-start-2 col-end-2 row-start-1 row-end-1 scale-0 transition-transform duration-[var(--duration)] ease-out group-data-toc-open:scale-100 group-data-toc-open:delay-[var(--duration)]"><line x1="18" x2="6" y1="6" y2="18"></line><line x1="6" x2="18" y1="6" y2="18"></line></svg>

                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="col-start-2 col-end-2 row-start-1 row-end-1 scale-0 transition-transform duration-[var(--duration)] ease-in group-data-toc-closed:scale-100 group-data-toc-closed:delay-[var(--duration)"><line x1="8" x2="21" y1="6" y2="6"></line><line x1="8" x2="21" y1="12" y2="12"></line><line x1="8" x2="21" y1="18" y2="18"></line><line x1="3" x2="3.01" y1="6" y2="6"></line><line x1="3" x2="3.01" y1="12" y2="12"></line><line x1="3" x2="3.01" y1="18" y2="18"></line></svg>

                  <div class="col-start-1 col-end-1 group-data-toc-closed:mx-2 truncate">
                    Open table of contents
                  </div>
                </button>

                <div data-blog-post-toc-container data-preload class="max-sm:card lg:h-full lg:p-4 lg:ml-auto lg:group-data-toc-open:translate-x-0 lg:group-data-toc-open:scale-x-1 lg:group-data-toc-open:opacity-1 lg:group-data-toc-closed:translate-x-full lg:group-data-toc-closed:opacity-0 lg:group-data-toc-closed:scale-x-0 lg:group-data-toc-closed:pointer-events-none transition-[transform,opacity] duration-300 ease-in-out">
                  <div class="hidden lg:flex lg:h-full lg:flex-col">
  <div class="flex items-center gap-2 h-10 flex-none">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-list"><line x1="8" x2="21" y1="6" y2="6"></line><line x1="8" x2="21" y1="12" y2="12"></line><line x1="8" x2="21" y1="18" y2="18"></line><line x1="3" x2="3.01" y1="6" y2="6"></line><line x1="3" x2="3.01" y1="12" y2="12"></line><line x1="3" x2="3.01" y1="18" y2="18"></line></svg>

    <h2 class="m-0">Table of Contents</h2>

    <div class="ml-auto flex items-center transition-transform duration-150 ease-in group-open:rotate-180 lg:hidden">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>
    </div>
  </div>

  <nav data-toc-wrapper class="pt-4 h-full min-h-0 lg:overflow-y-auto [&#38;_a_*]:indent-0 [&#38;_ol]:m-0 [&#38;_ol]:list-none [&#38;_ol]:indent-4 [&#38;_ol_li[data-active]>a]:text-primary [&#38;_ol_li[data-active]]:before:bg-primary [&#38;_ol_li]:relative [&#38;_ol_li]:before:absolute [&#38;_ol_li]:before:left-0 [&#38;_ol_li]:before:top-0 [&#38;_ol_li]:before:h-full [&#38;_ol_li]:before:w-[1px] [&#38;_ol_li]:before:bg-divider [&#38;_ol_li]:before:content-[''] [&#38;_ol_li_a:hover]:bg-hover [&#38;_ol_li_a]:block [&#38;_ol_li_a]:truncate [&#38;_ol_li_a]:border-b-0 [&#38;_ol_li_a]:transition-colors [&#38;_ol_li_a]:duration-300 [&#38;_ol_ol]:indent-8 [&#38;_ol_ol_ol]:indent-12 [&#38;_ol_ol_ol_ol]:indent-16">
    <ol data-astro-toc="1"><li data-astro-toc="1">
          <a href="#installing-ansible">Installing Ansible</a>
          
        </li><li data-astro-toc="1">
          <a href="#how-ansible-clicked-for-me">How Ansible clicked for me</a>
          
        </li><li data-astro-toc="1">
          <a href="#playbook">Playbook</a>
          
        </li><li data-astro-toc="1">
          <a href="#hosts-and-inventory">Hosts and inventory</a>
          
        </li><li data-astro-toc="1">
          <a href="#tasks">Tasks</a>
          <ol data-astro-toc="2"><li data-astro-toc="2">
          <a href="#become">Become</a>
          
        </li><li data-astro-toc="2">
          <a href="#modules">Modules</a>
          
        </li><li data-astro-toc="2">
          <a href="#idempotency">Idempotency</a>
          
        </li></ol>
        </li><li data-astro-toc="1">
          <a href="#facts-and-conditionals">Facts and conditionals</a>
          
        </li><li data-astro-toc="1">
          <a href="#ansible-galaxy">Ansible Galaxy</a>
          
        </li><li data-astro-toc="1">
          <a href="#loops">Loops</a>
          
        </li><li data-astro-toc="1">
          <a href="#jinja2">Jinja2</a>
          
        </li><li data-astro-toc="1">
          <a href="#roles">Roles</a>
          
        </li><li data-astro-toc="1">
          <a href="#dotfiles-use-cases">dotfiles use cases</a>
          <ol data-astro-toc="2"><li data-astro-toc="2">
          <a href="#building-neovim-from-source">Building Neovim from source</a>
          
        </li><li data-astro-toc="2">
          <a href="#installing-efm-langserver">Installing efm-langserver</a>
          
        </li><li data-astro-toc="2">
          <a href="#installing-linters-and-formatters">Installing linters and formatters</a>
          
        </li><li data-astro-toc="2">
          <a href="#stow">Stow</a>
          
        </li></ol>
        </li><li data-astro-toc="1">
          <a href="#gnome">GNOME</a>
          
        </li><li data-astro-toc="1">
          <a href="#conclusion">Conclusion</a>
          
        </li></ol>
  </nav>
</div>

<details class="group px-horizontal-padding py-4 lg:hidden" aria-label="Table of Contents">
  <summary class="list-none">
    <div class="flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-list"><line x1="8" x2="21" y1="6" y2="6"></line><line x1="8" x2="21" y1="12" y2="12"></line><line x1="8" x2="21" y1="18" y2="18"></line><line x1="3" x2="3.01" y1="6" y2="6"></line><line x1="3" x2="3.01" y1="12" y2="12"></line><line x1="3" x2="3.01" y1="18" y2="18"></line></svg>

      <h2 class="m-0">Table of Contents</h2>

      <div class="flex items-center ml-auto transition-transform duration-150 ease-in group-open:rotate-180 lg:hidden">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>
      </div>
    </div>
  </summary>

  <nav data-toc-wrapper class="mt-4 [&#38;_ol]:m-0 [&#38;_ol]:list-outside [&#38;_ol]:px-horizontal-padding [&#38;_ol_li:not(:first-child)]:mt-1">
    <ol data-astro-toc="1"><li data-astro-toc="1">
          <a href="#installing-ansible">Installing Ansible</a>
          
        </li><li data-astro-toc="1">
          <a href="#how-ansible-clicked-for-me">How Ansible clicked for me</a>
          
        </li><li data-astro-toc="1">
          <a href="#playbook">Playbook</a>
          
        </li><li data-astro-toc="1">
          <a href="#hosts-and-inventory">Hosts and inventory</a>
          
        </li><li data-astro-toc="1">
          <a href="#tasks">Tasks</a>
          <ol data-astro-toc="2"><li data-astro-toc="2">
          <a href="#become">Become</a>
          
        </li><li data-astro-toc="2">
          <a href="#modules">Modules</a>
          
        </li><li data-astro-toc="2">
          <a href="#idempotency">Idempotency</a>
          
        </li></ol>
        </li><li data-astro-toc="1">
          <a href="#facts-and-conditionals">Facts and conditionals</a>
          
        </li><li data-astro-toc="1">
          <a href="#ansible-galaxy">Ansible Galaxy</a>
          
        </li><li data-astro-toc="1">
          <a href="#loops">Loops</a>
          
        </li><li data-astro-toc="1">
          <a href="#jinja2">Jinja2</a>
          
        </li><li data-astro-toc="1">
          <a href="#roles">Roles</a>
          
        </li><li data-astro-toc="1">
          <a href="#dotfiles-use-cases">dotfiles use cases</a>
          <ol data-astro-toc="2"><li data-astro-toc="2">
          <a href="#building-neovim-from-source">Building Neovim from source</a>
          
        </li><li data-astro-toc="2">
          <a href="#installing-efm-langserver">Installing efm-langserver</a>
          
        </li><li data-astro-toc="2">
          <a href="#installing-linters-and-formatters">Installing linters and formatters</a>
          
        </li><li data-astro-toc="2">
          <a href="#stow">Stow</a>
          
        </li></ol>
        </li><li data-astro-toc="1">
          <a href="#gnome">GNOME</a>
          
        </li><li data-astro-toc="1">
          <a href="#conclusion">Conclusion</a>
          
        </li></ol>
  </nav>
</details>
                </div>
              </aside>

          <div data-blog-post class="w-full max-w-prose [&#38;>pre]:my-8 [&#38;>pre]:max-sm:full-bleed [&#38;>[data-codeblock]]:my-8 [&#38;>[data-codeblock]]:max-sm:full-bleed [&#38;>[data-codeblock]_pre]:max-sm:rounded-none [&#38;>[data-codeblock]_[data-codeblock-header]]:max-sm:rounded-none [&#38;>img]:my-8 [&#38;_img]:mx-auto [&#38;>hr]:border-0 [&#38;>hr]:text-center [&#38;>hr]:after:content-['⁂'] [&#38;>figure]:my-8 [&#38;>figure]:max-sm:full-bleed [&#38;>astro-island>div]:my-8 [&#38;>lite-youtube]:my-8 [&#38;>blockquote]:my-8 [&#38;>figure_video]:min-h-[15em] [&#38;_.katex-display]:overflow-x-auto [&#38;_.katex-display]:overflow-y-hidden">
            
  <p>A dotfiles repo will help you manage configuration over time and synchronize
them across machines, but it won’t help you with your dependencies — you still
have to install git, tmux, vim, etc. Let’s see how Ansible can help with that.</p>
<p>Ansible would often come up as a solution to dependency management, but I’d
quickly dismiss it because it looked too complex and enterprise-y, an
impression that the <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://www.ansible.com">landing page</a> certainly
contributed to. In my opinion, It doesn’t help convey the idea of what Ansible
turned out to be for me: a tool to automate tasks in a declarative way.</p>
<p>I wish I was introduced to Ansible differently, so this post is an attempt to
write the introduction I wish I’ve had. We’ll deliberately abstract away the
more complex applications of Ansible and focus on solving one problem: how to
set up a machine with your preferred programs, appearances, settings etc.</p>
<h2 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="installing-ansible">
  
  Installing Ansible<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#installing-ansible"><span class="icon icon-link"></span></a>

</h2>
<p>First things first, let’s install Ansible. The official docs has an
extensive <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html#installing-ansible-on-specific-operating-systems">list with installation instructions for many Unix-like operating
systems</a>.</p>
<aside class="my-8 flex gap-4 sm:rounded border-y sm:border-y-0 sm:border-l bg-surface max-sm:full-bleed px-horizontal-padding py-4 sm:shadow-sm sm:shadow-shadow sm:mx-0 flex-row border-warn">
  <div class="">
    <div class="text-warn">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-xoctagon"><polygon points="7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2"></polygon><line x1="15" x2="9" y1="9" y2="15"></line><line x1="9" x2="15" y1="9" y2="15"></line></svg>
  </div>
  </div>

  <article class="overflow-x-hidden max-w-prose [&_h2]:first-of-type:mt-0 [&_h2]:first-of-type:pt-0">
    
  

  <p><a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/user_guide/windows_faq.html#windows-faq-ansible">Ansible cannot run on a Windows
machine</a>,
which is surprising. It can only <em>remotely manage</em> Windows machines, from a
Unix-like OS, such as WSL.</p>

  </article>
</aside>
<p>Another option, available at every operating system, is to use
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://pypi.org/project/pip/">pip</a>, the package manager for Python, which was
my choice:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    <div class="shrink-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
          <svg viewBox="0 0 128 128" width="1em" height="1em"><path fill="none" d="M4.24 4.24h119.53v119.53H4.24z"></path><path fill="currentColor" d="M109.01 28.64 71.28 6.24c-2.25-1.33-4.77-2-7.28-2s-5.03.67-7.28 2.01l-37.74 22.4c-4.5 2.67-7.28 7.61-7.28 12.96v44.8c0 5.35 2.77 10.29 7.28 12.96l37.73 22.4c2.25 1.34 4.76 2 7.28 2 2.51 0 5.03-.67 7.28-2l37.74-22.4c4.5-2.67 7.28-7.62 7.28-12.96V41.6c0-5.34-2.77-10.29-7.28-12.96zM79.79 98.59l.06 3.22c0 .39-.25.83-.55.99l-1.91 1.1c-.3.15-.56-.03-.56-.42l-.03-3.17c-1.63.68-3.29.84-4.34.42-.2-.08-.29-.37-.21-.71l.69-2.91c.06-.23.18-.46.34-.6.06-.06.12-.1.18-.13.11-.06.22-.07.31-.03 1.14.38 2.59.2 3.99-.5 1.78-.9 2.97-2.72 2.95-4.52-.02-1.64-.9-2.31-3.05-2.33-2.74.01-5.3-.53-5.34-4.57-.03-3.32 1.69-6.78 4.43-8.96l-.03-3.25c0-.4.24-.84.55-1l1.85-1.18c.3-.15.56.04.56.43l.03 3.25c1.36-.54 2.54-.69 3.61-.44.23.06.34.38.24.75l-.72 2.88c-.06.22-.18.44-.33.58a.77.77 0 0 1-.19.14c-.1.05-.19.06-.28.05-.49-.11-1.65-.36-3.48.56-1.92.97-2.59 2.64-2.58 3.88.02 1.48.77 1.93 3.39 1.97 3.49.06 4.99 1.58 5.03 5.09.05 3.44-1.79 7.15-4.61 9.41zm26.34-60.5-35.7 22.05c-4.45 2.6-7.73 5.52-7.74 10.89v43.99c0 3.21 1.3 5.29 3.29 5.9-.65.11-1.32.19-1.98.19-2.09 0-4.15-.57-5.96-1.64l-37.73-22.4c-3.69-2.19-5.98-6.28-5.98-10.67V41.6c0-4.39 2.29-8.48 5.98-10.67l37.74-22.4c1.81-1.07 3.87-1.64 5.96-1.64s4.15.57 5.96 1.64l37.74 22.4c3.11 1.85 5.21 5.04 5.8 8.63-1.27-2.67-4.09-3.39-7.38-1.47z"></path><path fill="currentColor" d="m99.12 90.73-9.4 5.62c-.25.15-.43.31-.43.61v2.46c0 .3.2.43.45.28l9.54-5.8c.25-.15.29-.42.29-.72v-2.17c0-.3-.2-.42-.45-.28z"></path></svg>
        </div>

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      Bash
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var d;{let h={0:t=>t,1:t=>JSON.parse(t,a),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(JSON.parse(t,a)),5:t=>new Set(JSON.parse(t,a)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(JSON.parse(t)),9:t=>new Uint16Array(JSON.parse(t)),10:t=>new Uint32Array(JSON.parse(t))},a=(t,e)=>{if(t===""||!Array.isArray(e))return e;let[r,n]=e;return r in h?h[r](n):void 0};customElements.get("astro-island")||customElements.define("astro-island",(d=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=async()=>{var o;if(!this.hydrator||!this.isConnected)return;let e=(o=this.parentElement)==null?void 0:o.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let r=this.querySelectorAll("astro-slot"),n={},c=this.querySelectorAll("template[data-astro-template]");for(let s of c){let i=s.closest(this.tagName);i!=null&&i.isSameNode(this)&&(n[s.getAttribute("data-astro-template")||"default"]=s.innerHTML,s.remove())}for(let s of r){let i=s.closest(this.tagName);i!=null&&i.isSameNode(this)&&(n[s.getAttribute("name")||"default"]=s.innerHTML)}let l=this.hasAttribute("props")?JSON.parse(this.getAttribute("props"),a):{};await this.hydrator(this)(this.Component,l,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((e,r)=>{r.disconnect(),setTimeout(()=>this.childrenConnectedCallback(),0)}).observe(this,{childList:!0})}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}start(){let e=JSON.parse(this.getAttribute("opts")),r=this.getAttribute("client");if(Astro[r]===void 0){window.addEventListener(`astro:${r}`,()=>this.start(),{once:!0});return}Astro[r](async()=>{let n=this.getAttribute("renderer-url"),[c,{default:l}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),o=this.getAttribute("component-export")||"default";if(!o.includes("."))this.Component=c[o];else{this.Component=c;for(let s of o.split("."))this.Component=this.Component[s]}return this.hydrator=l,this.hydrate},e,this)}attributeChangedCallback(){this.hydrate()}},d.observedAttributes=["props"],d))}})();</script><astro-island uid="Z1Y3Dx1" prefix="r2" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;$ pip install ansible\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-shell"><span class="line"><span style="color:#ABB2BF">$ pip install ansible</span></span></code></pre>
</div>
<h2 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="how-ansible-clicked-for-me">
  
  How Ansible clicked for me<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#how-ansible-clicked-for-me"><span class="icon icon-link"></span></a>

</h2>
<p>If I remember correctly, it was by looking at the source code of a dotfiles
repo that used it. The <code>README.md</code> explained that you needed to run a one
single command to set up everything:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    <div class="shrink-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
          <svg viewBox="0 0 128 128" width="1em" height="1em"><path fill="none" d="M4.24 4.24h119.53v119.53H4.24z"></path><path fill="currentColor" d="M109.01 28.64 71.28 6.24c-2.25-1.33-4.77-2-7.28-2s-5.03.67-7.28 2.01l-37.74 22.4c-4.5 2.67-7.28 7.61-7.28 12.96v44.8c0 5.35 2.77 10.29 7.28 12.96l37.73 22.4c2.25 1.34 4.76 2 7.28 2 2.51 0 5.03-.67 7.28-2l37.74-22.4c4.5-2.67 7.28-7.62 7.28-12.96V41.6c0-5.34-2.77-10.29-7.28-12.96zM79.79 98.59l.06 3.22c0 .39-.25.83-.55.99l-1.91 1.1c-.3.15-.56-.03-.56-.42l-.03-3.17c-1.63.68-3.29.84-4.34.42-.2-.08-.29-.37-.21-.71l.69-2.91c.06-.23.18-.46.34-.6.06-.06.12-.1.18-.13.11-.06.22-.07.31-.03 1.14.38 2.59.2 3.99-.5 1.78-.9 2.97-2.72 2.95-4.52-.02-1.64-.9-2.31-3.05-2.33-2.74.01-5.3-.53-5.34-4.57-.03-3.32 1.69-6.78 4.43-8.96l-.03-3.25c0-.4.24-.84.55-1l1.85-1.18c.3-.15.56.04.56.43l.03 3.25c1.36-.54 2.54-.69 3.61-.44.23.06.34.38.24.75l-.72 2.88c-.06.22-.18.44-.33.58a.77.77 0 0 1-.19.14c-.1.05-.19.06-.28.05-.49-.11-1.65-.36-3.48.56-1.92.97-2.59 2.64-2.58 3.88.02 1.48.77 1.93 3.39 1.97 3.49.06 4.99 1.58 5.03 5.09.05 3.44-1.79 7.15-4.61 9.41zm26.34-60.5-35.7 22.05c-4.45 2.6-7.73 5.52-7.74 10.89v43.99c0 3.21 1.3 5.29 3.29 5.9-.65.11-1.32.19-1.98.19-2.09 0-4.15-.57-5.96-1.64l-37.73-22.4c-3.69-2.19-5.98-6.28-5.98-10.67V41.6c0-4.39 2.29-8.48 5.98-10.67l37.74-22.4c1.81-1.07 3.87-1.64 5.96-1.64s4.15.57 5.96 1.64l37.74 22.4c3.11 1.85 5.21 5.04 5.8 8.63-1.27-2.67-4.09-3.39-7.38-1.47z"></path><path fill="currentColor" d="m99.12 90.73-9.4 5.62c-.25.15-.43.31-.43.61v2.46c0 .3.2.43.45.28l9.54-5.8c.25-.15.29-.42.29-.72v-2.17c0-.3-.2-.42-.45-.28z"></path></svg>
        </div>

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      Bash
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="187xGr" prefix="r3" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;$ ansible-playbook --ask-become-pass bootstrap.yml\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-shell"><span class="line"><span style="color:#ABB2BF">$ ansible-playbook --ask-become-pass bootstrap.yml</span></span></code></pre>
</div>
<p>So I went and looked at what was going on at the <code>bootstrap.yml</code> file:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      yaml
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="Z1EkxKv" prefix="r4" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;- name: Bootstrap development environment\n  hosts: localhost\n\n  tasks:\n  - name: Install packages with apt\n    become: yes\n    ansible.builtin.apt:\n      name:\n        - git\n        - tmux\n      state: present\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-yaml"><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Bootstrap development environment</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">hosts</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">localhost</span></span><span class="line"><span> </span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">tasks</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">  - </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Install packages with apt</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">become</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">yes</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">ansible.builtin.apt</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">        - </span><span style="color:#98C379">git</span></span><span class="line"><span style="color:#ABB2BF">        - </span><span style="color:#98C379">tmux</span></span><span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E06C75">state</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">present</span></span></code></pre>
</div>
<p>Things immediately clicked for me once I saw it, like, it’s clear that this is
using <code>apt</code> to download packages!</p>
<p>Of course, at this level, how is that much better than directly running <code>apt install git tmux</code> in a shell script called, say, <code>bootstrap.sh</code>? In this
particular example, it’s not much better but it’s better already, as we’ll see.
We’re just getting started.</p>
<p>There’s still a lot going on that we have to understand, e.g. what is <code>become</code>,
and <code>hosts</code>? But I think the terminology already shows what is Ansible’s
primary goal: <em>to leave a machine in a desired state by playing a bunch of
tasks</em>. In this example, the desired state is to have git and tmux installed
(or “present”), but the desired state will likely not be that simple. Also,
what if we’re on macOS? Or Fedora? We won’t be able to use <code>apt</code> in this case.
We’ll see that Ansible makes it easy to handle this.</p>
<h2 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="playbook">
  
  Playbook<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#playbook"><span class="icon icon-link"></span></a>

</h2>
<p>The file <code>bootstrap.yml</code> is, in Ansible terminology, a
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html">playbook</a>,
which is, in my own words, a way to declare which tasks should run in a machine
in order to achieve the desired state. Playbooks are written in YAML, which is
easy to read and <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://learnxinyminutes.com/docs/yaml/">learn</a>.</p>
<p>A playbook may contain various plays, and each play may contain various tasks.
For example, the <code>bootstrap.yml</code> playbook has a single play, named “Boostrap
development environment”, with one task, “Install packages with apt”.</p>
<h2 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="hosts-and-inventory">
  
  Hosts and inventory<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#hosts-and-inventory"><span class="icon icon-link"></span></a>

</h2>
<p>Ansible can execute tasks on remote and local machines. This is managed with
the help of an
”<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html">inventory</a>”,
where these machines (<code>hosts</code>) are classified with patterns like “prod”,
“test”, “webserver” etc..</p>
<p>We’re not interested in that here since we just want to run tasks on our local
machine. Passing <code>localhost</code> as a playbook’s <code>hosts</code> will do what we want,
without any inventory, because <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/inventory/implicit_localhost.html">Ansible will implicitly define <code>localhost</code> to
match the local
machine</a>.</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      yaml
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="Z154l4c" prefix="r5" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;- name: Bootstrap development environment\n  hosts: localhost\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-yaml" metastring="{2}"><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Bootstrap development environment</span></span><span class="line highlight"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">hosts</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">localhost</span></span></code></pre>
</div>
<h2 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="tasks">
  
  Tasks<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#tasks"><span class="icon icon-link"></span></a>

</h2>
<p>Now, let’s dissect the “Install packages with apt” task. Here it is again:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      yaml
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="1F9pwP" prefix="r6" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;  tasks:\n  - name: Install packages with apt\n    become: yes\n    ansible.builtin.apt:\n      name:\n        - git\n        - tmux\n      state: present\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-yaml"><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">tasks</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">  - </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Install packages with apt</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">become</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">yes</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">ansible.builtin.apt</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">        - </span><span style="color:#98C379">git</span></span><span class="line"><span style="color:#ABB2BF">        - </span><span style="color:#98C379">tmux</span></span><span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E06C75">state</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">present</span></span></code></pre>
</div>
<h3 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="become">
  
  Become<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#become"><span class="icon icon-link"></span></a>

</h3>
<p>Let’s start with the keyword
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/user_guide/become.html"><code>become</code></a>. It
is used so that you can “become another user while this task is executing”,
that user being by default <code>root</code>. So it’s, effectively, the equivalent of
using <code>sudo</code>. This is also why you need to run the playbook with the option
<code>--ask-become-pass</code> (<code>-K</code> for short), because it’ll be necessary to prompt for
your password.</p>
<p>If you need to become another user other than <code>root</code>, use the <code>become_user</code>
keyword.</p>
<h3 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="modules">
  
  Modules<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#modules"><span class="icon icon-link"></span></a>

</h3>
<p><code>ansible.builtin.apt</code> is an <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/user_guide/modules_intro.html">Ansible
module</a>,
which is the preferred way to interact with another program in an Ansible
playbook.</p>
<p>Ansible has several built-in modules, <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/index.html">here’s a full
list</a>.
It has modules for most Linux distributions package managers, like
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/dnf_module.html"><code>dnf</code></a>.
But there are also community-developed modules, like one for
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/collections/community/general/homebrew_module.html">Homebrew</a>,
if you’re on macOS, which we’ll have to download separately, which we’ll learn
how shortly.</p>
<p>An Ansible module takes arguments to accomplish a task. In the
<code>ansible.builtin.apt</code> case, we pass a list of packages to the
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/2.9/modules/apt_module.html#parameter-name"><code>name</code></a>
argument and the desired state we want them to be in to the
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/2.9/modules/apt_module.html#parameter-state"><code>state</code></a>
argument.</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      yaml
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="1YLu2w" prefix="r7" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;  tasks:\n  - name: Install packages with apt\n    become: yes\n    ansible.builtin.apt:\n      name:\n        - git\n        - tmux\n      state: present # could also be &#39;latest&#39; or &#39;absent&#39;\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-yaml" metastring="{4-8}"><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">tasks</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">  - </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Install packages with apt</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">become</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">yes</span></span><span class="line highlight"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">ansible.builtin.apt</span><span style="color:#ABB2BF">:</span></span><span class="line highlight"><span style="color:#ABB2BF">      </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">:</span></span><span class="line highlight"><span style="color:#ABB2BF">        - </span><span style="color:#98C379">git</span></span><span class="line highlight"><span style="color:#ABB2BF">        - </span><span style="color:#98C379">tmux</span></span><span class="line highlight"><span style="color:#ABB2BF">      </span><span style="color:#E06C75">state</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">present</span><span style="color:#ABB2BF"> </span><span style="color:#7F848E"># could also be &#39;latest&#39; or &#39;absent&#39;</span></span></code></pre>
</div>
<h3 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="idempotency">
  
  Idempotency<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#idempotency"><span class="icon icon-link"></span></a>

</h3>
<p>Ansible playbooks are meant to be idempotent, meaning that, no matter how many
times they run, the machine will end up in the same desired state.</p>
<p>An Ansible module can tell if something changed between runs. For example,
let’s say I already have git and tmux installed and run the <code>bootstrap.yml</code>
playbook:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    <div class="shrink-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
          <svg viewBox="0 0 128 128" width="1em" height="1em"><path fill="none" d="M4.24 4.24h119.53v119.53H4.24z"></path><path fill="currentColor" d="M109.01 28.64 71.28 6.24c-2.25-1.33-4.77-2-7.28-2s-5.03.67-7.28 2.01l-37.74 22.4c-4.5 2.67-7.28 7.61-7.28 12.96v44.8c0 5.35 2.77 10.29 7.28 12.96l37.73 22.4c2.25 1.34 4.76 2 7.28 2 2.51 0 5.03-.67 7.28-2l37.74-22.4c4.5-2.67 7.28-7.62 7.28-12.96V41.6c0-5.34-2.77-10.29-7.28-12.96zM79.79 98.59l.06 3.22c0 .39-.25.83-.55.99l-1.91 1.1c-.3.15-.56-.03-.56-.42l-.03-3.17c-1.63.68-3.29.84-4.34.42-.2-.08-.29-.37-.21-.71l.69-2.91c.06-.23.18-.46.34-.6.06-.06.12-.1.18-.13.11-.06.22-.07.31-.03 1.14.38 2.59.2 3.99-.5 1.78-.9 2.97-2.72 2.95-4.52-.02-1.64-.9-2.31-3.05-2.33-2.74.01-5.3-.53-5.34-4.57-.03-3.32 1.69-6.78 4.43-8.96l-.03-3.25c0-.4.24-.84.55-1l1.85-1.18c.3-.15.56.04.56.43l.03 3.25c1.36-.54 2.54-.69 3.61-.44.23.06.34.38.24.75l-.72 2.88c-.06.22-.18.44-.33.58a.77.77 0 0 1-.19.14c-.1.05-.19.06-.28.05-.49-.11-1.65-.36-3.48.56-1.92.97-2.59 2.64-2.58 3.88.02 1.48.77 1.93 3.39 1.97 3.49.06 4.99 1.58 5.03 5.09.05 3.44-1.79 7.15-4.61 9.41zm26.34-60.5-35.7 22.05c-4.45 2.6-7.73 5.52-7.74 10.89v43.99c0 3.21 1.3 5.29 3.29 5.9-.65.11-1.32.19-1.98.19-2.09 0-4.15-.57-5.96-1.64l-37.73-22.4c-3.69-2.19-5.98-6.28-5.98-10.67V41.6c0-4.39 2.29-8.48 5.98-10.67l37.74-22.4c1.81-1.07 3.87-1.64 5.96-1.64s4.15.57 5.96 1.64l37.74 22.4c3.11 1.85 5.21 5.04 5.8 8.63-1.27-2.67-4.09-3.39-7.38-1.47z"></path><path fill="currentColor" d="m99.12 90.73-9.4 5.62c-.25.15-.43.31-.43.61v2.46c0 .3.2.43.45.28l9.54-5.8c.25-.15.29-.42.29-.72v-2.17c0-.3-.2-.42-.45-.28z"></path></svg>
        </div>

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      Bash
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="1COWSC" prefix="r8" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;$ ansible-playbook -K bootstrap.yml\nBECOME password:\n\nPLAY [Bootstrap development environment] *****************************************************************************\n\nTASK [Gathering Facts] ***********************************************************************************************\nok: [localhost]\n\nTASK [Install packages with apt] ******************************************************************************************\nok: [localhost]\n\nPLAY RECAP ***********************************************************************************************************\nlocalhost                  : ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-shell" metastring="{9-10}"><span class="line"><span style="color:#ABB2BF">$ ansible-playbook -K bootstrap.yml</span></span><span class="line"><span style="color:#ABB2BF">BECOME password:</span></span><span class="line"><span> </span></span><span class="line"><span style="color:#ABB2BF">PLAY [Bootstrap development environment] *****************************************************************************</span></span><span class="line"><span> </span></span><span class="line"><span style="color:#ABB2BF">TASK [Gathering Facts] ***********************************************************************************************</span></span><span class="line"><span style="color:#ABB2BF">ok: [localhost]</span></span><span class="line"><span> </span></span><span class="line highlight"><span style="color:#ABB2BF">TASK [Install packages with apt] ******************************************************************************************</span></span><span class="line highlight"><span style="color:#ABB2BF">ok: [localhost]</span></span><span class="line"><span> </span></span><span class="line"><span style="color:#ABB2BF">PLAY RECAP ***********************************************************************************************************</span></span><span class="line"><span style="color:#ABB2BF">localhost                  </span><span style="color:#56B6C2">:</span><span style="color:#ABB2BF"> ok=2    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</span></span></code></pre>
</div>
<p>The task “Install packages with apt” was labelled “ok”, as in “nothing
changed”: git and tmux were already present. If either were absent, the task
would have been labelled as “changed”, because now both are present.</p>
<p>This feature is module-dependent. The task could be idempotent by nature, yet
Ansible wouldn’t know about it unless the module is smart enough to tell it.</p>
<p>To illustrate this, let’s use the
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/shell_module.html#shell-module"><code>ansible.builtin.shell</code></a>,
which is used to run arbitrary commands into a shell. <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/user_guide/intro_adhoc.html">Let’s run a task using
this module in an ad hoc
way</a>
(outside of a playbook):</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    <div class="shrink-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
          <svg viewBox="0 0 128 128" width="1em" height="1em"><path fill="none" d="M4.24 4.24h119.53v119.53H4.24z"></path><path fill="currentColor" d="M109.01 28.64 71.28 6.24c-2.25-1.33-4.77-2-7.28-2s-5.03.67-7.28 2.01l-37.74 22.4c-4.5 2.67-7.28 7.61-7.28 12.96v44.8c0 5.35 2.77 10.29 7.28 12.96l37.73 22.4c2.25 1.34 4.76 2 7.28 2 2.51 0 5.03-.67 7.28-2l37.74-22.4c4.5-2.67 7.28-7.62 7.28-12.96V41.6c0-5.34-2.77-10.29-7.28-12.96zM79.79 98.59l.06 3.22c0 .39-.25.83-.55.99l-1.91 1.1c-.3.15-.56-.03-.56-.42l-.03-3.17c-1.63.68-3.29.84-4.34.42-.2-.08-.29-.37-.21-.71l.69-2.91c.06-.23.18-.46.34-.6.06-.06.12-.1.18-.13.11-.06.22-.07.31-.03 1.14.38 2.59.2 3.99-.5 1.78-.9 2.97-2.72 2.95-4.52-.02-1.64-.9-2.31-3.05-2.33-2.74.01-5.3-.53-5.34-4.57-.03-3.32 1.69-6.78 4.43-8.96l-.03-3.25c0-.4.24-.84.55-1l1.85-1.18c.3-.15.56.04.56.43l.03 3.25c1.36-.54 2.54-.69 3.61-.44.23.06.34.38.24.75l-.72 2.88c-.06.22-.18.44-.33.58a.77.77 0 0 1-.19.14c-.1.05-.19.06-.28.05-.49-.11-1.65-.36-3.48.56-1.92.97-2.59 2.64-2.58 3.88.02 1.48.77 1.93 3.39 1.97 3.49.06 4.99 1.58 5.03 5.09.05 3.44-1.79 7.15-4.61 9.41zm26.34-60.5-35.7 22.05c-4.45 2.6-7.73 5.52-7.74 10.89v43.99c0 3.21 1.3 5.29 3.29 5.9-.65.11-1.32.19-1.98.19-2.09 0-4.15-.57-5.96-1.64l-37.73-22.4c-3.69-2.19-5.98-6.28-5.98-10.67V41.6c0-4.39 2.29-8.48 5.98-10.67l37.74-22.4c1.81-1.07 3.87-1.64 5.96-1.64s4.15.57 5.96 1.64l37.74 22.4c3.11 1.85 5.21 5.04 5.8 8.63-1.27-2.67-4.09-3.39-7.38-1.47z"></path><path fill="currentColor" d="m99.12 90.73-9.4 5.62c-.25.15-.43.31-.43.61v2.46c0 .3.2.43.45.28l9.54-5.8c.25-.15.29-.42.29-.72v-2.17c0-.3-.2-.42-.45-.28z"></path></svg>
        </div>

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      Bash
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="Yrtge" prefix="r9" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;$ ansible localhost -m ansible.builtin.shell -a &#39;echo $SHELL&#39;\n\n[WARNING]: No inventory was parsed, only implicit localhost is available\nlocalhost | CHANGED | rc=0 &gt;&gt;\n/bin/bash\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-shell"><span class="line"><span style="color:#ABB2BF">$ ansible localhost -m ansible.builtin.shell -a </span><span style="color:#98C379">&#39;echo $SHELL&#39;</span></span><span class="line"><span> </span></span><span class="line"><span style="color:#ABB2BF">[WARNING]: No inventory was parsed, only implicit localhost is available</span></span><span class="line"><span style="color:#ABB2BF">localhost | CHANGED | rc=0 &gt;&gt;</span></span><span class="line"><span style="color:#ABB2BF">/bin/bash</span></span></code></pre>
</div>
<p>Ansible says something changed, but why? Running <code>echo $SHELL</code> cannot change
anything in a system (I guess?). But Ansible has no way to know this, since it
could be any arbitrary command, such as <code>rm -rf $HOME</code>.</p>
<p>Most of Ansible built-in modules are idempotent and smart enough to tell if
something changed between runs. <code>ansible.builtin.shell</code> is kind of a low-level
one, so it’s best to avoid it whenever possible. There are ways to make it
smarter with parameters such as
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/shell_module.html#parameter-creates"><code>creates</code></a>,
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/shell_module.html#parameter-removes"><code>removes</code></a>,
or, at the task level,
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_error_handling.html#defining-changed"><code>changed_when</code></a>.</p>
<h2 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="facts-and-conditionals">
  
  Facts and conditionals<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#facts-and-conditionals"><span class="icon icon-link"></span></a>

</h2>
<p>Now let’s imagine you use both macOS and Ubuntu. You want to install git and
tmux in both operating systems with Ansible. You’ll need to add some sort of
conditional logic to your playbook since <code>apt</code> isn’t available in macOS, and
you probably don’t want to use Homebrew in Linux, even though you could.</p>
<p><a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_conditionals.html#basic-conditionals-with-when">We can run a task conditionally with the <code>when</code>
keyword</a>:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      yaml
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="ZwACSq" prefix="r10" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;  tasks:\n  - name: Install packages with apt\n    become: yes\n    ansible.builtin.apt:\n      name:\n        - git\n        - tmux\n      state: present\n    when: ansible_distribution == \&quot;Ubuntu\&quot;\n\n  tasks:\n  - name: Install packages with brew\n    become: yes\n    community.general.homebew:\n      name:\n        - git\n        - tmux\n      state: present\n    when: ansible_distribution == \&quot;MacOSX\&quot;\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-yaml" metastring="{9, 19}"><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">tasks</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">  - </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Install packages with apt</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">become</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">yes</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">ansible.builtin.apt</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">        - </span><span style="color:#98C379">git</span></span><span class="line"><span style="color:#ABB2BF">        - </span><span style="color:#98C379">tmux</span></span><span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E06C75">state</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">present</span></span><span class="line highlight"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">when</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">ansible_distribution == &quot;Ubuntu&quot;</span></span><span class="line"><span> </span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">tasks</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">  - </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Install packages with brew</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">become</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">yes</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">community.general.homebew</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">        - </span><span style="color:#98C379">git</span></span><span class="line"><span style="color:#ABB2BF">        - </span><span style="color:#98C379">tmux</span></span><span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E06C75">state</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">present</span></span><span class="line highlight"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">when</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">ansible_distribution == &quot;MacOSX&quot;</span></span></code></pre>
</div>
<p>The task will run if the expression passed to <code>when</code> evaluates to <code>True</code>. This
expression is a Jinja2 expression, a template engine written in Python, so it’s
not strictly Python syntax but it looks a lot like it.</p>
<p>The <code>ansible_distribution</code> variable is an <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_vars_facts.html">Ansible
fact</a>:
information about your system gathered and provided by Ansible, for
convenience. There are a LOT of facts, you can run <code>ansible localhost -m ansible.builtin.setup</code> to check what’s available, but here’s the <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_conditionals.html#commonly-used-facts">most commonly
used
ones</a>:
<code>ansible_distribution</code>, <code>ansible_distribution_version</code> and <code>ansible_os_family</code>.</p>
<h2 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="ansible-galaxy">
  
  Ansible Galaxy<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#ansible-galaxy"><span class="icon icon-link"></span></a>

</h2>
<p>The module <code>community.general.homebrew</code> is not a built-in module, you have to
install it separately via <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://galaxy.ansible.com/docs/">Ansible Galaxy</a>,
which is a hub for Ansible content.</p>
<p>Ansible Galaxy provides a command-line interface to install stuff, like
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://galaxy.ansible.com/docs/contributing/creating_collections.html">collections</a>
and roles (which we’ll learn about shortly). <code>community.general</code> is a
collection of modules, which we can install by running:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    <div class="shrink-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
          <svg viewBox="0 0 128 128" width="1em" height="1em"><path fill="none" d="M4.24 4.24h119.53v119.53H4.24z"></path><path fill="currentColor" d="M109.01 28.64 71.28 6.24c-2.25-1.33-4.77-2-7.28-2s-5.03.67-7.28 2.01l-37.74 22.4c-4.5 2.67-7.28 7.61-7.28 12.96v44.8c0 5.35 2.77 10.29 7.28 12.96l37.73 22.4c2.25 1.34 4.76 2 7.28 2 2.51 0 5.03-.67 7.28-2l37.74-22.4c4.5-2.67 7.28-7.62 7.28-12.96V41.6c0-5.34-2.77-10.29-7.28-12.96zM79.79 98.59l.06 3.22c0 .39-.25.83-.55.99l-1.91 1.1c-.3.15-.56-.03-.56-.42l-.03-3.17c-1.63.68-3.29.84-4.34.42-.2-.08-.29-.37-.21-.71l.69-2.91c.06-.23.18-.46.34-.6.06-.06.12-.1.18-.13.11-.06.22-.07.31-.03 1.14.38 2.59.2 3.99-.5 1.78-.9 2.97-2.72 2.95-4.52-.02-1.64-.9-2.31-3.05-2.33-2.74.01-5.3-.53-5.34-4.57-.03-3.32 1.69-6.78 4.43-8.96l-.03-3.25c0-.4.24-.84.55-1l1.85-1.18c.3-.15.56.04.56.43l.03 3.25c1.36-.54 2.54-.69 3.61-.44.23.06.34.38.24.75l-.72 2.88c-.06.22-.18.44-.33.58a.77.77 0 0 1-.19.14c-.1.05-.19.06-.28.05-.49-.11-1.65-.36-3.48.56-1.92.97-2.59 2.64-2.58 3.88.02 1.48.77 1.93 3.39 1.97 3.49.06 4.99 1.58 5.03 5.09.05 3.44-1.79 7.15-4.61 9.41zm26.34-60.5-35.7 22.05c-4.45 2.6-7.73 5.52-7.74 10.89v43.99c0 3.21 1.3 5.29 3.29 5.9-.65.11-1.32.19-1.98.19-2.09 0-4.15-.57-5.96-1.64l-37.73-22.4c-3.69-2.19-5.98-6.28-5.98-10.67V41.6c0-4.39 2.29-8.48 5.98-10.67l37.74-22.4c1.81-1.07 3.87-1.64 5.96-1.64s4.15.57 5.96 1.64l37.74 22.4c3.11 1.85 5.21 5.04 5.8 8.63-1.27-2.67-4.09-3.39-7.38-1.47z"></path><path fill="currentColor" d="m99.12 90.73-9.4 5.62c-.25.15-.43.31-.43.61v2.46c0 .3.2.43.45.28l9.54-5.8c.25-.15.29-.42.29-.72v-2.17c0-.3-.2-.42-.45-.28z"></path></svg>
        </div>

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      Bash
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="ZViyUl" prefix="r11" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;$ ansible-galaxy collection install community.general\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-shell"><span class="line"><span style="color:#ABB2BF">$ ansible-galaxy collection install community.general</span></span></code></pre>
</div>
<h2 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="loops">
  
  Loops<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#loops"><span class="icon icon-link"></span></a>

</h2>
<p>You may need a loop to accomplish a task. For example, the following task will
build <code>dwm</code>, <code>slock</code> and <code>dmenu</code> from source, by running <code>sudo make install</code> in
each directory containing the source code:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      yaml
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="1n8NVq" prefix="r12" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;- name: Build and install suckless tools\n  become: true\n  loop:\n    - dwm\n    - slock\n    - dmenu\n  community.general.make:\n    target: install\n    chdir: \&quot;suckless/{{ item }}\&quot;\n    make: /usr/bin/make\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-yaml"><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Build and install suckless tools</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">become</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">loop</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">    - </span><span style="color:#98C379">dwm</span></span><span class="line"><span style="color:#ABB2BF">    - </span><span style="color:#98C379">slock</span></span><span class="line"><span style="color:#ABB2BF">    - </span><span style="color:#98C379">dmenu</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">community.general.make</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">target</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">install</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">chdir</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;suckless/{{ item }}&quot;</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">make</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">/usr/bin/make</span></span></code></pre>
</div>
<p>Another example is if a module do not accept a list of strings as an argument,
just a string.
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/collections/community/general/npm_module.html"><code>community.general.npm</code></a>
is one of such modules. Here’s an example of how to install some npm modules
globally:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      yaml
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="Z6mfF9" prefix="r13" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;- name: Install npm global packages\n  loop:\n    - yalc\n    - npm-merge-driver\n    - diff-so-fancy\n  community.general.npm:\n    name: \&quot;{{ item }}\&quot;\n    state: present\n    global: true\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-yaml" metastring="{2-5, 7}"><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Install npm global packages</span></span><span class="line highlight"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">loop</span><span style="color:#ABB2BF">:</span></span><span class="line highlight"><span style="color:#ABB2BF">    - </span><span style="color:#98C379">yalc</span></span><span class="line highlight"><span style="color:#ABB2BF">    - </span><span style="color:#98C379">npm-merge-driver</span></span><span class="line highlight"><span style="color:#ABB2BF">    - </span><span style="color:#98C379">diff-so-fancy</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">community.general.npm</span><span style="color:#ABB2BF">:</span></span><span class="line highlight"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;{{ item }}&quot;</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">state</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">present</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">global</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span></span></code></pre>
</div>
<h2 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="jinja2">
  
  Jinja2<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#jinja2"><span class="icon icon-link"></span></a>

</h2>
<p><a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://jinja.palletsprojects.com/en/3.1.x/templates/">Jinja2</a> was mentioned
briefly in conditionals, but because it’s a huge component of Ansible, it
deserves a few more words than that.</p>
<p>We’ve been using Jinja2 throughout this post already, e.g., <code>{{ item }}</code> is a
Jinja2 expression to expand the value in the variable <code>item</code>.</p>
<p>It’s possible to manipulate this value with
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://jinja.palletsprojects.com/en/3.1.x/templates/#filters">filters</a>, e.g.
<code>{{ item | upper }}</code>.</p>
<p><a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://jinja.palletsprojects.com/en/3.1.x/templates/#list-of-builtin-filters">There are a lot of built-in
filters</a>.
The <code>upper</code> filter is kind of an innocuous one, there are some more powerful,
e.g. <code>product</code> to build a <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/2.8/user_guide/playbooks_filters.html#product-filters">cartesian
product</a>
from lists:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      yaml
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="3ns7L" prefix="r14" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;- name: Give users access to multiple databases\n  community.mysql.mysql_user:\n    name: \&quot;{{ item[0] }}\&quot;\n    priv: \&quot;{{ item[1] }}.*:ALL\&quot;\n    append_privs: yes\n    password: \&quot;foo\&quot;\n  loop: \&quot;{{ [&#39;alice&#39;, &#39;bob&#39;] | product([&#39;clientdb&#39;, &#39;employeedb&#39;, &#39;providerdb&#39;]) | list }}\&quot;\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-yaml" metastring="{3-4, 7}"><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Give users access to multiple databases</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">community.mysql.mysql_user</span><span style="color:#ABB2BF">:</span></span><span class="line highlight"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;{{ item[0] }}&quot;</span></span><span class="line highlight"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">priv</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;{{ item[1] }}.*:ALL&quot;</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">append_privs</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">yes</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">password</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;foo&quot;</span></span><span class="line highlight"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">loop</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;{{ [&#39;alice&#39;, &#39;bob&#39;] | product([&#39;clientdb&#39;, &#39;employeedb&#39;, &#39;providerdb&#39;]) | list }}&quot;</span></span></code></pre>
</div>
<p>Ansible uses <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_tests.html#playbooks-tests">Jinja2
tests</a>
to express conditional logic. The syntax for tests is slightly different than
the filter syntax:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      yaml
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="Z43E7t" prefix="r15" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;vars:\n  url: \&quot;https://example.com/users/foo/resources/bar\&quot;\n\ntasks:\n    - debug:\n        msg: \&quot;matched pattern 1\&quot;\n      when: url is match(\&quot;https://example.com/users/.*/resources\&quot;)\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-yaml" metastring="{7}"><span class="line"><span style="color:#E06C75">vars</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">url</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;https://example.com/users/foo/resources/bar&quot;</span></span><span class="line"><span> </span></span><span class="line"><span style="color:#E06C75">tasks</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">    - </span><span style="color:#E06C75">debug</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">msg</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;matched pattern 1&quot;</span></span><span class="line highlight"><span style="color:#ABB2BF">      </span><span style="color:#E06C75">when</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">url is match(&quot;https://example.com/users/.*/resources&quot;)</span></span></code></pre>
</div>
<p>The usual <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://jinja.palletsprojects.com/en/latest/templates/#comparisons">comparison
operators</a>
are available, like <code>==</code>, <code>!=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code>, and it’s, of course, also
possible to <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://jinja.palletsprojects.com/en/latest/templates/#logic">combine or transform multiple boolean
expressions</a> with
<code>and</code>, <code>or</code>, <code>not</code> etc.</p>
<h2 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="roles">
  
  Roles<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#roles"><span class="icon icon-link"></span></a>

</h2>
<p>An Ansible role is a way to organize your tasks logic in a file structure. A
role is usually the format in which you use other people’s Ansible tasks. For
example, <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://github.com/gantsign/ansible-role-visual-studio-code">there is an Ansible role to install Visual Studio
Code</a>. It’s
available in Ansible Galaxy, so we can install it like this:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    <div class="shrink-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
          <svg viewBox="0 0 128 128" width="1em" height="1em"><path fill="none" d="M4.24 4.24h119.53v119.53H4.24z"></path><path fill="currentColor" d="M109.01 28.64 71.28 6.24c-2.25-1.33-4.77-2-7.28-2s-5.03.67-7.28 2.01l-37.74 22.4c-4.5 2.67-7.28 7.61-7.28 12.96v44.8c0 5.35 2.77 10.29 7.28 12.96l37.73 22.4c2.25 1.34 4.76 2 7.28 2 2.51 0 5.03-.67 7.28-2l37.74-22.4c4.5-2.67 7.28-7.62 7.28-12.96V41.6c0-5.34-2.77-10.29-7.28-12.96zM79.79 98.59l.06 3.22c0 .39-.25.83-.55.99l-1.91 1.1c-.3.15-.56-.03-.56-.42l-.03-3.17c-1.63.68-3.29.84-4.34.42-.2-.08-.29-.37-.21-.71l.69-2.91c.06-.23.18-.46.34-.6.06-.06.12-.1.18-.13.11-.06.22-.07.31-.03 1.14.38 2.59.2 3.99-.5 1.78-.9 2.97-2.72 2.95-4.52-.02-1.64-.9-2.31-3.05-2.33-2.74.01-5.3-.53-5.34-4.57-.03-3.32 1.69-6.78 4.43-8.96l-.03-3.25c0-.4.24-.84.55-1l1.85-1.18c.3-.15.56.04.56.43l.03 3.25c1.36-.54 2.54-.69 3.61-.44.23.06.34.38.24.75l-.72 2.88c-.06.22-.18.44-.33.58a.77.77 0 0 1-.19.14c-.1.05-.19.06-.28.05-.49-.11-1.65-.36-3.48.56-1.92.97-2.59 2.64-2.58 3.88.02 1.48.77 1.93 3.39 1.97 3.49.06 4.99 1.58 5.03 5.09.05 3.44-1.79 7.15-4.61 9.41zm26.34-60.5-35.7 22.05c-4.45 2.6-7.73 5.52-7.74 10.89v43.99c0 3.21 1.3 5.29 3.29 5.9-.65.11-1.32.19-1.98.19-2.09 0-4.15-.57-5.96-1.64l-37.73-22.4c-3.69-2.19-5.98-6.28-5.98-10.67V41.6c0-4.39 2.29-8.48 5.98-10.67l37.74-22.4c1.81-1.07 3.87-1.64 5.96-1.64s4.15.57 5.96 1.64l37.74 22.4c3.11 1.85 5.21 5.04 5.8 8.63-1.27-2.67-4.09-3.39-7.38-1.47z"></path><path fill="currentColor" d="m99.12 90.73-9.4 5.62c-.25.15-.43.31-.43.61v2.46c0 .3.2.43.45.28l9.54-5.8c.25-.15.29-.42.29-.72v-2.17c0-.3-.2-.42-.45-.28z"></path></svg>
        </div>

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      Bash
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="ZgWXgG" prefix="r16" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;$ ansible-galaxy role install gantsign.visual-studio-code\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-shell"><span class="line"><span style="color:#ABB2BF">$ ansible-galaxy role install gantsign.visual-studio-code</span></span></code></pre>
</div>
<p>A role is usually customizable via parameters. For example, the
<code>gantsign.visual-studio-code</code> extension has a parameter that allows you to
install extensions:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      yaml
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="Z17SPko" prefix="r17" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;    - role: gantsign.visual-studio-code\n      users:\n        - username: phelipe\n          visual_studio_code_extensions:\n            - \&quot;eamodio.gitlens\&quot;\n            - \&quot;kahole.magit\&quot;\n            - \&quot;PhilHindle.errorlens\&quot;\n            - \&quot;sleistner.vscode-fileutils\&quot;\n            - \&quot;vscodevim.vim\&quot;\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-yaml" metastring="{4-9}"><span class="line"><span style="color:#ABB2BF">    - </span><span style="color:#E06C75">role</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">gantsign.visual-studio-code</span></span><span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E06C75">users</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">        - </span><span style="color:#E06C75">username</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">phelipe</span></span><span class="line highlight"><span style="color:#ABB2BF">          </span><span style="color:#E06C75">visual_studio_code_extensions</span><span style="color:#ABB2BF">:</span></span><span class="line highlight"><span style="color:#ABB2BF">            - </span><span style="color:#98C379">&quot;eamodio.gitlens&quot;</span></span><span class="line highlight"><span style="color:#ABB2BF">            - </span><span style="color:#98C379">&quot;kahole.magit&quot;</span></span><span class="line highlight"><span style="color:#ABB2BF">            - </span><span style="color:#98C379">&quot;PhilHindle.errorlens&quot;</span></span><span class="line highlight"><span style="color:#ABB2BF">            - </span><span style="color:#98C379">&quot;sleistner.vscode-fileutils&quot;</span></span><span class="line highlight"><span style="color:#ABB2BF">            - </span><span style="color:#98C379">&quot;vscodevim.vim&quot;</span></span></code></pre>
</div>
<p>In practice, creating a role is a matter of organizing things like tasks,
default variables, templates, files etc. in a file structure that Ansible can
understand.</p>
<p>You start by creating a <code>tasks/main.yml</code> file, which is the role’s entry point,
from which all tasks will derive.</p>
<p>Let’s check a role I made to install Neovim, to illustrate this:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    <div class="shrink-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
          <svg viewBox="0 0 128 128" width="1em" height="1em"><path fill="none" d="M4.24 4.24h119.53v119.53H4.24z"></path><path fill="currentColor" d="M109.01 28.64 71.28 6.24c-2.25-1.33-4.77-2-7.28-2s-5.03.67-7.28 2.01l-37.74 22.4c-4.5 2.67-7.28 7.61-7.28 12.96v44.8c0 5.35 2.77 10.29 7.28 12.96l37.73 22.4c2.25 1.34 4.76 2 7.28 2 2.51 0 5.03-.67 7.28-2l37.74-22.4c4.5-2.67 7.28-7.62 7.28-12.96V41.6c0-5.34-2.77-10.29-7.28-12.96zM79.79 98.59l.06 3.22c0 .39-.25.83-.55.99l-1.91 1.1c-.3.15-.56-.03-.56-.42l-.03-3.17c-1.63.68-3.29.84-4.34.42-.2-.08-.29-.37-.21-.71l.69-2.91c.06-.23.18-.46.34-.6.06-.06.12-.1.18-.13.11-.06.22-.07.31-.03 1.14.38 2.59.2 3.99-.5 1.78-.9 2.97-2.72 2.95-4.52-.02-1.64-.9-2.31-3.05-2.33-2.74.01-5.3-.53-5.34-4.57-.03-3.32 1.69-6.78 4.43-8.96l-.03-3.25c0-.4.24-.84.55-1l1.85-1.18c.3-.15.56.04.56.43l.03 3.25c1.36-.54 2.54-.69 3.61-.44.23.06.34.38.24.75l-.72 2.88c-.06.22-.18.44-.33.58a.77.77 0 0 1-.19.14c-.1.05-.19.06-.28.05-.49-.11-1.65-.36-3.48.56-1.92.97-2.59 2.64-2.58 3.88.02 1.48.77 1.93 3.39 1.97 3.49.06 4.99 1.58 5.03 5.09.05 3.44-1.79 7.15-4.61 9.41zm26.34-60.5-35.7 22.05c-4.45 2.6-7.73 5.52-7.74 10.89v43.99c0 3.21 1.3 5.29 3.29 5.9-.65.11-1.32.19-1.98.19-2.09 0-4.15-.57-5.96-1.64l-37.73-22.4c-3.69-2.19-5.98-6.28-5.98-10.67V41.6c0-4.39 2.29-8.48 5.98-10.67l37.74-22.4c1.81-1.07 3.87-1.64 5.96-1.64s4.15.57 5.96 1.64l37.74 22.4c3.11 1.85 5.21 5.04 5.8 8.63-1.27-2.67-4.09-3.39-7.38-1.47z"></path><path fill="currentColor" d="m99.12 90.73-9.4 5.62c-.25.15-.43.31-.43.61v2.46c0 .3.2.43.45.28l9.54-5.8c.25-.15.29-.42.29-.72v-2.17c0-.3-.2-.42-.45-.28z"></path></svg>
        </div>

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      Bash
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="ZHU54a" prefix="r18" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;$ tree roles/nvim\nroles/nvim\n└── tasks\n    ├── fedora.yml\n    ├── macos.yml\n    ├── main.yml\n    └── ubuntu.yml\n\n1 directory, 4 files\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-shell"><span class="line"><span style="color:#ABB2BF">$ tree roles/nvim</span></span><span class="line"><span style="color:#ABB2BF">roles/nvim</span></span><span class="line"><span style="color:#ABB2BF">└── tasks</span></span><span class="line"><span style="color:#ABB2BF">    ├── fedora.yml</span></span><span class="line"><span style="color:#ABB2BF">    ├── macos.yml</span></span><span class="line"><span style="color:#ABB2BF">    ├── main.yml</span></span><span class="line"><span style="color:#ABB2BF">    └── ubuntu.yml</span></span><span class="line"><span> </span></span><span class="line"><span style="color:#ABB2BF">1 directory, 4 files</span></span></code></pre>
</div>
<p>The contents of <code>main.yml</code> simply import tasks from the other files, depending
on the host’s operating system:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      yaml
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="1DLMI0" prefix="r19" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;- name: Build nvim from source in Ubuntu\n  import_tasks: ubuntu.yml\n  when: ansible_distribution == \&quot;Ubuntu\&quot;\n\n- name: Build nvim from source in Fedora\n  include_tasks: fedora.yml\n  when: ansible_distribution == \&quot;Fedora\&quot;\n\n- name: Install nvim with Homebrew in macOS\n  import_tasks: macos.yml\n  when: ansible_distribution == \&quot;MacOSX\&quot;\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-yaml"><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Build nvim from source in Ubuntu</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">import_tasks</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">ubuntu.yml</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">when</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">ansible_distribution == &quot;Ubuntu&quot;</span></span><span class="line"><span> </span></span><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Build nvim from source in Fedora</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">include_tasks</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">fedora.yml</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">when</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">ansible_distribution == &quot;Fedora&quot;</span></span><span class="line"><span> </span></span><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Install nvim with Homebrew in macOS</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">import_tasks</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">macos.yml</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">when</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">ansible_distribution == &quot;MacOSX&quot;</span></span></code></pre>
</div>
<p>Ansible will make it easy for you to use templates and files stored in the
role’s <code>templates</code> and <code>files</code> directory. You can provide variables’ default
values in the <code>default/main.yml</code> file. The list could go on, but I won’t go any
further. Learn more about it in the <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html">official docs about
roles</a>.</p>
<h2 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="dotfiles-use-cases">
  
  dotfiles use cases<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#dotfiles-use-cases"><span class="icon icon-link"></span></a>

</h2>
<p>Now let’s look at some examples at how I used Ansible to manage <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://github.com/phelipetls/dotfiles">my
dotfiles</a>.</p>
<h3 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="building-neovim-from-source">
  
  Building Neovim from source<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#building-neovim-from-source"><span class="icon icon-link"></span></a>

</h3>
<p>Let’s build Neovim from source with Ansible, in Ubuntu, with the help of the
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://github.com/neovim/neovim/wiki/Building-Neovim">official guide</a>.</p>
<aside class="my-8 flex gap-4 sm:rounded border-y sm:border-y-0 sm:border-l bg-surface max-sm:full-bleed px-horizontal-padding py-4 sm:shadow-sm sm:shadow-shadow sm:mx-0 flex-row border-note">
  <div class="">
    <div class="text-note">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info"><circle cx="12" cy="12" r="10"></circle><line x1="12" x2="12" y1="16" y2="12"></line><line x1="12" x2="12.01" y1="8" y2="8"></line></svg>
  </div>
  </div>

  <article class="overflow-x-hidden max-w-prose [&_h2]:first-of-type:mt-0 [&_h2]:first-of-type:pt-0">
    
  

  <p>I say Ubuntu because Fedora and Homebrew usually have an up-to-date Neovim
stable, so I can’t be bothered.</p>

  </article>
</aside>
<p>I already have Neovim source code as a git submodule in <code>deps/neovim</code>, but it’s
also possible to add a task to clone its repository with the
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/git_module.html"><code>ansible.builtin.git</code></a>
module.</p>
<p>We’ll need to install build dependencies, run some <code>make</code> commands, and that’s
it!</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      yaml
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="1dacCp" prefix="r20" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;# In case you don&#39;t like git submodules\n- name: Clone nvim repository\n  git:\n    repo: https://github.com/neovim/neovim\n    dest: \&quot;{{ ansible_env.HOME }}/src/nvim\&quot;\n    clone: true\n    version: \&quot;v6.0.0\&quot;\n\n- name: Install nvim build dependencies\n  become: true\n  apt:\n    name:\n      - ninja-build\n      - gettext\n      - libtool\n      - libtool-bin\n      - autoconf\n      - automake\n      - cmake\n      - g++\n      - pkg-config\n      - unzip\n      - curl\n    state: present\n\n- name: Build nvim release version\n  community.general.make:\n    chdir: deps/neovim\n    params:\n      CMAKE_BUILD_TYPE: Release\n\n- name: Install nvim release version\n  become: true\n  community.general.make:\n    chdir: deps/neovim\n    target: install\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-yaml"><span class="line"><span style="color:#7F848E"># In case you don&#39;t like git submodules</span></span><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Clone nvim repository</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">git</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">repo</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">https://github.com/neovim/neovim</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">dest</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;{{ ansible_env.HOME }}/src/nvim&quot;</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">clone</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">version</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;v6.0.0&quot;</span></span><span class="line"><span> </span></span><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Install nvim build dependencies</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">become</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">apt</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#98C379">ninja-build</span></span><span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#98C379">gettext</span></span><span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#98C379">libtool</span></span><span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#98C379">libtool-bin</span></span><span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#98C379">autoconf</span></span><span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#98C379">automake</span></span><span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#98C379">cmake</span></span><span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#98C379">g++</span></span><span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#98C379">pkg-config</span></span><span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#98C379">unzip</span></span><span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#98C379">curl</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">state</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">present</span></span><span class="line"><span> </span></span><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Build nvim release version</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">community.general.make</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">chdir</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">deps/neovim</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">params</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">      </span><span style="color:#E06C75">CMAKE_BUILD_TYPE</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Release</span></span><span class="line"><span> </span></span><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Install nvim release version</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">become</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">community.general.make</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">chdir</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">deps/neovim</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">target</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">install</span></span></code></pre>
</div>
<h3 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="installing-efm-langserver">
  
  Installing efm-langserver<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#installing-efm-langserver"><span class="icon icon-link"></span></a>

</h3>
<p><a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://github.com/mattn/efm-langserver"><code>efm-langserver</code></a> is a Language
Server to make any LSP client understand the output of an arbitrary linter or
formatter.</p>
<p>Let’s install it using Ansible too! It’s a Golang app, so we could use the Go
toolchain to install it, but I had too much trouble going down this path, so
now I just download the tarball from GitHub, unpack (with
<code>ansible.builtin.archive</code> module) it and put the binary into my <code>PATH</code> (in
<code>$HOME/.local/bin</code>):</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      yaml
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="ZfI5nk" prefix="r21" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;- name: Create directory ~/.local/bin/\n  file:\n    path: \&quot;{{ ansible_env.HOME }}/.local/bin\&quot;\n    state: directory\n\n- name: Install efm-langserver in Linux\n  unarchive:\n    src: https://github.com/mattn/efm-langserver/releases/download/v0.0.37/efm-langserver_v0.0.37_linux_amd64.tar.gz\n    dest: \&quot;{{ ansible_env.HOME }}/.local/bin\&quot;\n    remote_src: true\n    extra_opts:\n      - \&quot;--strip-components=1\&quot;\n      - \&quot;efm-langserver_v0.0.37_linux_amd64/efm-langserver\&quot;\n  when: ansible_distribution == \&quot;Ubuntu\&quot; or ansible_distribution == \&quot;Fedora\&quot;\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-yaml"><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Create directory ~/.local/bin/</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">file</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">path</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;{{ ansible_env.HOME }}/.local/bin&quot;</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">state</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">directory</span></span><span class="line"><span> </span></span><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Install efm-langserver in Linux</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">unarchive</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">src</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">https://github.com/mattn/efm-langserver/releases/download/v0.0.37/efm-langserver_v0.0.37_linux_amd64.tar.gz</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">dest</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;{{ ansible_env.HOME }}/.local/bin&quot;</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">remote_src</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">extra_opts</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#98C379">&quot;--strip-components=1&quot;</span></span><span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#98C379">&quot;efm-langserver_v0.0.37_linux_amd64/efm-langserver&quot;</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">when</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">ansible_distribution == &quot;Ubuntu&quot; or ansible_distribution == &quot;Fedora&quot;</span></span></code></pre>
</div>
<p><a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://github.com/phelipetls/dotfiles/blob/d10072c4ab01d02018f5caeb1510d3c6c0ebbd95/roles/efm-langserver/tasks/macos.yml">It isn’t as easy to do this in macOS
though</a>,
just because it’s a zip file instead, which lacks the convenience of the
<code>extra_opts</code> parameter… But I might be missing something.</p>
<h3 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="installing-linters-and-formatters">
  
  Installing linters and formatters<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#installing-linters-and-formatters"><span class="icon icon-link"></span></a>

</h3>
<p>I also install the linters and formatters I use with Ansible. Here’s a snippet
of it:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      yaml
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="2gNrE5" prefix="r22" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;- name: Install linters and formatters with dnf\n  become: true\n  dnf:\n    name:\n      - ShellCheck # this is shellcheck in apt and brew\n    state: present\n  when: ansible_distribution == \&quot;Fedora\&quot;\n\n# ...\n\n- name: Install linters and formatters with pip\n  ansible.builtin.pip:\n    name:\n      - flake8\n      - black\n      - yamllint\n      - git+https://github.com/Vimjas/vint@master\n    state: present\n    executable: pip3\n\n- name: Install linters and formatters with npm\n  loop:\n    - eslint_d\n    - prettier\n  community.general.npm:\n    name: \&quot;{{ item }}\&quot;\n    global: true\n    state: present\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-yaml"><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Install linters and formatters with dnf</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">become</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">dnf</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#98C379">ShellCheck</span><span style="color:#ABB2BF"> </span><span style="color:#7F848E"># this is shellcheck in apt and brew</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">state</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">present</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">when</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">ansible_distribution == &quot;Fedora&quot;</span></span><span class="line"><span> </span></span><span class="line"><span style="color:#7F848E"># ...</span></span><span class="line"><span> </span></span><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Install linters and formatters with pip</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">ansible.builtin.pip</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#98C379">flake8</span></span><span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#98C379">black</span></span><span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#98C379">yamllint</span></span><span class="line"><span style="color:#ABB2BF">      - </span><span style="color:#98C379">git+https://github.com/Vimjas/vint@master</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">state</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">present</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">executable</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">pip3</span></span><span class="line"><span> </span></span><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Install linters and formatters with npm</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">loop</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">    - </span><span style="color:#98C379">eslint_d</span></span><span class="line"><span style="color:#ABB2BF">    - </span><span style="color:#98C379">prettier</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">community.general.npm</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;{{ item }}&quot;</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">global</span><span style="color:#ABB2BF">: </span><span style="color:#D19A66">true</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">state</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">present</span></span></code></pre>
</div>
<p><a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://github.com/phelipetls/dotfiles/blob/d10072c4ab01d02018f5caeb1510d3c6c0ebbd95/roles/efm-langserver/tasks/main.yml#L21-L62">If you’re interested, you can look at the file on
GitHub</a>.</p>
<h3 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="stow">
  
  Stow<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#stow"><span class="icon icon-link"></span></a>

</h3>
<p>Stow is a huge part of dotfiles management: it’s responsible to put the
contents of my dofiles into my <code>$HOME</code> directory, as symlinks, while preserving
the same folder structure.</p>
<p>I also install and run Stow in my playbook. There isn’t an Ansible module for
Stow though, so I have to resort to <code>ansible.builtin.shell</code>, which isn’t great
because it’s dumb. But not all is lost, we can make it smarter by tweaking the
task parameters. We can determine if something changed between runs by running
Stow in verbose mode (<code>--verbose=2</code>), to make it describe everything it did,
and then analyze its output.</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      [No name]
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="Z6FvYE" prefix="r23" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;stow dir is /home/phelipe/dotfiles\nstow dir path relative to target /home/phelipe is dotfiles\nPlanning stow of package ....\n--- Skipping .profile as it already points to dotfiles/.profile\nPlanning stow of package .... done\nProcessing tasks...\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code><span class="line"><span>stow dir is /home/phelipe/dotfiles</span></span><span class="line"><span>stow dir path relative to target /home/phelipe is dotfiles</span></span><span class="line"><span>Planning stow of package ....</span></span><span class="line"><span>--- Skipping .profile as it already points to dotfiles/.profile</span></span><span class="line"><span>Planning stow of package .... done</span></span><span class="line"><span>Processing tasks...</span></span></code></pre>
</div>
<p>By looking at the output, we see that Stow says it skipped a file if there is
already a symlink for it in <code>$HOME</code>. But in the case there isn’t, it’ll say it
linked that file, like so:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      [No name]
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="1DWkzC" prefix="r24" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;LINK: .profile =&gt; dotfiles/.profile\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code><span class="line"><span>LINK: .profile =&gt; dotfiles/.profile</span></span></code></pre>
</div>
<p>So if the string <code>LINK</code> is in the stderr, it means a symlink was created,
something changed:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      yaml
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="28DYqB" prefix="r25" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;- name: Run stow\n  shell: \&quot;stow . --target {{ ansible_env.HOME }} --verbose=2\&quot;\n  register: result\n  changed_when: &#39;result.stderr is search(\&quot;LINK: \&quot;)&#39;\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-yaml" metastring="{8}"><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Run stow</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">shell</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;stow . --target {{ ansible_env.HOME }} --verbose=2&quot;</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">register</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">result</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">changed_when</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&#39;result.stderr is search(&quot;LINK: &quot;)&#39;</span></span></code></pre>
</div>
<p>This is a small thing, but it’s just nice to run a playbook and have everything
labelled as “ok”.</p>
<h2 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="gnome">
  
  GNOME<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#gnome"><span class="icon icon-link"></span></a>

</h2>
<p>We can’t customize GNOME with configuration files. We normally configure it
with GUIs, which is not a great thing if we’re interested in automating the
customization step.</p>
<p>Fortunately, there is a command line interface to make this possible called
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://wiki.gnome.org/Projects/dconf"><code>dconf</code></a> (there’s also <code>gsettings</code> but
we won’t use it). The collection <code>community.general</code> has a <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://docs.ansible.com/ansible/latest/collections/community/general/dconf_module.html">module for
<code>dconf</code></a>,
so let’s use it.</p>
<p>For now, I just made two tweaks to my GNOME DE:</p>
<ul>
<li>Click by tapping on the touchpad.</li>
<li>Show battery percentage next to the battery icon.</li>
</ul>
<p>Here are the equivalent tasks:</p>


<div data-codeblock class="last:mb-0" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-[var(--code-bg)] text-[var(--code-fg)] border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;">
    

    <div class="rtl truncate pl-8 text-right font-mono" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      yaml
    </div>

    <div class="ml-auto flex flex-row gap-2 [&_svg]:h-6 [&_svg]:w-6 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">
      

      <astro-island uid="es1Jy" prefix="r26" component-url="/_astro/CopyCodeBlockButton.7cde34a4.js" component-export="default" renderer-url="/_astro/client.e2ed4c61.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;- name: Enable tap to click on touchpad\n  community.general.dconf:\n    key: \&quot;/org/gnome/desktop/peripherals/touchpad/tap-to-click\&quot;\n    value: \&quot;true\&quot;\n\n- name: Show battery percentage\n  community.general.dconf:\n    key: \&quot;/org/gnome/desktop/interface/show-battery-percentage\&quot;\n    value: \&quot;true\&quot;\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded border border-divider p-1 shadow-sm shadow-shadow"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
    </div>
  </div>

  <pre class="shiki shadow-sm shadow-shadow rounded-b overflow-x-auto bg-[var(--code-bg)] text-[var(--code-fg)] [color-scheme:dark] [&#38;_code]:py-4 [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:my-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.popover]:text-white [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700" style="--code-bg: #282c34;--code-fg: #abb2bf;"><code class="language-yaml"><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Enable tap to click on touchpad</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">community.general.dconf</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">key</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;/org/gnome/desktop/peripherals/touchpad/tap-to-click&quot;</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">value</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;true&quot;</span></span><span class="line"><span> </span></span><span class="line"><span style="color:#ABB2BF">- </span><span style="color:#E06C75">name</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">Show battery percentage</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">community.general.dconf</span><span style="color:#ABB2BF">:</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">key</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;/org/gnome/desktop/interface/show-battery-percentage&quot;</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">value</span><span style="color:#ABB2BF">: </span><span style="color:#98C379">&quot;true&quot;</span></span></code></pre>
</div>
<p>But how did I find that I needed this specific key
<code>/org/gnome/desktop/peripherals/touchpad/tap-to-click</code>? That’s the hard part,
but it’s easier if we use
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://wiki.gnome.org/Apps/DconfEditor"><code>dconf-editor</code></a>, a GUI to explore
GNOME applications’ internal settings. Navigate through it until you find the
desired setting that seems responsible for what you want, grab its path and
pass the value you want to it.</p>
<h2 class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2" id="conclusion">
  
  Conclusion<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#conclusion"><span class="icon icon-link"></span></a>

</h2>
<p>You should now be able to automate downloading your favorite programs with your
preferred configuration across operating systems, with tasks/roles written by
you or by the community (which is the nicest part).</p>
<p>The next step should be to test if it really works by using a virtual machine
— the Vagrant and Virtual Box combo seems to be a popular choice.</p>
<p>It’s not wise to assume that your playbook will work on a fresh machine because
you might be relying on a dependency your playbook does not ensure it’s true,
even though it is in your current host.</p>

          </div>
        </div>
      </article>

      <hr class="max-sm:full-bleed mt-8">

      <nav class="flex items-stretch sm:gap-4 max-sm:full-bleed sm:my-8" aria-label="Posts navigation">
  <a class="sm:card flex flex-1 flex-col gap-2 border-0 px-horizontal-padding py-4 transition-colors duration-300 hover:bg-hover" href="/posts/moving-away-from-tiling-window-managers">
        <span class="text-primary">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><line x1="19" x2="5" y1="12" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
        </span>

        Moving away from tiling window managers
      </a>

  <div class="border-l border-divider sm:hidden"></div>

  <a class="sm:card flex flex-1 flex-col-reverse items-end justify-end gap-2 border-0 px-horizontal-padding py-4 text-right transition-colors duration-300 hover:bg-hover" href="/posts/bash-for-javascript-developers">
        Bash for JavaScript developers

        <span class="text-primary">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-right"><line x1="5" x2="19" y1="12" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
        </span>
      </a>
</nav>

      <hr class="max-sm:full-bleed mb-8">
    </div>
  </main>


    <footer class="border-t border-divider bg-background sm:border-0">
  <div class="mx-auto flex w-full max-w-content flex-col items-center px-horizontal-padding pt-4 pb-8 sm:justify-between">
    <nav aria-label="Contacts" class="flex gap-2 mb-2">
  <a id="contact-email" href="mailto:phelipe_teles@hotmail.com" aria-label="E-mail" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 min-w-[40px] h-[40px] flex justify-center items-center rounded-full px-2">
  
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail"><rect width="20" height="16" x="2" y="4" rx="2"></rect><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path></svg>
  
</a>

  <a id="contact-linkedin" href="https://linkedin.com/in/phelipeteles" aria-label="LinkedIn" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 min-w-[40px] h-[40px] flex justify-center items-center rounded-full px-2">
  
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-linkedin"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect width="4" height="12" x="2" y="9"></rect><circle cx="4" cy="4" r="2"></circle></svg>
  
</a>

  <a id="contact-github" href="https://github.com/phelipetls" aria-label="GitHub" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 min-w-[40px] h-[40px] flex justify-center items-center rounded-full px-2">
  
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg>
  
</a>
</nav>

    <span class="text-center">
      
            Todo conteúdo está sob a licença <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0</a>.
          
    </span>
  </div>
</footer>
  </body></html>