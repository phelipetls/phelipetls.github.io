<!DOCTYPE html>
<html class="h-full" lang="en">
  <head>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="description" content="Implementing dark mode in a server side rendered website is not as simple as you may initially think. There are some hacky things we should do to avoid flash of incorrect theme on reload, animation etc." />
<meta name="deploy-date" content="2022-02-01">
<meta name="publish-date" content="2021-04-29">
<meta name="last-modified-date" content="2021-04-29">
<meta name="author" content="">
<meta name="color-scheme" content="dark light">


<link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Merriweather" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather" />






  
  
  


<link rel="stylesheet" href="/css/main.min.css" />
<link rel="stylesheet" href="/css/light-syntax-highlight.min.css" />
<link rel="stylesheet" href="/css/dark-syntax-highlight.min.css" disabled />

<title>
  Implementing dark mode for SSR websites | Phelipe Teles
</title>



<meta property="og:title" content="Implementing dark mode for SSR websites" />
<meta property="og:description" content="Implementing dark mode in a server side rendered website is not as simple as you may initially think. There are some hacky things we should do to avoid flash of incorrect theme on reload, animation etc." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://phelipetls.github.io/posts/dark-mode-implementation-for-ssr-websites/" />
<meta property="article:published_time" content="2021-04-29T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-04-29T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Implementing dark mode for SSR websites"/>
<meta name="twitter:description" content="Implementing dark mode in a server side rendered website is not as simple as you may initially think. There are some hacky things we should do to avoid flash of incorrect theme on reload, animation etc."/>



    
      
    
  </head>

  <body class="px-4 py-8 preload text-normal bg-background flex flex-col container max-w-2xl min-h-full mx-auto transition transition-colors duration-75 ease-out" data-theme="light">
    

    
      
    

    <script>window.__setTheme = function(newTheme) {
  document.body.setAttribute("data-theme", newTheme);
  localStorage.setItem("__theme", newTheme);
  const oldTheme = newTheme === "dark" ? "light" : "dark";
  document
    .querySelector("link[href*='" + oldTheme + "']")
    .setAttribute("disabled", "");
  document
    .querySelector("link[href*='" + newTheme + "']")
    .removeAttribute("disabled");
};

const storedTheme = localStorage.getItem("__theme");

if (storedTheme) {
  window.__setTheme(storedTheme);
} else if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
  window.__setTheme("dark");
}

/* Enable animations */
window.addEventListener("load", function() {
  document.body.classList.remove("preload")
})
</script>

    <header class="mb-16">
  <h1 class="mb-4">
    <div class="flex justify-between">
      <a class="border-0 font-bold" href="https://phelipetls.github.io/">
        Phelipe Teles
      </a>

      <button
        id="theme-button"
        class="text-background bg-primary rounded-lg px-1 ring-divider ring-offset-background focus:ring-offset-2 focus:ring-2"
        aria-label="Change theme"
      >
        <svg width="24" height="24" viewBox="0 0 24 24">
          <defs>
            <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><title>Moon</title><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>

            <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><title>Sun</title><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>

          </defs>

          <use id="theme-button-svg-icon" href="#sun" />
        </svg>
      </button>
    </div>
  </h1>

  

  <nav class="flex flex-row flex-wrap gap-2" aria-label="Main navigation"><a
        id=""
        class="text-normal "
        href="https://phelipetls.github.io/"
      >
        About
      </a><a
        id=""
        class="text-normal "
        href="https://phelipetls.github.io/posts/"
      >
        Posts
      </a><a
        id=""
        class="text-normal "
        href="https://phelipetls.github.io/projects/"
      >
        Projects
      </a><a
        id="resume-download"
        class="text-normal "
        href="https://phelipetls.github.io"
      >
        Resumé
      </a></nav>
</header>


    <main class="flex flex-1 flex-col">
      
  <article>
    <h1>Implementing dark mode for SSR websites</h1>

    <time datetime="2021-04-29">
      Apr 29, 2021
    </time>

    <div class="sm:flex gap-2 mt-4">
      
  
    <a href="/tags/hugo/"class="inline-flex items-center gap-1 no-underline rounded px-3 border border-divider hover:bg-highlight hover:text-background">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag" style="display: inline;"><title>Tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
hugo</a>
  
    <a href="/tags/html/"class="inline-flex items-center gap-1 no-underline rounded px-3 border border-divider hover:bg-highlight hover:text-background">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag" style="display: inline;"><title>Tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
html</a>
  
    <a href="/tags/css/"class="inline-flex items-center gap-1 no-underline rounded px-3 border border-divider hover:bg-highlight hover:text-background">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag" style="display: inline;"><title>Tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
css</a>
  
    <a href="/tags/javascript/"class="inline-flex items-center gap-1 no-underline rounded px-3 border border-divider hover:bg-highlight hover:text-background">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag" style="display: inline;"><title>Tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
javascript</a>
  


    </div>

    <hr class="my-8" />

    <p>Implementing dark mode in a server side rendered website is not as simple as you
may initially think. There are some hacky things we should do to avoid flash of
incorrect theme on reload, animation etc.</p>
<p>In this blog post I&rsquo;ll dive into the implementation details on how to make it
work in general and then on how to implement it in Hugo-powered websites.</p>
<h2 class="group pt-3" id="css">
  CSS
  <a class="hidden text-highlight group-hover:inline" href="#css">#</a>
</h2>
<p>CSS variables makes it very easy to define which colors you&rsquo;ll use for dark or
light mode:</p>
<div class="highlight"><pre class="chroma"><code class="language-css" data-lang="css"><span class="p">:</span><span class="nd">root</span> <span class="p">{</span>
  <span class="nv">--black</span><span class="p">:</span> <span class="mh">#000000</span><span class="p">;</span>
  <span class="nv">--white</span><span class="p">:</span> <span class="mh">#ffffff</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">body</span><span class="o">[</span><span class="nt">data-theme</span><span class="o">=</span><span class="s2">&#34;light&#34;</span><span class="o">]</span> <span class="p">{</span>
  <span class="nv">--bg-color</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="kc">white</span><span class="p">);</span>
  <span class="nv">--fg-color</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="kc">black</span><span class="p">);</span>
<span class="p">}</span>

<span class="nt">body</span><span class="o">[</span><span class="nt">data-theme</span><span class="o">=</span><span class="s2">&#34;dark&#34;</span><span class="o">]</span> <span class="p">{</span>
  <span class="nv">--bg-color</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="kc">black</span><span class="p">);</span>
  <span class="nv">--fg-color</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="kc">white</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>And that&rsquo;s it.</p>
<p>To toggle from one theme to another we just need some JavaScript:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&#34;button.theme-toggler&#34;</span><span class="p">);</span>

<span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">theme</span> <span class="o">===</span> <span class="s2">&#34;dark&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&#34;data-theme&#34;</span><span class="p">,</span> <span class="s2">&#34;light&#34;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&#34;data-theme&#34;</span><span class="p">,</span> <span class="s2">&#34;dark&#34;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div><h2 class="group pt-3" id="theme-persistence">
  Theme persistence
  <a class="hidden text-highlight group-hover:inline" href="#theme-persistence">#</a>
</h2>
<p>To make the theme persist, we&rsquo;ll use
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage"><code>localStorage</code></a>.</p>
<p>Every time the theme changes, we save it to <code>localStorage</code>. When the page
reloads, we read from <code>localStorage</code> and change the theme:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">storedTheme</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s2">&#34;__theme&#34;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">storedTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* Change theme to storedTheme */</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&#34;button.theme-switcher&#34;</span><span class="p">);</span>

<span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="cm">/* Toggle theme */</span>
<span class="p">});</span>
</code></pre></div><p>We just need to put this in a <code>script</code> tag at the end of the <code>body</code> tag to make
it work!&hellip; except the page will flash on reload.</p>
<p>This is because, at the time the script runs, the page has already been drawn in
light mode, and just then we change it to dark mode.</p>
<p>The fix is to set the theme from <code>localStorage</code> <em>as early as possible</em>. But this
also means that we won&rsquo;t be able to add an event listener to the button because
it has yet to be created:</p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">body</span> <span class="na">data-theme</span><span class="o">=</span><span class="s">&#34;light&#34;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="c">&lt;!--</span> <span class="nx">load</span> <span class="nx">theme</span> <span class="nx">from</span> <span class="nx">localStorage</span> <span class="o">--&gt;</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

  ...

  <span class="p">&lt;</span><span class="nt">button</span><span class="p">&gt;</span>Change theme<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="c">&lt;!--</span> <span class="nx">add</span> <span class="nx">button</span> <span class="nx">logic</span> <span class="o">--&gt;</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</code></pre></div><p>But that way we won&rsquo;t be able to share logic between scripts unless (here comes
the hack) we use a global variable.</p>
<p>In the first script, right after the body tag, we set the theme from
<code>localStorage</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nb">window</span><span class="p">.</span><span class="nx">__setTheme</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&#34;data-theme&#34;</span><span class="p">,</span> <span class="nx">newTheme</span><span class="p">);</span>
  <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s2">&#34;__theme&#34;</span><span class="p">,</span> <span class="nx">newTheme</span><span class="p">);</span>
  <span class="c1">// More logic...
</span><span class="c1"></span><span class="p">};</span>

<span class="kr">const</span> <span class="nx">storedTheme</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s2">&#34;__theme&#34;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">storedTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">__setTheme</span><span class="p">(</span><span class="nx">storedTheme</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>Then we make the button change the theme:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&#34;button.theme-toggler&#34;</span><span class="p">);</span>

<span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">theme</span> <span class="o">===</span> <span class="s2">&#34;dark&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">__setTheme</span><span class="p">(</span><span class="s2">&#34;light&#34;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">__setTheme</span><span class="p">(</span><span class="s2">&#34;dark&#34;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div><p><strong>NOTE:</strong> The script tag <em>has</em> to be inline, otherwise the flash will still
happen.</p>
<h2 class="group pt-3" id="transition-between-themes">
  Transition between themes
  <a class="hidden text-highlight group-hover:inline" href="#transition-between-themes">#</a>
</h2>
<p>This works, but we want some animations:</p>
<div class="highlight"><pre class="chroma"><code class="language-css" data-lang="css"><span class="nt">body</span> <span class="p">{</span>
  <span class="k">transition</span><span class="p">:</span> <span class="kc">color</span> <span class="mf">0.25</span><span class="kt">s</span> <span class="kc">ease</span><span class="o">-</span><span class="n">out</span><span class="p">,</span> <span class="k">background</span> <span class="mf">0.25</span><span class="kt">s</span> <span class="kc">ease</span><span class="o">-</span><span class="n">out</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>Now you reload the page and things are broken again, because the transition will
happen on reload.
<a href="https://css-tricks.com/transitions-only-after-page-load/">To prevent this, I used this trick from CSS-Tricks:</a></p>
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">body</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;preload&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-css" data-lang="css"><span class="p">.</span><span class="nc">preload</span> <span class="p">{</span>
  <span class="kp">-webkit-</span><span class="k">transition</span><span class="p">:</span> <span class="kc">none</span> <span class="cp">!important</span><span class="p">;</span>
  <span class="kp">-moz-</span><span class="k">transition</span><span class="p">:</span> <span class="kc">none</span> <span class="cp">!important</span><span class="p">;</span>
  <span class="kp">-ms-</span><span class="k">transition</span><span class="p">:</span> <span class="kc">none</span> <span class="cp">!important</span><span class="p">;</span>
  <span class="kp">-o-</span><span class="k">transition</span><span class="p">:</span> <span class="kc">none</span> <span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;load&#34;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s2">&#34;preload&#34;</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div><h2 class="group pt-3" id="respect-system-preferences">
  Respect system preferences
  <a class="hidden text-highlight group-hover:inline" href="#respect-system-preferences">#</a>
</h2>
<p>Finally, to respect the
<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-color-scheme"><code>prefers-color-scheme</code></a>
media query, we add to our first script:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">storedTheme</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s2">&#34;__theme&#34;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">storedTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">__setTheme</span><span class="p">(</span><span class="nx">storedTheme</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">matchMedia</span><span class="p">(</span><span class="s2">&#34;(prefers-color-scheme: dark)&#34;</span><span class="p">).</span><span class="nx">matches</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">__setTheme</span><span class="p">(</span><span class="s2">&#34;dark&#34;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>So that, if there&rsquo;s nothing in <code>localStorage</code>, we respect system settings.</p>
<h2 class="group pt-3" id="hugo-implementation-details">
  Hugo implementation details
  <a class="hidden text-highlight group-hover:inline" href="#hugo-implementation-details">#</a>
</h2>
<p>In <code>layouts/_default/baseof.html</code> template, we need something like this:</p>
<!-- prettier-ignore -->
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">body</span> <span class="na">data-theme</span><span class="o">=</span><span class="s">&#34;light&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;preload&#34;</span><span class="p">&gt;</span>
    {{ partial &#34;theme.html&#34; }}

    ...

    {{ partial &#34;theme-button.html&#34; }}
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div><p>In <code>partials/theme.html</code> we change theme based on <code>localStorage</code> or
<code>prefers-color-scheme</code>. In <code>layouts/partials/theme-button.html</code> we customize the
button.</p>
<p>Also, to change syntax highlighting colorscheme, we need to add
<code>pygmentsUseClasses = true</code> to our configuration file.</p>
<p>Then, we need to generate stylesheets for each different colorscheme and move
them to our assets folder.</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">hugo gen chromastyles --style<span class="o">=</span>monokai &gt; dark-syntax-highlight.css
hugo gen chromastyles --style<span class="o">=</span>lovelace &gt; light-syntax-highlight.css
</code></pre></div><p>Add them to our html (with the dark stylesheet disabled).</p>
<!-- prettier-ignore -->
<div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">{{ $syntaxHighlight := resources.Get &#34;css/light-syntax-highlight.css&#34; }}
{{ $darkSyntaxHighlight := resources.Get &#34;css/dark-syntax-highlight.css&#34; }}

<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{ $syntaxHighlight.RelPermalink }}&#34;</span> <span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;{{ $darkSyntaxHighlight.RelPermalink }}&#34;</span> <span class="na">disabled</span> <span class="p">/&gt;</span>
</code></pre></div><p>And handle enabling/disabling stylesheet when theme changes with JavaScript:</p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="nb">window</span><span class="p">.</span><span class="nx">__setTheme</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newTheme</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...
</span><span class="c1"></span>  <span class="kr">const</span> <span class="nx">oldTheme</span> <span class="o">=</span> <span class="nx">newTheme</span> <span class="o">===</span> <span class="s2">&#34;dark&#34;</span> <span class="o">?</span> <span class="s2">&#34;light&#34;</span> <span class="o">:</span> <span class="s2">&#34;dark&#34;</span><span class="p">;</span>
  <span class="nb">document</span>
    <span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&#34;link[href*=&#39;&#34;</span> <span class="o">+</span> <span class="nx">oldTheme</span> <span class="o">+</span> <span class="s2">&#34;&#39;]&#34;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&#34;disabled&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">);</span>
  <span class="nb">document</span>
    <span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">&#34;link[href*=&#39;&#34;</span> <span class="o">+</span> <span class="nx">newTheme</span> <span class="o">+</span> <span class="s2">&#34;&#39;]&#34;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">removeAttribute</span><span class="p">(</span><span class="s2">&#34;disabled&#34;</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div><p>And that&rsquo;s it, hopefully we can enjoy dark mode now.</p>


    <hr class="my-8" />

    <nav aria-label="Posts navigation">
      <div class="float-left sm:max-w-1/2 flex group gap-2">
        
          <div class="group-hover:text-highlight">
            ←
          </div>

          <a class="border-0" href="/posts/my-experience-testing-react-applications/" title="Previous post">
            My experience testing React applications
          </a>
        
      </div>

      <div class="float-right text-right mt-2 sm:mt-0 sm:max-w-1/2 flex group justify-end gap-2">
        
          <a class="border-0" href="/posts/extending-vim-with-ripgrep/" title="Next post">
            Extending Vim with ripgrep
          </a>

          <div class="group-hover:text-highlight">
            →
          </div>
        
      </div>
    </nav>
  </article>

    </main>

    <footer class="mt-16 text-center">
  <div>
    Icons by <a class="text-primary" href="https://feathericons.com/">Feather Icons</a>
  </div>

  <div>All content is under the
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
  Creative Commons Attribution 4.0
</a>
license
</div>
</footer>


    

    
    

    
      
      
    

    <script src="https://phelipetls.github.io/js/toggle-theme.js"></script>
    <script src="https://phelipetls.github.io/js/resume-download.js"></script>
  </body>
</html>
