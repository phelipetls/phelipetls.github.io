<!doctype html><html class=h-full lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Thoughts about writing integration tests for React apps, from
react-testing-library to Cypress.">
<meta name=deploy-date content="2022-03-02">
<meta name=publish-date content="2021-04-28">
<meta name=last-modified-date content="2022-02-02">
<meta name=author content>
<meta name=color-scheme content="dark light">
<link rel=icon href=/favicon.ico sizes=any>
<link rel=icon href=/icon.svg type=image/svg+xml>
<link rel=apple-touch-icon href=/apple-touch-icon.png>
<link rel=preconnect href=https://fonts.googleapis.com>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Merriweather&family=Fira+Sans&display=swap" rel=stylesheet>
<link rel=stylesheet href="/css/main.min.css">
<link rel=stylesheet href=/css/dark-syntax-highlight.min.css>
<title>
My experience testing React applications | Phelipe Teles
</title>
<meta property="og:title" content="My experience testing React applications">
<meta property="og:description" content="Thoughts about writing integration tests for React apps, from
react-testing-library to Cypress.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://phelipetls.github.io/posts/my-experience-testing-react-applications/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-04-28T00:00:00+00:00">
<meta property="article:modified_time" content="2022-02-02T23:33:24-03:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="My experience testing React applications">
<meta name=twitter:description content="Thoughts about writing integration tests for React apps, from
react-testing-library to Cypress.">
</head>
<body data-preload class="h-full text-foreground bg-background transition transition-colors duration-500 ease-out">
<script>function storeTheme(a){a&&localStorage.setItem('__theme',a)}function getStoredTheme(){return localStorage.getItem('__theme')}function setTheme(a){a==='auto'&&window.matchMedia('(prefers-color-scheme: dark)').matches&&(a='dark'),a==='dark'?document.body.classList.add('dark'):document.body.classList.remove('dark')}function dispatchNewThemeEvent(a){const b=new CustomEvent('newTheme',{detail:{theme:a}});document.body.dispatchEvent(b)}window.__setTheme=function(a){setTheme(a),storeTheme(a),dispatchNewThemeEvent(a)};const storedTheme=getStoredTheme()||'auto';window.__setTheme(storedTheme),window.addEventListener('load',function(){document.body.removeAttribute('data-preload'),dispatchNewThemeEvent(storedTheme)})</script>
<div data-scroll-container class="flex flex-col min-h-full">
<div data-nav-container class="sticky bg-background bg-opacity-90 backdrop-filter backdrop-blur-sm top-0 my-4 py-4 flex-shrink-0 z-30 will-change-transform transition-transform duration-200 ease-linear" style=transform:translateY(0%)>
<div class="flex items-center justify-between mx-auto max-w-prose px-4">
<nav aria-label="Main navigation">
<div class="flex flex-row flex-wrap gap-2"><a href=https://phelipetls.github.io/>
About
</a><a class=border-primary href=https://phelipetls.github.io/posts/>
Posts
</a><a href=https://phelipetls.github.io/projects/>
Projects
</a><a href=https://phelipetls.github.io/embedded-resume/>
Resum√©
</a></div>
</nav>
<button data-theme-button class="p-1 btn btn-icon" aria-label="Change theme" aria-expanded=false aria-controls=theme-menu aria-haspopup=true><svg width="24" height="24" viewBox="0 0 24 24"><title>Theme icon</title><defs><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg><svg id="monitor" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-monitor"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
</defs>
<use data-theme-button-svg-icon href=#sun>
</svg>
</button>
<ul data-theme-menu id=theme-menu class="absolute bg-background border border-divider rounded z-50 shadow-xl shadow-divider/50 flex flex-col list-none m-0" style=visibility:hidden;opacity:0;pointer-events:none role=menu aria-orientation=vertical aria-activedescendant=theme-option-auto aria-label="Theme options" tabindex=-1>
<li class="px-2 py-1 m-0 cursor-pointer flex items-center gap-1" id=theme-option-light data-theme=light role=menuitem tabindex=-1><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
Light
</li>
<li class="px-2 py-1 m-0 cursor-pointer flex items-center gap-1" id=theme-option-dark data-theme=dark role=menuitem tabindex=-1><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
Dark
</li>
<li class="px-2 py-1 m-0 cursor-pointer flex items-center gap-1" id=theme-option-auto data-theme=auto role=menuitem tabindex=-1><svg id="monitor" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-monitor"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
Auto
</li>
</ul>
</div>
</div>
<div class="my-8 px-4 flex-1 max-w-prose flex flex-col container mx-auto">
<main class="flex flex-1 flex-col">
<article>
<time class="uppercase text-sm" datetime=2021-04-28>
April 28, 2021
</time>
<h1 class="text-4xl mb-4">
My experience testing React applications
</h1>
<div class="text-sm mb-4 italic">
Last modified:
<time datetime=2022-02-02>
February 02, 2022
</time>
</div>
<div class=mb-4>
<a href=/tags/react/ class="no-underline rounded-full border-2 px-2">react</a>
<a href=/tags/javascript/ class="no-underline rounded-full border-2 px-2">javascript</a>
</div>
<hr class=my-8>
<p>Testing is not easy, it&rsquo;s a trade-off: either you slow down new feature
development by writing test to avoid regressions later, or you develop untested
features and bugs will inevitably be introduced later.</p>
<p>But I can understand how that ends up happening: we have to develop new features
fast and we don&rsquo;t have time for tests. It&rsquo;s not easy writing tests, but it&rsquo;s a
skill we have to develop. I try to do this with my side projects.</p>
<p>I started to write tests for my Python projects with the <code>unittest</code> and <code>pytest</code>
libraries. I wasn&rsquo;t very good at it as everything was new to me but I was
obsessed with getting a ~100% test coverage badge in the README so I persisted.
The benefits were obvious: I could refactor all I wanted later.</p>
<p>Sometimes tests got ugly because of all the mock/monkeypatch I needed to do to
make them isolated, which was annoying but it was worth it. It was usually a
seamless and rewarding experience.</p>
<p>But writing tests for React applications is a different beast &ndash; we&rsquo;re testing
user interfaces:</p>
<ul>
<li>Things change, often asynchronously, which means we need to wait for them to
appear or disappear.</li>
<li>We need to simulate user interactions.</li>
<li>There are a lot more network requests to mock, so it&rsquo;s harder to isolate.</li>
<li>Integration test are more useful than unit tests, so tests are more complex.</li>
<li>It&rsquo;s harder to debug (I didn&rsquo;t find an equivalent of <code>pytest --pdb</code>).</li>
<li>It&rsquo;s <strong>much slower</strong>.</li>
</ul>
<p>In this blog post I&rsquo;m going to talk about my experience with JavaScript
libraries for testing front-end web apps.</p>
<h2 class="mb-8 mt-16" id=react-testing-library>
<a class="border-0 text-primary inline-block" href=#react-testing-library>
#
</a>
<code>react-testing-library</code>
</h2>
<p>This library seems to be what everyone is using now, and I do see how that
happened. It has a very consistent API and good documentation.</p>
<p>I liked that:</p>
<ul>
<li>You can get elements on the screen with
<a href=https://testing-library.com/docs/queries/about/>queries that resembles the DOM API</a>
.</li>
<li>You don&rsquo;t have to
<a href=https://kentcdodds.com/blog/common-mistakes-with-react-testing-library#wrapping-things-in-act-unnecessarily>wrap anything in <code>act</code></a>
.</li>
</ul>
<p>I disliked that:</p>
<ul>
<li>It was hard to debug (difficult to grasp the UI state from the output of
<code>screen.debug()</code>)</li>
<li>You have to
<a href=https://testing-library.com/docs/guide-disappearance>wait for appearance and disappearance explicitly</a>
.</li>
<li>Requires some boilerplate to
<a href=%28https://testing-library.com/docs/react-testing-library/setup/%29>set up your tests</a>
(for example, to wrap some components in
<a href=https://reactrouter.com/web/api/MemoryRouter>MemoryRouter</a>
, context
providers,
<a href=https://react-query.tanstack.com/reference/QueryClient>QueryClient</a>
).</li>
<li>Your tests have to run in a node.js/jsdom environment, so (for example) if you
use canvas in your app,
<a href=https://github.com/jsdom/jsdom#canvas-support>it won&rsquo;t work out of the box</a>
.</li>
</ul>
<p>But it got the job done most of the time.</p>
<p>I usually combined it with <code>nock</code> and <code>msw</code> for mocking network requests.</p>
<h2 class="mb-8 mt-16" id=nock>
<a class="border-0 text-primary inline-block" href=#nock>
#
</a>
<code>nock</code>
</h2>
<p>The <code>nock</code> library works in node-only environment and has a well-thought, easy
to use API.</p>
<p>In my experience, it has just a few unexpected issues like
<a href=https://www.npmjs.com/package/nock#axios>not working with axios out of the box</a>
.</p>
<h2 class="mb-8 mt-16" id=msw>
<a class="border-0 text-primary inline-block" href=#msw>
#
</a>
<code>msw</code>
</h2>
<p>I later also tried <code>msw</code> after reading
<a href=https://kentcdodds.com/blog/stop-mocking-fetch/>Stop mocking fetch</a>
by Kent C.
Odds, and I liked it at lot. It can work in a browser (as a service worker) or
node.js (by intercepting requests made by native modules).</p>
<p>The problems I had with it is that it does not recognize URL search/query params
in the URL,
<a href=https://github.com/mswjs/msw/issues/71>you have to parse it yourself in the response handler</a>
.
This is by design though, it&rsquo;s just something I disliked.</p>
<p>Also, all mocks are usually in a separate file, like in <code>./mocks/handlers.js</code>,
which I thought made tests harder to read. It doesn&rsquo;t have to be like that of
course, but it&rsquo;s response handlers can get pretty long so it&rsquo;s a sane option.</p>
<h2 class="mb-8 mt-16" id=cypress>
<a class="border-0 text-primary inline-block" href=#cypress>
#
</a>
<code>cypress</code>
</h2>
<p>All of these led me to try <a href=https://docs.cypress.io/><code>Cypress</code></a>
, and I&rsquo;m
inclined to say it is my favorite solution so far.</p>
<p>You don&rsquo;t have to explicitly wait for anything to appear or disappear because it
does so automatically by
<a href=https://docs.cypress.io/guides/core-concepts/retry-ability>retrying it multiple times until a timeout is reached</a>
and it has a built-in API for mocking network requests with the
<a href=https://docs.cypress.io/api/commands/intercept>intercept function</a>
.</p>
<p>But it&rsquo;s not perfect either:</p>
<ul>
<li>It has its own quirks like using the <code>window</code> object might not work as you
expect because
<a href=https://docs.cypress.io/api/commands/window#Cypress-uses-2-different-windows>Cypress uses two different windows</a>
.</li>
<li>The <code>intercept</code> API has some unexpected behaviors like
<a href=https://github.com/cypress-io/cypress/issues/15956>requiring URLs to be properly encoded</a>
,
and others only recently fixed like its
<a href=https://github.com/cypress-io/cypress/issues/9302>most recent calls not overriding earlier ones</a>
.</li>
</ul>
<p>The benefits far outweigh these problems, mainly around debuggability:</p>
<ul>
<li>Each step (assertion, interceptions) is traced and shown by the test runner.</li>
<li>You have access to browser debugging capabilities, so you have access to the
browser DevTools.</li>
<li>There are snapshots of the UI state for each step.</li>
<li>Screenshots and videos of the test runs are recorded by default.</li>
</ul>
<h2 class="mb-8 mt-16" id=conclusion>
<a class="border-0 text-primary inline-block" href=#conclusion>
#
</a>
Conclusion
</h2>
<p>I think everyone would agree that Cypress is much well-suited for integration
tests. I thought <code>react-testing-library</code> to be complicated for complex
functional tests, so I&rsquo;d prefer to use it for unit testing small component
logic.</p>
</article>
<div class="rounded border-2 border-divider p-4 my-8 shadow">
<p class=text-center>
Subscribe via
<a href=https://phelipetls.github.io/posts/index.xml>RSS</a>
or e-mail. <i>Unsubscribe at any time</i>.
</p>
<form class="embeddable-buttondown-form flex justify-center my-4" action=https://buttondown.email/api/emails/embed-subscribe/phelipetls method=post target=popupwindow onsubmit="window.open('https://buttondown.email/phelipetls','popupwindow')">
<div class=min-w-0>
<label for=bd-email class=hidden>E-mail</label>
<input class="border border-primary h-full p-2 rounded-l" type=email name=email id=bd-email placeholder=E-mail>
</div>
<button class="btn btn-primary rounded-r" type=submit value=Subscribe>
Subscribe
</button>
</form>
<p class=text-center>
<a href=https://buttondown.email target=_blank>
Powered by Buttondown
</a>
</p>
</div>
<hr class=my-8>
<nav class="flex justify-between flex-wrap sm:flex-nowrap gap-2" aria-label="Posts navigation">
<a class="flex basis-1/2 items-center gap-2 border-0" href=/posts/migrating-from-cra-to-vite/ title="Previous post">
<span class=text-primary><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
</span>
Migrating from create-react-app to Vite
</a>
<a class="flex basis-1/2 items-center self-end text-right mt-2 sm:mt-0 h-full justify-end gap-2 border-0" href=/posts/implementing-dark-mode-for-static-websites/ title="Next post">
Implementing dark mode for static websites
<span class=text-primary><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
</span>
</a>
</nav>
</main>
</div>
<footer class="flex flex-col py-8 gap-2">
<div class="flex flex-wrap justify-center">
<nav class="flex gap-2 order-last sm:order-first" aria-label=Links>
<a href=mailto:phelipe_teles@hotmail.com title=E-mail>
E-mail
</a>
<a href=https://linkedin.com/in/phelipeteles title=LinkedIn>
LinkedIn
</a>
<a href=https://github.com/phelipetls title=GitHub>
GitHub
</a>
</nav>
</div>
<p class=text-center>
This content is under a
<a rel=license href=http://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0</a>
license.
</p>
</footer>
</div>
<script type=module src=https://phelipetls.github.io/js/theme-button.min.js></script>
<script type=module src=https://phelipetls.github.io/js/nav.min.js></script>
</body>
</html>