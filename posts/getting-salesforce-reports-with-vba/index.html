<!DOCTYPE html>
<html class="h-full text-base sm:text-lg selection:bg-primary selection:text-on-primary scroll-smooth scroll-pt-nav-height sm:scroll-pt-0" lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="deploy-date" content="2023-04-05">
    <meta name="author" content="Phelipe Teles">
    <meta name="color-scheme" content="dark light">

    <title>Getting Salesforce reports with VBA - Phelipe Teles | Phelipe Teles</title>



<link rel="canonical" href="https://phelipetls.github.io/posts/getting-salesforce-reports-with-vba/">

<meta name="description" content="For those who find themselves in an environment which heavily relies on Excel
and Salesforce, you may be interested in a way to automate the process of
downloading reports from inside Excel with VBA only.">

<meta name="robots" content="index, follow">

<meta property="og:title" content="Getting Salesforce reports with VBA">
<meta property="og:type" content="article">
<meta property="og:image" content="/posts/getting-salesforce-reports-with-vba/image.png">
<meta property="og:url" content="https://phelipetls.github.io/posts/getting-salesforce-reports-with-vba/">


<meta property="article:published_time" content="2020-08-05T00:00:00Z">


<meta property="article:author" content="Phelipe Teles">

<meta property="article:tag" content="salesforce"><meta property="article:tag" content="vba"><meta property="article:tag" content="excel">
<meta name="twitter:card" content="summary_large_image">



<meta content="/posts/getting-salesforce-reports-with-vba/image.png" name="twitter:image">

    

    <meta name="publish-date" content="2020-08-05"><meta name="keywords" content="salesforce, vba, excel"><meta name="description" content="For those who find themselves in an environment which heavily relies on Excel
and Salesforce, you may be interested in a way to automate the process of
downloading reports from inside Excel with VBA only."><style id="sandpack">--sxs{--sxs:1 sp-k-eyOShd sp-k-iOHdLQ}@media{@keyframes sp-k-eyOShd{0%{opacity:0}100%{opacity:1}}@keyframes sp-k-iOHdLQ{0%{transform:rotateX(-25.5deg) rotateY(45deg)}100%{transform:rotateX(-25.5deg) rotateY(405deg)}}}--sxs{--sxs:2 sp-c-gMfcns sp-c-bxeRRt sp-c-hfoyCM sp-c-fWymNx sp-c-euXojQ sp-c-bpmgvy sp-c-dEbKhQ sp-c-eyPpSQ sp-c-PJLV}@media{.sp-c-gMfcns svg{margin:auto}.sp-c-bxeRRt{-webkit-appearance:none;appearance:none;outline:none;display:flex;align-items:center;font-size:inherit;font-family:inherit;background-color:transparent;transition:color var(--sp-transitions-default), background var(--sp-transitions-default);cursor:pointer;color:var(--sp-colors-clickable);border:0;text-decoration:none}.sp-c-bxeRRt:disabled{color:var(--sp-colors-disabled)}.sp-c-bxeRRt:hover:not(:disabled,[data-active='true']){color:var(--sp-colors-hover)}.sp-c-bxeRRt[data-active="true"]{color:var(--sp-colors-accent)}.sp-c-bxeRRt svg{min-width:var(--sp-space-4);width:var(--sp-space-4);height:var(--sp-space-4)}.sp-c-bxeRRt.sp-c-gMfcns{padding:var(--sp-space-1);height:var(--sp-space-7);display:flex}.sp-c-bxeRRt.sp-c-gMfcns.sp-c-bxeRRt:not(:has(span)){width:var(--sp-space-7)}.sp-c-bxeRRt.sp-c-gMfcns.sp-c-bxeRRt:has(svg + span){padding-right:var(--sp-space-3);padding-left:var(--sp-space-2);gap:var(--sp-space-1)}.sp-c-hfoyCM{padding:0 var(--sp-space-1) 0 var(--sp-space-1);border-radius:var(--sp-border-radius);margin-left:var(--sp-space-1);width:var(--sp-space-5);visibility:hidden}.sp-c-hfoyCM svg{width:var(--sp-space-3);height:var(--sp-space-3);display:block;position:relative;top:1px}.sp-c-fWymNx{margin:0;display:block;font-family:var(--sp-font-mono);font-size:var(--sp-font-size);color:var(--sp-syntax-color-plain);line-height:var(--sp-font-lineHeight)}.sp-c-euXojQ{display:flex;flex-direction:column;width:100%;position:relative;background-color:var(--sp-colors-surface1);gap:1px}.sp-c-euXojQ:has(.sp-stack){background-color:var(--sp-colors-surface2)}.sp-c-bpmgvy{transform:translate(-4px, 9px) scale(0.13, 0.13)}.sp-c-bpmgvy *{position:absolute;width:96px;height:96px}.sp-c-dEbKhQ{background-color:var(--sp-colors-surface2);border-radius:99999px;border:1px solid var(--sp-colors-surface3)}.sp-c-dEbKhQ[data-active="true"]{color:var(--sp-colors-surface1);background:var(--sp-colors-accent)}.sp-c-dEbKhQ:hover:not(:disabled,[data-active='true']){background-color:var(--sp-colors-surface3)}.sp-c-eyPpSQ{padding:var(--sp-space-1) var(--sp-space-3)}}--sxs{--sxs:3 sp-c-PJLV-kCOVwI-status-pass sp-c-PJLV-kEzYsr-status-fail sp-c-PJLV-gHAhSA-status-skip sp-c-PJLV-jgnHyR-status-title sp-c-PJLV-iCgxLS-status-run sp-c-PJLV-bnDZSy-status-pass sp-c-PJLV-eYuGwt-status-fail}@media{.sp-c-PJLV-kCOVwI-status-pass{color:var(--test-pass)}.sp-c-PJLV-kEzYsr-status-fail{color:var(--test-fail)}.sp-c-PJLV-gHAhSA-status-skip{color:var(--test-skip)}.sp-c-PJLV-jgnHyR-status-title{color:var(--test-title)}.sp-c-PJLV-iCgxLS-status-run{background:var(--test-run);color:var(--sp-colors-surface1)}.sp-c-PJLV-bnDZSy-status-pass{background:var(--test-pass);color:var(--sp-colors-surface1)}.sp-c-PJLV-eYuGwt-status-fail{background:var(--test-fail);color:var(--sp-colors-surface1)}}</style>
  <link rel="stylesheet" href="/_astro/_id_.efcd29d4.css" />
<link rel="stylesheet" href="/_astro/_id_.0f1f195f.css" /><script type="module" src="/_astro/hoisted.fc07dece.js"></script></head>

  <body data-preload class="relative flex h-full flex-col bg-background font-sans text-on-background">
    <script>
  // @ts-check
  const storedThemeChoice = window.localStorage.getItem('__theme') ?? 'system'

  window.__setTheme = setTheme
  // prettier-ignore
  window.__setTheme(/** @type {ThemeChoice} */ (storedThemeChoice))

  /**
   * @type {(themeChoice: ThemeChoice) => void}
   */
  function setTheme(themeChoice) {
    let theme = themeChoice

    if (themeChoice === 'system') {
      theme = window.matchMedia('(prefers-color-scheme: dark)').matches
        ? 'dark'
        : 'light'
    }

    document.body.classList.toggle('dark', theme === 'dark')

    window.localStorage.setItem('__theme', themeChoice)

    document.body.dispatchEvent(
      new CustomEvent('newTheme', {
        detail: {
          themeChoice,
          theme,
        },
      })
    )
  }

  window.addEventListener('storage', function (e) {
    const newTheme = e.newValue
    if (newTheme && newTheme && e.key === '__theme') {
      // prettier-ignore
      window.__setTheme(/** @type {ThemeChoice} */ (newTheme))
    }
  })

  window.addEventListener('load', function () {
    document.body.removeAttribute('data-preload')
  })
</script>

    <div class="mb-8 w-full">
  <div class="pt-nav-height sm:hidden">
    <div class="fixed top-0 left-0 z-30 flex w-screen justify-between rounded-none border-b border-divider bg-background/90 py-4 px-horizontal-padding backdrop-blur">
  <div class="flex flex-row items-center gap-2 overflow-hidden">
    <a class="border-0" href="/posts/" data-testid="parent-page-link" aria-label="Go back to previous page">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left"><polyline points="15 18 9 12 15 6"></polyline></svg>
        </a>

    <h2 class="m-0 truncate font-sans font-normal">Getting Salesforce reports with VBA - Phelipe Teles</h2>
  </div>

  <button data-a11y-dialog-show="sidenav" class="btn btn-icon" data-testid="open-sidenav" aria-label="Open navigation sidebar">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" y1="12" x2="20" y2="12"></line><line x1="4" y1="6" x2="20" y2="6"></line><line x1="4" y1="18" x2="20" y2="18"></line></svg>
  </button>
</div>
  </div>

  <div class="hidden h-full w-full sm:block">
    <div class="flex h-full w-full items-center justify-between bg-background pr-horizontal-padding">
  <div class="mx-auto flex h-full w-full max-w-content justify-between">
    <nav class="flex h-full justify-between overflow-x-auto px-horizontal-padding" aria-label="Main navigation">
      <ul class="m-0 flex list-none flex-row flex-nowrap items-center gap-2">
        <li>
                <a id="about" href="/" class="hover:bg-hover relative flex items-center justify-center rounded border-0 py-1 px-2 transition-colors duration-300">
                  About
                </a>
              </li><li>
                <a id="posts" href="/posts" class="bg-primary text-on-primary card hover:bg-primary-hover relative flex items-center justify-center rounded border-0 py-1 px-2 transition-colors duration-300" aria-current="page">
                  Posts
                </a>
              </li><li>
                <a id="resume" href="/resume" class="hover:bg-hover relative flex items-center justify-center rounded border-0 py-1 px-2 transition-colors duration-300">
                  Résumé
                </a>
              </li>
      </ul>
    </nav>

    <div class="h-full py-3">
      <div class="flex h-full flex-row items-stretch gap-2 pl-2">
        <div class="relative flex h-full flex-row items-center">
  <span class="pointer-events-none absolute left-2 top-1/2 -translate-y-1/2 text-sm">
    <svg class="feather" viewBox="0 0 24 24" width="24" height="24">
      <title>Theme icon</title>

      <defs>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon" id="moon"><path d="M12 3a6.364 6.364 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun" id="sun"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-monitor" id="monitor"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
      </defs>

      <use data-theme-select-icon href="#monitor"></use>
    </svg>
  </span>

  <select class="card h-full appearance-none bg-surface py-1 px-8 text-center" data-theme-select aria-label="Choose a theme">
    <option value="light">Light</option>
    <option value="dark">Dark</option>
    <option value="system">System</option>
  </select>

  <span class="pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 text-sm">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>
  </span>
</div>
      </div>
    </div>
  </div>
</div>
  </div>
</div>
    <aside data-a11y-dialog="sidenav" aria-hidden="true" class="fixed z-50 h-full w-full" style="visibility: hidden;">
  <div data-a11y-dialog-hide class="fixed inset-0 -z-1 w-full bg-neutral-700 bg-opacity-75 backdrop-blur-sm">
  </div>

  <div role="document" class="ml-auto h-full w-3/4 rounded-none bg-background py-0 will-change-transform">
    <div class="flex h-full flex-col justify-between">
      <div class="mb-2 flex h-nav-height items-center justify-end px-horizontal-padding">
        <button data-a11y-dialog-hide class="btn btn-icon" aria-label="Close">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
      </div>

      <nav class="flex flex-1 flex-col" aria-label="Main navigation">
        <ul class="m-0 flex list-none flex-col items-center justify-center gap-4 px-horizontal-padding">
          <li class="w-full">
                  <a id="about" href="/" class="hover:bg-hover block w-full rounded border-0 p-2 text-center text-xl transition-colors duration-300">
                    About
                  </a>
                </li><li class="w-full">
                  <a id="posts" href="/posts" class="card bg-primary text-on-primary hover:bg-primary-hover block w-full rounded border-0 p-2 text-center text-xl transition-colors duration-300" aria-current="page">
                    Posts
                  </a>
                </li><li class="w-full">
                  <a id="resume" href="/resume" class="hover:bg-hover block w-full rounded border-0 p-2 text-center text-xl transition-colors duration-300">
                    Résumé
                  </a>
                </li>
        </ul>
      </nav>

      <div class="mb-4 flex h-12 flex-row items-center justify-center px-horizontal-padding">
        <div class="relative flex h-full flex-row items-center">
  <span class="pointer-events-none absolute left-2 top-1/2 -translate-y-1/2 text-sm">
    <svg class="feather" viewBox="0 0 24 24" width="24" height="24">
      <title>Theme icon</title>

      <defs>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon" id="moon"><path d="M12 3a6.364 6.364 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun" id="sun"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-monitor" id="monitor"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
      </defs>

      <use data-theme-select-icon href="#monitor"></use>
    </svg>
  </span>

  <select class="card h-full appearance-none bg-surface py-1 px-8 text-center" data-theme-select aria-label="Choose a theme">
    <option value="light">Light</option>
    <option value="dark">Dark</option>
    <option value="system">System</option>
  </select>

  <span class="pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 text-sm">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>
  </span>
</div>
      </div>
    </div>
  </div>
</aside>

    <main class="grid grid-cols-layout">
    <div class="col-full max-w-full rounded-none px-horizontal-padding pt-8 shadow-none sm:col-content sm:px-0">
      <article>
        <header>
          <h1 class="mb-4 text-4xl">
            Getting Salesforce reports with VBA
          </h1>

          <div class="mb-4 flex flex-col gap-2">
            <div class="flex items-center gap-2">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>

  <div>9 min.</div>
</div>

            <div class="flex items-center gap-2">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>

  <time datetime="2020-08-05">
    August 05, 2020
  </time>
</div>
          </div>

          <div class="mb-4 flex flex-wrap gap-2">
                <a class="inline-flex w-fit items-center justify-center rounded-full border border-divider bg-surface px-4 no-underline shadow shadow-shadow transition-colors duration-300 hover:border-divider hover:bg-hover whitespace-nowrap" href="/tags/salesforce">
  salesforce
</a><a class="inline-flex w-fit items-center justify-center rounded-full border border-divider bg-surface px-4 no-underline shadow shadow-shadow transition-colors duration-300 hover:border-divider hover:bg-hover whitespace-nowrap" href="/tags/vba">
  vba
</a><a class="inline-flex w-fit items-center justify-center rounded-full border border-divider bg-surface px-4 no-underline shadow shadow-shadow transition-colors duration-300 hover:border-divider hover:bg-hover whitespace-nowrap" href="/tags/excel">
  excel
</a>

                <a class="inline-flex w-fit items-center justify-center rounded-full border border-divider bg-surface px-4 no-underline shadow shadow-shadow transition-colors duration-300 hover:border-divider hover:bg-hover whitespace-nowrap" href="/tags">
  ...
</a>
              </div>
        </header>

        <hr class="my-8">

        <div class="flex flex-col-reverse lg:grid lg:grid-cols-[minmax(65ch,1fr),1fr]">
          <div data-blog-post class="[&#38;>pre]:full-width-on-mobile [&#38;>figure]:full-width-on-mobile [&#38;>[data-codeblock]]:full-width-on-mobile [&#38;>[data-codeblock]_pre]:max-sm:rounded-none [&#38;>[data-codeblock-with-header]]:mt-16 [&#38;_img]:mx-auto [&#38;>hr]:border-0 [&#38;>hr]:text-center [&#38;>hr]:after:content-['⁂'] [&#38;>pre]:my-8 [&#38;>figure]:my-8 [&#38;>img]:my-8 [&#38;>astro-island>div]:my-8 [&#38;>lite-youtube]:my-8 [&#38;>blockquote]:my-8 [&#38;>figure_video]:min-h-[15em] [&#38;_.katex-display]:overflow-x-auto [&#38;_.katex-display]:overflow-y-hidden [&#38;_*:where(h2,h3,h4,h5,h6)]:mb-8 [&#38;_*:where(h2,h3,h4,h5,h6)]:mt-4 [&#38;_*:where(h2,h3,h4,h5,h6)]:pt-4 [&#38;_*:where(h2,h3,h4,h5,h6)_a]:text-primary [&#38;_*:where(h2,h3,h4,h5,h6)_a]:border-0 [&#38;_*:where(h2,h3,h4,h5,h6)_a]:before:content-[&#34;_#&#34;]">
            <p>For those who find themselves in an environment which heavily relies on Excel
and Salesforce, you may be interested in a way to automate the process of
downloading reports from inside Excel with VBA only.</p>
<p>I think there are probably better tools for the job, like Apex, SOQL query or a
better programming language. I
<a href="https://github.com/reportforce">created a Python package for this purpose</a> but
I didn’t use it so much because it’s hard to integrate with Excel.</p>
<p>Instead, I looked into a way to do something similar with VBA and I managed to
do it. In this post I’ll share this with you.</p>
<h2 id="authentication">Authentication<a aria-hidden="true" tabIndex="-1" href="#authentication"><span class="icon icon-link"></span></a></h2>
<p>The more painless way I know of to
<a href="https://developer.salesforce.com/docs/atlas.en-us.api_asynch.meta/api_asynch/asynch_api_quickstart_login.htm">authenticate your requests for a Salesforce web service is via SOAP API</a>,
with username, password and a security token.</p>
<p>It returns a bunch of XML in the response, but we will only need the session id
(a JWT) inside of it. This is what the function below does.</p>
<p>From here onwards, we will need to authenticate every request by passing the
header <code>Authorization: Bearer $sessionId</code>.</p>


<div data-codeblock class="mt-16 group relative mb-8" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <pre class="relative shiki shadow shadow-shadow overflow-x-auto rounded rounded-tl-none bg-[var(--code-bg)] text-[var(--code-fg)] py-4 [color-scheme:dark] [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:mt-2 [&#38;_.popover]:mb-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700 [&#38;_.popover]:text-white"><code class="language-vb"><span class="line"><span style="color:#C678DD">Function </span><span style="color:#61AFEF">SalesforceLogin</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Username</span><span style="color:#ABB2BF"> As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                         Password As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                         SecurityToken As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">) As </span><span style="color:#E5C07B">String</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Request </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Set </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF"> = </span><span style="color:#56B6C2">CreateObject</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;MSXML2.XMLHTTP.6.0&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> XMLBody </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> XMLResponse </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Set </span><span style="color:#E06C75">XMLBody</span><span style="color:#ABB2BF"> = </span><span style="color:#56B6C2">CreateObject</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;MSXML2.DOMDocument.6.0&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Set </span><span style="color:#E06C75">XMLResponse</span><span style="color:#ABB2BF"> = </span><span style="color:#56B6C2">CreateObject</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;MSXML2.DOMDocument.6.0&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Url </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Body </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Response </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">Url</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">&quot;https://login.salesforce.com/services/Soap/u/47.0&quot;</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">Body</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">&quot;&lt;?xml version=&quot;&quot;1.0&quot;&quot; encoding=&quot;&quot;utf-8&quot;&quot; ?&gt;&quot;</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">           </span><span style="color:#98C379">&quot;&lt;env:Envelope xmlns:xsd=&quot;&quot;http://www.w3.org/2001/XMLSchema&quot;&quot;&quot;</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">           </span><span style="color:#98C379">&quot;    xmlns:xsi=&quot;&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&quot;&quot;</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">           </span><span style="color:#98C379">&quot;    xmlns:env=&quot;&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&quot;&gt;&quot;</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">           </span><span style="color:#98C379">&quot;  &lt;env:Body&gt;&quot;</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">           </span><span style="color:#98C379">&quot;    &lt;n1:login xmlns:n1=&quot;&quot;urn:partner.soap.sforce.com&quot;&quot;&gt;&quot;</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">           </span><span style="color:#98C379">&quot;      &lt;n1:username&gt;&quot;</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> Username</span><span style="color:#ABB2BF"> &amp; </span><span style="color:#98C379">&quot;&lt;/n1:username&gt;&quot;</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">           </span><span style="color:#98C379">&quot;      &lt;n1:password&gt;&quot;</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> Password</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> SecurityToken</span><span style="color:#ABB2BF"> &amp; </span><span style="color:#98C379">&quot;&lt;/n1:password&gt;&quot;</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">           </span><span style="color:#98C379">&quot;    &lt;/n1:login&gt;&quot;</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">           </span><span style="color:#98C379">&quot;  &lt;/env:Body&gt;&quot;</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">           </span><span style="color:#98C379">&quot;&lt;/env:Envelope&gt;&quot;</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    XMLBody.LoadXML Body</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF">.Open </span><span style="color:#98C379">&quot;POST&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> Url</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66"> False</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF">.setRequestHeader </span><span style="color:#98C379">&quot;Content-Type&quot;</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">&quot;text/xml&quot;</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF">.setRequestHeader </span><span style="color:#98C379">&quot;SOAPAction&quot;</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">&quot;login&quot;</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF">.send XMLBody.XML</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E5C07B">Response</span><span style="color:#ABB2BF"> = </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF">.responseText</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    XMLResponse.LoadXML </span><span style="color:#E5C07B">Response</span></span><span class="line"><span style="color:#ABB2BF">    XMLResponse.setProperty </span><span style="color:#98C379">&quot;SelectionNamespaces&quot;</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">&quot;xmlns:soapenv=&quot;&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&quot; xmlns:urn=&quot;&quot;urn:partner.soap.sforce.com&quot;&quot;&quot;</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> SessionId </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span><span class="line"><span style="color:#ABB2BF">    SessionId = XMLResponse.</span><span style="color:#61AFEF">SelectSingleNode</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;//urn:result/urn:sessionId&quot;</span><span style="color:#ABB2BF">).Text</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">SalesforceLogin</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> SessionId</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Set </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF"> =</span><span style="color:#D19A66"> Nothing</span></span><span class="line"></span><span class="line"><span style="color:#C678DD">End Function</span></span><span class="line"></span></code></pre>

  <div class="dark text-md absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-[100%] overflow-hidden sm:left-0">
    <div class="flex items-center gap-2 rounded-t border-t border-primary bg-[var(--code-bg)] px-2 py-1 text-[var(--code-fg)]">
      <div class="shrink-0">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
      </div>

      <div class="capitalize">vb</div>
    </div>
  </div>

  <div class="dark flex flex-row gap-2 absolute top-3 right-[var(--horizontal-padding)] text-2xl [&#38;_svg]:h-[1em] [&#38;_svg]:w-[1em] [&#38;_:is(button,a)]:opacity-0 [&#38;_:is(button,a)]:pointer-events-none [&#38;_:is(button,a)]:transition-opacity [&#38;_:is(button,a)]:duration-500 [&#38;_:is(button,a):focus-visible]:opacity-100 [&#38;_:is(button,a):focus-visible]:pointer-events-auto group-hover:[&#38;_:is(button,a)]:opacity-100 group-hover:[&#38;_:is(button,a)]:pointer-events-auto">
    

    <style>astro-island,astro-slot{display:contents}</style><script>(self.Astro=self.Astro||{}).load=a=>{(async()=>await(await a())())()},window.dispatchEvent(new Event("astro:load"));var l;{const c={0:t=>t,1:t=>JSON.parse(t,o),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(JSON.parse(t,o)),5:t=>new Set(JSON.parse(t,o)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(JSON.parse(t)),9:t=>new Uint16Array(JSON.parse(t)),10:t=>new Uint32Array(JSON.parse(t))},o=(t,s)=>{if(t===""||!Array.isArray(s))return s;const[e,n]=s;return e in c?c[e](n):void 0};customElements.get("astro-island")||customElements.define("astro-island",(l=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=()=>{if(!this.hydrator||this.parentElement&&this.parentElement.closest("astro-island[ssr]"))return;const s=this.querySelectorAll("astro-slot"),e={},n=this.querySelectorAll("template[data-astro-template]");for(const r of n){const i=r.closest(this.tagName);!i||!i.isSameNode(this)||(e[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(const r of s){const i=r.closest(this.tagName);!i||!i.isSameNode(this)||(e[r.getAttribute("name")||"default"]=r.innerHTML)}const a=this.hasAttribute("props")?JSON.parse(this.getAttribute("props"),o):{};this.hydrator(this)(this.Component,a,e,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),window.removeEventListener("astro:hydrate",this.hydrate),window.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((s,e)=>{e.disconnect(),this.childrenConnectedCallback()}).observe(this,{childList:!0})}async childrenConnectedCallback(){window.addEventListener("astro:hydrate",this.hydrate);let s=this.getAttribute("before-hydration-url");s&&await import(s),this.start()}start(){const s=JSON.parse(this.getAttribute("opts")),e=this.getAttribute("client");if(Astro[e]===void 0){window.addEventListener(`astro:${e}`,()=>this.start(),{once:!0});return}Astro[e](async()=>{const n=this.getAttribute("renderer-url"),[a,{default:r}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(const d of i.split("."))this.Component=this.Component[d]}return this.hydrator=r,this.hydrate},s,this)}attributeChangedCallback(){this.hydrator&&this.hydrate()}},l.observedAttributes=["props"],l))}</script><astro-island uid="Z20mBB5" component-url="/_astro/CopyCodeBlockButton.e58fef01.js" component-export="default" renderer-url="/_astro/client.47a71f61.js" props="{&quot;aria-label&quot;:[0,&quot;Copy code&quot;],&quot;tooltipText&quot;:[0,&quot;Copied!&quot;],&quot;code&quot;:[0,&quot;Function SalesforceLogin(Username As String, _\n                         Password As String, _\n                         SecurityToken As String) As String\n\n    Dim Request As Object\n    Set Request = CreateObject(\&quot;MSXML2.XMLHTTP.6.0\&quot;)\n\n    Dim XMLBody As Object\n    Dim XMLResponse As Object\n\n    Set XMLBody = CreateObject(\&quot;MSXML2.DOMDocument.6.0\&quot;)\n    Set XMLResponse = CreateObject(\&quot;MSXML2.DOMDocument.6.0\&quot;)\n\n    Dim Url As String\n    Dim Body As String\n    Dim Response As String\n\n    Url = \&quot;https://login.salesforce.com/services/Soap/u/47.0\&quot;\n\n    Body = \&quot;&lt;?xml version=\&quot;\&quot;1.0\&quot;\&quot; encoding=\&quot;\&quot;utf-8\&quot;\&quot; ?&gt;\&quot; &amp; vbNewLine &amp; _\n           \&quot;&lt;env:Envelope xmlns:xsd=\&quot;\&quot;http://www.w3.org/2001/XMLSchema\&quot;\&quot;\&quot; &amp; vbNewLine &amp; _\n           \&quot;    xmlns:xsi=\&quot;\&quot;http://www.w3.org/2001/XMLSchema-instance\&quot;\&quot;\&quot; &amp; vbNewLine &amp; _\n           \&quot;    xmlns:env=\&quot;\&quot;http://schemas.xmlsoap.org/soap/envelope/\&quot;\&quot;&gt;\&quot; &amp; vbNewLine &amp; _\n           \&quot;  &lt;env:Body&gt;\&quot; &amp; vbNewLine &amp; _\n           \&quot;    &lt;n1:login xmlns:n1=\&quot;\&quot;urn:partner.soap.sforce.com\&quot;\&quot;&gt;\&quot; &amp; vbNewLine &amp; _\n           \&quot;      &lt;n1:username&gt;\&quot; &amp; Username &amp; \&quot;&lt;/n1:username&gt;\&quot; &amp; vbNewLine &amp; _\n           \&quot;      &lt;n1:password&gt;\&quot; &amp; Password &amp; SecurityToken &amp; \&quot;&lt;/n1:password&gt;\&quot; &amp; vbNewLine &amp; _\n           \&quot;    &lt;/n1:login&gt;\&quot; &amp; vbNewLine &amp; _\n           \&quot;  &lt;/env:Body&gt;\&quot; &amp; vbNewLine &amp; _\n           \&quot;&lt;/env:Envelope&gt;\&quot;\n\n    XMLBody.LoadXML Body\n\n    Request.Open \&quot;POST\&quot;, Url, False\n    Request.setRequestHeader \&quot;Content-Type\&quot;, \&quot;text/xml\&quot;\n    Request.setRequestHeader \&quot;SOAPAction\&quot;, \&quot;login\&quot;\n    Request.send XMLBody.XML\n    Response = Request.responseText\n\n    XMLResponse.LoadXML Response\n    XMLResponse.setProperty \&quot;SelectionNamespaces\&quot;, \&quot;xmlns:soapenv=\&quot;\&quot;http://schemas.xmlsoap.org/soap/envelope/\&quot;\&quot; xmlns:urn=\&quot;\&quot;urn:partner.soap.sforce.com\&quot;\&quot;\&quot;\n\n    Dim SessionId As String\n    SessionId = XMLResponse.SelectSingleNode(\&quot;//urn:result/urn:sessionId\&quot;).Text\n\n    SalesforceLogin = SessionId\n\n    Set Request = Nothing\n\nEnd Function\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" class="flex items-center justify-center flex-row gap-2 transition-colors duration-300 hover:bg-hover disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled bg-background text-on-background rounded border border-divider p-1 shadow shadow-shadow" aria-label="Copy code"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
  </div>
</div>
<h2 id="parsing-json-inside-vba">Parsing JSON inside VBA?<a aria-hidden="true" tabIndex="-1" href="#parsing-json-inside-vba"><span class="icon icon-link"></span></a></h2>
<p>Now, to get an actual report inside Excel we will need to use the Analytics API.
So far, we didn’t had to rely on any external tools, there is an XML parser
inside VBA, but not a JSON parser at least that I know of. So we’re in trouble
here because that’s what Analytics speaks.</p>
<p>Fortunately, there is a
<a href="https://github.com/VBA-tools/VBA-JSON">JSON parser implementation for VBA</a>
which works flawlessly. You just need to download
<a href="https://raw.githubusercontent.com/VBA-tools/VBA-JSON/master/JsonConverter.bas">this file</a>
and import it as a module.</p>
<h2 id="unfortunate-api-limitations">Unfortunate API limitations<a aria-hidden="true" tabIndex="-1" href="#unfortunate-api-limitations"><span class="icon icon-link"></span></a></h2>
<p>This API unfortunately have a
<a href="https://developer.salesforce.com/docs/atlas.en-us.api_analytics.meta/api_analytics/sforce_analytics_rest_api_limits_limitations.htm">critical limitation</a>,
which is to return only a maximum of 2000 rows per report. Also, there is no way
to filter by row limits.</p>
<p>This almost turns it useless. The only way I know of is to use a column which
has only unique values and exclude already seen values with a filter, which is
what we’ll gonna do.</p>
<h2 id="getting-report-metadata">Getting report metadata<a aria-hidden="true" tabIndex="-1" href="#getting-report-metadata"><span class="icon icon-link"></span></a></h2>
<p>To be able to filter a report, we will need to fetch its metadata, which is a
huge JSON with key-value pairs describing the report.</p>
<p>We can get it with a <code>GET</code> request to
<code>https://$YOUR_INSTANCE_URL/services/data/v47.0/analytics/reports/$REPORT_ID/describe</code>.</p>


<div data-codeblock class="mt-16 group relative mb-8" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <pre class="relative shiki shadow shadow-shadow overflow-x-auto rounded rounded-tl-none bg-[var(--code-bg)] text-[var(--code-fg)] py-4 [color-scheme:dark] [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:mt-2 [&#38;_.popover]:mb-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700 [&#38;_.popover]:text-white"><code class="language-vb"><span class="line"><span style="color:#C678DD">Function</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">GetMetadata</span><span style="color:#ABB2BF">(</span><span style="color:#ABB2BF">ReportId As String, SessionId As String</span><span style="color:#ABB2BF">) As String</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Request </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Set </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF"> = </span><span style="color:#56B6C2">CreateObject</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;MSXML2.XMLHTTP.6.0&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Response </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Url </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#7F848E">&#39; NOTE: You will need your organization URL here</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">Url</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75">  YOUR_INSTANCE_URL</span><span style="color:#ABB2BF"> &amp; </span><span style="color:#98C379">&quot;/services/data/v47.0/analytics/reports/&quot;</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> ReportId</span><span style="color:#ABB2BF"> &amp; </span><span style="color:#98C379">&quot;/describe&quot;</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF">.Open </span><span style="color:#98C379">&quot;GET&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> Url</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66"> False</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF">.setRequestHeader </span><span style="color:#98C379">&quot;Authorization&quot;</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">&quot;Bearer &quot;</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> SessionId</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF">.send</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">GetMetadata</span><span style="color:#ABB2BF"> = </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF">.responseText</span></span><span class="line"><span style="color:#C678DD">End Function</span></span><span class="line"></span></code></pre>

  <div class="dark text-md absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-[100%] overflow-hidden sm:left-0">
    <div class="flex items-center gap-2 rounded-t border-t border-primary bg-[var(--code-bg)] px-2 py-1 text-[var(--code-fg)]">
      <div class="shrink-0">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
      </div>

      <div class="capitalize">vb</div>
    </div>
  </div>

  <div class="dark flex flex-row gap-2 absolute top-3 right-[var(--horizontal-padding)] text-2xl [&#38;_svg]:h-[1em] [&#38;_svg]:w-[1em] [&#38;_:is(button,a)]:opacity-0 [&#38;_:is(button,a)]:pointer-events-none [&#38;_:is(button,a)]:transition-opacity [&#38;_:is(button,a)]:duration-500 [&#38;_:is(button,a):focus-visible]:opacity-100 [&#38;_:is(button,a):focus-visible]:pointer-events-auto group-hover:[&#38;_:is(button,a)]:opacity-100 group-hover:[&#38;_:is(button,a)]:pointer-events-auto">
    

    <astro-island uid="2i8D13" component-url="/_astro/CopyCodeBlockButton.e58fef01.js" component-export="default" renderer-url="/_astro/client.47a71f61.js" props="{&quot;aria-label&quot;:[0,&quot;Copy code&quot;],&quot;tooltipText&quot;:[0,&quot;Copied!&quot;],&quot;code&quot;:[0,&quot;Function GetMetadata(ReportId As String, SessionId As String) As String\n    Dim Request As Object\n    Set Request = CreateObject(\&quot;MSXML2.XMLHTTP.6.0\&quot;)\n    Dim Response As String\n    Dim Url As String\n\n    &#39; NOTE: You will need your organization URL here\n    Url =  YOUR_INSTANCE_URL &amp; \&quot;/services/data/v47.0/analytics/reports/\&quot; &amp; ReportId &amp; \&quot;/describe\&quot;\n\n    Request.Open \&quot;GET\&quot;, Url, False\n    Request.setRequestHeader \&quot;Authorization\&quot;, \&quot;Bearer \&quot; &amp; SessionId\n    Request.send\n\n    GetMetadata = Request.responseText\nEnd Function\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" class="flex items-center justify-center flex-row gap-2 transition-colors duration-300 hover:bg-hover disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled bg-background text-on-background rounded border border-divider p-1 shadow shadow-shadow" aria-label="Copy code"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
  </div>
</div>
<h2 id="getting-an-individual-report">Getting an individual report<a aria-hidden="true" tabIndex="-1" href="#getting-an-individual-report"><span class="icon icon-link"></span></a></h2>
<p>With the function below, you will be able to get the report in JSON format.</p>
<p>This is achieved with a <code>POST</code> request to
<code>https://$YOUR_INSTANCE_URL/services/data/v47.0/analytics/reports/$REPORT_ID</code>,
optional metadata goes into the request body, this is what we use to filter the
report.</p>


<div data-codeblock class="mt-16 group relative mb-8" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <pre class="relative shiki shadow shadow-shadow overflow-x-auto rounded rounded-tl-none bg-[var(--code-bg)] text-[var(--code-fg)] py-4 [color-scheme:dark] [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:mt-2 [&#38;_.popover]:mb-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700 [&#38;_.popover]:text-white"><code class="language-vb"><span class="line"><span style="color:#C678DD">Function </span><span style="color:#61AFEF">GetReport</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">ReportId</span><span style="color:#ABB2BF"> As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                   SessionId As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                   Optional Metadata As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">&quot;&quot;</span><span style="color:#ABB2BF">) As </span><span style="color:#E5C07B">String</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Request </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Set </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF"> = </span><span style="color:#56B6C2">CreateObject</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;MSXML2.XMLHTTP.6.0&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Response </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Url </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">Url</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> YOUR_INSTANCE_URL</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">          </span><span style="color:#98C379">&quot;services/data/v47.0/analytics/reports/&quot;</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> ReportId</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF">.Open </span><span style="color:#98C379">&quot;POST&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> Url</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66"> False</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF">.setRequestHeader </span><span style="color:#98C379">&quot;Authorization&quot;</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">&quot;Bearer &quot;</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> SessionId</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF">.setRequestHeader </span><span style="color:#98C379">&quot;Content-Type&quot;</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">&quot;application/json&quot;</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">If</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">Metadata</span><span style="color:#ABB2BF"> &lt;&gt; </span><span style="color:#98C379">&quot;&quot;</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">Then</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">send</span><span style="color:#ABB2BF"> (</span><span style="color:#E06C75">Metadata</span><span style="color:#ABB2BF">)</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Else</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF">.send</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">End If</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E5C07B">Response</span><span style="color:#ABB2BF"> = </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF">.responseText</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">GetReport</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> Response</span></span><span class="line"><span style="color:#C678DD">End Function</span></span><span class="line"></span></code></pre>

  <div class="dark text-md absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-[100%] overflow-hidden sm:left-0">
    <div class="flex items-center gap-2 rounded-t border-t border-primary bg-[var(--code-bg)] px-2 py-1 text-[var(--code-fg)]">
      <div class="shrink-0">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
      </div>

      <div class="capitalize">vb</div>
    </div>
  </div>

  <div class="dark flex flex-row gap-2 absolute top-3 right-[var(--horizontal-padding)] text-2xl [&#38;_svg]:h-[1em] [&#38;_svg]:w-[1em] [&#38;_:is(button,a)]:opacity-0 [&#38;_:is(button,a)]:pointer-events-none [&#38;_:is(button,a)]:transition-opacity [&#38;_:is(button,a)]:duration-500 [&#38;_:is(button,a):focus-visible]:opacity-100 [&#38;_:is(button,a):focus-visible]:pointer-events-auto group-hover:[&#38;_:is(button,a)]:opacity-100 group-hover:[&#38;_:is(button,a)]:pointer-events-auto">
    

    <astro-island uid="ZhOelj" component-url="/_astro/CopyCodeBlockButton.e58fef01.js" component-export="default" renderer-url="/_astro/client.47a71f61.js" props="{&quot;aria-label&quot;:[0,&quot;Copy code&quot;],&quot;tooltipText&quot;:[0,&quot;Copied!&quot;],&quot;code&quot;:[0,&quot;Function GetReport(ReportId As String, _\n                   SessionId As String, _\n                   Optional Metadata As String = \&quot;\&quot;) As String\n\n    Dim Request As Object\n    Set Request = CreateObject(\&quot;MSXML2.XMLHTTP.6.0\&quot;)\n\n    Dim Response As String\n    Dim Url As String\n\n    Url = YOUR_INSTANCE_URL &amp; _\n          \&quot;services/data/v47.0/analytics/reports/\&quot; &amp; ReportId\n\n    Request.Open \&quot;POST\&quot;, Url, False\n    Request.setRequestHeader \&quot;Authorization\&quot;, \&quot;Bearer \&quot; &amp; SessionId\n    Request.setRequestHeader \&quot;Content-Type\&quot;, \&quot;application/json\&quot;\n\n    If Metadata &lt;&gt; \&quot;\&quot; Then\n        Request.send (Metadata)\n    Else\n        Request.send\n    End If\n\n    Response = Request.responseText\n\n    GetReport = Response\nEnd Function\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" class="flex items-center justify-center flex-row gap-2 transition-colors duration-300 hover:bg-hover disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled bg-background text-on-background rounded border border-divider p-1 shadow shadow-shadow" aria-label="Copy code"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
  </div>
</div>
<h2 id="writing-the-data-into-a-worksheet">Writing the data into a worksheet<a aria-hidden="true" tabIndex="-1" href="#writing-the-data-into-a-worksheet"><span class="icon icon-link"></span></a></h2>
<p>Now we need to extract the data and write it into a worksheet.</p>
<p><a href="https://developer.salesforce.com/docs/atlas.en-us.api_analytics.meta/api_analytics/sforce_analytics_rest_api_factmap_example.htm" title="Salesforce documentation on how to decode the factMap">Every thing we need is inside the <code>factMap</code> key</a>.
This can get complex if we intend to cover matrix and summary reports, which has
groupings etc., but tabular reports are much simpler.</p>
<p>What we need to do is to iterate through the values at <code>factMap.T!T.rows</code> and,
for each row, get every value inside <code>.dataCells</code> array.</p>
<p>This approach will only cover tabular reports, you can take a look at the
<a href="https://github.com/phelipetls/reportforce/tree/master/reportforce/helpers" title="Source code for reportforce package on a Github repository">reportforce source code</a>
if you need to cover these. By the way, there is an option to export to an Excel
(but not to write to a worksheet, obviously).</p>
<p>The below function takes care of this, its job is to go through every cell and
store it in an array, and then append that array to a worksheet range starting
from column A.</p>


<div data-codeblock class="mt-16 group relative mb-8" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <pre class="relative shiki shadow shadow-shadow overflow-x-auto rounded rounded-tl-none bg-[var(--code-bg)] text-[var(--code-fg)] py-4 [color-scheme:dark] [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:mt-2 [&#38;_.popover]:mb-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700 [&#38;_.popover]:text-white"><code class="language-vb"><span class="line"><span style="color:#C678DD">Function </span><span style="color:#61AFEF">WriteIntoWorksheet</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Report</span><span style="color:#ABB2BF"> As </span><span style="color:#E5C07B">Dictionary</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                            WorksheetName As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                            ColumnLabels As </span><span style="color:#E5C07B">Variant</span><span style="color:#ABB2BF">) As </span><span style="color:#E5C07B">Variant</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Rows </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Columns </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> ColumnInfo</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Set </span><span style="color:#E06C75">Columns</span><span style="color:#ABB2BF"> = </span><span style="color:#61AFEF">Report</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;reportMetadata&quot;</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">&quot;detailColumns&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Set </span><span style="color:#E06C75">ColumnInfo</span><span style="color:#ABB2BF"> = </span><span style="color:#61AFEF">Report</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;reportExtendedMetadata&quot;</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">&quot;detailColumnInfo&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Set </span><span style="color:#E06C75">Rows</span><span style="color:#ABB2BF"> = </span><span style="color:#61AFEF">Report</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;factMap&quot;</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">&quot;T!T&quot;</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">&quot;rows&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Total_Rows </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Long</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">Total_Rows</span><span style="color:#ABB2BF"> = Rows.Count</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Total_Columns </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Long</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">Total_Columns</span><span style="color:#ABB2BF"> = Columns.Count</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">If</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">Total_Rows</span><span style="color:#ABB2BF"> = </span><span style="color:#D19A66">0</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">Then</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#C678DD">Exit Function</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">End If</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Table</span><span style="color:#ABB2BF">() As </span><span style="color:#E5C07B">Variant</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">ReDim </span><span style="color:#61AFEF">Table</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Total_Rows</span><span style="color:#ABB2BF"> - </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> Total_Columns</span><span style="color:#ABB2BF"> - </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">)</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> row </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Variant</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> cell </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Variant</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> i </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Long</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">i</span><span style="color:#ABB2BF"> = </span><span style="color:#D19A66">0</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> j </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Long</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> dataType </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">For</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">Each</span><span style="color:#ABB2BF"> row In Rows</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">j</span><span style="color:#ABB2BF"> = </span><span style="color:#D19A66">0</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#C678DD">For</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">Each</span><span style="color:#ABB2BF"> cell In </span><span style="color:#61AFEF">row</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;dataCells&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"><span style="color:#ABB2BF">            </span><span style="color:#E06C75">dataType</span><span style="color:#ABB2BF"> = </span><span style="color:#61AFEF">ColumnInfo</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">Columns</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">j</span><span style="color:#ABB2BF"> + </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">))(</span><span style="color:#98C379">&quot;dataType&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">            </span><span style="color:#7F848E">&#39; If column is a date, get value property;</span></span><span class="line"><span style="color:#ABB2BF">            </span><span style="color:#7F848E">&#39; Excel understands it better</span></span><span class="line"><span style="color:#ABB2BF">            </span><span style="color:#C678DD">If</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">dataType</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">&quot;date&quot;</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">Then</span></span><span class="line"><span style="color:#ABB2BF">                </span><span style="color:#61AFEF">Table</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">i</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> j</span><span style="color:#ABB2BF">) = </span><span style="color:#61AFEF">cell</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;value&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"><span style="color:#ABB2BF">            </span><span style="color:#C678DD">Else</span></span><span class="line"><span style="color:#ABB2BF">                </span><span style="color:#61AFEF">Table</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">i</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> j</span><span style="color:#ABB2BF">) = </span><span style="color:#61AFEF">cell</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;label&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"><span style="color:#ABB2BF">            </span><span style="color:#C678DD">End If</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">            </span><span style="color:#E06C75">j</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> j</span><span style="color:#ABB2BF"> + </span><span style="color:#D19A66">1</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#C678DD">Next</span><span style="color:#ABB2BF"> cell</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">i</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> i</span><span style="color:#ABB2BF"> + </span><span style="color:#D19A66">1</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Next</span><span style="color:#ABB2BF"> row</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">With</span><span style="color:#ABB2BF"> ThisWorkbook.</span><span style="color:#61AFEF">Worksheets</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">WorksheetName</span><span style="color:#ABB2BF">)</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> LastRow </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Long</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">LastRow</span><span style="color:#ABB2BF"> = .</span><span style="color:#61AFEF">Range</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;A:A&quot;</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">Find</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;*&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                                     SearchOrder:=</span><span style="color:#E06C75">xlByRows</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                                     SearchDirection:=</span><span style="color:#E06C75">xlPrevious</span><span style="color:#ABB2BF">).row</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">        .</span><span style="color:#61AFEF">Range</span><span style="color:#ABB2BF">(.</span><span style="color:#61AFEF">Cells</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">LastRow</span><span style="color:#ABB2BF"> + </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">&quot;A&quot;</span><span style="color:#ABB2BF">),</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">               .</span><span style="color:#61AFEF">Cells</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Total_Rows</span><span style="color:#ABB2BF"> +</span><span style="color:#E06C75"> LastRow</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> Total_Columns</span><span style="color:#ABB2BF">)) =</span><span style="color:#E06C75"> Table</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#56B6C2">End</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">With</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">WriteIntoWorksheet</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> Table</span></span><span class="line"></span><span class="line"><span style="color:#C678DD">End Function</span></span><span class="line"></span></code></pre>

  <div class="dark text-md absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-[100%] overflow-hidden sm:left-0">
    <div class="flex items-center gap-2 rounded-t border-t border-primary bg-[var(--code-bg)] px-2 py-1 text-[var(--code-fg)]">
      <div class="shrink-0">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
      </div>

      <div class="capitalize">vb</div>
    </div>
  </div>

  <div class="dark flex flex-row gap-2 absolute top-3 right-[var(--horizontal-padding)] text-2xl [&#38;_svg]:h-[1em] [&#38;_svg]:w-[1em] [&#38;_:is(button,a)]:opacity-0 [&#38;_:is(button,a)]:pointer-events-none [&#38;_:is(button,a)]:transition-opacity [&#38;_:is(button,a)]:duration-500 [&#38;_:is(button,a):focus-visible]:opacity-100 [&#38;_:is(button,a):focus-visible]:pointer-events-auto group-hover:[&#38;_:is(button,a)]:opacity-100 group-hover:[&#38;_:is(button,a)]:pointer-events-auto">
    

    <astro-island uid="Z1M2MC0" component-url="/_astro/CopyCodeBlockButton.e58fef01.js" component-export="default" renderer-url="/_astro/client.47a71f61.js" props="{&quot;aria-label&quot;:[0,&quot;Copy code&quot;],&quot;tooltipText&quot;:[0,&quot;Copied!&quot;],&quot;code&quot;:[0,&quot;Function WriteIntoWorksheet(Report As Dictionary, _\n                            WorksheetName As String, _\n                            ColumnLabels As Variant) As Variant\n\n    Dim Rows As Object\n    Dim Columns As Object\n    Dim ColumnInfo\n\n    Set Columns = Report(\&quot;reportMetadata\&quot;)(\&quot;detailColumns\&quot;)\n    Set ColumnInfo = Report(\&quot;reportExtendedMetadata\&quot;)(\&quot;detailColumnInfo\&quot;)\n    Set Rows = Report(\&quot;factMap\&quot;)(\&quot;T!T\&quot;)(\&quot;rows\&quot;)\n\n    Dim Total_Rows As Long: Total_Rows = Rows.Count\n    Dim Total_Columns As Long: Total_Columns = Columns.Count\n\n    If Total_Rows = 0 Then\n        Exit Function\n    End If\n\n    Dim Table() As Variant\n    ReDim Table(Total_Rows - 1, Total_Columns - 1)\n\n    Dim row As Variant\n    Dim cell As Variant\n\n    Dim i As Long: i = 0\n    Dim j As Long\n    Dim dataType As String\n\n    For Each row In Rows\n        j = 0\n        For Each cell In row(\&quot;dataCells\&quot;)\n            dataType = ColumnInfo(Columns(j + 1))(\&quot;dataType\&quot;)\n\n            &#39; If column is a date, get value property;\n            &#39; Excel understands it better\n            If dataType = \&quot;date\&quot; Then\n                Table(i, j) = cell(\&quot;value\&quot;)\n            Else\n                Table(i, j) = cell(\&quot;label\&quot;)\n            End If\n\n            j = j + 1\n        Next cell\n        i = i + 1\n    Next row\n\n    With ThisWorkbook.Worksheets(WorksheetName)\n        Dim LastRow As Long\n        LastRow = .Range(\&quot;A:A\&quot;).Find(\&quot;*\&quot;, _\n                                     SearchOrder:=xlByRows, _\n                                     SearchDirection:=xlPrevious).row\n\n        .Range(.Cells(LastRow + 1, \&quot;A\&quot;), _\n               .Cells(Total_Rows + LastRow, Total_Columns)) = Table\n    End With\n\n    WriteIntoWorksheet = Table\n\nEnd Function\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" class="flex items-center justify-center flex-row gap-2 transition-colors duration-300 hover:bg-hover disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled bg-background text-on-background rounded border border-divider p-1 shadow shadow-shadow" aria-label="Copy code"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
  </div>
</div>
<p>We also need to get the values at <code>.reportMetadata.detailColumns</code> and
<code>reportExtendedMetadata.detailColumnInfo</code> to check how many columns the report
have and to extract the value at <code>.value</code> if it is a date.</p>
<h2 id="getting-the-entire-report">Getting the entire report<a aria-hidden="true" tabIndex="-1" href="#getting-the-entire-report"><span class="icon icon-link"></span></a></h2>
<p>To get the entire report, the key thing to overcome the API limitations is a key
called <code>.allData</code>, which will be <code>true</code> only if we got all the data from the
API.</p>
<p>So we get the first 2000 rows and, if <code>.allData</code> is <code>false</code>, we get the values
of an identifier column, filter them out and request a new report, until we get
all data.</p>
<p>We will modify the keys <code>.reportMetadata.standardDateFilter</code> and
<code>.reportMetadata.reportFilters</code>, to filter dates and other filters respectively.</p>
<p>If your report has a boolean filter, it’s likely that you’ll need to change it
because we will insert new filters. This is already done in the code by changing
the value at <code>.reportMetadata.reportBooleanFilter</code>, so you only need to pass it
as a parameter.</p>
<p>The function looks way more involved because we have to get the report headers
(the <code>label</code> property of each object inside
<code>.reportExtendedMetadata.detailColumnInfo</code>, the ones you see in the browser).</p>
<p>We also need the identifier column API name (an internal value), which we will
need to filter it.</p>


<div data-codeblock class="mt-16 group relative mb-8" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <pre class="relative shiki shadow shadow-shadow overflow-x-auto rounded rounded-tl-none bg-[var(--code-bg)] text-[var(--code-fg)] py-4 [color-scheme:dark] [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:mt-2 [&#38;_.popover]:mb-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700 [&#38;_.popover]:text-white"><code class="language-vb"><span class="line"><span style="color:#C678DD">Sub </span><span style="color:#61AFEF">DownloadEntireReport</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">ReportId</span><span style="color:#ABB2BF"> As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                         WorksheetName As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                         SessionId As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                         Optional IdentifierColumn As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">&quot;&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                         Optional BooleanFilter As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">&quot;&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                         Optional startDate As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">&quot;&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                         Optional endDate As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">&quot;&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Report </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> ReportMetadata </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Set </span><span style="color:#E06C75">ReportMetadata</span><span style="color:#ABB2BF"> = JsonConverter.</span><span style="color:#61AFEF">ParseJson</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">GetMetadata</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">ReportId</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> SessionId</span><span style="color:#ABB2BF">))</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> IdentifierColumnApiName </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> IdentifierColumnPosition </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Long</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Col </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Variant</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> i </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Long</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">i</span><span style="color:#ABB2BF"> = </span><span style="color:#D19A66">0</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> ColumnDetails </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Set </span><span style="color:#E06C75">ColumnDetails</span><span style="color:#ABB2BF"> = </span><span style="color:#61AFEF">ReportMetadata</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;reportExtendedMetadata&quot;</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">&quot;detailColumnInfo&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#7F848E">&#39; This is an array to store the column headers</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> ColumnLabels</span><span style="color:#ABB2BF">() As </span><span style="color:#E5C07B">Variant</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">ReDim </span><span style="color:#61AFEF">ColumnLabels</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, ColumnDetails.</span><span style="color:#E06C75">Count</span><span style="color:#ABB2BF"> - </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">)</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#7F848E">&#39; Collection the column headers</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">For</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">Each</span><span style="color:#ABB2BF"> Col In ColumnDetails.</span><span style="color:#56B6C2">Keys</span><span style="color:#ABB2BF">()</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#61AFEF">ColumnLabels</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> i</span><span style="color:#ABB2BF">) = </span><span style="color:#61AFEF">ColumnDetails</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Col</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">&quot;label&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#7F848E">&#39; Remember which column matches the identifier column label</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#C678DD">If</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">ColumnDetails</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Col</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">&quot;label&quot;</span><span style="color:#ABB2BF">) =</span><span style="color:#E06C75"> IdentifierColumn</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">Then</span></span><span class="line"><span style="color:#ABB2BF">            </span><span style="color:#E06C75">IdentifierColumnApiName</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> Col</span></span><span class="line"><span style="color:#ABB2BF">            </span><span style="color:#E06C75">IdentifierColumnPosition</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> i</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#C678DD">End If</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">i</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> i</span><span style="color:#ABB2BF"> + </span><span style="color:#D19A66">1</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Next</span><span style="color:#ABB2BF"> Col</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#7F848E">&#39; Write column headers starting from A1</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">With</span><span style="color:#ABB2BF"> ThisWorkbook.</span><span style="color:#61AFEF">Worksheets</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">WorksheetName</span><span style="color:#ABB2BF">)</span></span><span class="line"><span style="color:#ABB2BF">        .</span><span style="color:#61AFEF">Range</span><span style="color:#ABB2BF">(.</span><span style="color:#61AFEF">Cells</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">&quot;A&quot;</span><span style="color:#ABB2BF">), .</span><span style="color:#61AFEF">Cells</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, ColumnDetails.</span><span style="color:#E06C75">Count</span><span style="color:#ABB2BF">)) =</span><span style="color:#E06C75"> ColumnLabels</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#56B6C2">End</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">With</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> ReportMetadataJson </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">ReportMetadataJson</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">&quot;&quot;</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#7F848E">&#39; Setting date filters, if any</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">If</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">startDate</span><span style="color:#ABB2BF"> &lt;&gt; </span><span style="color:#98C379">&quot;&quot;</span><span style="color:#ABB2BF"> And </span><span style="color:#E06C75">endDate</span><span style="color:#ABB2BF"> &lt;&gt; </span><span style="color:#98C379">&quot;&quot;</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">Then</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#61AFEF">ReportMetadata</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;reportMetadata&quot;</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">&quot;standardDateFilter&quot;</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">&quot;durationValue&quot;</span><span style="color:#ABB2BF">) = </span><span style="color:#98C379">&quot;CUSTOM&quot;</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#61AFEF">ReportMetadata</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;reportMetadata&quot;</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">&quot;standardDateFilter&quot;</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">&quot;startDate&quot;</span><span style="color:#ABB2BF">) = </span><span style="color:#61AFEF">Format</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">startDate</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">&quot;yyyy-mm-dd&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#61AFEF">ReportMetadata</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;reportMetadata&quot;</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">&quot;standardDateFilter&quot;</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">&quot;endDate&quot;</span><span style="color:#ABB2BF">) = </span><span style="color:#61AFEF">Format</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">endDate</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">&quot;yyyy-mm-dd&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">ReportMetadataJson</span><span style="color:#ABB2BF"> = JsonConverter.</span><span style="color:#61AFEF">ConvertToJson</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">ReportMetadata</span><span style="color:#ABB2BF">)</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">End If</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#7F848E">&#39; Get first 2000 rows</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Set </span><span style="color:#E06C75">Report</span><span style="color:#ABB2BF"> = JsonConverter.</span><span style="color:#61AFEF">ParseJson</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">GetReport</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">ReportId</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> SessionId</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> ReportMetadataJson</span><span style="color:#ABB2BF">))</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> ReportTable </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Variant</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#E06C75">ReportTable</span><span style="color:#ABB2BF"> = </span><span style="color:#61AFEF">WriteIntoWorksheet</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Report</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> WorksheetName</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> ColumnLabels</span><span style="color:#ABB2BF">)</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#7F848E">&#39; Getting Remaining Values By Filtering Out Old Values</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">If</span><span style="color:#ABB2BF"> </span><span style="color:#E06C75">BooleanFilter</span><span style="color:#ABB2BF"> &lt;&gt; </span><span style="color:#98C379">&quot;&quot;</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">Then</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#61AFEF">ReportMetadata</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;reportMetadata&quot;</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">&quot;reportBooleanFilter&quot;</span><span style="color:#ABB2BF">) =</span><span style="color:#E06C75"> BooleanFilter</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">End If</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> IdentifierColumnValues</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> IdentifierColumnFilter </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">IdentifierColumnFilter</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">&quot;&quot;</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Filters </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Scripting</span><span style="color:#ABB2BF">.Dictionary</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Set </span><span style="color:#E06C75">Filters</span><span style="color:#ABB2BF"> =</span><span style="color:#C678DD"> New </span><span style="color:#ABB2BF">Dictionary</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> ReportFilters </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Do</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">Until</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">Report</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;allData&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">IdentifierColumnValues</span><span style="color:#ABB2BF"> = </span><span style="color:#61AFEF">GetValuesAtColumn</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">ReportTable</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> IdentifierColumnPosition</span><span style="color:#ABB2BF">)</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">IdentifierColumnFilter</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> IdentifierColumnFilter</span><span style="color:#ABB2BF"> &amp;</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                                 </span><span style="color:#56B6C2">Join</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Application</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">Transpose</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">IdentifierColumnValues</span><span style="color:#ABB2BF">), </span><span style="color:#98C379">&quot;,&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">        Filters.</span><span style="color:#56B6C2">RemoveAll</span></span><span class="line"><span style="color:#ABB2BF">        Filters.</span><span style="color:#56B6C2">Add</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">&quot;filterType&quot;</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">&quot;fieldValue&quot;</span></span><span class="line"><span style="color:#ABB2BF">        Filters.</span><span style="color:#56B6C2">Add</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">&quot;isRunPageEditable&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66"> True</span></span><span class="line"><span style="color:#ABB2BF">        Filters.</span><span style="color:#56B6C2">Add</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">&quot;column&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> IdentifierColumnApiName</span></span><span class="line"><span style="color:#ABB2BF">        Filters.</span><span style="color:#56B6C2">Add</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">&quot;operator&quot;</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">&quot;notEqual&quot;</span></span><span class="line"><span style="color:#ABB2BF">        Filters.</span><span style="color:#56B6C2">Add</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">&quot;value&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> IdentifierColumnFilter</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#C678DD">Set </span><span style="color:#E06C75">ReportFilters</span><span style="color:#ABB2BF"> = </span><span style="color:#61AFEF">ReportMetadata</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">&quot;reportMetadata&quot;</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">&quot;reportFilters&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#7F848E">&#39; If IdentifierColumn was already added, just change the filter value</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#C678DD">If</span><span style="color:#ABB2BF"> </span><span style="color:#61AFEF">ReportFilters</span><span style="color:#ABB2BF">(ReportFilters.</span><span style="color:#E06C75">Count</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">&quot;column&quot;</span><span style="color:#ABB2BF">) =</span><span style="color:#E06C75"> IdentifierColumn</span><span style="color:#ABB2BF"> </span><span style="color:#C678DD">Then</span></span><span class="line"><span style="color:#ABB2BF">            </span><span style="color:#61AFEF">ReportFilters</span><span style="color:#ABB2BF">(ReportFilters.</span><span style="color:#E06C75">Count</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">&quot;value&quot;</span><span style="color:#ABB2BF">) =</span><span style="color:#E06C75"> IdentifierColumnFilter</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#C678DD">Else</span></span><span class="line"><span style="color:#ABB2BF">            ReportFilters.</span><span style="color:#56B6C2">Add</span><span style="color:#ABB2BF"> Filters</span></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#C678DD">End If</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">ReportMetadataJson</span><span style="color:#ABB2BF"> = JsonConverter.</span><span style="color:#61AFEF">ConvertToJson</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">ReportMetadata</span><span style="color:#ABB2BF">)</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#C678DD">Set </span><span style="color:#E06C75">Report</span><span style="color:#ABB2BF"> = JsonConverter.</span><span style="color:#61AFEF">ParseJson</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">GetReport</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">ReportId</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> SessionId</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> ReportMetadataJson</span><span style="color:#ABB2BF">))</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">        </span><span style="color:#E06C75">ReportTable</span><span style="color:#ABB2BF"> = </span><span style="color:#61AFEF">WriteIntoWorksheet</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Report</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> WorksheetName</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">&quot;&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"><span style="color:#ABB2BF">    </span><span style="color:#C678DD">Loop</span></span><span class="line"></span><span class="line"><span style="color:#C678DD">End Sub</span></span><span class="line"></span></code></pre>

  <div class="dark text-md absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-[100%] overflow-hidden sm:left-0">
    <div class="flex items-center gap-2 rounded-t border-t border-primary bg-[var(--code-bg)] px-2 py-1 text-[var(--code-fg)]">
      <div class="shrink-0">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
      </div>

      <div class="capitalize">vb</div>
    </div>
  </div>

  <div class="dark flex flex-row gap-2 absolute top-3 right-[var(--horizontal-padding)] text-2xl [&#38;_svg]:h-[1em] [&#38;_svg]:w-[1em] [&#38;_:is(button,a)]:opacity-0 [&#38;_:is(button,a)]:pointer-events-none [&#38;_:is(button,a)]:transition-opacity [&#38;_:is(button,a)]:duration-500 [&#38;_:is(button,a):focus-visible]:opacity-100 [&#38;_:is(button,a):focus-visible]:pointer-events-auto group-hover:[&#38;_:is(button,a)]:opacity-100 group-hover:[&#38;_:is(button,a)]:pointer-events-auto">
    

    <astro-island uid="1dA2ww" component-url="/_astro/CopyCodeBlockButton.e58fef01.js" component-export="default" renderer-url="/_astro/client.47a71f61.js" props="{&quot;aria-label&quot;:[0,&quot;Copy code&quot;],&quot;tooltipText&quot;:[0,&quot;Copied!&quot;],&quot;code&quot;:[0,&quot;Sub DownloadEntireReport(ReportId As String, _\n                         WorksheetName As String, _\n                         SessionId As String, _\n                         Optional IdentifierColumn As String = \&quot;\&quot;, _\n                         Optional BooleanFilter As String = \&quot;\&quot;, _\n                         Optional startDate As String = \&quot;\&quot;, _\n                         Optional endDate As String = \&quot;\&quot;)\n\n    Dim Report As Object\n\n    Dim ReportMetadata As Object\n    Set ReportMetadata = JsonConverter.ParseJson(GetMetadata(ReportId, SessionId))\n\n    Dim IdentifierColumnApiName As String\n    Dim IdentifierColumnPosition As Long\n\n    Dim Col As Variant\n    Dim i As Long: i = 0\n\n    Dim ColumnDetails As Object\n    Set ColumnDetails = ReportMetadata(\&quot;reportExtendedMetadata\&quot;)(\&quot;detailColumnInfo\&quot;)\n\n    &#39; This is an array to store the column headers\n    Dim ColumnLabels() As Variant\n    ReDim ColumnLabels(0, ColumnDetails.Count - 1)\n\n    &#39; Collection the column headers\n    For Each Col In ColumnDetails.Keys()\n        ColumnLabels(0, i) = ColumnDetails(Col)(\&quot;label\&quot;)\n\n        &#39; Remember which column matches the identifier column label\n        If ColumnDetails(Col)(\&quot;label\&quot;) = IdentifierColumn Then\n            IdentifierColumnApiName = Col\n            IdentifierColumnPosition = i\n        End If\n\n        i = i + 1\n    Next Col\n\n    &#39; Write column headers starting from A1\n    With ThisWorkbook.Worksheets(WorksheetName)\n        .Range(.Cells(1, \&quot;A\&quot;), .Cells(1, ColumnDetails.Count)) = ColumnLabels\n    End With\n\n    Dim ReportMetadataJson As String: ReportMetadataJson = \&quot;\&quot;\n\n    &#39; Setting date filters, if any\n    If startDate &lt;&gt; \&quot;\&quot; And endDate &lt;&gt; \&quot;\&quot; Then\n        ReportMetadata(\&quot;reportMetadata\&quot;)(\&quot;standardDateFilter\&quot;)(\&quot;durationValue\&quot;) = \&quot;CUSTOM\&quot;\n        ReportMetadata(\&quot;reportMetadata\&quot;)(\&quot;standardDateFilter\&quot;)(\&quot;startDate\&quot;) = Format(startDate, \&quot;yyyy-mm-dd\&quot;)\n        ReportMetadata(\&quot;reportMetadata\&quot;)(\&quot;standardDateFilter\&quot;)(\&quot;endDate\&quot;) = Format(endDate, \&quot;yyyy-mm-dd\&quot;)\n\n        ReportMetadataJson = JsonConverter.ConvertToJson(ReportMetadata)\n    End If\n\n    &#39; Get first 2000 rows\n    Set Report = JsonConverter.ParseJson(GetReport(ReportId, SessionId, ReportMetadataJson))\n\n    Dim ReportTable As Variant\n    ReportTable = WriteIntoWorksheet(Report, WorksheetName, ColumnLabels)\n\n    &#39; Getting Remaining Values By Filtering Out Old Values\n\n    If BooleanFilter &lt;&gt; \&quot;\&quot; Then\n        ReportMetadata(\&quot;reportMetadata\&quot;)(\&quot;reportBooleanFilter\&quot;) = BooleanFilter\n    End If\n\n    Dim IdentifierColumnValues\n    Dim IdentifierColumnFilter As String: IdentifierColumnFilter = \&quot;\&quot;\n\n    Dim Filters As Scripting.Dictionary\n    Set Filters = New Dictionary\n\n    Dim ReportFilters As Object\n\n    Do Until Report(\&quot;allData\&quot;)\n        IdentifierColumnValues = GetValuesAtColumn(ReportTable, IdentifierColumnPosition)\n        IdentifierColumnFilter = IdentifierColumnFilter &amp; _\n                                 Join(Application.Transpose(IdentifierColumnValues), \&quot;,\&quot;)\n\n        Filters.RemoveAll\n        Filters.Add \&quot;filterType\&quot;, \&quot;fieldValue\&quot;\n        Filters.Add \&quot;isRunPageEditable\&quot;, True\n        Filters.Add \&quot;column\&quot;, IdentifierColumnApiName\n        Filters.Add \&quot;operator\&quot;, \&quot;notEqual\&quot;\n        Filters.Add \&quot;value\&quot;, IdentifierColumnFilter\n\n        Set ReportFilters = ReportMetadata(\&quot;reportMetadata\&quot;)(\&quot;reportFilters\&quot;)\n\n        &#39; If IdentifierColumn was already added, just change the filter value\n        If ReportFilters(ReportFilters.Count)(\&quot;column\&quot;) = IdentifierColumn Then\n            ReportFilters(ReportFilters.Count)(\&quot;value\&quot;) = IdentifierColumnFilter\n        Else\n            ReportFilters.Add Filters\n        End If\n\n        ReportMetadataJson = JsonConverter.ConvertToJson(ReportMetadata)\n\n        Set Report = JsonConverter.ParseJson(GetReport(ReportId, SessionId, ReportMetadataJson))\n\n        ReportTable = WriteIntoWorksheet(Report, WorksheetName, \&quot;\&quot;)\n    Loop\n\nEnd Sub\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" class="flex items-center justify-center flex-row gap-2 transition-colors duration-300 hover:bg-hover disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled bg-background text-on-background rounded border border-divider p-1 shadow shadow-shadow" aria-label="Copy code"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
  </div>
</div>
<p>To do the filter, we create a <code>Filters</code> dictionary to store all key-value pairs
we need, then add it to the <code>reportFilters</code> object, and change its value in
later iterations. Then we convert the metadata into a JSON string, get a new
filtered report and repeat the loop until we get all data.</p>
<p>Also notice that I use a custom function to get all values at a given column,
<code>GetValuesAtColumn</code>.</p>
<p><a href="https://gist.github.com/phelipetls/57a27f529561eefe73633093c737b7e0">Get the full source code in this GitHub gist</a>.</p>
<h2 id="how-to-use-it">How to use it<a aria-hidden="true" tabIndex="-1" href="#how-to-use-it"><span class="icon icon-link"></span></a></h2>
<p>It’s up to you how you’re gonna use this code. Here’s an example.</p>


<div data-codeblock class="mt-16 group relative mb-8" style="--code-bg: #282c34;--code-fg: #abb2bf;">
  <pre class="relative shiki shadow shadow-shadow overflow-x-auto rounded rounded-tl-none bg-[var(--code-bg)] text-[var(--code-fg)] py-4 [color-scheme:dark] [&#38;_code]:grid [&#38;_code>.line]:px-8 [&#38;_code>.line]:border-l-[2px] [&#38;_code>.line]:border-[var(--code-bg)] [&#38;_code>.line.highlight]:bg-[#272115] [&#38;_code>.line.highlight]:border-[#624710] [&#38;_.error]:text-sm [&#38;_.error]:px-8 [&#38;_.error]:py-1 [&#38;_.popover]:mt-2 [&#38;_.popover]:mb-2 [&#38;_.popover]:rounded-sm [&#38;_.popover]:bg-gray-700 [&#38;_.arrow]:bg-gray-700 [&#38;_.arrow]:border-gray-700 [&#38;_.popover]:text-white"><code class="language-vb"><span class="line"><span style="color:#C678DD">Sub </span><span style="color:#ABB2BF">DownloadReports</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> Username </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> Password</span><span style="color:#ABB2BF"> As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> SecurityToken</span><span style="color:#ABB2BF"> As </span><span style="color:#E5C07B">String</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">Username</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">&quot;username&quot;</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">Password</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">&quot;password&quot;</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#E06C75">SecurityToken</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">&quot;secret&quot;</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> SessionId </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span><span class="line"><span style="color:#ABB2BF">  SessionId = </span><span style="color:#61AFEF">SalesforceLogin</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Username</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> Password</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> SecurityToken</span><span style="color:#ABB2BF">)</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">If</span><span style="color:#ABB2BF"> </span><span style="color:#56B6C2">IsEmpty</span><span style="color:#ABB2BF">(SessionId) </span><span style="color:#C678DD">Then</span></span><span class="line"><span style="color:#ABB2BF">      </span><span style="color:#56B6C2">MsgBox</span><span style="color:#ABB2BF"> </span><span style="color:#98C379">&quot;Authentication Error&quot;</span></span><span class="line"><span style="color:#ABB2BF">      </span><span style="color:#C678DD">Exit Sub</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">End If</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> ReportId </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">ReportId</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">&quot;REPORT_ID&quot;</span></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">Dim</span><span style="color:#E06C75"> WorksheetName </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">WorksheetName</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">&quot;MY_REPORT&quot;</span></span><span class="line"></span><span class="line"><span style="color:#ABB2BF">  </span><span style="color:#C678DD">Call </span><span style="color:#61AFEF">DownloadEntireReport</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">ReportId</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> WorksheetName</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> SessionId</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                            IdentifierColumn:=</span><span style="color:#98C379">&quot;Número do caso&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                            BooleanFilter:=</span><span style="color:#98C379">&quot;1 AND 2 AND (3 OR 4)&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                            startDate:=</span><span style="color:#98C379">&quot;01/07/2020&quot;</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span><span class="line"><span style="color:#ABB2BF">                            endDate:=</span><span style="color:#98C379">&quot;31/07/2020&quot;</span><span style="color:#ABB2BF">)</span></span><span class="line"></span><span class="line"><span style="color:#C678DD">End Sub</span></span><span class="line"></span></code></pre>

  <div class="dark text-md absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-[100%] overflow-hidden sm:left-0">
    <div class="flex items-center gap-2 rounded-t border-t border-primary bg-[var(--code-bg)] px-2 py-1 text-[var(--code-fg)]">
      <div class="shrink-0">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-text"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
      </div>

      <div class="capitalize">vb</div>
    </div>
  </div>

  <div class="dark flex flex-row gap-2 absolute top-3 right-[var(--horizontal-padding)] text-2xl [&#38;_svg]:h-[1em] [&#38;_svg]:w-[1em] [&#38;_:is(button,a)]:opacity-0 [&#38;_:is(button,a)]:pointer-events-none [&#38;_:is(button,a)]:transition-opacity [&#38;_:is(button,a)]:duration-500 [&#38;_:is(button,a):focus-visible]:opacity-100 [&#38;_:is(button,a):focus-visible]:pointer-events-auto group-hover:[&#38;_:is(button,a)]:opacity-100 group-hover:[&#38;_:is(button,a)]:pointer-events-auto">
    

    <astro-island uid="ZNkgbx" component-url="/_astro/CopyCodeBlockButton.e58fef01.js" component-export="default" renderer-url="/_astro/client.47a71f61.js" props="{&quot;aria-label&quot;:[0,&quot;Copy code&quot;],&quot;tooltipText&quot;:[0,&quot;Copied!&quot;],&quot;code&quot;:[0,&quot;Sub DownloadReports\n\n  Dim Username As String, Password As String, SecurityToken As String\n\n  Username = \&quot;username\&quot;\n  Password = \&quot;password\&quot;\n  SecurityToken = \&quot;secret\&quot;\n\n  Dim SessionId As String\n  SessionId = SalesforceLogin(Username, Password, SecurityToken)\n\n  If IsEmpty(SessionId) Then\n      MsgBox \&quot;Authentication Error\&quot;\n      Exit Sub\n  End If\n\n  Dim ReportId As String: ReportId = \&quot;REPORT_ID\&quot;\n  Dim WorksheetName As String: WorksheetName = \&quot;MY_REPORT\&quot;\n\n  Call DownloadEntireReport(ReportId, WorksheetName, SessionId, _\n                            IdentifierColumn:=\&quot;Número do caso\&quot;, _\n                            BooleanFilter:=\&quot;1 AND 2 AND (3 OR 4)\&quot;, _\n                            startDate:=\&quot;01/07/2020\&quot;, _\n                            endDate:=\&quot;31/07/2020\&quot;)\n\nEnd Sub\n&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children=""><button type="button" class="flex items-center justify-center flex-row gap-2 transition-colors duration-300 hover:bg-hover disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled bg-background text-on-background rounded border border-divider p-1 shadow shadow-shadow" aria-label="Copy code"><span class="text-[var(--code-fg)]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard"><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button></astro-island>
  </div>
</div>
<h2 id="final-words">Final words<a aria-hidden="true" tabIndex="-1" href="#final-words"><span class="icon icon-link"></span></a></h2>
<p>You probably have a better way to do it, I would only recommend this approach to
someone in an environment very dependent on Excel, simply because it is super
convenient. You can put the report anywhere you want with zero overhead — no
need for a library to understand the complexity of an Excel archive.</p>
<p>And I gotta say, VBA is kind of a hard, its ecosystem is not great, obviously.
But I was very impressed by what it can do, despite of its shortcomings.
Nonetheless, it was still fun to write this.</p>
          </div>

          <aside class="">
            <div data-toc-wrapper class="w-full sm:overflow-y-auto lg:sticky lg:top-[1rem] lg:max-h-[calc(100vh-1rem)] lg:pb-8 lg:pl-8">
      <div class="hidden lg:block">
        <div class="flex justify-between gap-2">
          <div class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>

            <h2 class="m-0">Table of Contents</h2>
          </div>

          <div class="flex items-center transition-transform duration-100 ease-in group-open:rotate-180 lg:hidden">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>
          </div>
        </div>

        <div class="
          mt-4
          [&_a_*]:indent-0
          [&_nav_ol]:m-0
          [&_nav_ol]:list-none
          [&_nav_ol]:indent-4
          [&_nav_ol_ol]:indent-8
          [&_nav_ol_ol_ol]:indent-12
          [&_nav_ol_ol_ol_ol]:indent-16
          [&_nav_ol_li]:relative
          [&_nav_ol_li]:before:absolute
          [&_nav_ol_li]:before:top-0
          [&_nav_ol_li]:before:left-0
          [&_nav_ol_li]:before:h-full
          [&_nav_ol_li]:before:w-[1px]
          [&_nav_ol_li]:before:bg-divider
          [&_nav_ol_li]:before:content-['']
          [&_nav_ol_li_a]:block
          [&_nav_ol_li_a]:truncate
          [&_nav_ol_li_a]:border-b-0
          [&_nav_ol_li_a]:transition-colors
          [&_nav_ol_li_a]:duration-300
          [&_nav_ol_li_a:hover]:bg-hover
          [&_nav_ol_li[data-active]]:before:bg-primary
          [&_nav_ol_li[data-active]>a]:text-primary
       ">
          <nav data-toc>
  <ol>
  <li>
          <a href="#authentication">Authentication</a>

          <ol>
  
</ol>
        </li><li>
          <a href="#parsing-json-inside-vba">Parsing JSON inside VBA?</a>

          <ol>
  
</ol>
        </li><li>
          <a href="#unfortunate-api-limitations">Unfortunate API limitations</a>

          <ol>
  
</ol>
        </li><li>
          <a href="#getting-report-metadata">Getting report metadata</a>

          <ol>
  
</ol>
        </li><li>
          <a href="#getting-an-individual-report">Getting an individual report</a>

          <ol>
  
</ol>
        </li><li>
          <a href="#writing-the-data-into-a-worksheet">Writing the data into a worksheet</a>

          <ol>
  
</ol>
        </li><li>
          <a href="#getting-the-entire-report">Getting the entire report</a>

          <ol>
  
</ol>
        </li><li>
          <a href="#how-to-use-it">How to use it</a>

          <ol>
  
</ol>
        </li><li>
          <a href="#final-words">Final words</a>

          <ol>
  
</ol>
        </li>
</ol>
</nav>
        </div>
      </div>

      <details class="card group mb-8 max-w-prose px-horizontal-padding py-4 lg:hidden" aria-label="Table of Contents">
        <summary class="list-none">
          <div class="flex justify-between gap-2">
            <div class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-list"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>

              <h2 class="m-0">Table of Contents</h2>
            </div>

            <div class="flex items-center transition-transform duration-100 ease-in group-open:rotate-180 lg:hidden">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>
            </div>
          </div>
        </summary>

        <div class="
          mt-4
          [&_ol]:m-0
          [&_ol]:list-outside
          [&_ol]:px-horizontal-padding
          [&_ol_li:not(:first-child)]:mt-1
        ">
          <nav data-toc>
  <ol>
  <li>
          <a href="#authentication">Authentication</a>

          <ol>
  
</ol>
        </li><li>
          <a href="#parsing-json-inside-vba">Parsing JSON inside VBA?</a>

          <ol>
  
</ol>
        </li><li>
          <a href="#unfortunate-api-limitations">Unfortunate API limitations</a>

          <ol>
  
</ol>
        </li><li>
          <a href="#getting-report-metadata">Getting report metadata</a>

          <ol>
  
</ol>
        </li><li>
          <a href="#getting-an-individual-report">Getting an individual report</a>

          <ol>
  
</ol>
        </li><li>
          <a href="#writing-the-data-into-a-worksheet">Writing the data into a worksheet</a>

          <ol>
  
</ol>
        </li><li>
          <a href="#getting-the-entire-report">Getting the entire report</a>

          <ol>
  
</ol>
        </li><li>
          <a href="#how-to-use-it">How to use it</a>

          <ol>
  
</ol>
        </li><li>
          <a href="#final-words">Final words</a>

          <ol>
  
</ol>
        </li>
</ol>
</nav>
        </div>
      </details>
    </div>
          </aside>
        </div>
      </article>

      <hr class="full-width-on-mobile mt-8">

      <div class="full-width-on-mobile sm:my-8">
        <nav class="flex items-stretch sm:gap-4" aria-label="Posts navigation">
  <div class="flex-1"></div>

  <div class="border-l border-divider sm:hidden"></div>

  <a class="sm:card flex flex-none basis-1/2 flex-col-reverse items-end justify-end gap-2 border-0 py-4 px-horizontal-padding text-right transition-colors duration-300 hover:bg-hover" href="/posts/async-make-in-nvim-with-lua">
        Asynchronous :make in Neovim with Lua

        <span class="text-primary">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
        </span>
      </a>
</nav>
      </div>

      <hr class="full-width-on-mobile mb-8">
    </div>
  </main>

    <footer class="mt-8 border-t border-divider bg-background sm:border-0">
  <div class="mx-auto flex w-full max-w-content flex-col items-center gap-2 px-horizontal-padding pt-4 pb-8 sm:justify-between">
    <nav aria-label="Contacts" class="flex gap-2">
  <a class="rounded-full transition-colors duration-300 hover:bg-hover p-2 [&_svg]:transition-colors [&_svg]:duration-300 hover:text-primary border-0" id="contact-email" href="phelipe_teles@hotmail.com" aria-label="E-mail">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail"><rect x="2" y="4" width="20" height="16" rx="2"></rect><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path></svg>
</a>

  <a class="rounded-full transition-colors duration-300 hover:bg-hover p-2 [&_svg]:transition-colors [&_svg]:duration-300 hover:text-primary border-0" id="contact-linkedin" href="https://linkedin.com/in/phelipeteles" aria-label="LinkedIn">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-linkedin"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
</a>

  <a class="rounded-full transition-colors duration-300 hover:bg-hover p-2 [&_svg]:transition-colors [&_svg]:duration-300 hover:text-primary border-0" id="contact-github" href="https://github.com/phelipetls" aria-label="GitHub">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg>
</a>
</nav>

    <span class="text-center">All content is under a
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0</a>
license.
</span>
  </div>
</footer>
  </body></html>