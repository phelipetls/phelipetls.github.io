<!DOCTYPE html><html class="h-full min-h-0 text-base sm:text-lg selection:bg-primary selection:text-on-primary scroll-smooth scroll-pt-nav-height sm:scroll-pt-0" lang="en-US" data-notransition> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="deploy-date" content="2025-10-15"><meta name="author" content="Phelipe Teles"><meta name="color-scheme" content="dark light"><title>Getting Salesforce reports with VBA - Phelipe Teles | Phelipe Teles</title><link rel="canonical" href="https://phelipetls.github.io/posts/getting-salesforce-reports-with-vba/"><meta name="description" content="For those who find themselves in an environment which heavily relies on Excel
and Salesforce, you may be interested in a way to automate the process of
downloading reports from inside Excel with VBA only."><meta name="robots" content="index, follow"><meta property="og:title" content="Getting Salesforce reports with VBA"><meta property="og:type" content="article"><meta property="og:image" content="https://phelipetls.github.io/posts/getting-salesforce-reports-with-vba/image.png"><meta property="og:url" content="https://phelipetls.github.io/posts/getting-salesforce-reports-with-vba/"><meta property="og:image:url" content="https://phelipetls.github.io/posts/getting-salesforce-reports-with-vba/image.png"><meta property="og:image:height"><meta property="og:image:alt" content="Blog Post Getting Salesforce reports with VBA Preview Image"><meta property="article:published_time" content="2020-08-05T00:00:00Z"><meta property="article:author" content="Phelipe Teles"><meta property="article:tag" content="salesforce"><meta property="article:tag" content="vba"><meta property="article:tag" content="excel"><meta name="twitter:card" content="summary_large_image"><meta content="https://phelipetls.github.io/posts/getting-salesforce-reports-with-vba/image.png" name="twitter:image"> <meta name="publish-date" content="2020-08-05"> <meta name="keywords" content="salesforce, vba, excel"><meta name="description" content="For those who find themselves in an environment which heavily relies on Excel
and Salesforce, you may be interested in a way to automate the process of
downloading reports from inside Excel with VBA only."> <style id="sandpack">--sxs{--sxs:1 sp-k-eyOShd sp-k-iOHdLQ}@media{@keyframes sp-k-eyOShd{0%{opacity:0}100%{opacity:1}}@keyframes sp-k-iOHdLQ{0%{transform:rotateX(-25.5deg) rotateY(45deg)}100%{transform:rotateX(-25.5deg) rotateY(405deg)}}}--sxs{--sxs:2 sp-c-gMfcns sp-c-bxeRRt sp-c-hfoyCM sp-c-fWymNx sp-c-euXojQ sp-c-bpmgvy sp-c-PJLV}@media{.sp-c-gMfcns svg{margin:auto}.sp-c-bxeRRt{-webkit-appearance:none;appearance:none;outline:none;display:flex;align-items:center;font-size:inherit;font-family:inherit;background-color:transparent;transition:color var(--sp-transitions-default), background var(--sp-transitions-default);cursor:pointer;color:var(--sp-colors-clickable);border:0;text-decoration:none}.sp-c-bxeRRt:disabled{color:var(--sp-colors-disabled)}.sp-c-bxeRRt:hover:not(:disabled,[data-active='true']){color:var(--sp-colors-hover)}.sp-c-bxeRRt[data-active="true"]{color:var(--sp-colors-accent)}.sp-c-bxeRRt svg{min-width:var(--sp-space-4);width:var(--sp-space-4);height:var(--sp-space-4)}.sp-c-bxeRRt.sp-c-gMfcns{padding:var(--sp-space-1);height:var(--sp-space-7);display:flex}.sp-c-bxeRRt.sp-c-gMfcns.sp-c-bxeRRt:not(:has(span)){width:var(--sp-space-7)}.sp-c-bxeRRt.sp-c-gMfcns.sp-c-bxeRRt:has(svg + span){padding-right:var(--sp-space-3);padding-left:var(--sp-space-2);gap:var(--sp-space-1)}.sp-c-hfoyCM{padding:0 var(--sp-space-1) 0 var(--sp-space-1);border-radius:var(--sp-border-radius);margin-left:var(--sp-space-1);width:var(--sp-space-5);visibility:hidden}.sp-c-hfoyCM svg{width:var(--sp-space-3);height:var(--sp-space-3);display:block;position:relative;top:1px}.sp-c-fWymNx{margin:0;display:block;font-family:var(--sp-font-mono);font-size:var(--sp-font-size);color:var(--sp-syntax-color-plain);line-height:var(--sp-font-lineHeight)}.sp-c-euXojQ{display:flex;flex-direction:column;width:100%;position:relative;background-color:var(--sp-colors-surface1);gap:1px}.sp-c-euXojQ:has(.sp-stack){background-color:var(--sp-colors-surface2)}.sp-c-bpmgvy{transform:translate(-4px, 9px) scale(0.13, 0.13)}.sp-c-bpmgvy *{position:absolute;width:96px;height:96px}}--sxs{--sxs:3 sp-c-PJLV-kCOVwI-status-pass sp-c-PJLV-kEzYsr-status-fail sp-c-PJLV-gHAhSA-status-skip sp-c-PJLV-jgnHyR-status-title sp-c-PJLV-iCgxLS-status-run sp-c-PJLV-bnDZSy-status-pass sp-c-PJLV-eYuGwt-status-fail}@media{.sp-c-PJLV-kCOVwI-status-pass{color:var(--test-pass)}.sp-c-PJLV-kEzYsr-status-fail{color:var(--test-fail)}.sp-c-PJLV-gHAhSA-status-skip{color:var(--test-skip)}.sp-c-PJLV-jgnHyR-status-title{color:var(--test-title)}.sp-c-PJLV-iCgxLS-status-run{background:var(--test-run);color:var(--sp-colors-surface1)}.sp-c-PJLV-bnDZSy-status-pass{background:var(--test-pass);color:var(--sp-colors-surface1)}.sp-c-PJLV-eYuGwt-status-fail{background:var(--test-fail);color:var(--sp-colors-surface1)}}</style> <link rel="stylesheet" href="/_astro/_id_.ubW0JEXm.css">
<link rel="stylesheet" href="/_astro/_id_.Ck7a8zcL.css"></head> <body class="relative flex h-full flex-col bg-background font-sans text-on-background [&_main]:my-6"> <script>
  // @ts-check
  const storedThemeChoice = window.localStorage.getItem('__theme') ?? 'system'

  window.__setTheme = setTheme
  // prettier-ignore
  window.__setTheme(/** @type {ThemeChoice} */ (storedThemeChoice))

  /**
   * @type {(themeChoice: ThemeChoice) => Promise<void>}
   */
  async function setTheme(themeChoice) {
    let theme = themeChoice

    if (themeChoice === 'system') {
      theme = window.matchMedia('(prefers-color-scheme: dark)').matches
        ? 'dark'
        : 'light'
    }

    const changeTheme = () => {
      document.body.classList.toggle('dark', theme === 'dark')
    }

    let viewTransition = null

    if (
      document.startViewTransition &&
      !document.documentElement.hasAttribute('data-notransition')
    ) {
      document.documentElement.setAttribute('data-notransition', '')

      const width = document.documentElement.clientWidth
      const height = document.documentElement.clientHeight
      const diagonal = Math.sqrt(width ** 2 + height ** 2)
      const circleRadius = height > width ? height : diagonal
      document.documentElement.style.setProperty(
        '--circle-radius',
        `${circleRadius}px`,
      )

      viewTransition = document.startViewTransition(() => {
        changeTheme()
      })
    } else {
      changeTheme()
    }

    window.localStorage.setItem('__theme', themeChoice)

    document.body.dispatchEvent(
      new CustomEvent('newTheme', {
        detail: {
          themeChoice,
          theme,
        },
      }),
    )

    if (viewTransition) {
      await viewTransition.finished
      document.documentElement.removeAttribute('data-notransition')
    }
  }

  window.addEventListener('storage', function (e) {
    const newTheme = e.newValue
    if (newTheme && newTheme && e.key === '__theme') {
      // prettier-ignore
      window.__setTheme(/** @type {ThemeChoice} */ (newTheme))
    }
  })

  window.addEventListener('load', function () {
    document.documentElement.removeAttribute('data-notransition')
  })
</script> <div class="w-full"> <div class="pt-nav-height sm:hidden"> <div class="h-nav-height fixed top-0 left-0 z-30 flex w-screen items-center justify-between rounded-none bg-background/90 backdrop-blur-xs px-horizontal-padding"> <div class="flex flex-row items-center gap-2 min-w-0"> <a href="/posts/" data-testid="parent-page-link" aria-label="Go back to previous page"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left "><path d="m15 18-6-6 6-6"></path></svg> </a> <h2 class="m-0 truncate font-sans font-normal">Getting Salesforce reports with VBA - Phelipe Teles</h2> </div> <button type="button" class="hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 min-w-[40px] h-[40px] flex justify-center items-center rounded-full px-2 bg-transparent" data-a11y-dialog-show="sidenav" data-testid="open-sidenav" aria-label="Open navigation sidebar"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu "><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg> </button> </div> </div> <div class="hidden h-full w-full sm:block"> <div class="grid grid-cols-layout"> <div class="flex w-full items-center justify-between"> <div class="mx-auto flex w-full max-w-content justify-between"> <nav class="flex justify-between" aria-label="Main navigation"> <ul class="m-0 flex flex-row list-none gap-4"> <li class=""> <a id="about" href="/" class="py-2 inline-block h-full w-full group"> <span class="underline underline-offset-8 decoration-2 decoration-transparent group-hover:decoration-hover"> About </span> </a> </li><li class=""> <a id="posts" href="/posts/" class="py-2 inline-block h-full w-full group" aria-current="page"> <span class="underline underline-offset-8 decoration-2 decoration-primary group-hover:decoration-primary-hover"> Posts </span> </a> </li> </ul> </nav> <div class="flex flex-row items-center gap-2">  <div style="--gap:2px;--icon-size:24px;--select-padding:calc(var(--icon-size) + var(--gap) * 2)" class="h-[32px] rounded-sm items-center grid justify-between bg-surface shadow-xs shadow-shadow"> <select class="h-full sm:py-0 rounded-sm bg-inherit appearance-none text-center row-start-1 col-start-1 col-end-4 px-(--select-padding)" data-theme-select="true" aria-label="Choose a theme">  <option value="light">Light</option> <option value="dark">Dark</option> <option value="system">System</option>   </select> <span style="--svg-size:calc(var(--icon-size) - 8px)" class="col-span-1 col-start-1 row-start-1 flex items-center justify-center w-(--icon-size) h-(--icon-size) [&#38;_svg]:w-(--svg-size) [&#38;_svg]:h-(--svg-size) pointer-events-none">  <svg class="feather" viewBox="0 0 24 24" width="24" height="24"> <title>Theme icon</title> <defs> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon " id="moon"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun " id="sun"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-monitor " id="monitor"><rect width="20" height="14" x="2" y="3" rx="2"></rect><line x1="8" x2="16" y1="21" y2="21"></line><line x1="12" x2="12" y1="17" y2="21"></line></svg> </defs> <use data-theme-select-icon href="#monitor"></use> </svg>  </span> <span style="--svg-size:calc(var(--icon-size) - 8px)" class="justify-self-end row-start-1 col-start-3 col-span-1 flex items-center justify-center w-(--icon-size) h-(--icon-size) [&#38;_svg]:w-(--svg-size) [&#38;_svg]:h-(--svg-size) pointer-events-none">  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down "><path d="m6 9 6 6 6-6"></path></svg>  </span> </div> <script type="module">const i=document.querySelectorAll("[data-theme-select]");i?.forEach(e=>{const t=window.localStorage.getItem("__theme")??"system";s(t);const o=Array.from(e.options).find(n=>n.value===t);o&&o.setAttribute("selected",""),e.addEventListener("change",function(n){if(!n.target)return;const c=n.target.selectedOptions[0];c&&window.__setTheme(c.value)})});document.body.addEventListener("newTheme",function(e){const t=e.detail.themeChoice;s(t)});function s(e){const t={dark:"#moon",light:"#sun",system:"#monitor"}[e];i.forEach(o=>{o.parentElement?.querySelector("[data-theme-select-icon]")?.setAttribute("href",t)})}</script> </div> </div> </div> </div> </div> </div> <aside data-a11y-dialog="sidenav" aria-hidden="true" class="fixed z-50 h-full w-full" style="visibility: hidden;"> <div data-a11y-dialog-hide class="fixed inset-0 -z-1 w-full bg-neutral-700/75 backdrop-blur-xs"></div> <div role="document" class="ml-auto h-full flex flex-col w-3/4 rounded-none bg-background py-0 will-change-transform"> <div class="mb-2 flex h-nav-height items-center justify-end px-horizontal-padding"> <button type="button" data-a11y-dialog-hide="true" aria-label="Close" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 min-w-[40px] h-[40px] flex justify-center items-center rounded-full px-2"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x "><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg> </button> </div> <nav class="flex flex-col" aria-label="Main navigation"> <ul class="m-0 flex list-none flex-col items-center justify-center gap-2 px-horizontal-padding"> <li class="w-full"> <a id="about" href="/" class="flex items-center justify-center flex-row transition-colors duration-300 hover:bg-hover disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled rounded-sm whitespace-nowrap py-1 px-2 bg-surface text-on-background"><div class="pr-2"></div>About<div class="pl-2"></div></a> </li><li class="w-full"> <a id="posts" href="/posts/" aria-current="page" class="flex items-center justify-center flex-row transition-colors duration-300 disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled rounded-sm whitespace-nowrap py-1 px-2 bg-primary text-on-primary hover:bg-primary-hover shadow-xs shadow-shadow"><div class="pr-2"></div>Posts<div class="pl-2"></div></a> </li> </ul> </nav> <div class="flex flex-col gap-2 pb-4 mt-auto px-horizontal-padding"> <div style="--gap:2px;--icon-size:24px;--select-padding:calc(var(--icon-size) + var(--gap) * 2)" class="h-[32px] rounded-sm items-center grid justify-between bg-background"> <select class="h-full sm:py-0 rounded-sm bg-inherit appearance-none text-center row-start-1 col-start-1 col-end-4 px-(--select-padding)" data-language-select="true" aria-label="Choose a language">  <option selected value="en">English</option> <option value="pt">Português</option>   </select> <span style="--svg-size:calc(var(--icon-size) - 8px)" class="col-span-1 col-start-1 row-start-1 flex items-center justify-center w-(--icon-size) h-(--icon-size) [&#38;_svg]:w-(--svg-size) [&#38;_svg]:h-(--svg-size) pointer-events-none">  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-languages " slot="start-icon"><path d="m5 8 6 6"></path><path d="m4 14 6-6 2-3"></path><path d="M2 5h12"></path><path d="M7 2h1"></path><path d="m22 22-5-10-5 10"></path><path d="M14 18h6"></path></svg>  </span> <span style="--svg-size:calc(var(--icon-size) - 8px)" class="justify-self-end row-start-1 col-start-3 col-span-1 flex items-center justify-center w-(--icon-size) h-(--icon-size) [&#38;_svg]:w-(--svg-size) [&#38;_svg]:h-(--svg-size) pointer-events-none">  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down "><path d="m6 9 6 6 6-6"></path></svg>  </span> </div> <script type="module">const a=document.querySelectorAll("[data-language-select]");a?.forEach(e=>{e.addEventListener("change",function(){window.location.href=n()})});function n(){const e=window.location.pathname;let t=e;switch(e){case"/pt":t="/";break;case"/":t="/pt/";break;default:e.startsWith("/pt/")?t=e.replace("/pt/","/"):t="/pt"+e;break}return t}</script> <div style="--gap:2px;--icon-size:24px;--select-padding:calc(var(--icon-size) + var(--gap) * 2)" class="h-[32px] rounded-sm items-center grid justify-between bg-surface shadow-xs shadow-shadow"> <select class="h-full sm:py-0 rounded-sm bg-inherit appearance-none text-center row-start-1 col-start-1 col-end-4 px-(--select-padding)" data-theme-select="true" aria-label="Choose a theme">  <option value="light">Light</option> <option value="dark">Dark</option> <option value="system">System</option>   </select> <span style="--svg-size:calc(var(--icon-size) - 8px)" class="col-span-1 col-start-1 row-start-1 flex items-center justify-center w-(--icon-size) h-(--icon-size) [&#38;_svg]:w-(--svg-size) [&#38;_svg]:h-(--svg-size) pointer-events-none">  <svg class="feather" viewBox="0 0 24 24" width="24" height="24"> <title>Theme icon</title> <defs> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon " id="moon"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun " id="sun"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-monitor " id="monitor"><rect width="20" height="14" x="2" y="3" rx="2"></rect><line x1="8" x2="16" y1="21" y2="21"></line><line x1="12" x2="12" y1="17" y2="21"></line></svg> </defs> <use data-theme-select-icon href="#monitor"></use> </svg>  </span> <span style="--svg-size:calc(var(--icon-size) - 8px)" class="justify-self-end row-start-1 col-start-3 col-span-1 flex items-center justify-center w-(--icon-size) h-(--icon-size) [&#38;_svg]:w-(--svg-size) [&#38;_svg]:h-(--svg-size) pointer-events-none">  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down "><path d="m6 9 6 6 6-6"></path></svg>  </span> </div>  </div> </div> </aside> <script type="module" src="/_astro/SideNav.astro_astro_type_script_index_0_lang.DwDLKeHA.js"></script>   <main class="grid grid-cols-layout"> <div class="sm:col-content px-0"> <article> <header class="flex flex-col"> <h1 class="mb-4 text-4xl max-w-prose"> Getting Salesforce reports with VBA </h1> <div class="mb-4 flex gap-2 flex-row flex-wrap"> <div class="flex items-center gap-2"> <svg xmlns="http://www.w3.org/2000/svg" width="1.25em" height="1.25em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar shrink-0"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect><line x1="16" x2="16" y1="2" y2="6"></line><line x1="8" x2="8" y1="2" y2="6"></line><line x1="3" x2="21" y1="10" y2="10"></line></svg> <time datetime="2020-08-05"> August 05, 2020 </time> </div> <div class="flex items-center gap-2"> <svg xmlns="http://www.w3.org/2000/svg" width="1.25em" height="1.25em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-timer shrink-0"><line x1="10" x2="14" y1="2" y2="2"></line><line x1="12" x2="15" y1="14" y2="11"></line><circle cx="12" cy="14" r="8"></circle></svg> <div>9 min.</div> </div> <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover flex flex-row gap-2 items-center shrink-0" target="_blank" href="https://github.com/phelipetls/blog/blob/master/src/content/posts/getting-salesforce-reports-with-vba/index.mdx"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-code2 "><path d="M4 22h14a2 2 0 0 0 2-2V7.5L14.5 2H6a2 2 0 0 0-2 2v4"></path><polyline points="14 2 14 8 20 8"></polyline><path d="m9 18 3-3-3-3"></path><path d="m5 12-3 3 3 3"></path></svg> Source code</a> </div> <div class="mb-4 flex max-w-xl flex-wrap gap-2"> <a class="inline-flex gap-2 w-fit items-center justify-center rounded-full border border-divider bg-surface px-4 no-underline shadow-xs shadow-shadow transition-colors duration-300 hover:border-divider hover:bg-hover whitespace-nowrap order-2" href="/tags/salesforce/"> <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag "><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"></path><path d="M7 7h.01"></path></svg> salesforce  </a><a class="inline-flex gap-2 w-fit items-center justify-center rounded-full border border-divider bg-surface px-4 no-underline shadow-xs shadow-shadow transition-colors duration-300 hover:border-divider hover:bg-hover whitespace-nowrap order-2" href="/tags/vba/"> <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag "><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"></path><path d="M7 7h.01"></path></svg> vba  </a><a class="inline-flex gap-2 w-fit items-center justify-center rounded-full border border-divider bg-surface px-4 no-underline shadow-xs shadow-shadow transition-colors duration-300 hover:border-divider hover:bg-hover whitespace-nowrap order-2" href="/tags/excel/"> <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag "><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"></path><path d="M7 7h.01"></path></svg> excel  </a> <a class="inline-flex gap-2 w-fit items-center justify-center rounded-full border border-divider bg-surface px-4 no-underline shadow-xs shadow-shadow transition-colors duration-300 hover:border-divider hover:bg-hover whitespace-nowrap order-2" href="/tags/">  ...  </a> </div> </header> <hr class="my-8"> <div data-blog-post-container data-toc="open" class="group flex flex-col lg:gap-8 lg:flex-row-reverse"> <aside style="--offset-from-top:1rem" class="relative shrink-0 mb-8 lg:ml-auto lg:mb-0 lg:basis-1/3 lg:sticky lg:top-(--offset-from-top) lg:h-[calc(100vh-var(--offset-from-top)*2)] overflow-hidden"> <button type="button" data-toggle-toc="true" data-open-toc-label="Open table of contents" data-closed-toc-label="Close table of contents" aria-label="Close table of contents" style="--duration:150ms" data-preload="true" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary duration-300 min-w-[40px] h-[40px] justify-center items-center rounded-full px-2 z-1 absolute top-4 right-4 hidden lg:grid lg:min-w-0 lg:group-data-toc-open:grid-cols-[0fr_max-content] lg:group-data-toc-closed:grid-cols-[1fr_max-content] transition-all duration-(--duration) ease-in-out lg:justify-center"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x col-start-2 col-end-2 row-start-1 row-end-1 scale-0 transition-transform duration-(--duration) ease-out group-data-toc-open:scale-100 group-data-toc-open:delay-(--duration)"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-list col-start-2 col-end-2 row-start-1 row-end-1 scale-0 transition-transform duration-(--duration) ease-in group-data-toc-closed:scale-100 group-data-toc-closed:delay-[var(--duration)"><line x1="8" x2="21" y1="6" y2="6"></line><line x1="8" x2="21" y1="12" y2="12"></line><line x1="8" x2="21" y1="18" y2="18"></line><line x1="3" x2="3.01" y1="6" y2="6"></line><line x1="3" x2="3.01" y1="12" y2="12"></line><line x1="3" x2="3.01" y1="18" y2="18"></line></svg> <div class="col-start-1 col-end-1 group-data-toc-closed:mx-2 truncate"> Open table of contents </div> </button> <div data-blog-post-toc-container data-preload class="card lg:h-full lg:p-4 lg:ml-auto lg:opacity-100 lg:group-data-toc-closed:opacity-0 lg:group-data-toc-closed:pointer-events-none transition-opacity duration-300 ease-in-out"> <div class="hidden lg:flex lg:h-full lg:flex-col"> <div class="flex items-center gap-2 h-10 flex-none"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-list "><line x1="8" x2="21" y1="6" y2="6"></line><line x1="8" x2="21" y1="12" y2="12"></line><line x1="8" x2="21" y1="18" y2="18"></line><line x1="3" x2="3.01" y1="6" y2="6"></line><line x1="3" x2="3.01" y1="12" y2="12"></line><line x1="3" x2="3.01" y1="18" y2="18"></line></svg> <h2 class="m-0">Table of Contents</h2> <div class="ml-auto flex items-center transition-transform duration-150 ease-in group-open:rotate-180 lg:hidden"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down "><path d="m6 9 6 6 6-6"></path></svg> </div> </div> <nav data-toc-wrapper class="pt-4 h-full min-h-0 lg:overflow-y-auto [&#38;_a_*]:indent-0 [&#38;_ol]:m-0 [&#38;_ol]:list-none [&#38;_ol]:indent-4 [&#38;_ol_li[data-active]>a]:text-primary [&#38;_ol_li[data-active]]:before:bg-primary [&#38;_ol_li]:relative [&#38;_ol_li]:before:absolute [&#38;_ol_li]:before:left-0 [&#38;_ol_li]:before:top-0 [&#38;_ol_li]:before:h-full [&#38;_ol_li]:before:w-px [&#38;_ol_li]:before:bg-divider [&#38;_ol_li]:before:content-[''] [&#38;_ol_li_a:hover]:bg-hover [&#38;_ol_li_a]:block [&#38;_ol_li_a]:truncate [&#38;_ol_li_a]:border-b-0 [&#38;_ol_li_a]:transition-colors [&#38;_ol_li_a]:duration-300 [&#38;_ol_ol]:indent-8 [&#38;_ol_ol_ol]:indent-12 [&#38;_ol_ol_ol_ol]:indent-16"> <ol data-astro-toc="1"><li data-astro-toc="1"> <a href="#authentication">Authentication</a>  </li><li data-astro-toc="1"> <a href="#parsing-json-inside-vba">Parsing JSON inside VBA?</a>  </li><li data-astro-toc="1"> <a href="#unfortunate-api-limitations">Unfortunate API limitations</a>  </li><li data-astro-toc="1"> <a href="#getting-report-metadata">Getting report metadata</a>  </li><li data-astro-toc="1"> <a href="#getting-an-individual-report">Getting an individual report</a>  </li><li data-astro-toc="1"> <a href="#writing-the-data-into-a-worksheet">Writing the data into a worksheet</a>  </li><li data-astro-toc="1"> <a href="#getting-the-entire-report">Getting the entire report</a>  </li><li data-astro-toc="1"> <a href="#how-to-use-it">How to use it</a>  </li><li data-astro-toc="1"> <a href="#final-words">Final words</a>  </li></ol> </nav> </div> <details class="group px-horizontal-padding py-4 lg:hidden" aria-label="Table of Contents"> <summary class="list-none"> <div class="flex items-center gap-2"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-list "><line x1="8" x2="21" y1="6" y2="6"></line><line x1="8" x2="21" y1="12" y2="12"></line><line x1="8" x2="21" y1="18" y2="18"></line><line x1="3" x2="3.01" y1="6" y2="6"></line><line x1="3" x2="3.01" y1="12" y2="12"></line><line x1="3" x2="3.01" y1="18" y2="18"></line></svg> <h2 class="m-0">Table of Contents</h2> <div class="flex items-center ml-auto transition-transform duration-150 ease-in group-open:rotate-180 lg:hidden"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-down "><path d="m6 9 6 6 6-6"></path></svg> </div> </div> </summary> <nav data-toc-wrapper class="mt-4 [&#38;_ol]:m-0 [&#38;_ol]:list-outside [&#38;_ol]:px-horizontal-padding [&#38;_ol_li:not(:first-child)]:mt-1"> <ol data-astro-toc="1"><li data-astro-toc="1"> <a href="#authentication">Authentication</a>  </li><li data-astro-toc="1"> <a href="#parsing-json-inside-vba">Parsing JSON inside VBA?</a>  </li><li data-astro-toc="1"> <a href="#unfortunate-api-limitations">Unfortunate API limitations</a>  </li><li data-astro-toc="1"> <a href="#getting-report-metadata">Getting report metadata</a>  </li><li data-astro-toc="1"> <a href="#getting-an-individual-report">Getting an individual report</a>  </li><li data-astro-toc="1"> <a href="#writing-the-data-into-a-worksheet">Writing the data into a worksheet</a>  </li><li data-astro-toc="1"> <a href="#getting-the-entire-report">Getting the entire report</a>  </li><li data-astro-toc="1"> <a href="#how-to-use-it">How to use it</a>  </li><li data-astro-toc="1"> <a href="#final-words">Final words</a>  </li></ol> </nav> </details> <script type="module">const s=document.querySelector("nav[data-toc-wrapper] ol"),o=s?.closest("[data-toc-wrapper]"),l=document.querySelector("[data-blog-post]"),a=s?.querySelector("li");function u(t){t.setAttribute("data-active","")}function d(t){t.removeAttribute("data-active")}function f(){s?.querySelectorAll("li").forEach(d)}function g(t){const e=t.getAttribute("id"),c=s?.querySelector(`li a[href="#${e}"]`);return c?c.closest("li"):null}const h=new IntersectionObserver(t=>{t.forEach(e=>{if(!o)return;const c=e.target;if(e.isIntersecting){const n=g(c);if(!n)return;f(),u(n);const r=o.getBoundingClientRect(),i=n.getBoundingClientRect();if(n===a){o.scrollTop=0;return}if(r.top>i.top){o.scrollTop-=r.top-i.top;return}i.bottom>r.bottom&&(o.scrollTop+=i.bottom-r.bottom)}})},{threshold:1}),m=l.querySelectorAll("h2, h3, h4, h4, h6");for(const t of m)h.observe(t);</script> </div> </aside> <div data-blog-post class="min-w-0 [&#38;>pre]:my-8 max-sm:[&#38;>pre]:full-bleed *:data-codeblock:my-8 max-sm:*:data-codeblock:full-bleed max-sm:[&#38;>[data-codeblock]_pre]:rounded-none max-sm:[&#38;>[data-codeblock]_[data-codeblock-header]]:rounded-none [&#38;>hr]:border-0 [&#38;>hr]:text-center [&#38;>hr]:after:content-['⁂'] max-sm:[&#38;>figure]:full-bleed [&#38;>astro-island>div]:my-8 [&#38;>lite-youtube]:my-8 [&#38;>blockquote]:my-8 [&#38;>figure_video]:min-h-[15em] [&#38;_.katex-display]:max-w-prose [&#38;_.katex-display]:overflow-x-auto [&#38;_.katex-display]:overflow-y-hidden"> <p class="max-w-prose">For those who find themselves in an environment which heavily relies on Excel
and Salesforce, you may be interested in a way to automate the process of
downloading reports from inside Excel with VBA only.</p>
<p class="max-w-prose">I think there are probably better tools for the job, like Apex, SOQL query or a
better programming language. I
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://github.com/reportforce">created a Python package for this purpose</a> but
I didn’t use it so much because it’s hard to integrate with Excel.</p>
<p class="max-w-prose">Instead, I looked into a way to do something similar with VBA and I managed to
do it. In this post I’ll share this with you.</p>
<h2 id="authentication" class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2">  Authentication<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#authentication"><span class="icon icon-link"></span></a>  </h2>
<p class="max-w-prose">The more painless way I know of to
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://developer.salesforce.com/docs/atlas.en-us.api_asynch.meta/api_asynch/asynch_api_quickstart_login.htm">authenticate your requests for a Salesforce web service is via SOAP API</a>,
with username, password and a security token.</p>
<p class="max-w-prose">It returns a bunch of XML in the response, but we will only need the session id
(a JWT) inside of it. This is what the function below does.</p>
<p class="max-w-prose">From here onwards, we will need to authenticate every request by passing the
header <code>Authorization: Bearer $sessionId</code>.</p>
<div data-codeblock class="last:mb-0 max-w-2xl text-sm [&#38;_>_pre]:shadow-xs [&#38;_>_pre]:shadow-shadow [&#38;_>_pre]:rounded-b [&#38;_>_pre]:overflow-x-auto [&#38;_>_pre]:scheme-dark [&#38;_>_pre_>_code]:py-4 [&#38;_>_pre_>_code]:grid [&#38;_.line]:px-horizontal-padding [&#38;_.line]:border-l-2 [&#38;_.line]:border-(--code-bg) [&#38;_.line]:min-h-[1lh] [&#38;_.line]:empty:last:min-h-0 [&#38;_.line.highlighted]:bg-[#272115] [&#38;_.line.highlighted]:border-[#624710] [&#38;_.twoslash-query-line]:px-horizontal-padding [&#38;_.twoslash-error-line]:border-l-2 [&#38;_.twoslash-error-line]:border-(--code-bg) [&#38;_.twoslash-error-line]:py-1 [&#38;_.twoslash-error-line]:px-4 [&#38;_.twoslash-error-line]:bg-[#d4565620] [&#38;_.twoslash-error-line]:text-[#d45656] [&#38;_.twoslash-error-line]:border-[#d45656] [&#38;_.twoslash-popup-arrow]:bg-(--code-bg) [&#38;_.twoslash-popup-container]:bg-(--code-bg)" style="--code-bg: #282c34;--code-fg: #abb2bf;"> <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-(--code-bg) text-(--code-fg) border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;"> <div class="flex pl-horizontal-padding items-center gap-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">  <div class="rtl truncate text-lg" style="--code-bg: #282c34;--code-fg: #abb2bf;"> vb </div> </div> <div class="ml-auto flex flex-row gap-2 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">  <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="1x4VkV" prefix="r38" component-url="/_astro/CopyCodeBlockButton.CunNfTy3.js" component-export="default" renderer-url="/_astro/client.BXosma6P.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;Function SalesforceLogin(Username As String, _\n                         Password As String, _\n                         SecurityToken As String) As String\n\n    Dim Request As Object\n    Set Request = CreateObject(\&quot;MSXML2.XMLHTTP.6.0\&quot;)\n\n    Dim XMLBody As Object\n    Dim XMLResponse As Object\n\n    Set XMLBody = CreateObject(\&quot;MSXML2.DOMDocument.6.0\&quot;)\n    Set XMLResponse = CreateObject(\&quot;MSXML2.DOMDocument.6.0\&quot;)\n\n    Dim Url As String\n    Dim Body As String\n    Dim Response As String\n\n    Url = \&quot;https://login.salesforce.com/services/Soap/u/47.0\&quot;\n\n    Body = \&quot;&lt;?xml version=\&quot;\&quot;1.0\&quot;\&quot; encoding=\&quot;\&quot;utf-8\&quot;\&quot; ?&gt;\&quot; &amp; vbNewLine &amp; _\n           \&quot;&lt;env:Envelope xmlns:xsd=\&quot;\&quot;http://www.w3.org/2001/XMLSchema\&quot;\&quot;\&quot; &amp; vbNewLine &amp; _\n           \&quot;    xmlns:xsi=\&quot;\&quot;http://www.w3.org/2001/XMLSchema-instance\&quot;\&quot;\&quot; &amp; vbNewLine &amp; _\n           \&quot;    xmlns:env=\&quot;\&quot;http://schemas.xmlsoap.org/soap/envelope/\&quot;\&quot;&gt;\&quot; &amp; vbNewLine &amp; _\n           \&quot;  &lt;env:Body&gt;\&quot; &amp; vbNewLine &amp; _\n           \&quot;    &lt;n1:login xmlns:n1=\&quot;\&quot;urn:partner.soap.sforce.com\&quot;\&quot;&gt;\&quot; &amp; vbNewLine &amp; _\n           \&quot;      &lt;n1:username&gt;\&quot; &amp; Username &amp; \&quot;&lt;/n1:username&gt;\&quot; &amp; vbNewLine &amp; _\n           \&quot;      &lt;n1:password&gt;\&quot; &amp; Password &amp; SecurityToken &amp; \&quot;&lt;/n1:password&gt;\&quot; &amp; vbNewLine &amp; _\n           \&quot;    &lt;/n1:login&gt;\&quot; &amp; vbNewLine &amp; _\n           \&quot;  &lt;/env:Body&gt;\&quot; &amp; vbNewLine &amp; _\n           \&quot;&lt;/env:Envelope&gt;\&quot;\n\n    XMLBody.LoadXML Body\n\n    Request.Open \&quot;POST\&quot;, Url, False\n    Request.setRequestHeader \&quot;Content-Type\&quot;, \&quot;text/xml\&quot;\n    Request.setRequestHeader \&quot;SOAPAction\&quot;, \&quot;login\&quot;\n    Request.send XMLBody.XML\n    Response = Request.responseText\n\n    XMLResponse.LoadXML Response\n    XMLResponse.setProperty \&quot;SelectionNamespaces\&quot;, \&quot;xmlns:soapenv=\&quot;\&quot;http://schemas.xmlsoap.org/soap/envelope/\&quot;\&quot; xmlns:urn=\&quot;\&quot;urn:partner.soap.sforce.com\&quot;\&quot;\&quot;\n\n    Dim SessionId As String\n    SessionId = XMLResponse.SelectSingleNode(\&quot;//urn:result/urn:sessionId\&quot;).Text\n\n    SalesforceLogin = SessionId\n\n    Set Request = Nothing\n\nEnd Function&quot;]}" ssr client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded-sm border border-divider p-1 shadow-xs shadow-shadow"><span class="text-(--code-fg)"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard "><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button><!--astro:end--></astro-island> </div> </div> <pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">Function </span><span style="color:#61AFEF">SalesforceLogin</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Username</span><span style="color:#ABB2BF"> As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">                         Password As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">                         SecurityToken As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">) As </span><span style="color:#E5C07B">String</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> Request </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span>
<span class="line"><span style="color:#C678DD">    Set </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF"> = </span><span style="color:#56B6C2">CreateObject</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"MSXML2.XMLHTTP.6.0"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> XMLBody </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> XMLResponse </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Set </span><span style="color:#E06C75">XMLBody</span><span style="color:#ABB2BF"> = </span><span style="color:#56B6C2">CreateObject</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"MSXML2.DOMDocument.6.0"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#C678DD">    Set </span><span style="color:#E06C75">XMLResponse</span><span style="color:#ABB2BF"> = </span><span style="color:#56B6C2">CreateObject</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"MSXML2.DOMDocument.6.0"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> Url </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> Body </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> Response </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">    Url</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">"https://login.salesforce.com/services/Soap/u/47.0"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">    Body</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">"&#x3C;?xml version=""1.0"" encoding=""utf-8"" ?>"</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#98C379">           "&#x3C;env:Envelope xmlns:xsd=""http://www.w3.org/2001/XMLSchema"""</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#98C379">           "    xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"""</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#98C379">           "    xmlns:env=""http://schemas.xmlsoap.org/soap/envelope/"">"</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#98C379">           "  &#x3C;env:Body>"</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#98C379">           "    &#x3C;n1:login xmlns:n1=""urn:partner.soap.sforce.com"">"</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#98C379">           "      &#x3C;n1:username>"</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> Username</span><span style="color:#ABB2BF"> &#x26; </span><span style="color:#98C379">"&#x3C;/n1:username>"</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#98C379">           "      &#x3C;n1:password>"</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> Password</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> SecurityToken</span><span style="color:#ABB2BF"> &#x26; </span><span style="color:#98C379">"&#x3C;/n1:password>"</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#98C379">           "    &#x3C;/n1:login>"</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#98C379">           "  &#x3C;/env:Body>"</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> vbNewLine</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#98C379">           "&#x3C;/env:Envelope>"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    XMLBody.LoadXML Body</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">    Request</span><span style="color:#ABB2BF">.Open </span><span style="color:#98C379">"POST"</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> Url</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66"> False</span></span>
<span class="line"><span style="color:#E5C07B">    Request</span><span style="color:#ABB2BF">.setRequestHeader </span><span style="color:#98C379">"Content-Type"</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"text/xml"</span></span>
<span class="line"><span style="color:#E5C07B">    Request</span><span style="color:#ABB2BF">.setRequestHeader </span><span style="color:#98C379">"SOAPAction"</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"login"</span></span>
<span class="line"><span style="color:#E5C07B">    Request</span><span style="color:#ABB2BF">.send XMLBody.XML</span></span>
<span class="line"><span style="color:#E5C07B">    Response</span><span style="color:#ABB2BF"> = </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF">.responseText</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">    XMLResponse.LoadXML </span><span style="color:#E5C07B">Response</span></span>
<span class="line"><span style="color:#ABB2BF">    XMLResponse.setProperty </span><span style="color:#98C379">"SelectionNamespaces"</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"xmlns:soapenv=""http://schemas.xmlsoap.org/soap/envelope/"" xmlns:urn=""urn:partner.soap.sforce.com"""</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> SessionId </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span>
<span class="line"><span style="color:#ABB2BF">    SessionId = XMLResponse.</span><span style="color:#61AFEF">SelectSingleNode</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"//urn:result/urn:sessionId"</span><span style="color:#ABB2BF">).Text</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">    SalesforceLogin</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> SessionId</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Set </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF"> =</span><span style="color:#D19A66"> Nothing</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">End Function</span></span></code></pre> </div> <script type="module" src="/_astro/CodeBlock.astro_astro_type_script_index_0_lang.CZ7V3yCn.js"></script>
<h2 id="parsing-json-inside-vba" class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2">  Parsing JSON inside VBA?<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#parsing-json-inside-vba"><span class="icon icon-link"></span></a>  </h2>
<p class="max-w-prose">Now, to get an actual report inside Excel we will need to use the Analytics API.
So far, we didn’t had to rely on any external tools, there is an XML parser
inside VBA, but not a JSON parser at least that I know of. So we’re in trouble
here because that’s what Analytics speaks.</p>
<p class="max-w-prose">Fortunately, there is a
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://github.com/VBA-tools/VBA-JSON">JSON parser implementation for VBA</a>
which works flawlessly. You just need to download
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://raw.githubusercontent.com/VBA-tools/VBA-JSON/master/JsonConverter.bas">this file</a>
and import it as a module.</p>
<h2 id="unfortunate-api-limitations" class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2">  Unfortunate API limitations<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#unfortunate-api-limitations"><span class="icon icon-link"></span></a>  </h2>
<p class="max-w-prose">This API unfortunately have a
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://developer.salesforce.com/docs/atlas.en-us.api_analytics.meta/api_analytics/sforce_analytics_rest_api_limits_limitations.htm">critical limitation</a>,
which is to return only a maximum of 2000 rows per report. Also, there is no way
to filter by row limits.</p>
<p class="max-w-prose">This almost turns it useless. The only way I know of is to use a column which
has only unique values and exclude already seen values with a filter, which is
what we’ll gonna do.</p>
<h2 id="getting-report-metadata" class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2">  Getting report metadata<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#getting-report-metadata"><span class="icon icon-link"></span></a>  </h2>
<p class="max-w-prose">To be able to filter a report, we will need to fetch its metadata, which is a
huge JSON with key-value pairs describing the report.</p>
<p class="max-w-prose">We can get it with a <code>GET</code> request to
<code>https://$YOUR_INSTANCE_URL/services/data/v47.0/analytics/reports/$REPORT_ID/describe</code>.</p>
<div data-codeblock class="last:mb-0 max-w-2xl text-sm [&#38;_>_pre]:shadow-xs [&#38;_>_pre]:shadow-shadow [&#38;_>_pre]:rounded-b [&#38;_>_pre]:overflow-x-auto [&#38;_>_pre]:scheme-dark [&#38;_>_pre_>_code]:py-4 [&#38;_>_pre_>_code]:grid [&#38;_.line]:px-horizontal-padding [&#38;_.line]:border-l-2 [&#38;_.line]:border-(--code-bg) [&#38;_.line]:min-h-[1lh] [&#38;_.line]:empty:last:min-h-0 [&#38;_.line.highlighted]:bg-[#272115] [&#38;_.line.highlighted]:border-[#624710] [&#38;_.twoslash-query-line]:px-horizontal-padding [&#38;_.twoslash-error-line]:border-l-2 [&#38;_.twoslash-error-line]:border-(--code-bg) [&#38;_.twoslash-error-line]:py-1 [&#38;_.twoslash-error-line]:px-4 [&#38;_.twoslash-error-line]:bg-[#d4565620] [&#38;_.twoslash-error-line]:text-[#d45656] [&#38;_.twoslash-error-line]:border-[#d45656] [&#38;_.twoslash-popup-arrow]:bg-(--code-bg) [&#38;_.twoslash-popup-container]:bg-(--code-bg)" style="--code-bg: #282c34;--code-fg: #abb2bf;"> <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-(--code-bg) text-(--code-fg) border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;"> <div class="flex pl-horizontal-padding items-center gap-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">  <div class="rtl truncate text-lg" style="--code-bg: #282c34;--code-fg: #abb2bf;"> vb </div> </div> <div class="ml-auto flex flex-row gap-2 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">  <astro-island uid="Z1DvYcd" prefix="r39" component-url="/_astro/CopyCodeBlockButton.CunNfTy3.js" component-export="default" renderer-url="/_astro/client.BXosma6P.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;Function GetMetadata(ReportId As String, SessionId As String) As String\n    Dim Request As Object\n    Set Request = CreateObject(\&quot;MSXML2.XMLHTTP.6.0\&quot;)\n    Dim Response As String\n    Dim Url As String\n\n    &#39; NOTE: You will need your organization URL here\n    Url =  YOUR_INSTANCE_URL &amp; \&quot;/services/data/v47.0/analytics/reports/\&quot; &amp; ReportId &amp; \&quot;/describe\&quot;\n\n    Request.Open \&quot;GET\&quot;, Url, False\n    Request.setRequestHeader \&quot;Authorization\&quot;, \&quot;Bearer \&quot; &amp; SessionId\n    Request.send\n\n    GetMetadata = Request.responseText\nEnd Function&quot;]}" ssr client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded-sm border border-divider p-1 shadow-xs shadow-shadow"><span class="text-(--code-fg)"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard "><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button><!--astro:end--></astro-island> </div> </div> <pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">Function</span><span style="color:#61AFEF"> GetMetadata</span><span style="color:#ABB2BF">(</span><span style="color:#ABB2BF;font-style:italic">ReportId As String, SessionId As String</span><span style="color:#ABB2BF">) As String</span></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> Request </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span>
<span class="line"><span style="color:#C678DD">    Set </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF"> = </span><span style="color:#56B6C2">CreateObject</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"MSXML2.XMLHTTP.6.0"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> Response </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> Url </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    ' NOTE: You will need your organization URL here</span></span>
<span class="line"><span style="color:#E06C75">    Url</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75">  YOUR_INSTANCE_URL</span><span style="color:#ABB2BF"> &#x26; </span><span style="color:#98C379">"/services/data/v47.0/analytics/reports/"</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> ReportId</span><span style="color:#ABB2BF"> &#x26; </span><span style="color:#98C379">"/describe"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">    Request</span><span style="color:#ABB2BF">.Open </span><span style="color:#98C379">"GET"</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> Url</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66"> False</span></span>
<span class="line"><span style="color:#E5C07B">    Request</span><span style="color:#ABB2BF">.setRequestHeader </span><span style="color:#98C379">"Authorization"</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"Bearer "</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> SessionId</span></span>
<span class="line"><span style="color:#E5C07B">    Request</span><span style="color:#ABB2BF">.send</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">    GetMetadata</span><span style="color:#ABB2BF"> = </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF">.responseText</span></span>
<span class="line"><span style="color:#C678DD">End Function</span></span></code></pre> </div> 
<h2 id="getting-an-individual-report" class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2">  Getting an individual report<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#getting-an-individual-report"><span class="icon icon-link"></span></a>  </h2>
<p class="max-w-prose">With the function below, you will be able to get the report in JSON format.</p>
<p class="max-w-prose">This is achieved with a <code>POST</code> request to
<code>https://$YOUR_INSTANCE_URL/services/data/v47.0/analytics/reports/$REPORT_ID</code>,
optional metadata goes into the request body, this is what we use to filter the
report.</p>
<div data-codeblock class="last:mb-0 max-w-2xl text-sm [&#38;_>_pre]:shadow-xs [&#38;_>_pre]:shadow-shadow [&#38;_>_pre]:rounded-b [&#38;_>_pre]:overflow-x-auto [&#38;_>_pre]:scheme-dark [&#38;_>_pre_>_code]:py-4 [&#38;_>_pre_>_code]:grid [&#38;_.line]:px-horizontal-padding [&#38;_.line]:border-l-2 [&#38;_.line]:border-(--code-bg) [&#38;_.line]:min-h-[1lh] [&#38;_.line]:empty:last:min-h-0 [&#38;_.line.highlighted]:bg-[#272115] [&#38;_.line.highlighted]:border-[#624710] [&#38;_.twoslash-query-line]:px-horizontal-padding [&#38;_.twoslash-error-line]:border-l-2 [&#38;_.twoslash-error-line]:border-(--code-bg) [&#38;_.twoslash-error-line]:py-1 [&#38;_.twoslash-error-line]:px-4 [&#38;_.twoslash-error-line]:bg-[#d4565620] [&#38;_.twoslash-error-line]:text-[#d45656] [&#38;_.twoslash-error-line]:border-[#d45656] [&#38;_.twoslash-popup-arrow]:bg-(--code-bg) [&#38;_.twoslash-popup-container]:bg-(--code-bg)" style="--code-bg: #282c34;--code-fg: #abb2bf;"> <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-(--code-bg) text-(--code-fg) border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;"> <div class="flex pl-horizontal-padding items-center gap-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">  <div class="rtl truncate text-lg" style="--code-bg: #282c34;--code-fg: #abb2bf;"> vb </div> </div> <div class="ml-auto flex flex-row gap-2 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">  <astro-island uid="to7IK" prefix="r45" component-url="/_astro/CopyCodeBlockButton.CunNfTy3.js" component-export="default" renderer-url="/_astro/client.BXosma6P.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;Function GetReport(ReportId As String, _\n                   SessionId As String, _\n                   Optional Metadata As String = \&quot;\&quot;) As String\n\n    Dim Request As Object\n    Set Request = CreateObject(\&quot;MSXML2.XMLHTTP.6.0\&quot;)\n\n    Dim Response As String\n    Dim Url As String\n\n    Url = YOUR_INSTANCE_URL &amp; _\n          \&quot;services/data/v47.0/analytics/reports/\&quot; &amp; ReportId\n\n    Request.Open \&quot;POST\&quot;, Url, False\n    Request.setRequestHeader \&quot;Authorization\&quot;, \&quot;Bearer \&quot; &amp; SessionId\n    Request.setRequestHeader \&quot;Content-Type\&quot;, \&quot;application/json\&quot;\n\n    If Metadata &lt;&gt; \&quot;\&quot; Then\n        Request.send (Metadata)\n    Else\n        Request.send\n    End If\n\n    Response = Request.responseText\n\n    GetReport = Response\nEnd Function&quot;]}" ssr client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded-sm border border-divider p-1 shadow-xs shadow-shadow"><span class="text-(--code-fg)"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard "><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button><!--astro:end--></astro-island> </div> </div> <pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">Function </span><span style="color:#61AFEF">GetReport</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">ReportId</span><span style="color:#ABB2BF"> As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">                   SessionId As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">                   Optional Metadata As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">""</span><span style="color:#ABB2BF">) As </span><span style="color:#E5C07B">String</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> Request </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span>
<span class="line"><span style="color:#C678DD">    Set </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF"> = </span><span style="color:#56B6C2">CreateObject</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"MSXML2.XMLHTTP.6.0"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> Response </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> Url </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">    Url</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> YOUR_INSTANCE_URL</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#98C379">          "services/data/v47.0/analytics/reports/"</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> ReportId</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">    Request</span><span style="color:#ABB2BF">.Open </span><span style="color:#98C379">"POST"</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> Url</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66"> False</span></span>
<span class="line"><span style="color:#E5C07B">    Request</span><span style="color:#ABB2BF">.setRequestHeader </span><span style="color:#98C379">"Authorization"</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"Bearer "</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> SessionId</span></span>
<span class="line"><span style="color:#E5C07B">    Request</span><span style="color:#ABB2BF">.setRequestHeader </span><span style="color:#98C379">"Content-Type"</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"application/json"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    If</span><span style="color:#E06C75"> Metadata</span><span style="color:#ABB2BF"> &#x3C;> </span><span style="color:#98C379">""</span><span style="color:#C678DD"> Then</span></span>
<span class="line"><span style="color:#E5C07B">        Request</span><span style="color:#ABB2BF">.</span><span style="color:#E06C75">send</span><span style="color:#ABB2BF"> (</span><span style="color:#E06C75">Metadata</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#C678DD">    Else</span></span>
<span class="line"><span style="color:#E5C07B">        Request</span><span style="color:#ABB2BF">.send</span></span>
<span class="line"><span style="color:#C678DD">    End If</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B">    Response</span><span style="color:#ABB2BF"> = </span><span style="color:#E5C07B">Request</span><span style="color:#ABB2BF">.responseText</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">    GetReport</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> Response</span></span>
<span class="line"><span style="color:#C678DD">End Function</span></span></code></pre> </div> 
<h2 id="writing-the-data-into-a-worksheet" class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2">  Writing the data into a worksheet<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#writing-the-data-into-a-worksheet"><span class="icon icon-link"></span></a>  </h2>
<p class="max-w-prose">Now we need to extract the data and write it into a worksheet.</p>
<p class="max-w-prose"><a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://developer.salesforce.com/docs/atlas.en-us.api_analytics.meta/api_analytics/sforce_analytics_rest_api_factmap_example.htm" title="Salesforce documentation on how to decode the factMap">Every thing we need is inside the <code>factMap</code> key</a>.
This can get complex if we intend to cover matrix and summary reports, which has
groupings etc., but tabular reports are much simpler.</p>
<p class="max-w-prose">What we need to do is to iterate through the values at <code>factMap.T!T.rows</code> and,
for each row, get every value inside <code>.dataCells</code> array.</p>
<p class="max-w-prose">This approach will only cover tabular reports, you can take a look at the
<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://github.com/phelipetls/reportforce/tree/master/reportforce/helpers" title="Source code for reportforce package on a Github repository">reportforce source code</a>
if you need to cover these. By the way, there is an option to export to an Excel
(but not to write to a worksheet, obviously).</p>
<p class="max-w-prose">The below function takes care of this, its job is to go through every cell and
store it in an array, and then append that array to a worksheet range starting
from column A.</p>
<div data-codeblock class="last:mb-0 max-w-2xl text-sm [&#38;_>_pre]:shadow-xs [&#38;_>_pre]:shadow-shadow [&#38;_>_pre]:rounded-b [&#38;_>_pre]:overflow-x-auto [&#38;_>_pre]:scheme-dark [&#38;_>_pre_>_code]:py-4 [&#38;_>_pre_>_code]:grid [&#38;_.line]:px-horizontal-padding [&#38;_.line]:border-l-2 [&#38;_.line]:border-(--code-bg) [&#38;_.line]:min-h-[1lh] [&#38;_.line]:empty:last:min-h-0 [&#38;_.line.highlighted]:bg-[#272115] [&#38;_.line.highlighted]:border-[#624710] [&#38;_.twoslash-query-line]:px-horizontal-padding [&#38;_.twoslash-error-line]:border-l-2 [&#38;_.twoslash-error-line]:border-(--code-bg) [&#38;_.twoslash-error-line]:py-1 [&#38;_.twoslash-error-line]:px-4 [&#38;_.twoslash-error-line]:bg-[#d4565620] [&#38;_.twoslash-error-line]:text-[#d45656] [&#38;_.twoslash-error-line]:border-[#d45656] [&#38;_.twoslash-popup-arrow]:bg-(--code-bg) [&#38;_.twoslash-popup-container]:bg-(--code-bg)" style="--code-bg: #282c34;--code-fg: #abb2bf;"> <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-(--code-bg) text-(--code-fg) border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;"> <div class="flex pl-horizontal-padding items-center gap-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">  <div class="rtl truncate text-lg" style="--code-bg: #282c34;--code-fg: #abb2bf;"> vb </div> </div> <div class="ml-auto flex flex-row gap-2 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">  <astro-island uid="Z11L5Vv" prefix="r46" component-url="/_astro/CopyCodeBlockButton.CunNfTy3.js" component-export="default" renderer-url="/_astro/client.BXosma6P.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;Function WriteIntoWorksheet(Report As Dictionary, _\n                            WorksheetName As String, _\n                            ColumnLabels As Variant) As Variant\n\n    Dim Rows As Object\n    Dim Columns As Object\n    Dim ColumnInfo\n\n    Set Columns = Report(\&quot;reportMetadata\&quot;)(\&quot;detailColumns\&quot;)\n    Set ColumnInfo = Report(\&quot;reportExtendedMetadata\&quot;)(\&quot;detailColumnInfo\&quot;)\n    Set Rows = Report(\&quot;factMap\&quot;)(\&quot;T!T\&quot;)(\&quot;rows\&quot;)\n\n    Dim Total_Rows As Long: Total_Rows = Rows.Count\n    Dim Total_Columns As Long: Total_Columns = Columns.Count\n\n    If Total_Rows = 0 Then\n        Exit Function\n    End If\n\n    Dim Table() As Variant\n    ReDim Table(Total_Rows - 1, Total_Columns - 1)\n\n    Dim row As Variant\n    Dim cell As Variant\n\n    Dim i As Long: i = 0\n    Dim j As Long\n    Dim dataType As String\n\n    For Each row In Rows\n        j = 0\n        For Each cell In row(\&quot;dataCells\&quot;)\n            dataType = ColumnInfo(Columns(j + 1))(\&quot;dataType\&quot;)\n\n            &#39; If column is a date, get value property;\n            &#39; Excel understands it better\n            If dataType = \&quot;date\&quot; Then\n                Table(i, j) = cell(\&quot;value\&quot;)\n            Else\n                Table(i, j) = cell(\&quot;label\&quot;)\n            End If\n\n            j = j + 1\n        Next cell\n        i = i + 1\n    Next row\n\n    With ThisWorkbook.Worksheets(WorksheetName)\n        Dim LastRow As Long\n        LastRow = .Range(\&quot;A:A\&quot;).Find(\&quot;*\&quot;, _\n                                     SearchOrder:=xlByRows, _\n                                     SearchDirection:=xlPrevious).row\n\n        .Range(.Cells(LastRow + 1, \&quot;A\&quot;), _\n               .Cells(Total_Rows + LastRow, Total_Columns)) = Table\n    End With\n\n    WriteIntoWorksheet = Table\n\nEnd Function&quot;]}" ssr client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded-sm border border-divider p-1 shadow-xs shadow-shadow"><span class="text-(--code-fg)"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard "><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button><!--astro:end--></astro-island> </div> </div> <pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">Function </span><span style="color:#61AFEF">WriteIntoWorksheet</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Report</span><span style="color:#ABB2BF"> As </span><span style="color:#E5C07B">Dictionary</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">                            WorksheetName As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">                            ColumnLabels As </span><span style="color:#E5C07B">Variant</span><span style="color:#ABB2BF">) As </span><span style="color:#E5C07B">Variant</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> Rows </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> Columns </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> ColumnInfo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Set </span><span style="color:#E06C75">Columns</span><span style="color:#ABB2BF"> = </span><span style="color:#61AFEF">Report</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"reportMetadata"</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">"detailColumns"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#C678DD">    Set </span><span style="color:#E06C75">ColumnInfo</span><span style="color:#ABB2BF"> = </span><span style="color:#61AFEF">Report</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"reportExtendedMetadata"</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">"detailColumnInfo"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#C678DD">    Set </span><span style="color:#E06C75">Rows</span><span style="color:#ABB2BF"> = </span><span style="color:#61AFEF">Report</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"factMap"</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">"T!T"</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">"rows"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> Total_Rows </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Long</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">Total_Rows</span><span style="color:#ABB2BF"> = Rows.Count</span></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> Total_Columns </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Long</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">Total_Columns</span><span style="color:#ABB2BF"> = Columns.Count</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    If</span><span style="color:#E06C75"> Total_Rows</span><span style="color:#ABB2BF"> = </span><span style="color:#D19A66">0</span><span style="color:#C678DD"> Then</span></span>
<span class="line"><span style="color:#C678DD">        Exit Function</span></span>
<span class="line"><span style="color:#C678DD">    End If</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> Table</span><span style="color:#ABB2BF">() As </span><span style="color:#E5C07B">Variant</span></span>
<span class="line"><span style="color:#C678DD">    ReDim </span><span style="color:#61AFEF">Table</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Total_Rows</span><span style="color:#ABB2BF"> - </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> Total_Columns</span><span style="color:#ABB2BF"> - </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> row </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Variant</span></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> cell </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Variant</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> i </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Long</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">i</span><span style="color:#ABB2BF"> = </span><span style="color:#D19A66">0</span></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> j </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Long</span></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> dataType </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    For</span><span style="color:#C678DD"> Each</span><span style="color:#ABB2BF"> row In Rows</span></span>
<span class="line"><span style="color:#E06C75">        j</span><span style="color:#ABB2BF"> = </span><span style="color:#D19A66">0</span></span>
<span class="line"><span style="color:#C678DD">        For</span><span style="color:#C678DD"> Each</span><span style="color:#ABB2BF"> cell In </span><span style="color:#61AFEF">row</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"dataCells"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#E06C75">            dataType</span><span style="color:#ABB2BF"> = </span><span style="color:#61AFEF">ColumnInfo</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">Columns</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">j</span><span style="color:#ABB2BF"> + </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">))(</span><span style="color:#98C379">"dataType"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">            ' If column is a date, get value property;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic">            ' Excel understands it better</span></span>
<span class="line"><span style="color:#C678DD">            If</span><span style="color:#E06C75"> dataType</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">"date"</span><span style="color:#C678DD"> Then</span></span>
<span class="line"><span style="color:#61AFEF">                Table</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">i</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> j</span><span style="color:#ABB2BF">) = </span><span style="color:#61AFEF">cell</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"value"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#C678DD">            Else</span></span>
<span class="line"><span style="color:#61AFEF">                Table</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">i</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> j</span><span style="color:#ABB2BF">) = </span><span style="color:#61AFEF">cell</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"label"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#C678DD">            End If</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">            j</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> j</span><span style="color:#ABB2BF"> + </span><span style="color:#D19A66">1</span></span>
<span class="line"><span style="color:#C678DD">        Next</span><span style="color:#ABB2BF"> cell</span></span>
<span class="line"><span style="color:#E06C75">        i</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> i</span><span style="color:#ABB2BF"> + </span><span style="color:#D19A66">1</span></span>
<span class="line"><span style="color:#C678DD">    Next</span><span style="color:#ABB2BF"> row</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    With</span><span style="color:#ABB2BF"> ThisWorkbook.</span><span style="color:#61AFEF">Worksheets</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">WorksheetName</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#C678DD">        Dim</span><span style="color:#E06C75"> LastRow </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Long</span></span>
<span class="line"><span style="color:#E06C75">        LastRow</span><span style="color:#ABB2BF"> = .</span><span style="color:#61AFEF">Range</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"A:A"</span><span style="color:#ABB2BF">).</span><span style="color:#61AFEF">Find</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"*"</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">                                     SearchOrder:=</span><span style="color:#E06C75">xlByRows</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">                                     SearchDirection:=</span><span style="color:#E06C75">xlPrevious</span><span style="color:#ABB2BF">).row</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">        .</span><span style="color:#61AFEF">Range</span><span style="color:#ABB2BF">(.</span><span style="color:#61AFEF">Cells</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">LastRow</span><span style="color:#ABB2BF"> + </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"A"</span><span style="color:#ABB2BF">),</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">               .</span><span style="color:#61AFEF">Cells</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Total_Rows</span><span style="color:#ABB2BF"> +</span><span style="color:#E06C75"> LastRow</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> Total_Columns</span><span style="color:#ABB2BF">)) =</span><span style="color:#E06C75"> Table</span></span>
<span class="line"><span style="color:#56B6C2">    End</span><span style="color:#C678DD"> With</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">    WriteIntoWorksheet</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> Table</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">End Function</span></span></code></pre> </div> 
<p class="max-w-prose">We also need to get the values at <code>.reportMetadata.detailColumns</code> and
<code>reportExtendedMetadata.detailColumnInfo</code> to check how many columns the report
have and to extract the value at <code>.value</code> if it is a date.</p>
<h2 id="getting-the-entire-report" class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2">  Getting the entire report<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#getting-the-entire-report"><span class="icon icon-link"></span></a>  </h2>
<p class="max-w-prose">To get the entire report, the key thing to overcome the API limitations is a key
called <code>.allData</code>, which will be <code>true</code> only if we got all the data from the
API.</p>
<p class="max-w-prose">So we get the first 2000 rows and, if <code>.allData</code> is <code>false</code>, we get the values
of an identifier column, filter them out and request a new report, until we get
all data.</p>
<p class="max-w-prose">We will modify the keys <code>.reportMetadata.standardDateFilter</code> and
<code>.reportMetadata.reportFilters</code>, to filter dates and other filters respectively.</p>
<p class="max-w-prose">If your report has a boolean filter, it’s likely that you’ll need to change it
because we will insert new filters. This is already done in the code by changing
the value at <code>.reportMetadata.reportBooleanFilter</code>, so you only need to pass it
as a parameter.</p>
<p class="max-w-prose">The function looks way more involved because we have to get the report headers
(the <code>label</code> property of each object inside
<code>.reportExtendedMetadata.detailColumnInfo</code>, the ones you see in the browser).</p>
<p class="max-w-prose">We also need the identifier column API name (an internal value), which we will
need to filter it.</p>
<div data-codeblock class="last:mb-0 max-w-2xl text-sm [&#38;_>_pre]:shadow-xs [&#38;_>_pre]:shadow-shadow [&#38;_>_pre]:rounded-b [&#38;_>_pre]:overflow-x-auto [&#38;_>_pre]:scheme-dark [&#38;_>_pre_>_code]:py-4 [&#38;_>_pre_>_code]:grid [&#38;_.line]:px-horizontal-padding [&#38;_.line]:border-l-2 [&#38;_.line]:border-(--code-bg) [&#38;_.line]:min-h-[1lh] [&#38;_.line]:empty:last:min-h-0 [&#38;_.line.highlighted]:bg-[#272115] [&#38;_.line.highlighted]:border-[#624710] [&#38;_.twoslash-query-line]:px-horizontal-padding [&#38;_.twoslash-error-line]:border-l-2 [&#38;_.twoslash-error-line]:border-(--code-bg) [&#38;_.twoslash-error-line]:py-1 [&#38;_.twoslash-error-line]:px-4 [&#38;_.twoslash-error-line]:bg-[#d4565620] [&#38;_.twoslash-error-line]:text-[#d45656] [&#38;_.twoslash-error-line]:border-[#d45656] [&#38;_.twoslash-popup-arrow]:bg-(--code-bg) [&#38;_.twoslash-popup-container]:bg-(--code-bg)" style="--code-bg: #282c34;--code-fg: #abb2bf;"> <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-(--code-bg) text-(--code-fg) border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;"> <div class="flex pl-horizontal-padding items-center gap-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">  <div class="rtl truncate text-lg" style="--code-bg: #282c34;--code-fg: #abb2bf;"> vb </div> </div> <div class="ml-auto flex flex-row gap-2 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">  <astro-island uid="Z1zRJ6X" prefix="r47" component-url="/_astro/CopyCodeBlockButton.CunNfTy3.js" component-export="default" renderer-url="/_astro/client.BXosma6P.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;Sub DownloadEntireReport(ReportId As String, _\n                         WorksheetName As String, _\n                         SessionId As String, _\n                         Optional IdentifierColumn As String = \&quot;\&quot;, _\n                         Optional BooleanFilter As String = \&quot;\&quot;, _\n                         Optional startDate As String = \&quot;\&quot;, _\n                         Optional endDate As String = \&quot;\&quot;)\n\n    Dim Report As Object\n\n    Dim ReportMetadata As Object\n    Set ReportMetadata = JsonConverter.ParseJson(GetMetadata(ReportId, SessionId))\n\n    Dim IdentifierColumnApiName As String\n    Dim IdentifierColumnPosition As Long\n\n    Dim Col As Variant\n    Dim i As Long: i = 0\n\n    Dim ColumnDetails As Object\n    Set ColumnDetails = ReportMetadata(\&quot;reportExtendedMetadata\&quot;)(\&quot;detailColumnInfo\&quot;)\n\n    &#39; This is an array to store the column headers\n    Dim ColumnLabels() As Variant\n    ReDim ColumnLabels(0, ColumnDetails.Count - 1)\n\n    &#39; Collection the column headers\n    For Each Col In ColumnDetails.Keys()\n        ColumnLabels(0, i) = ColumnDetails(Col)(\&quot;label\&quot;)\n\n        &#39; Remember which column matches the identifier column label\n        If ColumnDetails(Col)(\&quot;label\&quot;) = IdentifierColumn Then\n            IdentifierColumnApiName = Col\n            IdentifierColumnPosition = i\n        End If\n\n        i = i + 1\n    Next Col\n\n    &#39; Write column headers starting from A1\n    With ThisWorkbook.Worksheets(WorksheetName)\n        .Range(.Cells(1, \&quot;A\&quot;), .Cells(1, ColumnDetails.Count)) = ColumnLabels\n    End With\n\n    Dim ReportMetadataJson As String: ReportMetadataJson = \&quot;\&quot;\n\n    &#39; Setting date filters, if any\n    If startDate &lt;&gt; \&quot;\&quot; And endDate &lt;&gt; \&quot;\&quot; Then\n        ReportMetadata(\&quot;reportMetadata\&quot;)(\&quot;standardDateFilter\&quot;)(\&quot;durationValue\&quot;) = \&quot;CUSTOM\&quot;\n        ReportMetadata(\&quot;reportMetadata\&quot;)(\&quot;standardDateFilter\&quot;)(\&quot;startDate\&quot;) = Format(startDate, \&quot;yyyy-mm-dd\&quot;)\n        ReportMetadata(\&quot;reportMetadata\&quot;)(\&quot;standardDateFilter\&quot;)(\&quot;endDate\&quot;) = Format(endDate, \&quot;yyyy-mm-dd\&quot;)\n\n        ReportMetadataJson = JsonConverter.ConvertToJson(ReportMetadata)\n    End If\n\n    &#39; Get first 2000 rows\n    Set Report = JsonConverter.ParseJson(GetReport(ReportId, SessionId, ReportMetadataJson))\n\n    Dim ReportTable As Variant\n    ReportTable = WriteIntoWorksheet(Report, WorksheetName, ColumnLabels)\n\n    &#39; Getting Remaining Values By Filtering Out Old Values\n\n    If BooleanFilter &lt;&gt; \&quot;\&quot; Then\n        ReportMetadata(\&quot;reportMetadata\&quot;)(\&quot;reportBooleanFilter\&quot;) = BooleanFilter\n    End If\n\n    Dim IdentifierColumnValues\n    Dim IdentifierColumnFilter As String: IdentifierColumnFilter = \&quot;\&quot;\n\n    Dim Filters As Scripting.Dictionary\n    Set Filters = New Dictionary\n\n    Dim ReportFilters As Object\n\n    Do Until Report(\&quot;allData\&quot;)\n        IdentifierColumnValues = GetValuesAtColumn(ReportTable, IdentifierColumnPosition)\n        IdentifierColumnFilter = IdentifierColumnFilter &amp; _\n                                 Join(Application.Transpose(IdentifierColumnValues), \&quot;,\&quot;)\n\n        Filters.RemoveAll\n        Filters.Add \&quot;filterType\&quot;, \&quot;fieldValue\&quot;\n        Filters.Add \&quot;isRunPageEditable\&quot;, True\n        Filters.Add \&quot;column\&quot;, IdentifierColumnApiName\n        Filters.Add \&quot;operator\&quot;, \&quot;notEqual\&quot;\n        Filters.Add \&quot;value\&quot;, IdentifierColumnFilter\n\n        Set ReportFilters = ReportMetadata(\&quot;reportMetadata\&quot;)(\&quot;reportFilters\&quot;)\n\n        &#39; If IdentifierColumn was already added, just change the filter value\n        If ReportFilters(ReportFilters.Count)(\&quot;column\&quot;) = IdentifierColumn Then\n            ReportFilters(ReportFilters.Count)(\&quot;value\&quot;) = IdentifierColumnFilter\n        Else\n            ReportFilters.Add Filters\n        End If\n\n        ReportMetadataJson = JsonConverter.ConvertToJson(ReportMetadata)\n\n        Set Report = JsonConverter.ParseJson(GetReport(ReportId, SessionId, ReportMetadataJson))\n\n        ReportTable = WriteIntoWorksheet(Report, WorksheetName, \&quot;\&quot;)\n    Loop\n\nEnd Sub&quot;]}" ssr client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded-sm border border-divider p-1 shadow-xs shadow-shadow"><span class="text-(--code-fg)"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard "><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button><!--astro:end--></astro-island> </div> </div> <pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">Sub </span><span style="color:#61AFEF">DownloadEntireReport</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">ReportId</span><span style="color:#ABB2BF"> As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">                         WorksheetName As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">                         SessionId As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">                         Optional IdentifierColumn As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">""</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">                         Optional BooleanFilter As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">""</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">                         Optional startDate As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">""</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">                         Optional endDate As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">""</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> Report </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> ReportMetadata </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span>
<span class="line"><span style="color:#C678DD">    Set </span><span style="color:#E06C75">ReportMetadata</span><span style="color:#ABB2BF"> = JsonConverter.</span><span style="color:#61AFEF">ParseJson</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">GetMetadata</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">ReportId</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> SessionId</span><span style="color:#ABB2BF">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> IdentifierColumnApiName </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> IdentifierColumnPosition </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Long</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> Col </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Variant</span></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> i </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Long</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">i</span><span style="color:#ABB2BF"> = </span><span style="color:#D19A66">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> ColumnDetails </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span>
<span class="line"><span style="color:#C678DD">    Set </span><span style="color:#E06C75">ColumnDetails</span><span style="color:#ABB2BF"> = </span><span style="color:#61AFEF">ReportMetadata</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"reportExtendedMetadata"</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">"detailColumnInfo"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    ' This is an array to store the column headers</span></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> ColumnLabels</span><span style="color:#ABB2BF">() As </span><span style="color:#E5C07B">Variant</span></span>
<span class="line"><span style="color:#C678DD">    ReDim </span><span style="color:#61AFEF">ColumnLabels</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">, ColumnDetails.</span><span style="color:#E06C75">Count</span><span style="color:#ABB2BF"> - </span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    ' Collection the column headers</span></span>
<span class="line"><span style="color:#C678DD">    For</span><span style="color:#C678DD"> Each</span><span style="color:#ABB2BF"> Col In ColumnDetails.</span><span style="color:#56B6C2">Keys</span><span style="color:#ABB2BF">()</span></span>
<span class="line"><span style="color:#61AFEF">        ColumnLabels</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">0</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> i</span><span style="color:#ABB2BF">) = </span><span style="color:#61AFEF">ColumnDetails</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Col</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">"label"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        ' Remember which column matches the identifier column label</span></span>
<span class="line"><span style="color:#C678DD">        If</span><span style="color:#61AFEF"> ColumnDetails</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Col</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">"label"</span><span style="color:#ABB2BF">) =</span><span style="color:#E06C75"> IdentifierColumn</span><span style="color:#C678DD"> Then</span></span>
<span class="line"><span style="color:#E06C75">            IdentifierColumnApiName</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> Col</span></span>
<span class="line"><span style="color:#E06C75">            IdentifierColumnPosition</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> i</span></span>
<span class="line"><span style="color:#C678DD">        End If</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">        i</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> i</span><span style="color:#ABB2BF"> + </span><span style="color:#D19A66">1</span></span>
<span class="line"><span style="color:#C678DD">    Next</span><span style="color:#ABB2BF"> Col</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    ' Write column headers starting from A1</span></span>
<span class="line"><span style="color:#C678DD">    With</span><span style="color:#ABB2BF"> ThisWorkbook.</span><span style="color:#61AFEF">Worksheets</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">WorksheetName</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF">        .</span><span style="color:#61AFEF">Range</span><span style="color:#ABB2BF">(.</span><span style="color:#61AFEF">Cells</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"A"</span><span style="color:#ABB2BF">), .</span><span style="color:#61AFEF">Cells</span><span style="color:#ABB2BF">(</span><span style="color:#D19A66">1</span><span style="color:#ABB2BF">, ColumnDetails.</span><span style="color:#E06C75">Count</span><span style="color:#ABB2BF">)) =</span><span style="color:#E06C75"> ColumnLabels</span></span>
<span class="line"><span style="color:#56B6C2">    End</span><span style="color:#C678DD"> With</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> ReportMetadataJson </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">ReportMetadataJson</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">""</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    ' Setting date filters, if any</span></span>
<span class="line"><span style="color:#C678DD">    If</span><span style="color:#E06C75"> startDate</span><span style="color:#ABB2BF"> &#x3C;> </span><span style="color:#98C379">""</span><span style="color:#ABB2BF"> And </span><span style="color:#E06C75">endDate</span><span style="color:#ABB2BF"> &#x3C;> </span><span style="color:#98C379">""</span><span style="color:#C678DD"> Then</span></span>
<span class="line"><span style="color:#61AFEF">        ReportMetadata</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"reportMetadata"</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">"standardDateFilter"</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">"durationValue"</span><span style="color:#ABB2BF">) = </span><span style="color:#98C379">"CUSTOM"</span></span>
<span class="line"><span style="color:#61AFEF">        ReportMetadata</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"reportMetadata"</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">"standardDateFilter"</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">"startDate"</span><span style="color:#ABB2BF">) = </span><span style="color:#61AFEF">Format</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">startDate</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"yyyy-mm-dd"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#61AFEF">        ReportMetadata</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"reportMetadata"</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">"standardDateFilter"</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">"endDate"</span><span style="color:#ABB2BF">) = </span><span style="color:#61AFEF">Format</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">endDate</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"yyyy-mm-dd"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">        ReportMetadataJson</span><span style="color:#ABB2BF"> = JsonConverter.</span><span style="color:#61AFEF">ConvertToJson</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">ReportMetadata</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#C678DD">    End If</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    ' Get first 2000 rows</span></span>
<span class="line"><span style="color:#C678DD">    Set </span><span style="color:#E06C75">Report</span><span style="color:#ABB2BF"> = JsonConverter.</span><span style="color:#61AFEF">ParseJson</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">GetReport</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">ReportId</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> SessionId</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> ReportMetadataJson</span><span style="color:#ABB2BF">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> ReportTable </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Variant</span></span>
<span class="line"><span style="color:#E06C75">    ReportTable</span><span style="color:#ABB2BF"> = </span><span style="color:#61AFEF">WriteIntoWorksheet</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Report</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> WorksheetName</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> ColumnLabels</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">    ' Getting Remaining Values By Filtering Out Old Values</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    If</span><span style="color:#E06C75"> BooleanFilter</span><span style="color:#ABB2BF"> &#x3C;> </span><span style="color:#98C379">""</span><span style="color:#C678DD"> Then</span></span>
<span class="line"><span style="color:#61AFEF">        ReportMetadata</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"reportMetadata"</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">"reportBooleanFilter"</span><span style="color:#ABB2BF">) =</span><span style="color:#E06C75"> BooleanFilter</span></span>
<span class="line"><span style="color:#C678DD">    End If</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> IdentifierColumnValues</span></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> IdentifierColumnFilter </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">IdentifierColumnFilter</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">""</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> Filters </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Scripting</span><span style="color:#ABB2BF">.Dictionary</span></span>
<span class="line"><span style="color:#C678DD">    Set </span><span style="color:#E06C75">Filters</span><span style="color:#ABB2BF"> =</span><span style="color:#C678DD"> New </span><span style="color:#ABB2BF">Dictionary</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Dim</span><span style="color:#E06C75"> ReportFilters </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">Object</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">    Do</span><span style="color:#C678DD"> Until</span><span style="color:#61AFEF"> Report</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"allData"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#E06C75">        IdentifierColumnValues</span><span style="color:#ABB2BF"> = </span><span style="color:#61AFEF">GetValuesAtColumn</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">ReportTable</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> IdentifierColumnPosition</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#E06C75">        IdentifierColumnFilter</span><span style="color:#ABB2BF"> =</span><span style="color:#E06C75"> IdentifierColumnFilter</span><span style="color:#ABB2BF"> &#x26;</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#56B6C2">                                 Join</span><span style="color:#ABB2BF">(</span><span style="color:#E5C07B">Application</span><span style="color:#ABB2BF">.</span><span style="color:#61AFEF">Transpose</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">IdentifierColumnValues</span><span style="color:#ABB2BF">), </span><span style="color:#98C379">","</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF">        Filters.</span><span style="color:#56B6C2">RemoveAll</span></span>
<span class="line"><span style="color:#ABB2BF">        Filters.</span><span style="color:#56B6C2">Add</span><span style="color:#98C379"> "filterType"</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"fieldValue"</span></span>
<span class="line"><span style="color:#ABB2BF">        Filters.</span><span style="color:#56B6C2">Add</span><span style="color:#98C379"> "isRunPageEditable"</span><span style="color:#ABB2BF">,</span><span style="color:#D19A66"> True</span></span>
<span class="line"><span style="color:#ABB2BF">        Filters.</span><span style="color:#56B6C2">Add</span><span style="color:#98C379"> "column"</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> IdentifierColumnApiName</span></span>
<span class="line"><span style="color:#ABB2BF">        Filters.</span><span style="color:#56B6C2">Add</span><span style="color:#98C379"> "operator"</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">"notEqual"</span></span>
<span class="line"><span style="color:#ABB2BF">        Filters.</span><span style="color:#56B6C2">Add</span><span style="color:#98C379"> "value"</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> IdentifierColumnFilter</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">        Set </span><span style="color:#E06C75">ReportFilters</span><span style="color:#ABB2BF"> = </span><span style="color:#61AFEF">ReportMetadata</span><span style="color:#ABB2BF">(</span><span style="color:#98C379">"reportMetadata"</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">"reportFilters"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic">        ' If IdentifierColumn was already added, just change the filter value</span></span>
<span class="line"><span style="color:#C678DD">        If</span><span style="color:#61AFEF"> ReportFilters</span><span style="color:#ABB2BF">(ReportFilters.</span><span style="color:#E06C75">Count</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">"column"</span><span style="color:#ABB2BF">) =</span><span style="color:#E06C75"> IdentifierColumn</span><span style="color:#C678DD"> Then</span></span>
<span class="line"><span style="color:#61AFEF">            ReportFilters</span><span style="color:#ABB2BF">(ReportFilters.</span><span style="color:#E06C75">Count</span><span style="color:#ABB2BF">)(</span><span style="color:#98C379">"value"</span><span style="color:#ABB2BF">) =</span><span style="color:#E06C75"> IdentifierColumnFilter</span></span>
<span class="line"><span style="color:#C678DD">        Else</span></span>
<span class="line"><span style="color:#ABB2BF">            ReportFilters.</span><span style="color:#56B6C2">Add</span><span style="color:#ABB2BF"> Filters</span></span>
<span class="line"><span style="color:#C678DD">        End If</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">        ReportMetadataJson</span><span style="color:#ABB2BF"> = JsonConverter.</span><span style="color:#61AFEF">ConvertToJson</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">ReportMetadata</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">        Set </span><span style="color:#E06C75">Report</span><span style="color:#ABB2BF"> = JsonConverter.</span><span style="color:#61AFEF">ParseJson</span><span style="color:#ABB2BF">(</span><span style="color:#61AFEF">GetReport</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">ReportId</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> SessionId</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> ReportMetadataJson</span><span style="color:#ABB2BF">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">        ReportTable</span><span style="color:#ABB2BF"> = </span><span style="color:#61AFEF">WriteIntoWorksheet</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Report</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> WorksheetName</span><span style="color:#ABB2BF">, </span><span style="color:#98C379">""</span><span style="color:#ABB2BF">)</span></span>
<span class="line"><span style="color:#C678DD">    Loop</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">End Sub</span></span></code></pre> </div> 
<p class="max-w-prose">To do the filter, we create a <code>Filters</code> dictionary to store all key-value pairs
we need, then add it to the <code>reportFilters</code> object, and change its value in
later iterations. Then we convert the metadata into a JSON string, get a new
filtered report and repeat the loop until we get all data.</p>
<p class="max-w-prose">Also notice that I use a custom function to get all values at a given column,
<code>GetValuesAtColumn</code>.</p>
<p class="max-w-prose"><a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" href="https://gist.github.com/phelipetls/57a27f529561eefe73633093c737b7e0">Get the full source code in this GitHub gist</a>.</p>
<h2 id="how-to-use-it" class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2">  How to use it<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#how-to-use-it"><span class="icon icon-link"></span></a>  </h2>
<p class="max-w-prose">It’s up to you how you’re gonna use this code. Here’s an example.</p>
<div data-codeblock class="last:mb-0 max-w-2xl text-sm [&#38;_>_pre]:shadow-xs [&#38;_>_pre]:shadow-shadow [&#38;_>_pre]:rounded-b [&#38;_>_pre]:overflow-x-auto [&#38;_>_pre]:scheme-dark [&#38;_>_pre_>_code]:py-4 [&#38;_>_pre_>_code]:grid [&#38;_.line]:px-horizontal-padding [&#38;_.line]:border-l-2 [&#38;_.line]:border-(--code-bg) [&#38;_.line]:min-h-[1lh] [&#38;_.line]:empty:last:min-h-0 [&#38;_.line.highlighted]:bg-[#272115] [&#38;_.line.highlighted]:border-[#624710] [&#38;_.twoslash-query-line]:px-horizontal-padding [&#38;_.twoslash-error-line]:border-l-2 [&#38;_.twoslash-error-line]:border-(--code-bg) [&#38;_.twoslash-error-line]:py-1 [&#38;_.twoslash-error-line]:px-4 [&#38;_.twoslash-error-line]:bg-[#d4565620] [&#38;_.twoslash-error-line]:text-[#d45656] [&#38;_.twoslash-error-line]:border-[#d45656] [&#38;_.twoslash-popup-arrow]:bg-(--code-bg) [&#38;_.twoslash-popup-container]:bg-(--code-bg)" style="--code-bg: #282c34;--code-fg: #abb2bf;"> <div data-codeblock-header class="dark flex items-center gap-2 rounded-t py-1 bg-(--code-bg) text-(--code-fg) border-b border-divider" style="--code-bg: #282c34;--code-fg: #abb2bf;"> <div class="flex pl-horizontal-padding items-center gap-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">  <div class="rtl truncate text-lg" style="--code-bg: #282c34;--code-fg: #abb2bf;"> vb </div> </div> <div class="ml-auto flex flex-row gap-2 pr-2" style="--code-bg: #282c34;--code-fg: #abb2bf;">  <astro-island uid="1I4OWP" prefix="r48" component-url="/_astro/CopyCodeBlockButton.CunNfTy3.js" component-export="default" renderer-url="/_astro/client.BXosma6P.js" props="{&quot;successText&quot;:[0,&quot;Copied!&quot;],&quot;errorText&quot;:[0,&quot;Failed to copy&quot;],&quot;code&quot;:[0,&quot;Sub DownloadReports\n\n  Dim Username As String, Password As String, SecurityToken As String\n\n  Username = \&quot;username\&quot;\n  Password = \&quot;password\&quot;\n  SecurityToken = \&quot;secret\&quot;\n\n  Dim SessionId As String\n  SessionId = SalesforceLogin(Username, Password, SecurityToken)\n\n  If IsEmpty(SessionId) Then\n      MsgBox \&quot;Authentication Error\&quot;\n      Exit Sub\n  End If\n\n  Dim ReportId As String: ReportId = \&quot;REPORT_ID\&quot;\n  Dim WorksheetName As String: WorksheetName = \&quot;MY_REPORT\&quot;\n\n  Call DownloadEntireReport(ReportId, WorksheetName, SessionId, _\n                            IdentifierColumn:=\&quot;Número do caso\&quot;, _\n                            BooleanFilter:=\&quot;1 AND 2 AND (3 OR 4)\&quot;, _\n                            startDate:=\&quot;01/07/2020\&quot;, _\n                            endDate:=\&quot;31/07/2020\&quot;)\n\nEnd Sub&quot;]}" ssr client="load" opts="{&quot;name&quot;:&quot;CopyCodeBlockButton&quot;,&quot;value&quot;:true}" await-children><button type="button" aria-label="Copy code" class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 rounded-sm border border-divider p-1 shadow-xs shadow-shadow"><span class="text-(--code-fg)"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard "><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path></svg></span></button><!--astro:end--></astro-island> </div> </div> <pre class="shiki one-dark-pro" style="background-color:#282c34;color:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD">Sub </span><span style="color:#ABB2BF">DownloadReports</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">  Dim</span><span style="color:#E06C75"> Username </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> Password</span><span style="color:#ABB2BF"> As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> SecurityToken</span><span style="color:#ABB2BF"> As </span><span style="color:#E5C07B">String</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75">  Username</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">"username"</span></span>
<span class="line"><span style="color:#E06C75">  Password</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">"password"</span></span>
<span class="line"><span style="color:#E06C75">  SecurityToken</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">"secret"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">  Dim</span><span style="color:#E06C75"> SessionId </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span></span>
<span class="line"><span style="color:#ABB2BF">  SessionId = </span><span style="color:#61AFEF">SalesforceLogin</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">Username</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> Password</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> SecurityToken</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">  If</span><span style="color:#56B6C2"> IsEmpty</span><span style="color:#ABB2BF">(SessionId) </span><span style="color:#C678DD">Then</span></span>
<span class="line"><span style="color:#56B6C2">      MsgBox</span><span style="color:#98C379"> "Authentication Error"</span></span>
<span class="line"><span style="color:#C678DD">      Exit Sub</span></span>
<span class="line"><span style="color:#C678DD">  End If</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">  Dim</span><span style="color:#E06C75"> ReportId </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">ReportId</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">"REPORT_ID"</span></span>
<span class="line"><span style="color:#C678DD">  Dim</span><span style="color:#E06C75"> WorksheetName </span><span style="color:#ABB2BF">As </span><span style="color:#E5C07B">String</span><span style="color:#ABB2BF">: </span><span style="color:#E06C75">WorksheetName</span><span style="color:#ABB2BF"> = </span><span style="color:#98C379">"MY_REPORT"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">  Call </span><span style="color:#61AFEF">DownloadEntireReport</span><span style="color:#ABB2BF">(</span><span style="color:#E06C75">ReportId</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> WorksheetName</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> SessionId</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">                            IdentifierColumn:=</span><span style="color:#98C379">"Número do caso"</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">                            BooleanFilter:=</span><span style="color:#98C379">"1 AND 2 AND (3 OR 4)"</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">                            startDate:=</span><span style="color:#98C379">"01/07/2020"</span><span style="color:#ABB2BF">,</span><span style="color:#E06C75"> _</span></span>
<span class="line"><span style="color:#ABB2BF">                            endDate:=</span><span style="color:#98C379">"31/07/2020"</span><span style="color:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD">End Sub</span></span></code></pre> </div> 
<h2 id="final-words" class="mb-8 mt-4 pt-4 [&#38;_a]:text-primary [&#38;_a]:border-0 [&#38;_a]:before:content-['#'] [&#38;_a]:before:text-xl [&#38;_a]:before:ml-2">  Final words<a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" aria-hidden="true" tabindex="-1" href="#final-words"><span class="icon icon-link"></span></a>  </h2>
<p class="max-w-prose">You probably have a better way to do it, I would only recommend this approach to
someone in an environment very dependent on Excel, simply because it is super
convenient. You can put the report anywhere you want with zero overhead — no
need for a library to understand the complexity of an Excel archive.</p>
<p class="max-w-prose">And I gotta say, VBA is kind of a hard, its ecosystem is not great, obviously.
But I was very impressed by what it can do, despite of its shortcomings.
Nonetheless, it was still fun to write this.</p> </div> </div> </article> <hr class="max-sm:full-bleed mt-8"> <nav class="flex items-stretch sm:gap-4 max-sm:full-bleed sm:my-8" aria-label="Posts navigation"> <div class="flex-1"></div> <div class="border-l border-divider sm:hidden"></div> <a class="sm:card flex flex-1 flex-col-reverse items-end justify-end gap-2 border-0 px-horizontal-padding py-4 text-right transition-colors duration-300 hover:bg-hover" href="/posts/async-make-in-nvim-with-lua/"> Asynchronous :make in Neovim with Lua <span class="text-primary"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-right "><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg> </span> </a> </nav> <hr class="max-sm:full-bleed mb-8"> </div> </main>  <footer class="bg-background grid grid-cols-layout mt-auto sm:mt-0"> <div class="mx-auto flex w-full max-w-content flex-col pt-4 pb-8 sm:justify-between"> <nav aria-label="Contacts" class="flex gap-2 mb-2"> <a class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 min-w-[40px] h-[40px] flex justify-center items-center rounded-full px-2 shadow" id="contact-email" href="mailto:phelipe_teles@hotmail.com" aria-label="E-mail">  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail "><rect width="20" height="16" x="2" y="4" rx="2"></rect><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path></svg>  </a> <a class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 min-w-[40px] h-[40px] flex justify-center items-center rounded-full px-2 shadow" id="contact-linkedin" href="https://linkedin.com/in/phelipeteles" aria-label="LinkedIn">  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-linkedin "><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect width="4" height="12" x="2" y="9"></rect><circle cx="4" cy="4" r="2"></circle></svg>  </a> <a class="bg-surface hover:bg-hover text-on-background disabled:bg-disabled disabled:text-on-disabled disabled:hover:cursor-not-allowed disabled:hover:bg-disabled hover:text-primary transition-colors duration-300 min-w-[40px] h-[40px] flex justify-center items-center rounded-full px-2 shadow" id="contact-github" href="https://github.com/phelipetls" aria-label="GitHub">  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github "><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg>  </a> </nav> <span class="text-sm"> 
All content is under a <a class="underline underline-offset-4 decoration-primary hover:decoration-primary-hover" rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0</a>
license.
 </span> </div> </footer> </body></html> <script type="module">const e=document.querySelector("[data-blog-post-container]"),t=document.querySelector("[data-toggle-toc]"),o=document.querySelector("[data-blog-post-toc-container]");let n=new AbortController;const a=localStorage.getItem("__preferred_toc_state");a!==null&&(a==="open"?s():(c(),o?.classList.add("invisible")));function s(){n.abort(),o?.classList.remove("invisible"),e instanceof HTMLElement&&t instanceof HTMLButtonElement&&(e.setAttribute("data-toc","open"),localStorage.setItem("__preferred_toc_state","open"),t.setAttribute("aria-label",t.dataset.closedTocLabel??""))}function c(){n=new AbortController,o?.addEventListener("transitionend",()=>{o?.classList.add("invisible")},{signal:n.signal}),e instanceof HTMLElement&&t instanceof HTMLButtonElement&&(e.setAttribute("data-toc","closed"),localStorage.setItem("__preferred_toc_state","closed"),t.setAttribute("aria-label",t.dataset.openTocLabel??""))}t?.addEventListener("click",()=>{if(!(e instanceof HTMLDivElement))return;e.dataset.toc==="open"?c():s()});</script>