<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="description" content="How and why to migrate a CRA project to Vite." />
<meta name="deploy-date" content="2022-02-14">
<meta name="publish-date" content="2021-04-23">
<meta name="last-modified-date" content="2022-02-06">
<meta name="author" content="">
<meta name="color-scheme" content="dark light">


<link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" href="/icon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Merriweather&family=Fira+Sans&display=swap" rel="stylesheet">





  
  


<link rel="stylesheet" href="/css/main.min.css" />
<link rel="stylesheet" href="/css/dark-syntax-highlight.min.css" />

<title>
  Migrating from create-react-app to Vite | Phelipe Teles
</title>



<meta property="og:title" content="Migrating from create-react-app to Vite" />
<meta property="og:description" content="How and why to migrate a CRA project to Vite." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://phelipetls.github.io/posts/migrating-from-cra-to-vite/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-23T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-02-06T19:17:03-03:00" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Migrating from create-react-app to Vite"/>
<meta name="twitter:description" content="How and why to migrate a CRA project to Vite."/>





    
      
    
  </head>

  <body class="preload text-foreground bg-background transition transition-colors duration-75 ease-out">
    

    
      
    

    <script>window.__setTheme = function (newTheme) {
  document.body.setAttribute('data-theme', newTheme)
  localStorage.setItem('__theme', newTheme)
}

const storedTheme = localStorage.getItem('__theme')

if (storedTheme) {
  window.__setTheme(storedTheme)
} else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
  window.__setTheme('dark')
}

/* Enable animations */
window.addEventListener('load', function () {
  document.body.classList.remove('preload')
})
</script>

    <div class="flex flex-col min-h-screen">
      <div class="nav-container overflow-hidden sticky bg-background bg-opacity-80 backdrop-filter backdrop-blur-sm top-0 py-4 mt-6 flex-shrink-0 z-50">
  <div class="flex items-center justify-between mx-auto max-w-prose px-4">
    <nav class="" aria-label="Main navigation">
      

      <div class="flex flex-row flex-wrap gap-2"><a
            id=""
            class="text-foreground "
            href="https://phelipetls.github.io/"
          >
            About
          </a><a
            id=""
            class="text-foreground border-primary"
            href="https://phelipetls.github.io/posts/"
          >
            Posts
          </a><a
            id=""
            class="text-foreground "
            href="https://phelipetls.github.io/projects/"
          >
            Projects
          </a><a
            id=""
            class="text-foreground "
            href="https://phelipetls.github.io/resume/"
          >
            Resumé
          </a></div>
    </nav>

    <button
  id="theme-button"
  class="rounded-full p-1"
  aria-label="Change theme"
>
  <svg width="24" height="24" viewBox="0 0 24 24">
    <title>Theme icon</title>

    <defs>
      <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><title>Moon</title><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>

      <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><title>Sun</title><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>

    </defs>

    <use id="theme-button-svg-icon" href="#sun" />
  </svg>
</button>

  </div>
</div>


      <div class="py-16 px-4 flex-1 max-w-prose mx-auto flex flex-col container mx-auto">
        <main class="flex flex-1 flex-col">
          
  <article>
    <h1 class="text-4xl mb-4">
      Migrating from create-react-app to Vite
    </h1>

    <div class="mb-4">
      <time datetime="2021-04-23">
        
          April 23, 2021
        
      </time>

      <br class="inline sm:hidden" />

      
        <span class="hidden sm:inline">
          &nbsp;·&nbsp;
        </span>

        <time class="italic" datetime="2022-02-06">
          Last modified at February 06, 2022
        </time>
      
    </div>

    
      <div>
        <span class="mr-1">
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag" style="display: inline;"><title>Tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>

</span>


  <a href="/tags/javascript/" class="no-underline">javascript</a><span class="last:hidden">,</span>

  <a href="/tags/typescript/" class="no-underline">typescript</a><span class="last:hidden">,</span>


      </div>
    

    <hr class="my-8" />

    <p>I started to learn React with <code>create-react-app</code> like everyone else, and it
really does its job well. I never had to worry too much about tooling but&hellip; it
is slow to start up.</p>
<p>This never bothered me too much but it&rsquo;s noticeable and everyone would agree it
could be better. Lately, we&rsquo;re witnessing projects developed to improve on this,
more noticeably <a
  href="https://github.com/evanw/esbuild"
  
  class=""
>esbuild</a>
 and
<a
  href="https://vitejs.dev/"
  
  class=""
>Vite</a>
.</p>
<p>I wanted to try this out and thought about migrating a small app of mine, mostly
written in Typescript, to Vite. And it was more easy than I expected.</p>
<h2 class="text-primary group mb-8 mt-16" id="initial-setup">
  Initial setup
  <a class="border-0 hidden text-highlight group-hover:inline" href="#initial-setup">#</a>
</h2>
<p>First, I installed Vite:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">npm install vite
</code></pre></div><p>Updated my npm scripts:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="gh">diff --git a/package.json b/package.json
</span><span class="gh">index f3307f5..32724e4 100644
</span><span class="gh"></span><span class="gd">--- a/package.json
</span><span class="gd"></span><span class="gi">+++ b/package.json
</span><span class="gi"></span><span class="gu">@@ -31,10 +31,10 @@
</span><span class="gu"></span>     &#34;typescript&#34;: &#34;^4.1.2&#34;
   },
   &#34;scripts&#34;: {
<span class="gd">-    &#34;start&#34;: &#34;react-app-rewired start&#34;,
</span><span class="gd"></span><span class="gi">+    &#34;start&#34;: &#34;vite&#34;,
</span><span class="gi"></span><span class="gd">-    &#34;build&#34;: &#34;react-app-rewired build&#34;,
</span><span class="gd"></span><span class="gi">+    &#34;build&#34;: &#34;vite build&#34;,
</span><span class="gi"></span>     &#34;test&#34;: &#34;react-scripts test&#34;,
</code></pre></div><p>Next, I needed to modify my <code>index.html</code> file.
<a
  href="https://vitejs.dev/guide/#index-html-and-project-root"
  
  class=""
>The reasons for the following steps are explained in more detail here</a>
.</p>
<p>Moved my <code>index.html</code> from the <code>./public</code> folder to my project&rsquo;s root folder and
added a <code>script</code> tag with my JS entry point as its <code>src</code> attribute.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="gh">diff --git a/public/index.html b/index.html
</span><span class="gh"></span>similarity index 88%
rename from public/index.html
rename to index.html
<span class="gh">index ecb0830..3abb36f 100644
</span><span class="gh"></span><span class="gd">--- a/public/index.html
</span><span class="gd"></span><span class="gi">+++ b/index.html
</span><span class="gi"></span><span class="gu">@@ -12,5 +12,6 @@
</span><span class="gu"></span>   &lt;body&gt;
     &lt;noscript&gt;You need to enable JavaScript to run this app.&lt;/noscript&gt;
     &lt;div id=&#34;root&#34;&gt;&lt;/div&gt;
<span class="gi">+    &lt;script type=&#34;module&#34; src=&#34;/src/index.jsx&#34;&gt;&lt;/script&gt;
</span><span class="gi"></span>   &lt;/body&gt;
 &lt;/html&gt;
</code></pre></div><p>I didn&rsquo;t had to but if you have any <code>%PUBLIC_URL%</code> in your html file, just
replace it with <code>/</code>, as explained in the linked article.</p>
<h2 class="text-primary group mb-8 mt-16" id="typescript-setup">
  TypeScript setup
  <a class="border-0 hidden text-highlight group-hover:inline" href="#typescript-setup">#</a>
</h2>
<p>At this point, I couldn&rsquo;t get my app to run because my project used
<code>tsconfig.json</code> <code>include</code> properties to make absolute imports, which Vite didn&rsquo;t
understand.</p>
<p>The solution was simple: install a Vite plugin called
<a
  href="https://github.com/aleclarson/vite-tsconfig-paths"
  
  class="border-foreground"
><code>vite-tsconfig-paths</code></a>
 which
supports, apart from
<a
  href="https://www.typescriptlang.org/docs/handbook/module-resolution.html#path-mapping"
  
  class=""
>path mapping</a>
,
<code>include</code> and <code>exclude</code> properties as well:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">npm install vite-tsconfig-paths
</code></pre></div><p>Once installed, we add it to our <code>vite.config.ts</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="kr">import</span> <span class="p">{</span> <span class="nx">defineConfig</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;vite&#34;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">tsconfigPaths</span> <span class="kr">from</span> <span class="s2">&#34;vite-tsconfig-paths&#34;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">defineConfig</span><span class="p">({</span>
  <span class="nx">build</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">outDir</span><span class="o">:</span> <span class="s2">&#34;build&#34;</span>
  <span class="p">},</span>
  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span><span class="nx">tsconfigPaths</span><span class="p">()]</span>
<span class="p">});</span>
</code></pre></div><p>I also set the output directory to be <code>build</code>, instead of the default <code>dist</code>,
because that&rsquo;s what CRA uses.</p>
<p>After that, I was able to start a server and see my app running.</p>
<h2 class="text-primary group mb-8 mt-16" id="jest-setup">
  Jest setup
  <a class="border-0 hidden text-highlight group-hover:inline" href="#jest-setup">#</a>
</h2>
<p>Because I intended to remove <code>react-scripts</code> from my project, I needed to figure
out how to run my Jest tests without <code>react-scripts test</code>.</p>
<p>I needed a way to get Jest to understand/transpile TypeScript and JSX.</p>
<p>Fortunately, there is project to help with that called
<a
  href="https://kulshekhar.github.io/ts-jest/"
  
  class="border-foreground"
><code>ts-jest</code></a>
. All we need to do is add it
as a jest preset in <code>jest.config.js</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">preset</span><span class="o">:</span> <span class="s2">&#34;ts-jest&#34;</span><span class="p">,</span>
  <span class="nx">setupFilesAfterEnv</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;&lt;rootDir&gt;src/setupTests.ts&#34;</span><span class="p">],</span>
  <span class="nx">testPathIgnorePatterns</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;&lt;rootDir&gt;/cypress/&#34;</span><span class="p">],</span>
  <span class="nx">moduleDirectories</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;node_modules&#34;</span><span class="p">,</span> <span class="s2">&#34;src&#34;</span><span class="p">]</span>
<span class="p">};</span>
</code></pre></div><p>For my specific setup, I also needed to:</p>
<ul>
<li>Ignore <code>*.spec.js</code> files inside <code>./cypress/integration</code> folder</li>
<li>Rename <code>./src/setupTests.js</code> to <code>./src/setupTests.ts</code>. Otherwise, types from
the <code>@testing-library/jest-dom/extend-expect</code> wouldn&rsquo;t be imported.</li>
<li>Add <code>&quot;src&quot;</code> to <code>moduleDirectories</code>, because it would not understand absolute
imports that look up paths inside <code>tsconfig.json</code> <code>include</code> property</li>
</ul>
<h2 class="text-primary group mb-8 mt-16" id="conclusion">
  Conclusion
  <a class="border-0 hidden text-highlight group-hover:inline" href="#conclusion">#</a>
</h2>
<p>This seems to be working fine so far, development environment is much faster to
boot, though I haven&rsquo;t checked how great hot reloading is.</p>
<p>But I&rsquo;m amazed by that first experience and how straightforward it was.</p>
<p>Finally, I uninstalled my CRA-related dev dependencies:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh">npm uninstall react-scripts customize-cra react-app-rewired babel-plugin-import
</code></pre></div>

    <hr class="my-8" />

    <nav class="grid grid-cols-1 gap-2 sm:grid-cols-2" aria-label="Posts navigation">
  <div class="sm:col-start-1 sm:col-end-1 h-full flex items-center gap-2 group">
    
      <div class="flex items-center group-hover:text-highlight">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left"><polyline points="15 18 9 12 15 6"></polyline></svg>
      </div>

      <a class="border-0" href="/posts/configuring-eslint-to-work-with-neovim-lsp/" title="Previous post">
        Configuring eslint to work with Neovim LSP
      </a>
    
  </div>

  <div class="sm:col-start-2 sm:col-end-2 text-right mt-2 sm:mt-0 h-full flex justify-end gap-2 group">
    
      <a class="border-0" href="/posts/my-experience-testing-react-applications/" title="Next post">
        My experience testing React applications
      </a>

      <div class="flex items-center group-hover:text-highlight">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline></svg>
      </div>
    
  </div>
</nav>

  </article>

        </main>

        <footer class="flex flex-col items-center gap-8 mt-16">
  <nav
    class="flex gap-4"
    aria-label="Links"
  >
    <a class="border-0" href="mailto:" title="E-mail">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"><title>E-Mail</title><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>

</a>

<a class="border-0" href="" title="LinkedIn">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-linkedin"><title>LinkedIn</title><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>

</a>

<a class="border-0" href="" title="GitHub">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><title>GitHub</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>

</a>

  </nav>

  <p>
    This content is under a
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0</a>
license.

  </p>
</footer>

      </div>
    </div>

    

    
    

    
      
      
    

    <script src="https://phelipetls.github.io/js/toggle-theme.js"></script>
    <script src="https://phelipetls.github.io/js/nav.js"></script>

    
    
  </body>
</html>
