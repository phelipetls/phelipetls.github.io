<!DOCTYPE html>
<html class="h-full" lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="description" content="Neste post pretendo continuar o que foi iniciado no último, onde transformamos dados contidos em texto em um data.frame, um formato muito mais amigável para a exploração e visualização de dados no R." />
<meta name="deploy-date" content="2022-02-09">
<meta name="publish-date" content="2019-04-07">
<meta name="last-modified-date" content="2022-02-08">
<meta name="author" content="">
<meta name="color-scheme" content="dark light">


<link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" href="/icon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">

<link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Merriweather" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather" />





  
  


<link rel="stylesheet" href="/css/main.min.css" />
<link rel="stylesheet" href="/css/dark-syntax-highlight.min.css" />

<title>
  Homicídios em Baltimore: visualizações com ggplot2 e gganimate | Phelipe Teles
</title>



<meta property="og:title" content="Homicídios em Baltimore: visualizações com ggplot2 e gganimate" />
<meta property="og:description" content="Neste post pretendo continuar o que foi iniciado no último, onde transformamos dados contidos em texto em um data.frame, um formato muito mais amigável para a exploração e visualização de dados no R." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://phelipetls.github.io/pt/posts/visualizacao-dados-homicidios-baltimore/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-07T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-02-08T21:57:09-03:00" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Homicídios em Baltimore: visualizações com ggplot2 e gganimate"/>
<meta name="twitter:description" content="Neste post pretendo continuar o que foi iniciado no último, onde transformamos dados contidos em texto em um data.frame, um formato muito mais amigável para a exploração e visualização de dados no R."/>





    
      
    
  </head>

  <body class="px-4 py-8 preload text-normal bg-background flex flex-col container max-w-2xl min-h-full mx-auto transition transition-colors duration-75 ease-out" data-theme="light">
    

    
      
    

    <script>window.__setTheme = function(newTheme) {
  document.body.setAttribute("data-theme", newTheme);
  localStorage.setItem("__theme", newTheme);
};

const storedTheme = localStorage.getItem("__theme");

if (storedTheme) {
  window.__setTheme(storedTheme);
} else if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
  window.__setTheme("dark");
}

/* Enable animations */
window.addEventListener("load", function() {
  document.body.classList.remove("preload")
})
</script>

    <header class="mb-16">
  <div class="flex justify-between">
    <h1 class="mb-4 text-3xl">
      <a class="border-0 font-bold" href="https://phelipetls.github.io/pt/">
        Phelipe Teles
      </a>
    </h1>

    <div>
      <button
        id="theme-button"
        class="rounded-full text-primary p-1"
        aria-label="Mudar tema"
      >
        <svg width="24" height="24" viewBox="0 0 24 24">
          <title>Ícone do tema</title>

          <defs>
            <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><title>Lua</title><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>

            <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><title>Sol</title><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>

          </defs>

          <use id="theme-button-svg-icon" href="#sun" />
        </svg>
      </button>
    </div>
  </div>

  

  <nav class="flex flex-row flex-wrap gap-2" aria-label="Navegação principal"><a
        id=""
        class="text-normal "
        href="https://phelipetls.github.io/pt/"
      >
        Sobre
      </a><a
        id=""
        class="text-normal border-primary"
        href="https://phelipetls.github.io/pt/posts/"
      >
        Posts
      </a><a
        id=""
        class="text-normal "
        href="https://phelipetls.github.io/pt/projects/"
      >
        Projetos
      </a></nav>
</header>


    <main class="flex flex-1 flex-col">
      
  <article>
    <div class="mb-4">
      <time datetime="2019-04-07">
        
          7 de Abril
        
      </time>

      
        <span>
          &nbsp;·&nbsp;

          <time datetime="2022-02-08">
            Editado em 08 de Agosto
          </time>
        </span>
      
    </div>

    <h1 class="text-4xl mb-4">
      Homicídios em Baltimore: visualizações com ggplot2 e gganimate
    </h1>

    
      <div>
        <span class="mr-1">
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag" style="display: inline;"><title>Tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>

</span>


  <a href="/pt/tags/dataviz/" class="no-underline">dataviz</a><span class="last:hidden">,</span>

  <a href="/pt/tags/tidyverse/" class="no-underline">tidyverse</a><span class="last:hidden">,</span>

  <a href="/pt/tags/gganimate/" class="no-underline">gganimate</a><span class="last:hidden">,</span>

  <a href="/pt/tags/ggplot2/" class="no-underline">ggplot2</a><span class="last:hidden">,</span>


      </div>
    

    <hr class="my-8" />

    <p>Neste post pretendo continuar o que foi iniciado no último, onde transformamos
dados contidos em texto em um data.frame, um formato muito mais amigável para a
exploração e visualização de dados no R.</p>
<p>O procedimento geral agora, com os dados já limpos, é transformá-los e fazer a
visualização que queremos. Daí o uso extensivo do tidyverse antes de chamar o
ggplot2.</p>
<p>Ok, vamos primeiro olhar para a nossa
<a
  href="https://raw.githubusercontent.com/phelipetls/phelipetls.github.io/master/assets/homicides_df.csv"
  title="Link do arquivo raw"
  class=""
>base de dados</a>

e ver que perguntas gostaríamos de responder:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>

<span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">read_csv</span><span class="p">(</span><span class="s">&#34;https://raw.githubusercontent.com/phelipetls/phelipetls.github.io/master/assets/homicides_df.csv&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">na.omit</span><span class="p">()</span>

<span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">head</span><span class="p">()</span>
</code></pre></div><pre><code>## # A tibble: 6 x 8
##   causas         lon   lat raca  genero idade data       endereco
##   &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;
## 1 Shooting     -76.7  39.3 Black Male      17 2007-01-01 3400 Clifton Ave.
## 2 Shooting     -76.7  39.3 Black Male      26 2007-01-02 4900 Challedon Ro~
## 3 Blunt Force  -76.6  39.3 Black Female    44 2007-01-02 2000 West North A~
## 4 Asphyxiation -76.6  39.4 Black Male      21 2007-01-03 5900 Northwood Dr~
## 5 Blunt Force  -76.6  39.2 White Male      61 2007-01-05 500 Maude Ave.
## 6 Shooting     -76.6  39.4 Black Male      46 2007-01-05 5200 Ready Ave.
</code></pre>
<p>Há diversas questões a serem exploradas aqui, a primeira e mais sensível que vem
a mente é a racial: quais raças costumam ser vítimas de homicídio? Vamos,
naturalmente, estar interessados também na mesma pergunta para diferentes
características das pessoas, como gênero, idade etc. e como elas se relacionam
umas com as outras. Por exemplo, será que mulheres negras acabam vítimas de
homicídios muito mais que as brancas?</p>
<p>Os dados nos possibilitam também enxergar a distribuição geográfica, que áreas
da cidade são as mais violentas etc.</p>
<p>E, por fim, é interessante visualizar como o número de vítimas evolui no tempo.
Será que vem declinando com o passar dos anos?</p>
<h2 class="group mb-8 mt-8" id="evolução-do-número-de-vítimas-no-tempo">
  Evolução do número de vítimas no tempo
  <a class="border-0 hidden text-highlight group-hover:inline" href="#evolu%c3%a7%c3%a3o-do-n%c3%bamero-de-v%c3%adtimas-no-tempo">#</a>
</h2>
<p>Esse é um bom ponto para se começar a entender os dados. Vamos fazer essa
visualização com um gráfico de linhas:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="nf">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span>

<span class="c1"># configurando o tema</span>
<span class="nf">theme_set</span><span class="p">(</span><span class="nf">theme_minimal</span><span class="p">())</span>
<span class="nf">theme_update</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&#34;bottom&#34;</span><span class="p">)</span>

<span class="c1"># criando a variável pro ano</span>
<span class="n">df</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">ano</span> <span class="o">=</span> <span class="nf">year</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="n">df</span> <span class="o">%&gt;%</span>
  <span class="nf">count</span><span class="p">(</span><span class="n">ano</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">ano</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">n</span>
  <span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s">&#34;\nAno&#34;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&#34;Número de homicídios na cidade de Baltimore por ano&#34;</span>
  <span class="p">)</span>
</code></pre></div><p><img src="./unnamed-chunk-2-1.png" alt="plot1"></p>
<p>Ok, uma boa notícia, parece que o número de homicídios vem reduzindo com os
anos…</p>
<p>Exceto por essa queda brusca em 2012, que deveria gerar suspeitas. De fato, essa
queda será esclarecida por outra visualização mais adiante. Se desconsiderarmos
2012, o quadro da violência não parece apresentar melhoras tão significativas.</p>
<p>É interessante visualizar também como isso se deu para as diferentes raças:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">df</span> <span class="o">%&gt;%</span>
  <span class="c1"># contagem dos casos por raça e ano</span>
  <span class="nf">count</span><span class="p">(</span><span class="n">raca</span><span class="p">,</span> <span class="n">ano</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">ano</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span>
    <span class="n">fill</span> <span class="o">=</span> <span class="n">raca</span>
  <span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_col</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&#34;Raça das vítimas de homicídios em Baltimore&#34;</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s">&#34;Set1&#34;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#34;Raça&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="m">2007</span><span class="o">:</span><span class="m">2012</span><span class="p">)</span>
</code></pre></div><p><img src="./unnamed-chunk-3-1.png" alt="plot2"><!-- --></p>
<p>Essa é a primeira visualização do que já era esperado: na cidade de Baltimore, a
violência afeta muito mais os negros do que a qualquer outra raça. Impressiona a
magnitude da desigualdade.</p>
<p>Um gráfico interessante que vi <a
  href="https://homicides.news.baltimoresun.com/"
  
  class=""
>aqui</a>
,
foi o do crescimento acumulado do número de vítimas por mês para cada ano, que
tentei replicar abaixo:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">acumulado</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">mes</span> <span class="o">=</span> <span class="nf">month</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="nf">count</span><span class="p">(</span><span class="n">ano</span><span class="p">,</span> <span class="n">mes</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">group_by</span><span class="p">(</span><span class="n">ano</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">soma_cumulativa</span> <span class="o">=</span> <span class="nf">cumsum</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="nf">na.omit</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">mes</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">soma_cumulativa</span><span class="p">,</span>
    <span class="n">color</span> <span class="o">=</span> <span class="nf">factor</span><span class="p">(</span><span class="n">ano</span><span class="p">),</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">ano</span>
  <span class="p">))</span> <span class="o">+</span>
  <span class="nf">scale_color_brewer</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s">&#34;Dark2&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="s">&#34;# acumulado de homicídios\n&#34;</span><span class="p">,</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&#34;Evolução temporal dos homicídios em Baltimore&#34;</span><span class="p">,</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;Ano&#34;</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">1.2</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_x_continuous</span><span class="p">(</span>
    <span class="n">breaks</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">,</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="nf">month</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="bp">T</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">levels</span><span class="p">()</span>
  <span class="p">)</span>


<span class="n">acumulado</span>
</code></pre></div><p><img src="./unnamed-chunk-4-1.png" alt="plot3"><!-- --></p>
<p>E aqui fica claro o porquê da queda em 2012: não temos os dados de todos os
meses. Também salta aos olhos que a violência diminuiu em relação a 2007, mas se
manteve mais ou menos estável no resto do período.</p>
<h2 class="group mb-8 mt-8" id="aspectos-sociais-das-vítimas">
  Aspectos sociais das vítimas
  <a class="border-0 hidden text-highlight group-hover:inline" href="#aspectos-sociais-das-v%c3%adtimas">#</a>
</h2>
<p>Vamos tentar visualizar agora como a violência afeta as pessoas de diferentes
grupos:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">df</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">idade</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_histogram</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="n">raca</span><span class="p">),</span>
    <span class="n">binwidth</span> <span class="o">=</span> <span class="m">5</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">facet_grid</span><span class="p">(</span><span class="n">. </span><span class="o">~</span> <span class="n">genero</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s">&#34;Set1&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s">&#34;Idade&#34;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
    <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;Raça&#34;</span><span class="p">,</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&#34;Número de homicídios na cidade de Baltimore&#34;</span><span class="p">,</span>
    <span class="n">subtitle</span> <span class="o">=</span> <span class="s">&#34;Por gênero, raça e idade (de 2007 até maio de 2012)&#34;</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span> <span class="o">=</span> <span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="m">10</span><span class="p">))</span>
</code></pre></div><p><img src="./unnamed-chunk-5-1.png" alt="plot3"><!-- --></p>
<p>E assim podemos ver que o mais afetado pela violência é o homem negro da faixa
dos 20-30 anos. Se olharmos bem, pode-se também observar que a mulher negra está
em posição mais vulnerável à violência que a branca, provavelmente porque vive
nas regiões onde a violência é maior.</p>
<p>Também impressiona o contraste entre os números para cada gênero. Os homens são
muito mais propensos a serem mortos violentamente.</p>
<h2 class="group mb-8 mt-8" id="que-causa-de-morte-é-a-mais-comum">
  Que causa de morte é a mais comum?
  <a class="border-0 hidden text-highlight group-hover:inline" href="#que-causa-de-morte-%c3%a9-a-mais-comum">#</a>
</h2>
<p>Para ver quais são as causas mais comuns, vamos fazer um simples gráfico de
barras:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">df</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">causas</span><span class="p">,</span>
    <span class="n">fill</span> <span class="o">=</span> <span class="n">causas</span>
  <span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_bar</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
    <span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;Causas&#34;</span><span class="p">,</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&#34;Causas de morte mais comuns&#34;</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s">&#34;Set1&#34;</span><span class="p">)</span>
</code></pre></div><p><img src="./unnamed-chunk-6-1.png" alt="plot5"><!-- --></p>
<p>Os homicídios por armas de fogo são de longe os mais comuns, seguido por
esfaqueamento e contusão.</p>
<h2 class="group mb-8 mt-8" id="mapas-e-animações">
  Mapas e animações
  <a class="border-0 hidden text-highlight group-hover:inline" href="#mapas-e-anima%c3%a7%c3%b5es">#</a>
</h2>
<p>Para visualizar a distribuição geográfica da ocorrência de homicídios, temos que
primeiro plotar o mapa da cidade. O código abaixo mostra como fazer isso, com a
ajuda do dataset <code>county</code> do pacote <code>maps</code>, de onde extraímos as coordenadas
geográficas, para depois plotar com <code>geom_polyon()</code>.</p>
<p>Uma vez com o mapa, minha ideia foi criar uma animação para visualizar o aspecto
temporal, espacial e qualitativo (nesse caso, pela raça das vítimas) com um
único gráfico. Para isso, vamos usar a função <code>gganimate::transition_manual</code>, de
forma a mostrar por mês o crescimento no número de vítimas:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="nf">library</span><span class="p">(</span><span class="n">gganimate</span><span class="p">)</span>

<span class="c1"># mapa de baltimore city</span>
<span class="n">baltimore_map</span> <span class="o">&lt;-</span> <span class="nf">map_data</span><span class="p">(</span><span class="s">&#34;county&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">filter</span><span class="p">(</span><span class="n">subregion</span> <span class="o">==</span> <span class="s">&#34;baltimore city&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">long</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_polygon</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="s">&#34;lightgray&#34;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;black&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">coord_map</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme_void</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s">&#34;bottom&#34;</span><span class="p">)</span>

<span class="c1"># criando variável para cada mês de cada ano</span>
<span class="n">df</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span>
  <span class="nf">arrange</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">ano_mes</span> <span class="o">=</span> <span class="nf">format</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&#34;%B de %Y&#34;</span><span class="p">))</span>

<span class="c1"># criando a animação</span>
<span class="n">anim</span> <span class="o">&lt;-</span> <span class="n">baltimore_map</span> <span class="o">+</span>
  <span class="nf">geom_point</span><span class="p">(</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span>
    <span class="nf">aes</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span>
      <span class="n">lat</span><span class="p">,</span>
      <span class="n">group</span> <span class="o">=</span> <span class="n">ano_mes</span><span class="p">,</span>
      <span class="n">color</span> <span class="o">=</span> <span class="n">raca</span>
    <span class="p">),</span>
    <span class="n">size</span> <span class="o">=</span> <span class="m">3.5</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">.7</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&#34;Que raças e regiões são mais vulneráveis ao homicídio?&#34;</span><span class="p">,</span>
    <span class="n">subtitle</span> <span class="o">=</span> <span class="s">&#34;{ current_frame }&#34;</span><span class="p">,</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;Raça&#34;</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">scale_color_brewer</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="s">&#34;Set1&#34;</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">transition_manual</span><span class="p">(</span><span class="nf">factor</span><span class="p">(</span><span class="n">ano_mes</span><span class="p">,</span> <span class="c1"># ordernando os meses</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="nf">unique</span><span class="p">(</span><span class="n">ano_mes</span><span class="p">)</span>
  <span class="p">),</span>
  <span class="n">cumulative</span> <span class="o">=</span> <span class="bp">T</span>
  <span class="p">)</span>

<span class="c1"># desacelerando a animação (padrão é 10fps)</span>
<span class="nf">animate</span><span class="p">(</span><span class="n">anim</span><span class="p">,</span> <span class="n">fps</span> <span class="o">=</span> <span class="m">5</span><span class="p">)</span>
</code></pre></div><p><img src="./unnamed-chunk-7-1.gif" alt="gif1"><!-- --></p>
<p>Fica evidente daí como a violência é concentrada em certos bairros.</p>
<p>Outra ideia é visualizar a evolução dos homicídios no tempo, por causa de morte.
Para isso, vamos usar ot <code>gganimate::transition_states</code>, para visualizarmos as
mudanças ocorridas no decorrer dos anos.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">df</span> <span class="o">%&gt;%</span>
  <span class="nf">count</span><span class="p">(</span><span class="n">ano</span><span class="p">,</span> <span class="n">causas</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">causas</span><span class="p">,</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span>
    <span class="n">fill</span> <span class="o">=</span> <span class="n">causas</span>
  <span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_col</span><span class="p">(</span><span class="n">show.legend</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_text</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span>
    <span class="n">label</span> <span class="o">=</span> <span class="nf">paste0</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="nf">round</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span>
    <span class="n">hjust</span> <span class="o">=</span> <span class="m">-0.2</span>
  <span class="p">))</span> <span class="o">+</span>
  <span class="nf">coord_flip</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&#34;Causas de morte mais comuns&#34;</span><span class="p">,</span>
    <span class="n">subtitle</span> <span class="o">=</span> <span class="s">&#34;Ano: { closest_state }&#34;</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">transition_states</span><span class="p">(</span><span class="n">ano</span><span class="p">)</span>
</code></pre></div><p><img src="./unnamed-chunk-8-1.gif" alt="gif2"><!-- --></p>
<p>E que tal animarmos aquele gráfico do número acumulado? Vamos usar o
<code>gganimate::transition_reveal()</code> para revelar ao longo do eixo do tempo como os
números crescem.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-r" data-lang="r"><span class="n">acumulado</span> <span class="o">+</span>
  <span class="nf">geom_segment</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span>
    <span class="n">xend</span> <span class="o">=</span> <span class="m">12.5</span><span class="p">,</span>
    <span class="n">yend</span> <span class="o">=</span> <span class="n">soma_cumulativa</span>
  <span class="p">),</span>
  <span class="n">linetype</span> <span class="o">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#34;grey&#34;</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_text</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="m">13</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="nf">paste0</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">,</span> <span class="n">soma_cumulativa</span><span class="p">)))</span> <span class="o">+</span>
  <span class="nf">transition_reveal</span><span class="p">(</span><span class="n">mes</span><span class="p">)</span>
</code></pre></div><p><img src="./unnamed-chunk-9-1.gif" alt="gif3"><!-- --></p>
<h2 class="group mb-8 mt-8" id="conclusões">
  Conclusões
  <a class="border-0 hidden text-highlight group-hover:inline" href="#conclus%c3%b5es">#</a>
</h2>
<p>Este post é certamente só uma amostra do pontecial do combo ggplot2 + gganimate,
talvez uma das maiores vantagens de se usar o R, e espero que te ajude a criar
as suas próprias visualizações, apesar de não ter sido exatamente o intuito ser
didático.</p>
<p>O gganimate é bem novo ainda e tem relativamente pouca informação sobre na
internet. Eu demorei bastante para fazer alguns desses gráficos, mas acho que o
resultado valeu a pena.</p>
<p>Para aprender mais sobre ggplot2, tente este
<a
  href="http://www.cookbook-r.com/Graphs/"
  
  class=""
>cookbook</a>
 é ótimo. Para maiores referências
sobre animações, tente o respositório
<a
  href="https://github.com/ropenscilabs/learngganimate"
  
  class=""
>learngganimate</a>
, esse
<a
  href="https://cran.r-project.org/web/packages/gganimate/vignettes/gganimate.html"
  
  class=""
>vignette</a>

ou o próprio <a
  href="https://gganimate.com/"
  
  class=""
>site do pacote</a>
.</p>


    <hr class="my-8" />

    <nav class="grid grid-cols-1 gap-2 sm:grid-cols-2" aria-label="Navegação entre posts">
      <div class="sm:col-start-1 sm:col-end-1 h-full flex items-center gap-2 group">
        
          <div class="flex items-center group-hover:text-highlight">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left"><polyline points="15 18 9 12 15 6"></polyline></svg>
          </div>

          <a class="border-0" href="/pt/posts/homicidios-em-baltimore-minerando-dados-r/" title="Post anterior">
            Extraindo dados de texto com regex no R
          </a>
        
      </div>

      <div class="sm:col-start-2 sm:col-end-2 text-right mt-2 sm:mt-0 h-full flex justify-end gap-2 group">
        
          <a class="border-0" href="/pt/posts/game-of-thrones-text-mining/" title="Próximo post">
            Mineração de Texto com as legendas de Game of Thrones
          </a>

          <div class="flex items-center group-hover:text-highlight">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline></svg>
          </div>
        
      </div>
    </nav>
  </article>

    </main>

    <footer class="mt-16 text-right text-sm">
  <div class="mb-2">
    

    <a href="https://phelipetls.github.io/pt/posts/index.xml">RSS</a> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss inline"><title>RSS</title><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg>

    </div>

  <div>Conteúdo sob a licença
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0</a>
</div>
</footer>


    

    

    
      
    

    <script src="https://phelipetls.github.io/js/toggle-theme.js"></script>

    
      <script async src="https://cdn.panelbear.com/analytics.js?site=I8KFO1BpnCi"></script>
      <script>
          window.panelbear = window.panelbear || function() { (window.panelbear.q = window.panelbear.q || []).push(arguments); };
          panelbear('config', { site: 'I8KFO1BpnCi' });
      </script>
    

    
    
  </body>
</html>
