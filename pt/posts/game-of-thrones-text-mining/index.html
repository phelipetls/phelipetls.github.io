<!doctype html><html class="scroll-smooth scroll-pt-nav-height sm:scroll-pt-0
h-full text-base selection:bg-on-background selection:text-background sm:text-lg" lang=pt-br><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=deploy-date content="2022-11-05"><meta name=author content="Phelipe Teles"><meta name=color-scheme content="dark light"><style>@font-face{font-family:fira sans;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/fira-sans-v16-latin-regular.woff2)format('woff2')}@font-face{font-family:fira sans;font-style:normal;font-weight:600;font-display:swap;src:url(/fonts/fira-sans-v16-latin-600.woff2)format('woff2')}@font-face{font-family:merriweather;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/merriweather-v30-latin-regular.woff2)format('woff2')}@font-face{font-family:merriweather;font-style:normal;font-weight:700;font-display:swap;src:url(/fonts/merriweather-v30-latin-700.woff2)format('woff2')}</style><script async defer data-website-id=32b90065-c2a6-4390-9684-dfde99409815 src=https://umami-production-10b2.up.railway.app/main.js></script>
<script type=module defer src=https://phelipetls.github.io/js/bundle.min.js></script><meta name=description content="Desenvolvedor web front-end que escreve sobre a prática da programação e suas ferramentas"><meta name=publish-date content="2019-04-20"><meta name=last-modified-date content="2022-06-16"><meta name=keywords content="tidyverse,dataviz,ggplot2,tidytext"><title>Mineração de Texto com as legendas de Game of Thrones |
Phelipe Teles</title><meta property="og:title" content="Mineração de Texto com as legendas de Game of Thrones"><meta property="og:description" content="Neste post procuro visualizar dados textuais das legendads de Game of Thrones com o R, utilizando o pacote tidytext , que torna trivial esse tipo de tarefa."><meta property="og:type" content="article"><meta property="og:url" content="https://phelipetls.github.io/pt/posts/game-of-thrones-text-mining/"><meta property="og:image" content="https://phelipetls.github.io/pt/posts/game-of-thrones-text-mining/post-image.pt.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-04-20T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-16T12:32:59-03:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://phelipetls.github.io/pt/posts/game-of-thrones-text-mining/post-image.pt.png"><meta name=twitter:title content="Mineração de Texto com as legendas de Game of Thrones"><meta name=twitter:description content="Neste post procuro visualizar dados textuais das legendads de Game of Thrones com o R, utilizando o pacote tidytext , que torna trivial esse tipo de tarefa."><link rel=stylesheet href="/css/main.min.css"><link rel=stylesheet href=https://phelipetls.github.io/css/vendor/lite-yt-embed.min.css><link rel=stylesheet href=/css/dark-syntax-highlight.min.css></head><body data-preload class="ease h-full bg-background font-sans text-on-background transition-colors duration-500"><script>(()=>{window.__setTheme=s;var e=o();window.__setTheme(e),window.addEventListener("load",function(){document.body.removeAttribute("data-preload"),t(e)}),window.addEventListener("storage",function(e){const t=e.newValue;e.key==="__theme"&&window.__setTheme(t)});function s(e){if(!e)return;a(e),c(e),t(e)}function c(e){localStorage.setItem("__theme",e)}function o(){return localStorage.getItem("__theme")||"system"}function i(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function n(e){return e==="system"?i():e}function a(e){const t=n(e);document.body.classList.toggle("dark",t==="dark")}function r(e){return new CustomEvent("newTheme",{detail:{themeChoice:e,theme:n(e)}})}function t(e){document.body.dispatchEvent(r(e))}})()</script><div class="relative flex h-full flex-col"><div data-nav-container class="mb-8 w-full"><div class="pt-nav-height sm:hidden"><nav class="fixed top-0 left-0 z-30 flex w-screen justify-between rounded-none border-b border-divider bg-background/90 py-4 px-horizontal-padding backdrop-blur" aria-label="Navegação principal"><div class="flex flex-row items-center gap-2 overflow-hidden"><a class=border-0 href=https://phelipetls.github.io/pt/posts/><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left"><polyline points="15 18 9 12 15 6"/></svg></a><h2 class="m-0 truncate font-sans font-normal">Mineração de Texto com as legendas de Game of Thrones</h2></div><button data-a11y-dialog-show=sidenav class="btn btn-icon" aria-label="Abrir barra de navegação lateral"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></nav></div><div class="hidden h-full w-full sm:block"><div class="flex h-full w-full items-center justify-between bg-background pr-horizontal-padding"><div class="mx-auto flex h-full w-full max-w-content justify-between"><nav class="flex h-full justify-between overflow-x-auto px-horizontal-padding" aria-label="Navegação principal"><ul class="m-0 flex list-none flex-row flex-nowrap items-center gap-2"><li><a id=about href=https://phelipetls.github.io/pt/ class="hover:bg-hover
relative
flex
items-center
justify-center
rounded
border-0
py-1
px-2
transition-colors
duration-300"><span>Sobre</span></a></li><li><a id=posts href=https://phelipetls.github.io/pt/posts/ aria-current=page class="bg-primary card hover:bg-primary-hover
relative
flex
items-center
justify-center
rounded
border-0
py-1
px-2
transition-colors
duration-300"><span class=text-on-primary>Posts</span></a></li><li><a id=projects href=https://phelipetls.github.io/pt/projects/ class="hover:bg-hover
relative
flex
items-center
justify-center
rounded
border-0
py-1
px-2
transition-colors
duration-300"><span>Projetos</span></a></li><li><a id=resume href=https://phelipetls.github.io/pt/resume/ class="hover:bg-hover
relative
flex
items-center
justify-center
rounded
border-0
py-1
px-2
transition-colors
duration-300"><span>Currículo</span></a></li></ul></nav><div class="h-full py-3"><div class="flex h-full flex-row items-stretch gap-2 pl-2"><div class="relative flex h-full flex-row items-center"><span class="pointer-events-none absolute left-2 top-1/2 -translate-y-1/2 text-sm"><svg class="feather" viewBox="0 0 24 24" width="24" height="24"><title>Ícone do tema</title><defs><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg><svg id="monitor" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-monitor"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg></defs><use data-theme-select-icon href=#monitor></use></svg></span>
<select class="card h-full appearance-none bg-surface py-1 px-8 text-center" data-theme-select id=theme-select aria-label="Escolha um tema"><option value=light>Claro</option><option value=dark>Escuro</option><option value=system>Sistema</option></select>
<span class="pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></div></div></div></div></div></div></div><aside data-a11y-dialog=sidenav aria-hidden=true class="fixed z-50 h-full w-full" style=visibility:hidden><div data-a11y-dialog-hide class="fixed inset-0 -z-1 w-full bg-neutral-700 bg-opacity-75 backdrop-blur-sm"></div><div role=document class="ml-auto h-full w-3/4 rounded-none bg-background py-0 will-change-transform"><div class="flex h-full flex-col justify-between"><div class="mb-2 flex h-nav-height items-center justify-end px-horizontal-padding"><button data-a11y-dialog-hide class="btn btn-icon" aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div><nav class="flex flex-1 flex-col"><ul class="m-0 flex list-none flex-col items-center justify-center gap-4 px-horizontal-padding"><li class=w-full><a id=about href=https://phelipetls.github.io/pt/ class="hover:bg-hover
block
w-full
rounded
border-0
p-2
text-center
text-xl
transition-colors
duration-300">Sobre</a></li><li class=w-full><a id=posts href=https://phelipetls.github.io/pt/posts/ aria-current=page class="card bg-primary text-on-primary hover:bg-primary-hover
block
w-full
rounded
border-0
p-2
text-center
text-xl
transition-colors
duration-300">Posts</a></li><li class=w-full><a id=projects href=https://phelipetls.github.io/pt/projects/ class="hover:bg-hover
block
w-full
rounded
border-0
p-2
text-center
text-xl
transition-colors
duration-300">Projetos</a></li><li class=w-full><a id=resume href=https://phelipetls.github.io/pt/resume/ class="hover:bg-hover
block
w-full
rounded
border-0
p-2
text-center
text-xl
transition-colors
duration-300">Currículo</a></li></ul></nav><div class="mb-4 flex h-12 flex-row items-center justify-center px-horizontal-padding"><div class="relative flex h-full flex-row items-center"><span class="pointer-events-none absolute left-2 top-1/2 -translate-y-1/2 text-sm"><svg class="feather" viewBox="0 0 24 24" width="24" height="24"><title>Ícone do tema</title><defs><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg><svg id="monitor" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-monitor"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg></defs><use data-theme-select-icon href=#monitor></use></svg></span>
<select class="card h-full appearance-none bg-surface py-1 px-8 text-center" data-theme-select id=theme-select aria-label="Escolha um tema"><option value=light>Claro</option><option value=dark>Escuro</option><option value=system>Sistema</option></select>
<span class="pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></div></div></div></div></aside><main class="grid grid-cols-layout"><div class="col-full max-w-full rounded-none px-horizontal-padding pt-8 shadow-none sm:col-content sm:px-0"><article><header><h1 class="mb-4 text-4xl">Mineração de Texto com as legendas de Game of Thrones</h1><div class="mb-4 flex flex-col gap-2"><div class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-book-open"><path d="M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"/><path d="M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"/></svg><div>1 min.</div></div><div class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><time datetime=2019-04-20>20 de
Abril</time></div></div><div class="mb-4 flex flex-wrap gap-2"><a href=/pt/tags/tidyverse/ class="tag whitespace-nowrap">tidyverse</a>
<a href=/pt/tags/dataviz/ class="tag whitespace-nowrap">dataviz</a>
<a href=/pt/tags/ggplot2/ class="tag whitespace-nowrap">ggplot2</a>
<a href=/pt/tags/tidytext/ class="tag whitespace-nowrap">tidytext</a>
<a href=/pt/tags class=tag aria-label="Todas as tags">...</a></div></header><hr class=my-8><div class="flex flex-col-reverse lg:grid lg:grid-cols-[1fr,minmax(0,1fr)]"><div data-blog-post class="[&>pre]:full-width-on-mobile
       [&>figure]:full-width-on-mobile
    [&>[data-codeblock]]:full-width-on-mobile
max-w-prose
[&>[data-codeblock]_pre]:max-sm:rounded-none
[&>[data-codeblock-with-header]]:mt-16
[&_img]:mx-auto
              [&>hr]:border-0
[&>hr]:text-center
              [&>hr]:after:content-['⁂']
[&>pre]:my-8
              [&>figure]:my-8
[&>blockquote]:my-8
              [&>figure_img]:bg-surface
          [&>figure_img]:sm:rounded
          [&>figure_video]:min-h-[15em]
      [&>figure_video]:bg-surface
        [&>figure_video]:sm:rounded
        [&_.katex-display]:overflow-x-auto
 [&_.katex-display]:overflow-y-hidden"><p>Neste post procuro visualizar dados textuais das legendads de Game of Thrones
com o R, utilizando o pacote
<a href=https://www.tidytextmining.com rel=external><code>tidytext</code><span class="ml-1 [&_svg]:inline-block [&_svg]:h-[1em] [&_svg]:w-[1em] [&_svg]:align-text-top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
</span></a>, que
torna trivial esse tipo de tarefa.</p><p>A ideia é transformar um bloco de texto, como um livro, em um tidy DataFrame. No
nosso, caso faremos com as legendas de GOT.</p><h2 class="mb-8 mt-4 pt-4" id=obtendo-os-dados>Obtendo os dados
<a class="text-primary border-0" href=#obtendo-os-dados>#</a></h2><p>Os dados brutos foram coletados
<a href=https://www.kaggle.com/gunnvant/game-of-thrones-srt rel=external>aqui<span class="ml-1 [&_svg]:inline-block [&_svg]:h-[1em] [&_svg]:w-[1em] [&_svg]:align-text-top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
</span></a>, formato JSON. São 7
arquivos, que contêm todas as legendas para as sete temporadas de GOT.
Felizmente, há uma biblioteca para ler arquivos JSON no R, o <code>jsonlite</code>.</p><p>No código abaixo, o que fiz foi ler cada arquivo, aplicando a função
<code>jsonlite::fromJSON()</code> a cada um deles com <code>purrr::map()</code>, o que me dá uma
lista. Depois, transformei essa lista em um vetor com <code>unlist()</code>, que por fim
transformei em um data.frame com <code>tibble::enframe()</code>.</p><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=nf>library</span><span class=p>(</span><span class=n>jsonlite</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>library</span><span class=p>(</span><span class=n>tidyverse</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>setwd</span><span class=p>(</span><span class=s>&#34;~/got_subtitles/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># vetor com o endereço dos arquivos</span>
</span></span><span class=line><span class=cl><span class=n>arquivos</span> <span class=o>&lt;-</span> <span class=nf>dir</span><span class=p>(</span><span class=n>path</span> <span class=o>=</span> <span class=nf>getwd</span><span class=p>(),</span> <span class=n>pattern</span> <span class=o>=</span> <span class=s>&#34;json$&#34;</span><span class=p>,</span> <span class=n>full.names</span> <span class=o>=</span> <span class=bp>T</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># lendo os arquivos</span>
</span></span><span class=line><span class=cl><span class=n>got_subs_raw</span> <span class=o>&lt;-</span> <span class=nf>map</span><span class=p>(</span><span class=n>arquivos</span><span class=p>,</span> <span class=o>~</span> <span class=nf>fromJSON</span><span class=p>(</span><span class=n>.x</span><span class=p>))</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>unlist</span><span class=p>()</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>enframe</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>got_subs_raw</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>## # A tibble: 44,890 x 2
##    name                             value
##    &lt;chr&gt;                            &lt;chr&gt;
##  1 Game Of Thrones S01E01 Winter I~ Easy, boy.
##  2 Game Of Thrones S01E01 Winter I~ Our orders were to track the wildlings.
##  3 Game Of Thrones S01E01 Winter I~ - Right. Give it here. - No!
##  4 Game Of Thrones S01E01 Winter I~ Put away your blade.
##  5 Game Of Thrones S01E01 Winter I~ - I take orders from your father, not ~
##  6 Game Of Thrones S01E01 Winter I~ I'm sorry, Bran.
##  7 Game Of Thrones S01E01 Winter I~ Lord Stark?
##  8 Game Of Thrones S01E01 Winter I~ There are five pups.
##  9 Game Of Thrones S01E01 Winter I~ One for each of the Stark children.
## 10 Game Of Thrones S01E01 Winter I~ The direwolf is the sigil of your hous~
## # ... with 44,880 more rows
</code></pre><p>Agora vamos limpar esse DataFrame, procurando extrair variáveis interessantes
como temporada, número e nome do episódio etc.</p><p>Primeiro vamos retirar o prefixo &lsquo;Game of Throns S&rsquo;, o que nos deixa com &lsquo;01E01
Winter Is Coming&rsquo;, &lsquo;{Temporada}E{Episódio} {Nome do episódio}&rsquo;. Vamos usar
regexes para extrair cada parte individualmente.</p><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=n>got_subs</span> <span class=o>&lt;-</span> <span class=n>got_subs_raw</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>mutate</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=nf>str_remove</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=s>&#34;Game Of Thrones S&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>season_episode</span> <span class=o>=</span> <span class=nf>str_extract</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=s>&#34;\\d+E\\d+&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=nf>str_match</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=s>&#34;([A-z,&#39; ]+)\\.srt&#34;</span><span class=p>)</span><span class=n>[</span><span class=p>,</span> <span class=m>2</span><span class=n>]</span> <span class=o>%&gt;%</span> <span class=nf>trimws</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># separando a temporada do episódio</span>
</span></span><span class=line><span class=cl>  <span class=nf>separate</span><span class=p>(</span><span class=n>season_episode</span><span class=p>,</span> <span class=nf>c</span><span class=p>(</span><span class=s>&#34;season&#34;</span><span class=p>,</span> <span class=s>&#34;episode&#34;</span><span class=p>),</span> <span class=n>sep</span> <span class=o>=</span> <span class=s>&#34;E&#34;</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># transformando o que é número para numeric</span>
</span></span><span class=line><span class=cl>  <span class=nf>mutate</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>season</span> <span class=o>=</span> <span class=nf>as.numeric</span><span class=p>(</span><span class=n>season</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>episode</span> <span class=o>=</span> <span class=nf>as.numeric</span><span class=p>(</span><span class=n>episode</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>select</span><span class=p>(</span><span class=n>season</span><span class=p>,</span> <span class=n>episode</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>got_subs</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>## # A tibble: 44,890 x 4
##    season episode name          value
##     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;
##  1      1       1 Winter Is Co~ Easy, boy.
##  2      1       1 Winter Is Co~ Our orders were to track the wildlings.
##  3      1       1 Winter Is Co~ - Right. Give it here. - No!
##  4      1       1 Winter Is Co~ Put away your blade.
##  5      1       1 Winter Is Co~ - I take orders from your father, not you.~
##  6      1       1 Winter Is Co~ I'm sorry, Bran.
##  7      1       1 Winter Is Co~ Lord Stark?
##  8      1       1 Winter Is Co~ There are five pups.
##  9      1       1 Winter Is Co~ One for each of the Stark children.
## 10      1       1 Winter Is Co~ The direwolf is the sigil of your house.
## # ... with 44,880 more rows
</code></pre><p>Podemos tornar isso se quebrarmos a coluna <code>value</code> em unidades menores, como
palavras. O pacote <code>tidytext</code> tem uma função para isso, chamada <code>unnest_tokens</code>.
É mais geral e pode servir para separar um texto em caracteres, frases,
parágrafos etc.</p><p>Será útil também a função <code>rownames_to_column</code>, para podermos saber quais
palavras pertencem à mesma frase após a separação etc.</p><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=nf>library</span><span class=p>(</span><span class=n>tidytext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>got_words</span> <span class=o>&lt;-</span> <span class=n>got_subs</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>rownames_to_column</span><span class=p>()</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>unnest_tokens</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>got_words</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>## # A tibble: 286,901 x 5
##    rowname season episode name             word
##    &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;
##  1 1            1       1 Winter Is Coming easy
##  2 1            1       1 Winter Is Coming boy
##  3 2            1       1 Winter Is Coming our
##  4 2            1       1 Winter Is Coming orders
##  5 2            1       1 Winter Is Coming were
##  6 2            1       1 Winter Is Coming to
##  7 2            1       1 Winter Is Coming track
##  8 2            1       1 Winter Is Coming the
##  9 2            1       1 Winter Is Coming wildlings
## 10 3            1       1 Winter Is Coming right
## # ... with 286,891 more rows
</code></pre><p>Vamos contar quais são as palavras mais comuns:</p><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=n>got_words</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>count</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>sort</span> <span class=o>=</span> <span class=bp>T</span><span class=p>)</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>## # A tibble: 9,695 x 2
##    word      n
##    &lt;chr&gt; &lt;int&gt;
##  1 the   11856
##  2 you   10585
##  3 i     10267
##  4 to     7864
##  5 a      6006
##  6 and    5064
##  7 of     4430
##  8 your   3342
##  9 my     3234
## 10 it     2962
## # ... with 9,685 more rows
</code></pre><p>A maioria são preposições, pronomes etc., o que não é muito interessante.
Felizmente, isso é muito facilmente resolvido por esse pacote. Basta rodar um
<code>dplyr::anti_join</code> com um dataset que contém essas palavras, conhecidas como
‘stop words’.</p><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=n>got_words</span> <span class=o>&lt;-</span> <span class=n>got_words</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>anti_join</span><span class=p>(</span><span class=n>stop_words</span><span class=p>)</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>## Joining, by = &quot;word&quot;
</code></pre><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=n>got_words</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>count</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>sort</span> <span class=o>=</span> <span class=bp>T</span><span class=p>)</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>## # A tibble: 9,079 x 2
##    word        n
##    &lt;chr&gt;   &lt;int&gt;
##  1 lord     1133
##  2 king      831
##  3 father    693
##  4 grace     517
##  5 time      513
##  6 lady      510
##  7 north     412
##  8 stark     409
##  9 people    394
## 10 brother   393
## # ... with 9,069 more rows
</code></pre><p>E aqui vemos algo mais específico de GOT, mas essas palavras são assim tão
frequentes por serem pronomes de tratamento de GOT, são as stop words desse
universo. Por isso, achei prudente retirá-las.</p><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=n>got_stop_words</span> <span class=o>&lt;-</span> <span class=nf>c</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;father&#34;</span><span class=p>,</span> <span class=s>&#34;mother&#34;</span><span class=p>,</span> <span class=s>&#34;queen&#34;</span><span class=p>,</span> <span class=s>&#34;king&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;boy&#34;</span><span class=p>,</span> <span class=s>&#34;girl&#34;</span><span class=p>,</span> <span class=s>&#34;lord&#34;</span><span class=p>,</span> <span class=s>&#34;lady&#34;</span><span class=p>,</span> <span class=s>&#34;son&#34;</span><span class=p>,</span> <span class=s>&#34;sister&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;grace&#34;</span><span class=p>,</span> <span class=s>&#34;ser&#34;</span><span class=p>,</span> <span class=s>&#34;brother&#34;</span><span class=p>,</span> <span class=s>&#34;sister&#34;</span><span class=p>,</span> <span class=s>&#34;king&#39;s&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>got_words</span> <span class=o>&lt;-</span> <span class=n>got_words</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>filter</span><span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=n>word</span> <span class=o>%in%</span> <span class=n>got_stop_words</span><span class=p>))</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>add_count</span><span class=p>(</span><span class=n>word</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>got_words</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>count</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>sort</span> <span class=o>=</span> <span class=bp>T</span><span class=p>)</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>## # A tibble: 9,065 x 2
##    word       n
##    &lt;chr&gt;  &lt;int&gt;
##  1 time     513
##  2 north    412
##  3 stark    409
##  4 people   394
##  5 dead     375
##  6 kill     349
##  7 fight    313
##  8 told     295
##  9 die      284
## 10 life     278
## # ... with 9,055 more rows
</code></pre><p>E aqui as coisas começam a ficar interessantes!</p><p>A
<a href=./got_words.csv rel=external>base limpa com essas palavras pode ser baixada aqui<span class="ml-1 [&_svg]:inline-block [&_svg]:h-[1em] [&_svg]:w-[1em] [&_svg]:align-text-top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
</span></a>.</p><h2 class="mb-8 mt-4 pt-4" id=correlação-entre-as-palavras>Correlação entre as palavras
<a class="text-primary border-0" href=#correla%c3%a7%c3%a3o-entre-as-palavras>#</a></h2><p>Agora, vamos visualizar quais as palavras que aparecem juntas com mais
frequência, com a função <code>pairwise_cor</code> do pacote <code>widyr</code>.</p><p>Só precisamos filtrar nossa base antes, porque não queremos que o R compare cada
par de 81579 palavras: escolheremos as palavras que apareçam 50 vezes ou mais.</p><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=nf>library</span><span class=p>(</span><span class=n>widyr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>word_pairs</span> <span class=o>&lt;-</span> <span class=n>got_words</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>add_count</span><span class=p>(</span><span class=n>word</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>filter</span><span class=p>(</span><span class=n>n</span> <span class=o>&gt;=</span> <span class=m>50</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>pairwise_cor</span><span class=p>(</span><span class=n>word</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>rowname</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>sort</span> <span class=o>=</span> <span class=bp>T</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>word_pairs</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>## # A tibble: 109,892 x 3
##    item1    item2    correlation
##    &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
##  1 color    font           0.968
##  2 font     color          0.968
##  3 rock     casterly       0.908
##  4 casterly rock           0.908
##  5 watch    night's        0.674
##  6 night's  watch          0.674
##  7 white    walkers        0.639
##  8 walkers  white          0.639
##  9 jon      snow           0.540
## 10 snow     jon            0.540
## # ... with 109,882 more rows
</code></pre><p>Dentre alguns resultado interessantes, nos deparamos com um bastante anormal.
color font? font color? Isso é código HTML usado para formatação que acabou
entrando no documento, que eventualmente serão ignoradas.</p><p>Para visualizar essas relações, vamos usar grafos. Nele as palavras são nós e os
vértices as corrrelações (um vértice mais escuro indica uma correlação mais
alta), teremos assim uma network dos top 100 par de palavras mais
correlacionados entre si.</p><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=nf>library</span><span class=p>(</span><span class=n>ggraph</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>library</span><span class=p>(</span><span class=n>igraph</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>set.seed</span><span class=p>(</span><span class=m>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>word_pairs</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>filter</span><span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=n>item1</span> <span class=o>%in%</span> <span class=nf>c</span><span class=p>(</span><span class=s>&#34;font&#34;</span><span class=p>,</span> <span class=s>&#34;color&#34;</span><span class=p>,</span> <span class=s>&#34;game&#34;</span><span class=p>)))</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>top_n</span><span class=p>(</span><span class=m>100</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>graph_from_data_frame</span><span class=p>()</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>ggraph</span><span class=p>(</span><span class=n>layout</span> <span class=o>=</span> <span class=s>&#34;fr&#34;</span><span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>geom_edge_link</span><span class=p>(</span><span class=nf>aes</span><span class=p>(</span><span class=n>edge_alpha</span> <span class=o>=</span> <span class=n>correlation</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>show.legend</span> <span class=o>=</span> <span class=bp>F</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>geom_node_point</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>color</span> <span class=o>=</span> <span class=s>&#34;skyblue&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>size</span> <span class=o>=</span> <span class=m>3</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>geom_node_text</span><span class=p>(</span><span class=nf>aes</span><span class=p>(</span><span class=n>label</span> <span class=o>=</span> <span class=n>name</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>repel</span> <span class=o>=</span> <span class=bp>T</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>theme_void</span><span class=p>()</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><figure><picture><source srcset=https://phelipetls.github.io/pt/posts/game-of-thrones-text-mining/grafo-de-palavras_hu415c4de9f87900c78a93d44386cca5f4_12721_672x480_resize_q75_h2_box_3.webp type=image/webp><img src=./grafo-de-palavras.png alt="Grafo das palavras mais comuns em Game of Thrones"></picture><figcaption class="mt-2 px-horizontal-padding text-center"><span>Grafo das palavras mais comuns em Game of Thrones</span></figcaption></figure><h2 class="mb-8 mt-4 pt-4" id=palavras-mais-frequentes>Palavras mais frequentes
<a class="text-primary border-0" href=#palavras-mais-frequentes>#</a></h2><p>Agora, vamos visualizar quais as palavras mais frequentes em geral e por
temporada. Para isso vamos utilizar nuvem de palavras.</p><p>O em geral primeiro. Vamos ver quais são as top 50 palavras em uma nuvem, com a
função <code>wordcloud::wordcloud</code>, que toma como argumentos principais um vetor de
palavras e um de frequências.</p><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=nf>library</span><span class=p>(</span><span class=n>wordcloud</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nf>library</span><span class=p>(</span><span class=n>RColorBrewer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>paleta</span> <span class=o>&lt;-</span> <span class=nf>brewer.pal</span><span class=p>(</span><span class=m>6</span><span class=p>,</span> <span class=s>&#34;Dark2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>set.seed</span><span class=p>(</span><span class=m>99</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>got_words</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>count</span><span class=p>(</span><span class=n>word</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>with</span><span class=p>(</span><span class=nf>wordcloud</span><span class=p>(</span><span class=n>word</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>max.words</span> <span class=o>=</span> <span class=m>50</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>colors</span> <span class=o>=</span> <span class=n>paleta</span>
</span></span><span class=line><span class=cl>  <span class=p>))</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><figure><picture><source srcset=https://phelipetls.github.io/pt/posts/game-of-thrones-text-mining/nuvem-de-palavras_hu802528e548c43673306b2f68b2c4d548_52953_672x480_resize_q75_h2_box_3.webp type=image/webp><img src=./nuvem-de-palavras.png alt="Nuvem de palavras das palavras mais comuns em Game of Thrones"></picture><figcaption class="mt-2 px-horizontal-padding text-center"><span>Nuvem de palavras das palavras mais comuns em Game of Thrones</span></figcaption></figure><p>Agora, vamos ver como isso varia para cada temporada, com o pacote
<code>ggwordcloud</code>.</p><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=nf>library</span><span class=p>(</span><span class=n>ggwordcloud</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>theme_set</span><span class=p>(</span><span class=nf>theme_minimal</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>got_words</span> <span class=o>&lt;-</span> <span class=n>got_words</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>filter</span><span class=p>(</span><span class=o>!</span><span class=nf>str_detect</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=s>&#34;font|color&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>got_words</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>count</span><span class=p>(</span><span class=n>season</span><span class=p>,</span> <span class=n>word</span><span class=p>,</span> <span class=n>name</span> <span class=o>=</span> <span class=s>&#34;count&#34;</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>group_by</span><span class=p>(</span><span class=n>season</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>top_n</span><span class=p>(</span><span class=m>20</span><span class=p>,</span> <span class=n>count</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>ggplot</span><span class=p>(</span><span class=nf>aes</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>label</span> <span class=o>=</span> <span class=n>word</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>size</span> <span class=o>=</span> <span class=n>count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>color</span> <span class=o>=</span> <span class=n>count</span> <span class=o>%&gt;%</span> <span class=nf>as.numeric</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>))</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>geom_text_wordcloud</span><span class=p>(</span><span class=n>rm_outside</span> <span class=o>=</span> <span class=bp>T</span><span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>scale_size_area</span><span class=p>(</span><span class=n>max_size</span> <span class=o>=</span> <span class=m>10</span><span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>scale_color_viridis_c</span><span class=p>()</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>facet_wrap</span><span class=p>(</span><span class=n>. </span><span class=o>~</span> <span class=n>season</span><span class=p>,</span> <span class=n>nrow</span> <span class=o>=</span> <span class=m>3</span><span class=p>,</span> <span class=n>ncol</span> <span class=o>=</span> <span class=m>3</span><span class=p>)</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><figure><picture><source srcset=https://phelipetls.github.io/pt/posts/game-of-thrones-text-mining/nuvem_de_palavras_por_temporada_hu841a9230559c2591f0284ba64123ff4a_129116_1366x728_resize_q75_h2_box_3.webp type=image/webp><img src=./nuvem_de_palavras_por_temporada.png alt="Nuvem de palavras por temporada"></picture><figcaption class="mt-2 px-horizontal-padding text-center"><span>Nuvem de palavras por temporada</span></figcaption></figure><h2 class="mb-8 mt-4 pt-4" id=análise-de-sentimentos>Análise de sentimentos
<a class="text-primary border-0" href=#an%c3%a1lise-de-sentimentos>#</a></h2><p>Outra coisa que é interessante de ser feita é analisar o sentimento médio do
texto, se nele há mais palavras consideradas negativas ou positivas etc.</p><p>Esse é um tópico delicado teoricamente, já que não é algo tão trivial para um
computador deduzir se uma frase expressa um sentimento bom ou ruim. Não vamos
deixar o computador fazer isso, mas usar um léxico que mapeia palavras a
sentimentos, feito por humanos.</p><p>Por exemplo, o léxico <code>afinn</code> classifica algumas mil palavras em uma escala que
varia de -5 (muito negativo) até 5 (muito positivo).</p><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=nf>get_sentiments</span><span class=p>(</span><span class=s>&#34;afinn&#34;</span><span class=p>)</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>## # A tibble: 2,476 x 2
##    word       score
##    &lt;chr&gt;      &lt;int&gt;
##  1 abandon       -2
##  2 abandoned     -2
##  3 abandons      -2
##  4 abducted      -2
##  5 abduction     -2
##  6 abductions    -2
##  7 abhor         -3
##  8 abhorred      -3
##  9 abhorrent     -3
## 10 abhors        -3
## # ... with 2,466 more rows
</code></pre><p>Já esse classifica cada palavra binariamente, em ‘negativa’ ou ‘positiva’,
cobrindo uma porção maior de palavras.</p><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=nf>get_sentiments</span><span class=p>(</span><span class=s>&#34;bing&#34;</span><span class=p>)</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>## # A tibble: 6,788 x 2
##    word        sentiment
##    &lt;chr&gt;       &lt;chr&gt;
##  1 2-faced     negative
##  2 2-faces     negative
##  3 a+          positive
##  4 abnormal    negative
##  5 abolish     negative
##  6 abominable  negative
##  7 abominably  negative
##  8 abominate   negative
##  9 abomination negative
## 10 abort       negative
## # ... with 6,778 more rows
</code></pre><p>Outra base possível de ser usada é essa, que cobre muito mais palavras e
categorias, além de ter mais palavras positivas (em relação às negativas) que a
base &lsquo;bing&rsquo;.</p><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=nf>get_sentiments</span><span class=p>(</span><span class=s>&#34;nrc&#34;</span><span class=p>)</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>## # A tibble: 13,901 x 2
##    word        sentiment
##    &lt;chr&gt;       &lt;chr&gt;
##  1 abacus      trust
##  2 abandon     fear
##  3 abandon     negative
##  4 abandon     sadness
##  5 abandoned   anger
##  6 abandoned   fear
##  7 abandoned   negative
##  8 abandoned   sadness
##  9 abandonment anger
## 10 abandonment fear
## # ... with 13,891 more rows
</code></pre><p>Vamos aplicar a análise de sentimento com as três e ver como elas se
diferenciam.</p><p>Vejamos primeiro quais são as palavras negativas e positivas mais comuns.</p><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=n>got_bing</span> <span class=o>&lt;-</span> <span class=n>got_words</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>filter</span><span class=p>(</span><span class=n>word</span> <span class=o>!=</span> <span class=s>&#34;stark&#34;</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>select</span><span class=p>(</span><span class=o>-</span><span class=n>rowname</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>inner_join</span><span class=p>(</span><span class=nf>get_sentiments</span><span class=p>(</span><span class=s>&#34;bing&#34;</span><span class=p>))</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>## Joining, by = &quot;word&quot;
</code></pre><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=n>got_bing</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>distinct</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>.keep_all</span> <span class=o>=</span> <span class=bp>T</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>group_by</span><span class=p>(</span><span class=n>sentiment</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>top_n</span><span class=p>(</span><span class=m>10</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>ggplot</span><span class=p>(</span><span class=nf>aes</span><span class=p>(</span><span class=nf>fct_reorder</span><span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>n</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>fill</span> <span class=o>=</span> <span class=n>sentiment</span>
</span></span><span class=line><span class=cl>  <span class=p>))</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>geom_col</span><span class=p>(</span><span class=n>show.legend</span> <span class=o>=</span> <span class=bp>F</span><span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>coord_flip</span><span class=p>()</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>facet_wrap</span><span class=p>(</span><span class=n>. </span><span class=o>~</span> <span class=n>sentiment</span><span class=p>,</span> <span class=n>scale</span> <span class=o>=</span> <span class=s>&#34;free_y&#34;</span><span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>labs</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=kc>NULL</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=kc>NULL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span> <span class=o>=</span> <span class=s>&#34;Palavras Negativas e Positivas Mais Comuns&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><figure><picture><source srcset=https://phelipetls.github.io/pt/posts/game-of-thrones-text-mining/palavras-negativas-e-positivas_huec1597bf28bf3b759bcd23c9dfc86ab4_8396_672x480_resize_q75_h2_box_3.webp type=image/webp><img src=./palavras-negativas-e-positivas.png alt="Palavras negativas e positivas"></picture><figcaption class="mt-2 px-horizontal-padding text-center"><span>Palavras negativas e positivas</span></figcaption></figure><p>Agora, vamos fazer isso em por temporada e medir o sentimento médio a cada seção
de n palavras.</p><p>Vamos usar o dataset <code>afinn</code> e uma seção formada por 25 palavras.</p><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=n>got_afinn</span> <span class=o>&lt;-</span> <span class=n>got_words</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>inner_join</span><span class=p>(</span><span class=nf>get_sentiments</span><span class=p>(</span><span class=s>&#34;afinn&#34;</span><span class=p>))</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>select</span><span class=p>(</span><span class=o>-</span><span class=n>rowname</span><span class=p>,</span> <span class=o>-</span><span class=n>n</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>mutate</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>row</span> <span class=o>=</span> <span class=nf>row_number</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=n>section</span> <span class=o>=</span> <span class=n>row</span> <span class=o>%/%</span> <span class=m>25</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>ungroup</span><span class=p>()</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>## Joining, by = &quot;word&quot;
</code></pre><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=n>got_afinn</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>group_by</span><span class=p>(</span><span class=n>season</span><span class=p>,</span> <span class=n>section</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>summarise</span><span class=p>(</span><span class=n>avg_sentiment</span> <span class=o>=</span> <span class=nf>mean</span><span class=p>(</span><span class=n>score</span><span class=p>))</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>ggplot</span><span class=p>(</span><span class=nf>aes</span><span class=p>(</span><span class=n>section</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>avg_sentiment</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>fill</span> <span class=o>=</span> <span class=n>avg_sentiment</span>
</span></span><span class=line><span class=cl>  <span class=p>))</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>geom_col</span><span class=p>(</span><span class=n>show.legend</span> <span class=o>=</span> <span class=bp>F</span><span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>labs</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=s>&#34;Seções&#34;</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=s>&#34;Sentimento médio\n&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span> <span class=o>=</span> <span class=s>&#34;Sentimento médio a cada 25 palavras por temporada&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>scale_fill_gradient2</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>low</span> <span class=o>=</span> <span class=s>&#34;firebrick3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>high</span> <span class=o>=</span> <span class=s>&#34;dodgerblue3&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>facet_wrap</span><span class=p>(</span><span class=n>season</span> <span class=o>~</span> <span class=n>.,</span> <span class=n>scale</span> <span class=o>=</span> <span class=s>&#34;free_x&#34;</span><span class=p>)</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><figure><picture><source srcset=https://phelipetls.github.io/pt/posts/game-of-thrones-text-mining/sentimento-medio-afinn_hu3860712ff7847586b1e1ed5f934c6114_12745_672x480_resize_q75_h2_box_3.webp type=image/webp><img src=./sentimento-medio-afinn.png alt="Sentimento médio, método afinn"></picture><figcaption class="mt-2 px-horizontal-padding text-center"><span>Sentimento médio, método afinn</span></figcaption></figure><p>Em geral, podemos ver que as temporadas foram ficando mais pesadas. Os picos
azuis claros foram ficando cada vez mais raros e os vales vermelhos mais agudos,
chegando a seu clímax na temporada 5, o Walk of Shame.</p><p>Vamos tentar o mesmo com as outras duas bases. Como elas classificam as palavras
binariamente, a ideia é calcular o &lsquo;sentimento líquido&rsquo;, o que se entende pela
diferença no número de palavras positivas e negativas, para cada seção.</p><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=n>got_bing</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>select</span><span class=p>(</span><span class=o>-</span><span class=n>n</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>mutate</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>row</span> <span class=o>=</span> <span class=nf>row_number</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=n>section</span> <span class=o>=</span> <span class=n>row</span> <span class=o>%/%</span> <span class=m>25</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>count</span><span class=p>(</span><span class=n>season</span><span class=p>,</span> <span class=n>episode</span><span class=p>,</span> <span class=n>section</span><span class=p>,</span> <span class=n>sentiment</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>spread</span><span class=p>(</span><span class=n>sentiment</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>fill</span> <span class=o>=</span> <span class=m>0</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>mutate</span><span class=p>(</span><span class=n>net_sentiment</span> <span class=o>=</span> <span class=n>positive</span> <span class=o>-</span> <span class=n>negative</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>ggplot</span><span class=p>(</span><span class=nf>aes</span><span class=p>(</span><span class=n>section</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>net_sentiment</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>fill</span> <span class=o>=</span> <span class=n>net_sentiment</span>
</span></span><span class=line><span class=cl>  <span class=p>))</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>geom_col</span><span class=p>(</span><span class=n>show.legend</span> <span class=o>=</span> <span class=bp>F</span><span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>scale_fill_gradient2</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>low</span> <span class=o>=</span> <span class=s>&#34;firebrick3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>high</span> <span class=o>=</span> <span class=s>&#34;navyblue&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>facet_wrap</span><span class=p>(</span><span class=n>. </span><span class=o>~</span> <span class=n>season</span><span class=p>,</span> <span class=n>scale</span> <span class=o>=</span> <span class=s>&#34;free_x&#34;</span><span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>labs</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=s>&#34;Seções&#34;</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=s>&#34;Sentimento médio\n&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span> <span class=o>=</span> <span class=s>&#34;Sentimento médio a cada 25 palavras por temporada&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>subtitle</span> <span class=o>=</span> <span class=s>&#34;Método Bing&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><figure><picture><source srcset=https://phelipetls.github.io/pt/posts/game-of-thrones-text-mining/sentimento-medio-bing_huafcc91f2c412bcb4edcb300976cfb7e9_12194_672x480_resize_q75_h2_box_3.webp type=image/webp><img src=./sentimento-medio-bing.png alt="Sentimento médio, método bing"></picture><figcaption class="mt-2 px-horizontal-padding text-center"><span>Sentimento médio, método bing</span></figcaption></figure><p>Ok, isso em geral vai de encontro com o que já havíamos visto.</p><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=n>got_nrc</span> <span class=o>&lt;-</span> <span class=n>got_words</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>filter</span><span class=p>(</span><span class=n>word</span> <span class=o>!=</span> <span class=s>&#34;stark&#34;</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>select</span><span class=p>(</span><span class=o>-</span><span class=n>rowname</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>inner_join</span><span class=p>(</span><span class=nf>get_sentiments</span><span class=p>(</span><span class=s>&#34;nrc&#34;</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>    <span class=nf>filter</span><span class=p>(</span><span class=n>sentiment</span> <span class=o>%in%</span> <span class=nf>c</span><span class=p>(</span><span class=s>&#34;negative&#34;</span><span class=p>,</span> <span class=s>&#34;positive&#34;</span><span class=p>)))</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>## Joining, by = &quot;word&quot;
</code></pre><div data-codeblock class="mt-16 [&_pre]:sm:rounded-tl-none
   group relative mb-8 [&_pre]:shadow [&_pre]:shadow-shadow [&_.highlight_pre]:[color-scheme:_dark]"><div data-codeblock-header class="absolute top-0 left-horizontal-padding mx-auto max-w-[calc(100%-var(--horizontal-padding)*2)] -translate-y-full overflow-hidden sm:left-0"><div class="chroma flex items-center gap-2 rounded-t border-t border-primary px-2 py-1"><div class=shrink-0><div class="h-[24px] w-[24px] [&>svg_*]:fill-current"><svg width="24" height="24" preserveAspectRatio="xMidYMid" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg width=" height="24"><path d="M64 14.648c-35.346.0-64 19.19-64 42.863C0 78.275 22.046 95.589 51.316 99.53V86.699c-15.55-4.89-26.166-14.693-26.166-25.991.0-16.183 21.779-29.303 48.646-29.303 26.866.0 46.693 8.975 46.693 29.303.0 10.486-5.273 17.95-14.066 22.72 1.204.908 2.22 2.072 2.904 3.419l.388.655C121.025 79.772 128 69.189 128 57.51c0-23.672-28.654-42.863-64-42.863zm20.1 74.88c-2.612.257-5.322.41-8.114.462l.002 9.63a88.362 88.362.0 0012.474-2.492l-.501-.941c-.68-1.268-1.347-2.543-2.033-3.807A41.01 41.01.0 0084.1 89.529z"/><path d="M97.469 81.036s3.874 1.169 6.124 2.307c.78.396 2.132 1.184 3.106 2.22a8.388 8.388.0 011.42 2.04l15.266 25.74-24.674.01-11.537-21.666s-2.363-4.06-3.817-5.237c-1.213-.982-1.73-1.331-2.929-1.331h-5.862l.004 28.219-21.834.009V41.263h43.845s19.97.36 19.97 19.359S97.47 81.035 97.47 81.035zm-9.497-24.137-13.218-.009-.006 12.257 13.224-.004s6.124-.019 6.124-6.235c0-6.34-6.124-6.01-6.124-6.01z" fill-rule="evenodd"/></svg width="24" height="24"></div></div><div>R</div></div></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-r data-lang=r><span class=line><span class=cl><span class=n>got_nrc</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>select</span><span class=p>(</span><span class=o>-</span><span class=n>n</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>mutate</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>row</span> <span class=o>=</span> <span class=nf>row_number</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=n>section</span> <span class=o>=</span> <span class=n>row</span> <span class=o>%/%</span> <span class=m>25</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>count</span><span class=p>(</span><span class=n>season</span><span class=p>,</span> <span class=n>episode</span><span class=p>,</span> <span class=n>section</span><span class=p>,</span> <span class=n>sentiment</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>spread</span><span class=p>(</span><span class=n>sentiment</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>fill</span> <span class=o>=</span> <span class=m>0</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>mutate</span><span class=p>(</span><span class=n>net_sentiment</span> <span class=o>=</span> <span class=n>positive</span> <span class=o>-</span> <span class=n>negative</span><span class=p>)</span> <span class=o>%&gt;%</span>
</span></span><span class=line><span class=cl>  <span class=nf>ggplot</span><span class=p>(</span><span class=nf>aes</span><span class=p>(</span><span class=n>section</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>net_sentiment</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>fill</span> <span class=o>=</span> <span class=n>net_sentiment</span>
</span></span><span class=line><span class=cl>  <span class=p>))</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>geom_col</span><span class=p>(</span><span class=n>show.legend</span> <span class=o>=</span> <span class=bp>F</span><span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>scale_fill_gradient2</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>low</span> <span class=o>=</span> <span class=s>&#34;firebrick3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>high</span> <span class=o>=</span> <span class=s>&#34;navyblue&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>facet_wrap</span><span class=p>(</span><span class=n>. </span><span class=o>~</span> <span class=n>season</span><span class=p>,</span> <span class=n>scale</span> <span class=o>=</span> <span class=s>&#34;free_x&#34;</span><span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>  <span class=nf>labs</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=s>&#34;Seções&#34;</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=s>&#34;Sentimento médio\n&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>title</span> <span class=o>=</span> <span class=s>&#34;Sentimento médio a cada 25 palavras por temporada&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>subtitle</span> <span class=o>=</span> <span class=s>&#34;Método NRC&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><figure><picture><source srcset=https://phelipetls.github.io/pt/posts/game-of-thrones-text-mining/sentimento-medio-nrc_hue47fe9bffb951fcc37255b0a5f2e8c15_12418_672x480_resize_q75_h2_box_3.webp type=image/webp><img src=./sentimento-medio-nrc.png alt="Sentimento médio, método NRC"></picture><figcaption class="mt-2 px-horizontal-padding text-center"><span>Sentimento médio, método NRC</span></figcaption></figure><p>Pera! Já esse nos dá quase que o resultado oposto! De fato, por esse método a
série não parece ser tão negativa quanto os outros haviam sugerido. Isso porque
essa base tem muito mais palavras positivas em relação a negativas. Palavras
como &rsquo;land&rsquo;, &lsquo;prince&rsquo; etc. são nela &lsquo;positivas&rsquo;, enquanto que nas outras, não.
Por ter mais palavras, aumentam também o número de seções.</p><p>Enfim, esse é um ponto delicado, incluído aqui somente por ser interessante em
si mesmo.</p></div><aside><div data-toc-wrapper class="w-full sm:overflow-y-auto lg:sticky lg:top-[1rem] lg:max-h-[calc(100vh-1rem)] lg:pb-8 lg:pl-8"><div class="hidden lg:block"><div class="flex justify-between gap-2"><div class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg><h2 class=m-0>Tabela de conteúdo</h2></div><div class="flex items-center transition-transform duration-100 ease-in group-open:rotate-180 lg:hidden"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></div></div><div class="mt-4
[&_a_*]:indent-0
          [&_nav_ol]:m-0
[&_nav_ol]:list-none
          [&_nav_ol]:indent-4
[&_nav_ol_ol]:indent-8
          [&_nav_ol_ol_ol]:indent-12
[&_nav_ol_ol_ol_ol]:indent-16
      [&_nav_ol_li]:relative
          [&_nav_ol_li]:before:absolute
[&_nav_ol_li]:before:top-0
         [&_nav_ol_li]:before:left-0
        [&_nav_ol_li]:before:h-full
        [&_nav_ol_li]:before:w-[1px]
       [&_nav_ol_li]:before:bg-divider
    [&_nav_ol_li]:before:content-['']
  [&_nav_ol_li_a]:block
          [&_nav_ol_li_a]:truncate
[&_nav_ol_li_a]:border-b-0
         [&_nav_ol_li_a]:transition-colors
  [&_nav_ol_li_a]:duration-500
       [&_nav_ol_li_a:hover]:bg-hover
     [&_nav_ol_li[data-active]]:before:bg-primary
[&_nav_ol_li[data-active]>a]:text-primary"><nav data-toc><ol><li><a href=#obtendo-os-dados>Obtendo os dados</a></li><li><a href=#correlação-entre-as-palavras>Correlação entre as palavras</a></li><li><a href=#palavras-mais-frequentes>Palavras mais frequentes</a></li><li><a href=#análise-de-sentimentos>Análise de sentimentos</a></li></ol></nav></div></div><details class="card group mb-8 max-w-prose px-horizontal-padding py-4 lg:hidden" aria-label="Tabela de conteúdo"><summary class=list-none><div class="flex justify-between gap-2"><div class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg><h2 class=m-0>Tabela de conteúdo</h2></div><div class="flex items-center transition-transform duration-100 ease-in group-open:rotate-180 lg:hidden"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></div></div></summary><div class="mt-4
[&_ol]:m-0
          [&_ol]:list-outside
[&_ol]:px-horizontal-padding
       [&_ol_li:not(:first-child)]:mt-1"><nav data-toc><ol><li><a href=#obtendo-os-dados>Obtendo os dados</a></li><li><a href=#correlação-entre-as-palavras>Correlação entre as palavras</a></li><li><a href=#palavras-mais-frequentes>Palavras mais frequentes</a></li><li><a href=#análise-de-sentimentos>Análise de sentimentos</a></li></ol></nav></div></details></div></aside></div></article><div data-theme-copy-code-tooltip role=tooltip class="pointer-events-none absolute rounded border border-divider bg-surface px-2" style=opacity:0>Copiado<div data-theme-copy-code-tooltip-arrow class="absolute h-[8px] w-[8px] rotate-45 border-r border-b border-divider bg-surface"></div></div><hr class="full-width-on-mobile mt-8"><div class="full-width-on-mobile sm:my-8"><nav class="flex items-stretch sm:gap-4" aria-label="Navegação entre posts"><a class="sm:card flex flex-none basis-1/2 flex-col gap-2 border-0 py-4 px-horizontal-padding transition-colors duration-500 hover:bg-hover" href=/pt/posts/visualizacao-dados-homicidios-baltimore/><span class=text-primary><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg></span>Homicídios em Baltimore: visualizações com ggplot2 e gganimate</a><div class="border-l border-divider sm:hidden"></div><a class="sm:card flex flex-none basis-1/2 flex-col-reverse items-end justify-end gap-2 border-0 py-4 px-horizontal-padding text-right transition-colors duration-500 hover:bg-hover" href=/pt/posts/gram-schmidt/>Processo de Gram-Schmidt com NumPy
<span class=text-primary><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span></a></nav></div><hr class="full-width-on-mobile mb-8"><template data-utterances-template><div class="grid place-items-center"><div data-utterances-loading role=progressbar class="[&_svg]:animate-spin [&_svg]:duration-[1500ms]"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-loader"><line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"/><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"/><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"/></svg></div><script src=https://utteranc.es/client.js data-repo=phelipetls/phelipetls.github.io data-issue-term=pathname crossorigin=anonymous data-theme=github-light async></script></div><hr class="mt-8 hidden sm:block"></template></div></main><footer class="mt-8 border-t border-divider bg-background sm:border-0"><div class="mx-auto flex w-full max-w-content flex-col items-center gap-2 px-horizontal-padding pt-4 pb-8 sm:justify-between"><nav aria-label=Contatos class="flex gap-2"><a id=contact-email class="rounded-full hover:bg-hover p-2 [&_svg]:hover:scale-105 [&_svg]:transition-[transform,colors] [&_svg]:duration-500 hover:text-primary border-0" href=mailto:phelipe_teles@hotmail.com aria-label=E-mail><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a><a id=contact-linkedin class="rounded-full hover:bg-hover p-2 [&_svg]:hover:scale-105 [&_svg]:transition-[transform,colors] [&_svg]:duration-500 hover:text-primary border-0" href=https://linkedin.com/in/phelipeteles aria-label=LinkedIn><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-linkedin"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a id=contact-github class="rounded-full hover:bg-hover p-2 [&_svg]:hover:scale-105 [&_svg]:transition-[transform,colors] [&_svg]:duration-500 hover:text-primary border-0" href=https://github.com/phelipetls aria-label=GitHub><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></nav><span class=text-center>Todo conteúdo está sob a licença
<a rel=license href=http://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0</a>.</span></div></footer></div><script src=https://phelipetls.github.io/js/post-bundle.min.js></script></body></html>