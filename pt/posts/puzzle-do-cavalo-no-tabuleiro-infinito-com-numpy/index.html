<!doctype html><html class="scroll-smooth scroll-pt-nav-height sm:scroll-pt-0
h-full text-base selection:bg-on-background selection:text-background sm:text-lg" lang=pt-br><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=deploy-date content="2022-10-02"><meta name=author content="Phelipe Teles"><meta name=color-scheme content="dark light"><style>@font-face{font-family:fira sans;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/fira-sans-v16-latin-regular.woff2)format('woff2')}@font-face{font-family:fira sans;font-style:normal;font-weight:600;font-display:swap;src:url(/fonts/fira-sans-v16-latin-600.woff2)format('woff2')}@font-face{font-family:merriweather;font-style:normal;font-weight:400;font-display:swap;src:url(/fonts/merriweather-v30-latin-regular.woff2)format('woff2')}@font-face{font-family:merriweather;font-style:normal;font-weight:700;font-display:swap;src:url(/fonts/merriweather-v30-latin-700.woff2)format('woff2')}</style><script async defer data-website-id=32b90065-c2a6-4390-9684-dfde99409815 src=https://umami-production-10b2.up.railway.app/main.js></script>
<script type=module defer src=https://phelipetls.github.io/js/bundle.min.js></script><meta name=description content="Desenvolvedor web front-end que escreve sobre a prática da programação e suas ferramentas"><meta name=publish-date content="2019-02-18"><meta name=last-modified-date content="2022-06-16"><meta name=keywords content="numpy,matplotlib"><title>Puzzle do cavalo no tabuleiro infinito com NumPy |
Phelipe Teles</title><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://phelipetls.github.io/pt/posts/puzzle-do-cavalo-no-tabuleiro-infinito-com-numpy/post-image.pt.png"><meta property="og:image" content="https://phelipetls.github.io/pt/posts/puzzle-do-cavalo-no-tabuleiro-infinito-com-numpy/post-image.pt.png"><meta property="og:title" content="Puzzle do cavalo no tabuleiro infinito com NumPy"><meta property="og:description" content="Para estrear o blog, escolhi explorar um puzzle probabilístico, que vi no blog do David Robinson, que consiste em estimar a probabilidade de um cavalo voltar à sua posição inicial após ter saltado aleatoriamente 20 vezes num tabuleiro de xadrez infinito (sendo os 8 possíveis saltos igualmente prováveis)."><meta property="og:type" content="article"><meta property="og:url" content="https://phelipetls.github.io/pt/posts/puzzle-do-cavalo-no-tabuleiro-infinito-com-numpy/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-02-18T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-16T12:32:59-03:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Puzzle do cavalo no tabuleiro infinito com NumPy"><meta name=twitter:description content="Para estrear o blog, escolhi explorar um puzzle probabilístico, que vi no blog do David Robinson, que consiste em estimar a probabilidade de um cavalo voltar à sua posição inicial após ter saltado aleatoriamente 20 vezes num tabuleiro de xadrez infinito (sendo os 8 possíveis saltos igualmente prováveis)."><link rel=stylesheet href="/css/main.min.css"><link rel=stylesheet href=https://phelipetls.github.io/css/vendor/lite-yt-embed.min.css><link rel=stylesheet href=/css/dark-syntax-highlight.min.css></head><body data-preload class="ease duration-250 h-full bg-background font-sans text-on-background transition-colors"><script>(()=>{window.__setTheme=s;var e=o();window.__setTheme(e),window.addEventListener("load",function(){document.body.removeAttribute("data-preload"),t(e)}),window.addEventListener("storage",function(e){const t=e.newValue;e.key==="__theme"&&window.__setTheme(t)});function s(e){if(!e)return;a(e),c(e),t(e)}function c(e){localStorage.setItem("__theme",e)}function o(){return localStorage.getItem("__theme")||"system"}function i(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function n(e){return e==="system"?i():e}function a(e){const t=n(e);document.body.classList.toggle("dark",t==="dark")}function r(e){return new CustomEvent("newTheme",{detail:{themeChoice:e,theme:n(e)}})}function t(e){document.body.dispatchEvent(r(e))}})()</script><div class="relative flex h-full flex-col"><div data-nav-container class="mb-8 w-full"><div class="pt-nav-height sm:hidden"><nav class="card fixed top-0 left-0 z-30 flex w-screen justify-between rounded-none py-4 px-page-padding" aria-label="Navegação principal"><div class="flex flex-row items-center gap-2 overflow-hidden whitespace-nowrap"><a class=border-0 href=https://phelipetls.github.io/pt/posts/><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left"><polyline points="15 18 9 12 15 6"/></svg></a><h2 class="m-0 overflow-hidden overflow-ellipsis font-sans font-normal">Puzzle do cavalo no tabuleiro infinito com NumPy</h2></div><button data-a11y-dialog-show=sidenav class="btn btn-icon" aria-label="Abrir barra de navegação lateral"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></nav></div><div class="hidden h-full sm:block"><div class="mx-auto flex h-full max-w-content items-center justify-between pr-page-padding"><nav class="flex h-full items-center overflow-x-auto px-page-padding" aria-label="Navegação principal"><ul class="m-0 flex h-full list-none flex-row flex-nowrap items-center gap-2 py-3"><li class=h-full><a id=about href=https://phelipetls.github.io/pt/ class="hover:bg-surface
relative
flex
h-full
items-center
justify-center
rounded-md
border-0
px-2
transition-colors
duration-300">Sobre</a></li><li class=h-full><a id=posts href=https://phelipetls.github.io/pt/posts/ aria-current=page class="hover:bg-hover card
relative
flex
h-full
items-center
justify-center
rounded-md
border-0
px-2
transition-colors
duration-300">Posts</a></li><li class=h-full><a id=projects href=https://phelipetls.github.io/pt/projects/ class="hover:bg-surface
relative
flex
h-full
items-center
justify-center
rounded-md
border-0
px-2
transition-colors
duration-300">Projetos</a></li><li class=h-full><a id=resume href=https://phelipetls.github.io/pt/resume/ class="hover:bg-surface
relative
flex
h-full
items-center
justify-center
rounded-md
border-0
px-2
transition-colors
duration-300">Currículo</a></li></ul></nav><div class="h-full py-3"><div class="flex h-full flex-row-reverse items-stretch gap-2 pl-2"><div class="relative flex h-full flex-row items-center"><span class="pointer-events-none absolute left-2 top-1/2 -translate-y-1/2 text-sm"><svg class="feather" viewBox="0 0 24 24" width="24" height="24"><title>Ícone do tema</title><defs><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg><svg id="monitor" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-monitor"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg></defs><use data-theme-select-icon href=#monitor></use></svg></span>
<select class="card h-full appearance-none bg-surface py-1 px-8 text-center" data-theme-select id=theme-select aria-label="Escolha um tema"><option value=light>Claro</option><option value=dark>Escuro</option><option value=system>Sistema</option></select>
<span class="pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></div></div></div></div></div></div><aside data-a11y-dialog=sidenav aria-hidden=true class="fixed z-50 h-full w-full" style=visibility:hidden><div data-a11y-dialog-hide class="fixed inset-0 -z-1 w-full bg-neutral-700 bg-opacity-75 backdrop-blur-sm"></div><div role=document class="ml-auto h-full w-3/4 rounded-none bg-background py-0"><div class="flex h-full flex-col justify-between"><div class="mb-2 flex h-nav-height items-center justify-end px-page-padding"><button data-a11y-dialog-hide class="btn btn-icon" aria-label=Close><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button></div><nav class="flex flex-1 flex-col"><ul class="m-0 flex list-none flex-col items-center justify-center gap-4 px-page-padding"><li class=w-full><a id=about href=https://phelipetls.github.io/pt/ class="hover:bg-surface
block
w-full
rounded-md
border-0
p-2
text-center
text-xl
transition-colors
duration-300">Sobre</a></li><li class=w-full><a id=posts href=https://phelipetls.github.io/pt/posts/ aria-current=page class="card hover:bg-hover
block
w-full
rounded-md
border-0
p-2
text-center
text-xl
transition-colors
duration-300">Posts</a></li><li class=w-full><a id=projects href=https://phelipetls.github.io/pt/projects/ class="hover:bg-surface
block
w-full
rounded-md
border-0
p-2
text-center
text-xl
transition-colors
duration-300">Projetos</a></li><li class=w-full><a id=resume href=https://phelipetls.github.io/pt/resume/ class="hover:bg-surface
block
w-full
rounded-md
border-0
p-2
text-center
text-xl
transition-colors
duration-300">Currículo</a></li></ul></nav><div class="justify-center
mb-4 flex h-12 flex-row items-center px-page-padding"><div class="relative flex h-full flex-row items-center"><span class="pointer-events-none absolute left-2 top-1/2 -translate-y-1/2 text-sm"><svg class="feather" viewBox="0 0 24 24" width="24" height="24"><title>Ícone do tema</title><defs><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg><svg id="monitor" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-monitor"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg></defs><use data-theme-select-icon href=#monitor></use></svg></span>
<select class="card h-full appearance-none bg-surface py-1 px-8 text-center" data-theme-select id=theme-select aria-label="Escolha um tema"><option value=light>Claro</option><option value=dark>Escuro</option><option value=system>Sistema</option></select>
<span class="pointer-events-none absolute right-2 top-1/2 -translate-y-1/2 text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></div></div></div></div></aside><main class="grid grid-cols-layout"><div class="col-full max-w-full rounded-none py-8 px-page-padding shadow-none sm:col-content sm:px-0"><article><header><h1 class="mb-4 text-4xl">Puzzle do cavalo no tabuleiro infinito com NumPy</h1><div class="mb-4 flex flex-col gap-2"><div class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-book-open"><path d="M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"/><path d="M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"/></svg><div>9 min.</div></div><div class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><time datetime=2019-02-18>18 de
Fevereiro</time></div></div><div class="mb-4 flex flex-wrap gap-2"><a href=/pt/tags/numpy/ class="tag whitespace-nowrap">numpy</a>
<a href=/pt/tags/matplotlib/ class="tag whitespace-nowrap">matplotlib</a>
<a href=/pt/tags class=tag aria-label="Todas as tags">...</a></div></header><hr class=my-8><div class="flex flex-col-reverse lg:flex-row"><div data-blog-post class=max-w-prose><p>Para estrear o blog, escolhi explorar um puzzle probabilístico, que vi no
<a href=http://varianceexplained.org/r/knight-chess/ rel=external>blog do David Robinson<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg></a>, que
consiste em estimar a probabilidade de um cavalo voltar à sua posição inicial
após ter saltado aleatoriamente 20 vezes num tabuleiro de xadrez infinito (sendo
os 8 possíveis saltos igualmente prováveis).</p><p>Em seu post, David inteligemente escolhe abordar o problema pelo tidyverse, o
que o permite simular o experimento de maneira eficiente e numa estrutura que
facilita a criação de visualizações do problema com o ggplot2.</p><p>Porém esse aqui não é um post sobre R. Como estou aprendendo Python, achei que
seria interessante tentar fazer a mesma simulação com uma de suas bibliotecas
mais famosas, o Numpy, para praticar e ver se ele cumpre o que promete:
operações vetorizadas e eficientes.</p><h2 class="mb-8 mt-4 pt-4" id=o-que-está-por-trás-da-eficiência-do-numpy>O que está por trás da eficiência do Numpy
<a class="text-primary border-0" href=#o-que-est%c3%a1-por-tr%c3%a1s-da-efici%c3%aancia-do-numpy>#</a></h2><p>O Numpy chega para suprir uma desvantagem que o Python tem por ser uma linguagem
de tipagem dinâmica e de script (não-compilada): ele não é tão bom em fazer
repetidas operações múltiplas vezes. Precisamente o que garante a ele uma
vantagem pelo lado do desenvolvimento de código (uma linguagem solta, fácil de
aprender) é o que compromete sua performance.</p><p>Para ilustrar essa dificuldade, vamos imaginar que queremos somar duas listas de
números elemento por elemento. Uma lista em Python comporta qualquer tipo de
dado (integer, float, string, ou até outras listas), e ele não tem como saber de
antemão que a lista é composta somente de integers, por exemplo. Então, o que
ele fará a cada operação é primeiro verificar o tipo de cada elemento para
depois descobrir que &ldquo;soma&rdquo; ele deve fazer. Porque, por exemplo, somar dois
integers é diferente de somar dois strings:</p><div data-codeblock class="group relative"><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=mi>1</span> <span class=o>+</span> <span class=mi>2</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><div data-codeblock class="group relative"><pre tabindex=0><code>3</code></pre><button data-copy-code-button class="btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><div data-codeblock class="group relative"><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=s2>&#34;1&#34;</span> <span class=o>+</span> <span class=s2>&#34;2&#34;</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>'12'
</code></pre><p>E é esse type-checking uma das razões que acabam retardando muito a operação
como um todo, principalmente quando isso vai se acumulando na casa dos milhões.
Numa linguagem compilada e em que você precisa declarar o tipo de suas
variáveis, isso não seria um problema.</p><p>O que o Numpy faz é, ao invés de verificar o tipo dos elementos cada vez que a
operação for chamada, ele o faz uma vez somente para depois executar a operação
a partir dessa informação (para isso serve o atributo &lsquo;dtype&rsquo; do ndarray - de
n-dimensional array -, a estrutura de dados básica do Numpy). Além disso, as
operações rodam no background em código C.</p><p>O custo disso é que a estrutura básica do Numpy perde a flexibilidade da lista,
já que ele comportará um tipo de dado somente. Mas é um custo que estamos
dispostos a pagar. Por exemplo:</p><div data-codeblock class="group relative"><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>a</span><span class=o>.</span><span class=n>dtype</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>dtype('int32')
</code></pre><p>Se tentarmos incluir um string nesse ndarray, ele será convertido para um
integer:</p><div data-codeblock class="group relative"><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;12&#34;</span>
</span></span><span class=line><span class=cl><span class=n>a</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>array([12,  2,  3,  4])
</code></pre><p>Mas se tentarmos incluir um número complexo, obtemos um erro:</p><div data-codeblock class="group relative"><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>a</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>2</span> <span class=o>+</span> <span class=mi>1</span><span class=n>j</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>---------------------------------------------------------------------------

TypeError                                 Traceback (most recent call last)

&lt;ipython-input-6-65561a8fbe75&gt; in &lt;module&gt;
----&gt; 1 a[0] = 2+1j


TypeError: can't convert complex to int
</code></pre><p>Esse comportamento é muito similar ao vetor do R.</p><h2 class="mb-8 mt-4 pt-4" id=simulando-os-movimentos-do-cavalo>Simulando os movimentos do cavalo
<a class="text-primary border-0" href=#simulando-os-movimentos-do-cavalo>#</a></h2><p>Dito isto, vejamos o que o Numpy pode fazer. Mas antes um esclarecimento</p><ul><li>devo todo o thought process no que diz respeito à modelagem ao Robinson, e
encorajo a todos lendo que confiram o post dele, se não antes, depois de ler
aqui. O único trabalho que tive foi o de escrever o código em Python.</li></ul><p>A ideia de Robinson para a simulação foi imaginar o tabuleiro como um plano
cartesiano, em que o cavalo está no ponto de origem, (0, 0), podendo saltar dali
para oito casas possíveis, com igual probabilidade, respeitando sempre as regras
do xadrez, como na imagem:</p><figure><picture><source srcset=https://phelipetls.github.io/pt/posts/puzzle-do-cavalo-no-tabuleiro-infinito-com-numpy/knight_moves_hu24c45fc18754249a4d44a59f6a0aa8a6_32676_769x768_resize_q75_h2_box_3.webp type=image/webp><img src=./knight_moves.png alt="Um cavalo de xadrez em um tabuleiro, com setas apontando os possíveis movimentos do cavalo no xadrez e suas equivalentes coordenadas em um plano cartesiano"></picture><figcaption><span>Cavalo de xadrez num plano cartesiano</span></figcaption></figure><p>Daí podemos notar que, se o cavalo pular para uma casa de coordenada x, a
coordenada y terá que ser igual a 3 - abs(x). Mas devemos tomar o cuidado para
assegurar que a coordenada y também possa ser negativa.</p><p>Com isso em mente, podemos simular um único salto.</p><div data-codeblock class="group relative"><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># sorteamos um dos números em parênteses para obter o x</span>
</span></span><span class=line><span class=cl><span class=n>x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># e calculamos o y pela relação já descrita</span>
</span></span><span class=line><span class=cl><span class=n>y</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span> <span class=o>-</span> <span class=nb>abs</span><span class=p>(</span><span class=n>x</span><span class=p>))</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>2 1
</code></pre><p>Mas, é claro, não é interessante simular somente um salto. Queremos, na verdade,
20 deles, precisamos de um vetor.</p><div data-codeblock class="group relative"><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>move_x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>2</span><span class=p>),</span> <span class=n>size</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>move_y</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span> <span class=o>-</span> <span class=nb>abs</span><span class=p>(</span><span class=n>move_x</span><span class=p>))</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>),</span> <span class=n>size</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>move_x</span><span class=p>,</span> <span class=n>move_y</span><span class=p>,</span> <span class=n>sep</span><span class=o>=</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>[-2  1 -1  2  1  1  2  2 -1 -2 -2  2 -1  2 -2  2 -1  1  2  1]
[-1  2  2 -1 -2 -2  1 -1  2  1 -1  1  2 -1 -1  1 -2 -2  1  2]
</code></pre><p>Ótimo! Foi bastante simples. É legal observar como funciona a sintaxe do Numpy.
Por ele ser totalmente voltado para operações vetoriais, podemos fazer operações
aritméticas em vetores elemento por elemento sem qualquer for loop, bata
subtrair de 3 o valor absoluto do vetor move_x, como se ele fosse um escalar, e
está feito!</p><p>Agora, sabendo disso, se realmente quisermos computar uma probabilidade, de nada
adianta termos somente uma amostra com vinte saltos aleatórios do cavalo,
precisamos de muitas mais. Vejamos com cem mil vezes mais. Com o Numpy, isso é
bem fácil de ser feito.</p><div data-codeblock class="group relative"><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>move_x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>2</span><span class=p>),</span> <span class=n>size</span><span class=o>=</span><span class=mi>20</span> <span class=o>*</span> <span class=mi>100000</span><span class=p>)</span><span class=o>.</span><span class=n>reshape</span><span class=p>((</span><span class=mi>20</span><span class=p>,</span> <span class=mi>100000</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>move_y</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span> <span class=o>-</span> <span class=nb>abs</span><span class=p>(</span><span class=n>move_x</span><span class=p>))</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>),</span> <span class=n>size</span><span class=o>=</span><span class=mi>20</span> <span class=o>*</span> <span class=mi>100000</span><span class=p>)</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>100000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>move_x</span><span class=p>,</span> <span class=n>move_y</span><span class=p>,</span> <span class=n>sep</span><span class=o>=</span><span class=s2>&#34;</span><span class=se>\n\n</span><span class=s2>&#34;</span><span class=p>)</span>  <span class=c1># sep = &#39;\n\n&#39; serve para espaçar o output do print</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>[[ 1 -2  1 ... -1  2  2]
 [ 1  1 -2 ...  2  2 -2]
 [ 1  2 -1 ... -1  1  1]
 ...
 [-1  1  1 ...  2  2 -2]
 [-1  1  2 ...  1 -1  2]
 [-1 -2  1 ...  2 -2  2]]

[[-2  1 -2 ...  2  1  1]
 [ 2 -2 -1 ...  1 -1 -1]
 [ 2 -1 -2 ...  2  2  2]
 ...
 [-2 -2  2 ...  1  1  1]
 [-2  2 -1 ...  2 -2 -1]
 [-2 -1 -2 ...  1 -1 -1]]
</code></pre><p>No código acima eu primeiro gerei 2 milhões de saltos em um vetor, e depois o
reorganizei como uma matriz 20 x 100.000. Me acostumei a enxergar matrizes como
vários vetores-coluna agrupados, então foi assim que fiz, questão de
preferência. Dessa forma, cada coluna representa uma tentativa e cada linha um
salto.</p><p>Para o próximo passo, queremos descobrir em que posição o cavalo está na medida
em que se move pelo tabuleiro. Podemos fazer isso ao calcular a soma cumulativa
das colunas.</p><p>Para isso, basta utilizarmos o método &lsquo;cumsum&rsquo; do ndarray, com o argumento de
axis igualado a 0, o que quer dizer que ele vai fazer a soma cumulativa &ldquo;down
the rows&rdquo;, linhas abaixo (o 0 é porque a linha é o &ldquo;primeiro&rdquo; elemento do
&ldquo;shape&rdquo; de uma matriz bidimensional, (20, 100000)), o que é justamente o que
queremos, já que interpretamos cada linha como um salto:</p><div data-codeblock class="group relative"><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>position_x</span> <span class=o>=</span> <span class=n>move_x</span><span class=o>.</span><span class=n>cumsum</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>position_y</span> <span class=o>=</span> <span class=n>move_y</span><span class=o>.</span><span class=n>cumsum</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>position_x</span><span class=p>,</span> <span class=n>position_y</span><span class=p>,</span> <span class=n>sep</span><span class=o>=</span><span class=s2>&#34;</span><span class=se>\n\n</span><span class=s2>&#34;</span><span class=p>)</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>[[ 1 -2  1 ... -1  2  2]
 [ 2 -1 -1 ...  1  4  0]
 [ 3  1 -2 ...  0  5  1]
 ...
 [ 4 -5 -8 ...  4 17  3]
 [ 3 -4 -6 ...  5 16  5]
 [ 2 -6 -5 ...  7 14  7]]

[[ -2   1  -2 ...   2   1   1]
 [  0  -1  -3 ...   3   0   0]
 [  2  -2  -5 ...   5   2   2]
 ...
 [ 12  -7 -12 ...   0   9   1]
 [ 10  -5 -13 ...   2   7   0]
 [  8  -6 -15 ...   3   6  -1]]
</code></pre><p>Mas, como o que nos interessa para responder ao problema é somente a última
linha (onde ele parou no plano quando deu o último salto), podemos extrair
somente ela pedindo a linha de indíce -1 de nossa matriz (no Python, -1 equivale
ao último elemento, -2 ao penúltimo etc.).</p><div data-codeblock class="group relative"><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>position_x</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=n>position_y</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=n>sep</span><span class=o>=</span><span class=s2>&#34;</span><span class=se>\n\n</span><span class=s2>&#34;</span><span class=p>)</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>[ 2 -6 -5 ...  7 14  7]

[  8  -6 -15 ...   3   6  -1]
</code></pre><p>Agora, para de fato termos uma estimativa da probabilidade do cavalo voltar à
origem após 20 saltos aleatórios, vamos calcular a frequência relativa desse
evento em cem mil tentativas. Podemos fazer isso da seguinte maneira:</p><div data-codeblock class="group relative"><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>((</span><span class=n>position_x</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>position_y</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>))</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>0.00648
</code></pre><p>Aqui, o que o Numpy fez primeiro foi criar um vetor de booleans, ao comparar os
dois vetores elemento por elemento, retornando Verdadeiro somente quando ambos
foram iguais a zero, caso em que ele retornou para a origem concluído seu random
walk.</p><p>Calculado esse vetor, o que fiz foi pedir sua média, e isso me dá justamente a
frequência relativa do evento de interesse: é a contagem das vezes que o evento
aconteceu (a soma dos verdadeiros, lidos como 1 pelo método &lsquo;mean&rsquo;) sobre o
comprimento do vetor.</p><p>E assim está pronto. Este é um resultado coerente com o obtido por Robinson, o
que é confortante. A probabilidade em questão é de aproximadamente 0.6%; ou
seja, a cada 1000 tentativas, podemos esperar que, em média, em 6 delas o cavalo
voltará à origem após dar 20 saltos aleatórios.</p><p>Podemos ter um relance da distribuição de probabilidades do problema com um
simples histograma, feito com 100 repetições do experimento.</p><div data-codeblock class="group relative"><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=n>matplotlib</span> <span class=n>inline</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># isso é uma list comprehension</span>
</span></span><span class=line><span class=cl><span class=n>knight_probs</span> <span class=o>=</span> <span class=p>[</span><span class=n>knight_infinite_board</span><span class=p>(</span><span class=mi>100000</span><span class=p>)</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>hist</span><span class=p>(</span><span class=n>knight_probs</span><span class=p>,</span> <span class=n>bins</span> <span class=o>=</span> <span class=mi>20</span><span class=p>)</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><figure><picture><source srcset=https://phelipetls.github.io/pt/posts/puzzle-do-cavalo-no-tabuleiro-infinito-com-numpy/histograma_hu6d4b9acb46d5887c708d66cc90ebe86f_3617_381x252_resize_q75_h2_box_3.webp type=image/webp><img src=./histograma.png alt="Histograma mostrando que a probabilidade estimada do cavalo voltar à origem após 20 saltos aleatórios é de 0.6%"></picture><figcaption><span>Histograma mostrando que a probabilidade estimada do cavalo voltar à origem após 20 saltos aleatórios é de 0.6%</span></figcaption></figure><h2 class="mb-8 mt-4 pt-4" id=a-eficiência-em-números>A eficiência em números
<a class="text-primary border-0" href=#a-efici%c3%aancia-em-n%c3%bameros>#</a></h2><p>E, só para coisa não ficar vaga, quão eficiente é o Numpy afinal? Podemos
verificar isso facilmente com o magic command do IPython, o %%timeit. Criei uma
função que toma como argumento qualquer número de tentativas para testarmos o
algoritmo.</p><div data-codeblock class="group relative"><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>knight_infinite_board</span><span class=p>(</span><span class=n>trials</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>move_x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>2</span><span class=p>),</span> <span class=n>size</span><span class=o>=</span><span class=mi>20</span> <span class=o>*</span> <span class=n>trials</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>move_y</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span> <span class=o>-</span> <span class=nb>abs</span><span class=p>(</span><span class=n>move_x</span><span class=p>))</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>),</span> <span class=n>size</span><span class=o>=</span><span class=mi>20</span> <span class=o>*</span> <span class=n>trials</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>position_x</span> <span class=o>=</span> <span class=n>move_x</span><span class=o>.</span><span class=n>reshape</span><span class=p>((</span><span class=mi>20</span><span class=p>,</span> <span class=n>trials</span><span class=p>))</span><span class=o>.</span><span class=n>cumsum</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>position_y</span> <span class=o>=</span> <span class=n>move_y</span><span class=o>.</span><span class=n>reshape</span><span class=p>((</span><span class=mi>20</span><span class=p>,</span> <span class=n>trials</span><span class=p>))</span><span class=o>.</span><span class=n>cumsum</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>((</span><span class=n>position_x</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>position_y</span> <span class=o>==</span> <span class=mi>0</span><span class=p>))</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><div data-codeblock class="group relative"><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>%%</span><span class=n>timeit</span>
</span></span><span class=line><span class=cl><span class=n>knight_infinite_board</span><span class=p>(</span><span class=mi>100000</span><span class=p>)</span> <span class=c1># cem mil tentativas</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>130 ms ± 4.16 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</code></pre><div data-codeblock class="group relative"><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>%%</span><span class=n>timeit</span>
</span></span><span class=line><span class=cl><span class=n>knight_infinite_board</span><span class=p>(</span><span class=mi>1000000</span><span class=p>)</span> <span class=c1># 1 milhão!</span></span></span></code></pre></div><button data-copy-code-button class="dark
btn btn-icon btn-icon-action pointer-events-none absolute right-0 top-3 hidden -translate-x-1/2 bg-surface opacity-0 transition-opacity duration-500 group-hover:pointer-events-auto group-hover:opacity-100" aria-label="Copiar código"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clipboard" id="clipboard"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg></button></div><pre><code>1.15 s ± 97.2 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
</code></pre><p>É extraordinariamente rápido. Mesmo quando se trata de cálculos com uma matriz
de 20 x 1 milhão! E meu computador certamente não ajuda. O mesmo feito no base
Python seria absurdamente mais lento.</p><h2 class="mb-8 mt-4 pt-4" id=conclusões>Conclusões
<a class="text-primary border-0" href=#conclus%c3%b5es>#</a></h2><p>Acho que com esse simples exercício, pudemos mesmo atestar que o Numpy é uma
ferramenta muito útil, garantindo eficiência com uma sintaxe simples e limpa. Há
dentro dele ainda muito mais a ser explorado do que o exposto aqui, incluindo as
mais diversas distribuições probabílistas com np.random, manipulação de matrizes
com np.linalg etc. O numpy é muito usado pelas mais importantes bibliotecas
relacionadas a Data Science e Machine Learning, como pandas e scikit-learn, por
isso um conhecimento apropriado de suas funcionalidades pode ajudar muito se o
objetivo é crescer na área de data science.</p><p>Pretendo trazer outros posts em que o usarei, mas por ora ficarei por aqui.
Espero que tenha sido proveitoso. Toda crítica/sugestão será muito bem-vinda.</p></div><aside class=flex-1><div data-toc-wrapper class="w-full overflow-y-auto lg:sticky lg:top-[1rem] lg:max-h-[calc(100vh-1rem)] lg:pb-8 lg:pl-8"><div class="hidden lg:block"><div class="flex justify-between gap-2"><div class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg><h2 class=m-0>Tabela de conteúdo</h2></div><div class="flex items-center transition-transform duration-100 ease-in group-open:rotate-180 lg:hidden"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></div></div><nav data-toc data-toc-desktop><ol><li><a href=#o-que-está-por-trás-da-eficiência-do-numpy>O que está por trás da eficiência do Numpy</a></li><li><a href=#simulando-os-movimentos-do-cavalo>Simulando os movimentos do cavalo</a></li><li><a href=#a-eficiência-em-números>A eficiência em números</a></li><li><a href=#conclusões>Conclusões</a></li></ol></nav></div><details class="card group mb-8 max-w-prose px-page-padding py-4 lg:hidden" aria-label="Tabela de conteúdo"><summary class=list-none><div class="flex justify-between gap-2"><div class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg><h2 class=m-0>Tabela de conteúdo</h2></div><div class="flex items-center transition-transform duration-100 ease-in group-open:rotate-180 lg:hidden"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></div></div></summary><nav data-toc data-toc-mobile><ol><li><a href=#o-que-está-por-trás-da-eficiência-do-numpy>O que está por trás da eficiência do Numpy</a></li><li><a href=#simulando-os-movimentos-do-cavalo>Simulando os movimentos do cavalo</a></li><li><a href=#a-eficiência-em-números>A eficiência em números</a></li><li><a href=#conclusões>Conclusões</a></li></ol></nav></details></div></aside></div></article><div data-theme-copy-code-tooltip role=tooltip class="pointer-events-none absolute rounded-md border border-divider bg-surface px-2" style=opacity:0>Copiado<div data-theme-copy-code-tooltip-arrow class="absolute h-[8px] w-[8px] rotate-45 border-r border-b border-divider bg-surface"></div></div><hr class=my-8><div class="grid place-items-center"><div data-utterances-loading><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-loader duration-[1500ms] animate-spin"><line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"/><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"/><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"/></svg></div><script data-utterances-client-script src=https://utteranc.es/client.js repo=phelipetls/phelipetls.github.io issue-term=pathname crossorigin=anonymous theme=github-light async></script></div><div class="-mx-page-padding mt-8 sm:mx-0"><hr><nav class="flex items-stretch" aria-label="Navegação entre posts"><div class=flex-grow></div><div class="border-l border-divider"></div><a class="flex flex-none basis-1/2 flex-col-reverse items-end justify-end gap-2 border-0 py-4 px-page-padding text-right transition-colors duration-500 hover:bg-hover" href=/pt/posts/tres-algoritmos-para-a-sequencia-de-fibonacci/>Três algoritmos para a sequência de Fibonacci
<span class=text-primary><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg></span></a></nav><hr></div></div></main><footer class="mt-8 bg-surface shadow-t shadow-shadow sm:bg-background sm:shadow-none"><div class="mx-auto flex w-full max-w-content flex-col items-center gap-4 py-8 px-page-padding sm:justify-between"><nav aria-label=Contatos class="flex gap-4"><a id=contact-email class=border-0 href=mailto:phelipe_teles@hotmail.com aria-label=E-mail><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a><a id=contact-linkedin class=border-0 href=https://linkedin.com/in/phelipeteles aria-label=LinkedIn><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-linkedin"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a id=contact-github class=border-0 href=https://github.com/phelipetls aria-label=GitHub><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></nav><span class=text-center>Todo conteúdo está sob a licença
<a rel=license href=http://creativecommons.org/licenses/by/4.0/>Creative Commons Attribution 4.0</a>.</span></div></footer></div><script src=https://phelipetls.github.io/js/post-bundle.min.js></script></body></html>