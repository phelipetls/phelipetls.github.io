<!DOCTYPE html>
<html class="h-full" lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="description" content="Web scraping pode ficar bem complicado quando a página é dinâmica, você não mais precisa somente carregar o código-fonte da página mas também precisa esperar o JavaScript da página construir a página, que é o caso do site do Reclame Aqui." />
<meta name="deploy-date" content="2022-02-01">
<meta name="publish-date" content="2019-08-18">
<meta name="last-modified-date" content="2019-08-18">
<meta name="author" content="">
<meta name="color-scheme" content="dark light">







  
  
  
  <link rel="stylesheet" href="/css/main.min.css" />
  <link rel="stylesheet" href="/css/light-syntax-highlight.min.css" />
  <link rel="stylesheet" href="/css/dark-syntax-highlight.min.css" disabled />


<title>
  Web Scraping de páginas dinâmicas com Python | Phelipe Teles
</title>

<meta property="og:title" content="Web Scraping de páginas dinâmicas com Python" />
<meta property="og:description" content="Web scraping pode ficar bem complicado quando a página é dinâmica, você não mais precisa somente carregar o código-fonte da página mas também precisa esperar o JavaScript da página construir a página, que é o caso do site do Reclame Aqui." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://phelipetls.github.io/pt/posts/web-scraping-de-paginas-dinamicas/" />
<meta property="article:published_time" content="2019-08-18T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-08-18T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Web Scraping de páginas dinâmicas com Python"/>
<meta name="twitter:description" content="Web scraping pode ficar bem complicado quando a página é dinâmica, você não mais precisa somente carregar o código-fonte da página mas também precisa esperar o JavaScript da página construir a página, que é o caso do site do Reclame Aqui."/>



    
      
    
  </head>

  <body class="px-4 py-8 preload text-normal bg-background flex flex-col container max-w-2xl min-h-full mx-auto transition transition-colors duration-75 ease-out" data-theme="light">
    

    
      
    

    <script>window.__setTheme = function(newTheme) {
  document.body.setAttribute("data-theme", newTheme);
  localStorage.setItem("__theme", newTheme);
  const oldTheme = newTheme === "dark" ? "light" : "dark";
  document
    .querySelector("link[href*='" + oldTheme + "']")
    .setAttribute("disabled", "");
  document
    .querySelector("link[href*='" + newTheme + "']")
    .removeAttribute("disabled");
};

const storedTheme = localStorage.getItem("__theme");

if (storedTheme) {
  window.__setTheme(storedTheme);
} else if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
  window.__setTheme("dark");
}

/* Enable animations */
window.addEventListener("load", function() {
  document.body.classList.remove("preload")
})
</script>

    <header class="mb-16">
  <h1 class="mb-4">
    <div class="flex justify-between">
      <a class="border-0 font-bold" href="https://phelipetls.github.io/pt/">
        Phelipe Teles
      </a>

      <button
        id="theme-button"
        class="text-background bg-primary rounded-lg px-1 ring-divider ring-offset-background focus:ring-offset-2 focus:ring-2"
        aria-label="Mudar tema"
      >
        <svg width="24" height="24" viewBox="0 0 24 24">
          <defs>
            <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><title>Lua</title><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>

            <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><title>Sol</title><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>

          </defs>

          <use id="theme-button-svg-icon" href="#sun" />
        </svg>
      </button>
    </div>
  </h1>

  

  <nav class="flex flex-row flex-wrap gap-2" aria-label="Navegação principal"><a
        id=""
        class="text-normal "
        href="https://phelipetls.github.io/pt/"
      >
        Sobre
      </a><a
        id=""
        class="text-normal "
        href="https://phelipetls.github.io/pt/posts/"
      >
        Posts
      </a><a
        id=""
        class="text-normal "
        href="https://phelipetls.github.io/pt/projects/"
      >
        Projetos
      </a><a
        id="resume-download"
        class="text-normal "
        href="https://phelipetls.github.io/pt/"
      >
        Resumé
      </a></nav>
</header>


    <main class="flex flex-1 flex-col">
      
  <article>
    <h1>Web Scraping de páginas dinâmicas com Python</h1>

    <time datetime="2019-08-18">
      Aug 18, 2019
    </time>

    <div class="sm:flex gap-2 mt-4">
      
  
    <a href="/pt/tags/web-scraping/"class="inline-flex items-center gap-1 no-underline rounded px-3 border border-divider hover:bg-highlight hover:text-background">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag" style="display: inline;"><title>Tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
web-scraping</a>
  
    <a href="/pt/tags/pandas/"class="inline-flex items-center gap-1 no-underline rounded px-3 border border-divider hover:bg-highlight hover:text-background">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag" style="display: inline;"><title>Tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
pandas</a>
  
    <a href="/pt/tags/regex/"class="inline-flex items-center gap-1 no-underline rounded px-3 border border-divider hover:bg-highlight hover:text-background">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag" style="display: inline;"><title>Tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
regex</a>
  
    <a href="/pt/tags/dataviz/"class="inline-flex items-center gap-1 no-underline rounded px-3 border border-divider hover:bg-highlight hover:text-background">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag" style="display: inline;"><title>Tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>
dataviz</a>
  


    </div>

    <hr class="my-8" />

    <p>Web scraping pode ficar bem complicado quando a página é dinâmica, você não mais
precisa somente carregar o código-fonte da página mas também precisa esperar o
JavaScript da página construir a página, que é o caso do site do Reclame Aqui.</p>
<p>Nesses casos, precisamos controlar um navegador remotamente por meio de um <em>web
driver</em>, por exemplo, o <code>geckodriver</code> para o Firefox ou <code>chromedriver</code> para o
Chrome.</p>
<p>Para isso, usamos uma biblioteca a partir da qual podemos instruir este
navegador a fazer o que queremos, por exemplo o <code>Selenium</code>.</p>
<p>Pros meus propósitos, usarei o <code>Selenium</code> para abrir uma URL e extrair alguma
informação na página, tarefa para alguma biblioteca que entenda estrutura HTML e
facilite a extração dos elementos, como a <code>BeautifulSoup</code>.</p>
<p>Utilizo essas duas bibliotecas no script abaixo. E podemos instalá-las com:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">pip3 instal selenium bs4
</code></pre></div><p>Para fazer o crawleamento, criei uma classe que aceita o nome de uma empresa e o
web driver a ser utilizado.</p>
<p>Ela tem o método <code>ReclameAqui.extrair_informacoes(n_paginas)</code> que vai extrair os
links e títulos das reclamações das primeiras <code>n_paginas</code>.</p>
<p>Outro método, o <code>ReclameAqui.extrair_descricoes()</code>, abre cada uma dessas URLs e
extrai as descrições das informações.</p>
<p>Para extrair a informação desejada, nós fazemos o <code>BeautifulSoup</code> &ldquo;entender&rdquo; o
código-fonte primeiro para depois usarmos os métodos para extração de algum
element do HTML.</p>
<p>Por exemplo, para extrair o título e os links das reclamações em cada página,
procuramos por parágrafos que contenham a classe <code>text-detail</code>:
(<code>&lt;p class='text-detail'&gt;&lt;/p&gt;</code>), e depois procuramos elementos <code>a</code>, que contém o
título dentro dele e o link dentro do atributo <code>href</code>.</p>
<p>Já para a descrição, procuramos por um elemento <code>div</code> com a classe
<code>complain-body</code>, e extraímos o texto dentro dele.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span> <span class="k">as</span> <span class="n">bs</span>


<span class="k">class</span> <span class="nc">ReclameAqui</span><span class="p">:</span>

    <span class="n">base_url</span> <span class="o">=</span> <span class="s2">&#34;https://www.reclameaqui.com.br/empresa/&#34;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">empresa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">driver</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">empresa</span> <span class="o">=</span> <span class="n">empresa</span>

    <span class="k">def</span> <span class="nf">extrair_informacoes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_paginas</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">empresa</span> <span class="o">+</span> <span class="s2">&#34;/lista-reclamacoes/?pagina=&#34;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reclamacoes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">titulos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_paginas</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">html</span> <span class="o">=</span> <span class="n">bs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="p">,</span> <span class="s2">&#34;html.parser&#34;</span><span class="p">)</span>

            <span class="n">reclamacoes_html</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&#34;p&#34;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;class&#34;</span><span class="p">:</span> <span class="s2">&#34;text-detail&#34;</span><span class="p">})</span>
            <span class="n">reclamacoes_na_pagina</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">reclamacao</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;|&#34;</span><span class="p">)</span> <span class="k">for</span> <span class="n">reclamacao</span> <span class="ow">in</span> <span class="n">reclamacoes_html</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reclamacoes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">reclamacoes_na_pagina</span><span class="p">)</span>

            <span class="n">titulos_e_links</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span>
                <span class="s2">&#34;a&#34;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;class&#34;</span><span class="p">:</span> <span class="s2">&#34;link-complain-id-complains&#34;</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">titulos</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">titulo</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">titulo</span> <span class="ow">in</span> <span class="n">titulos_e_links</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;href&#34;</span><span class="p">)</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">titulos_e_links</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">extrair_descricoes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">+</span> <span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">links</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">descricoes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">html</span> <span class="o">=</span> <span class="n">bs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="p">,</span> <span class="s2">&#34;html.parser&#34;</span><span class="p">)</span>
            <span class="n">descricao</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&#34;div&#34;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;class&#34;</span><span class="p">:</span> <span class="s2">&#34;complain-body&#34;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">descricoes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">descricao</span><span class="p">)</span>
</code></pre></div><p>Esse código deve funcionar para qualquer empresa contanto que a estrutura do
HTML do ReclameAqui não mude (isto é, o nome das classes e o tipo dos elementos
onde as informações se encontram).</p>


    <hr class="my-8" />

    <nav aria-label="Navegação entre posts">
      <div class="float-left sm:max-w-1/2 flex group gap-2">
        
          <div class="group-hover:text-highlight">
            ←
          </div>

          <a class="border-0" href="/pt/posts/gram-schmidt/" title="Post anterior">
            Processo de Gram-Schmidt com NumPy
          </a>
        
      </div>

      <div class="float-right text-right mt-2 sm:mt-0 sm:max-w-1/2 flex group justify-end gap-2">
        
      </div>
    </nav>
  </article>

    </main>

    <footer class="mt-16 text-center">
  <div>
    Ícones de <a class="text-primary" href="https://feathericons.com/">Feather Icons</a>
  </div>

  <div>Todo conteúdo está sob a licença
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
  Creative Commons Attribution 4.0
</a>
</div>
</footer>


    

    
    

    
      
      
    

    <script src="https://phelipetls.github.io/js/toggle-theme.js"></script>
    <script src="https://phelipetls.github.io/js/resume-download.js"></script>
  </body>
</html>
